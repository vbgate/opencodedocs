---
title: "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°: é«˜å¯ç”¨æ€§æˆ¦ç•¥ | Antigravity-Manager"
sidebarTitle: "ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚ˆã‚Šå®‰å®šã•ã›ã‚‹"
subtitle: "é«˜å¯ç”¨æ€§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°"
description: "Antigravity Manager ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã¨é«˜å¯ç”¨æ€§æˆ¦ç•¥ã‚’å­¦ã³ã¾ã™ã€‚ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€å¤±æ•—æ™‚ã®å†è©¦è¡Œãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã€ã‚·ã‚¹ãƒ†ãƒ å¯ç”¨æ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚"
tags:
  - "å¿œç”¨"
  - "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°"
  - "ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³"
  - "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³"
  - "å¤±æ•—æ™‚å†è©¦è¡Œ"
prerequisite:
  - "start-add-account"
  - "start-proxy-and-first-client"
  - "advanced-config"
order: 3
---
# é«˜å¯ç”¨æ€§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ï¼šãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨å¤±æ•—æ™‚å†è©¦è¡Œ

Antigravity Tools ã‚’ãƒ­ãƒ¼ã‚«ãƒ« AI ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨ã—ã¦ã—ã°ã‚‰ãä½¿ã£ã¦ã„ã‚‹ã¨ã€å¿…ãšåŒã˜å•é¡Œã«ã¶ã¤ã‹ã‚Šã¾ã™ï¼šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå°‘ãªã„ã»ã© 429/401/invalid_grant ãŒç™ºç”Ÿã—ã‚„ã™ãã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå¤šã„ã»ã©ã€Œã©ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå‹•ã„ã¦ã„ã‚‹ã‹ã€ãŒä¸æ˜ç­ã«ãªã‚Šã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã‚‚ä½ä¸‹ã—ã¾ã™ã€‚

ã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã«ã¤ã„ã¦æ˜ç¢ºã«è§£èª¬ã—ã¾ã™ï¼šã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ã©ã†é¸æŠã™ã‚‹ã‹ã€ã€Œã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ã¨ã¯ä½•ã‹ã€ã„ã¤å¼·åˆ¶çš„ã«ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‹ã€ãã—ã¦ã€Œå›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ã€ã‚’ä½¿ã£ã¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã‚’åˆ¶å¾¡å¯èƒ½ã«ã™ã‚‹æ–¹æ³•ã€‚

## å­¦ã‚“ã å¾Œã§ãã‚‹ã“ã¨

- Antigravity Tools ã® 3 ç¨®é¡ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ãŒå®Ÿéš›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ä½•ã‚’ã™ã‚‹ã‹ã‚’ç†è§£ã§ãã‚‹
- ã€Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆï¼ˆsession_idï¼‰ã€ã‚’ã©ã†ç”Ÿæˆã™ã‚‹ã‹ã€ãã—ã¦ãã‚ŒãŒã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã«ã©ã†å½±éŸ¿ã™ã‚‹ã‹ã‚’ç†è§£ã§ãã‚‹
- GUI ã§ã€Œå›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ã€ã‚’æœ‰åŠ¹/ç„¡åŠ¹ã«ã—ã€ã©ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¸Šæ›¸ãã™ã‚‹ã‹ã‚’ç†è§£ã§ãã‚‹
- 429/5xx/invalid_grint ã«é­é‡ã—ãŸã¨ãã€ã‚·ã‚¹ãƒ†ãƒ ãŒã©ã†ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’ãƒãƒ¼ã‚¯ã—ã€ã©ã†å†è©¦è¡Œã—ã€ã„ã¤ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‹ã‚’ç†è§£ã§ãã‚‹

## ç¾åœ¨ã®æ‚©ã¿

- Claude Code ã¾ãŸã¯ OpenAI SDK ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã¨çªç„¶ 429 ã«ãªã‚Šã€å†è©¦è¡Œã™ã‚‹ã¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ãŒä½ä¸‹ã™ã‚‹
- è¤‡æ•°ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒåŒæ™‚ã«ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã€äº’ã„ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹ã‚’ã€Œä¸Šæ›¸ãã€ã™ã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚‹
- ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ãŸã„ãŒã€ç¾åœ¨ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã©ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å‡¦ç†ã•ã‚Œã¦ã„ã‚‹ã‹ã‚ã‹ã‚‰ãªã„
- ã€Œæœ€ã‚‚å®‰å®šã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã ã‘ã‚’ä½¿ã„ãŸã„ãŒã€ã‚·ã‚¹ãƒ†ãƒ ãŒå¸¸ã«ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ã„ã‚‹

## ã“ã®æ–¹æ³•ã‚’ã„ã¤ä½¿ã†ã‹

- ã€Œå®‰å®šæ€§ï¼ˆã‚¨ãƒ©ãƒ¼ã‚’æ¸›ã‚‰ã™ã“ã¨ï¼‰ã€ã¨ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆï¼ˆåŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰ã€ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ãŒå¿…è¦ãªå ´åˆ
- åŒã˜ä¼šè©±ã‚’ã§ãã‚‹ã ã‘åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å†åˆ©ç”¨ã—ãŸã„å ´åˆï¼ˆPrompt Caching ã®æºã‚‰ãã‚’æ¸›ã‚‰ã™ï¼‰
- ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹/ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã„ã€ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç‰¹å®šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å›ºå®šã—ãŸã„å ´åˆ

## ğŸ’ å§‹ã‚ã‚‹å‰ã®æº–å‚™

1) å°‘ãªãã¨ã‚‚ 2 ã¤ã®åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æº–å‚™ã—ã¦ãã ã•ã„ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ—ãƒ¼ãƒ«ãŒå°ã•ã„ã»ã©ã€ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½™åœ°ãŒå°ã•ããªã‚Šã¾ã™ï¼‰
2) ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ï¼ˆã€ŒAPI Proxyã€ãƒšãƒ¼ã‚¸ã§ Running çŠ¶æ…‹ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼‰
3) è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’çŸ¥ã£ã¦ã„ã‚‹ã“ã¨ï¼ˆæ‰‹å‹•ã§è¨­å®šã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆï¼‰

::: tip ã¾ãšè¨­å®šã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¬ãƒƒã‚¹ãƒ³ã‚’è£œå®Œã—ã¦ãã ã•ã„
`gui_config.json` ã¨ã©ã®è¨­å®šãŒãƒ›ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå¯èƒ½ã‹ã‚’ã¾ã ã‚ˆãçŸ¥ã‚‰ãªã„å ´åˆã¯ã€å…ˆã« **[è¨­å®šå®Œå…¨è§£èª¬ï¼šAppConfig/ProxyConfigã€æ°¸ç¶šåŒ–å ´æ‰€ã¨ãƒ›ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®æ„å‘³](/ja/lbjlaq/Antigravity-Manager/advanced/config/)** ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
:::

## ã‚³ã‚¢ã‚³ãƒ³ã‚»ãƒ—ãƒˆï¼šä¸€å›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã©ã®ã‚ˆã†ãªã€Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã€å±¤ã‚’é€šéã™ã‚‹ã‹

ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã¯ã€Œå˜ä¸€ã®ã‚¹ã‚¤ãƒƒãƒã€ã§ã¯ãªãã€ã„ãã¤ã‹ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ãŒé‡ãªã£ã¦ã„ã¾ã™ï¼š

1) **SessionManager ãŒæœ€åˆã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆï¼ˆsession_idï¼‰ã‚’å‰²ã‚Šå½“ã¦ã¾ã™**
2) **Handlers ã¯å†è©¦è¡Œã™ã‚‹ãŸã³ã« TokenManager ã«å¼·åˆ¶çš„ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¦æ±‚ã—ã¾ã™**ï¼ˆ`attempt > 0`ï¼‰
3) **TokenManager ã¯æ¬¡ã®é †åºã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é¸æŠã—ã¾ã™ï¼šå›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆ â†’ ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ â†’ 60ç§’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ â†’ ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³**
4) **429/5xx ã«é­é‡ã™ã‚‹ã¨ãƒ¬ãƒ¼ãƒˆåˆ¶é™æƒ…å ±ã‚’è¨˜éŒ²ã—ã€å¾Œç¶šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠã§ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç©æ¥µçš„ã«ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™**

### ã€Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆï¼ˆsession_idï¼‰ã€ã¨ã¯ï¼Ÿ

**ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ**ã¯ã€Œã§ãã‚‹ã ã‘å®‰å®šã—ãŸ Session Keyã€ã§ã€åŒã˜ä¼šè©±ã®è¤‡æ•°ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

Claude ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯ã€å„ªå…ˆé †ä½ã¯æ¬¡ã®é€šã‚Šã§ã™ï¼š

1) `metadata.user_id`ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæ˜ç¤ºçš„ã«æ¸¡ã—ã€ã‹ã¤ç©ºã§ã¯ãªãã€ã‹ã¤ `"session-"` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å«ã¾ãªã„ã‚‚ã®ï¼‰
2) æœ€åˆã®ã€Œååˆ†ã«é•·ã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ SHA256 ãƒãƒƒã‚·ãƒ¥ã—ã¦ã€`sid-xxxxxxxxxxxxxxxx` ã«åˆ‡ã‚Šè©°ã‚ãŸã‚‚ã®

å¯¾å¿œã™ã‚‹å®Ÿè£…ï¼š`src-tauri/src/proxy/session_manager.rs`ï¼ˆClaude/OpenAI/Gemini ã«ã¯ãã‚Œãã‚Œã®æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

::: info å°ã•ãªè©³ç´°ï¼šãªãœæœ€åˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã ã‘ã‚’è¦‹ã‚‹ã®ã‹ï¼Ÿ
ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã¯ã€Œæœ€åˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿ã‚’ãƒãƒƒã‚·ãƒ¥ã—ã€ãƒ¢ãƒ‡ãƒ«åã‚„ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ··ãœãªã„ã€ã¨æ˜è¨˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€åŒã˜ä¼šè©±ã®è¤‡æ•°ã®ãƒ©ã‚¦ãƒ³ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã§ãã‚‹ã ã‘åŒã˜ session_id ã‚’ç”Ÿæˆã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚
:::

### TokenManager ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠå„ªå…ˆé †ä½

TokenManager ã®ã‚³ã‚¢ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã¯ï¼š

- `TokenManager::get_token(quota_group, force_rotate, session_id, target_model)`

ãã®å‡¦ç†ã¯å„ªå…ˆé †ä½ã§ç†è§£ã§ãã¾ã™ï¼š

1) **å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆFixed Accountï¼‰**ï¼šGUI ã§ã€Œå›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ã€ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ï¼ˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ è¨­å®šï¼‰å ´åˆã€ãã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãƒ¬ãƒ¼ãƒˆåˆ¶é™ã•ã‚Œã¦ãŠã‚‰ãšã€ã‚¯ã‚©ãƒ¼ã‚¿ä¿è­·ã«ã‚‚è¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€ç›´æ¥ãã‚Œã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
2) **ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆSession Bindingï¼‰**ï¼š`session_id` ãŒã‚ã‚Šã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ãŒ `PerformanceFirst` ã§ãªã„å ´åˆã€ãã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒã‚¤ãƒ³ãƒ‰ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å„ªå…ˆçš„ã«å†åˆ©ç”¨ã—ã¾ã™ã€‚
3) **60ç§’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å†åˆ©ç”¨**ï¼š`session_id` ãŒæ¸¡ã•ã‚Œã¦ã„ãªã„ï¼ˆã¾ãŸã¯ãƒã‚¤ãƒ³ãƒ‰ã«æˆåŠŸã—ã¦ã„ãªã„ï¼‰å ´åˆã€`PerformanceFirst` ä»¥å¤–ã§ã¯ 60 ç§’ä»¥å†…ã«ã€Œæœ€å¾Œã«ä½¿ç”¨ã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã‚’ã§ãã‚‹ã ã‘å†åˆ©ç”¨ã—ã¾ã™ã€‚
4) **ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ï¼ˆRound-robinï¼‰**ï¼šä¸Šè¨˜ãŒé©ç”¨ã§ããªã„å ´åˆã€ã‚°ãƒ­ãƒ¼ãƒãƒ«è‡ªå‹•ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«å¾“ã£ã¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã§é¸æŠã—ã¾ã™ã€‚

ã•ã‚‰ã« 2 ã¤ã®ã€Œè¦‹ãˆãªã„ãƒ«ãƒ¼ãƒ«ã€ãŒã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã«å¤§ããå½±éŸ¿ã—ã¾ã™ï¼š

- **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯æœ€åˆã«ã‚½ãƒ¼ãƒˆã•ã‚Œã¾ã™**ï¼šULTRA > PRO > FREEã€åŒã˜ãƒ†ã‚£ã‚¢å†…ã§ã¯æ®‹ã‚Šã‚¯ã‚©ãƒ¼ã‚¿ãŒé«˜ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå„ªå…ˆã•ã‚Œã¾ã™ã€‚
- **å¤±æ•—ã¾ãŸã¯ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã™**ï¼šå¤±æ•—ã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ `attempted` é›†åˆã«å…¥ã‚Šã¾ã™ã€‚ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¨ãƒãƒ¼ã‚¯ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚

### 3 ç¨®é¡ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã®é•ã„ã¯ä½•ã‹

è¨­å®šã§ã¯ã€æ¬¡ã®ã‚‚ã®ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š`CacheFirst` / `Balance` / `PerformanceFirst`ã€‚

ã€Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ TokenManager ã®å®Ÿéš›ã®åˆ†å²ã€ã‚’åŸºæº–ã«ã™ã‚‹ã¨ã€é‡è¦ãªé•ã„ã¯ 1 ã¤ã ã‘ã§ã™ï¼š**ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ 60ç§’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å†åˆ©ç”¨ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ã©ã†ã‹**ã€‚

- `PerformanceFirst`ï¼šã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ 60ç§’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å†åˆ©ç”¨ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€ç›´æ¥ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã‚’è¡Œã„ã¾ã™ï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™/ã‚¯ã‚©ãƒ¼ã‚¿ä¿è­·ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚‚å¼•ãç¶šãã‚¹ã‚­ãƒƒãƒ—ï¼‰ã€‚
- `CacheFirst` / `Balance`ï¼šã©ã¡ã‚‰ã‚‚ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ 60ç§’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å†åˆ©ç”¨ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚

::: warning max_wait_seconds ã«ã¤ã„ã¦
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰/è¨­å®šæ§‹é€ ã«ã¯ `max_wait_seconds` ãŒã‚ã‚Šã€UI ã§ã¯ `CacheFirst` ã®ã¿èª¿æ•´å¯èƒ½ã§ã™ã€‚ã—ã‹ã—ã€ç¾åœ¨ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã¯ `mode` ã®åˆ†å²ã«åŸºã¥ã„ã¦ãŠã‚Šã€`max_wait_seconds` ã‚’èª­ã¿å–ã£ã¦ã„ã¾ã›ã‚“ã€‚
:::

### å¤±æ•—æ™‚å†è©¦è¡Œã¨ã€Œå¼·åˆ¶çš„ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€ã¯ã©ã†é€£å‹•ã™ã‚‹ã‹

OpenAI/Gemini/Claude ã® handler ã§ã¯ã€æ¬¡ã®ã‚ˆã†ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã§å†è©¦è¡Œã‚’å‡¦ç†ã—ã¾ã™ï¼š

- 1 å›ç›®ã®è©¦è¡Œï¼š`force_rotate = false`
- 2 å›ç›®ä»¥é™ï¼š`force_rotate = true`ï¼ˆ`attempt > 0`ï¼‰ã€TokenManager ã¯ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼å†åˆ©ç”¨ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€æ¬¡ã®åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç›´æ¥æ¤œç´¢ã—ã¾ã™

429/529/503/500 ãªã©ã®ã‚¨ãƒ©ãƒ¼ã«é­é‡ã—ãŸã¨ãï¼š

- handler ã¯ `token_manager.mark_rate_limited(...)` ã‚’å‘¼ã³å‡ºã—ã¦ã€ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ã€Œãƒ¬ãƒ¼ãƒˆåˆ¶é™/éè² è·ã€ã¨ã—ã¦è¨˜éŒ²ã—ã€å¾Œç¶šã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã§ç©æ¥µçš„ã«ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚
- OpenAI äº’æ›ãƒ‘ã‚¹ã§ã¯ã€ã‚¨ãƒ©ãƒ¼ JSON ã‹ã‚‰ `RetryInfo.retryDelay` ã¾ãŸã¯ `quotaResetDelay` ã‚’è§£æã—ã‚ˆã†ã¨ã—ã€å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã‚’ç¶šã‘ã¾ã™ã€‚

## ã•ã‚ã‚„ã£ã¦ã¿ã‚ˆã†ï¼šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã‚’ã€Œåˆ¶å¾¡å¯èƒ½ã€ã«ã™ã‚‹

### ã‚¹ãƒ†ãƒƒãƒ— 1ï¼šæœ¬å½“ã«ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ—ãƒ¼ãƒ«ã€ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹

**ç†ç”±**
ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãŒé«˜åº¦ã§ã‚‚ã€ãƒ—ãƒ¼ãƒ«ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒ 1 ã¤ã—ã‹ãªã„ã¨é¸æŠã®ä½™åœ°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã€Œãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹ã«ãªã‚‰ãªã„/ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚’æ„Ÿã˜ã‚‰ã‚Œãªã„ã€å¤šãã®æ ¹æœ¬åŸå› ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå°‘ãªã™ãã‚‹ã“ã¨ã§ã™ã€‚

**æ“ä½œ**
ã€ŒAccountsã€ãƒšãƒ¼ã‚¸ã‚’é–‹ãã€å°‘ãªãã¨ã‚‚ 2 ã¤ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒåˆ©ç”¨å¯èƒ½ãªçŠ¶æ…‹ï¼ˆdisabled / proxy disabled ã§ã¯ãªã„ï¼‰ã«ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

**ç¢ºèªã™ã¹ãã‚‚ã®**ï¼šå°‘ãªãã¨ã‚‚ 2 ã¤ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒæ­£å¸¸ã«ã‚¯ã‚©ãƒ¼ã‚¿ã‚’æ›´æ–°ã§ãã€ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·èµ·å‹•å¾Œã« `active_accounts` ãŒ 0 ã§ã¯ãªã„ã“ã¨ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 2ï¼šGUI ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã™ã‚‹

**ç†ç”±**
ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã¯ã€ŒåŒã˜ä¼šè©±ã€ã‚’ã§ãã‚‹ã ã‘åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å†åˆ©ç”¨ã™ã‚‹ã‹ã€æ¯å›ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã™ã‚‹ã‹ã‚’æ±ºå®šã—ã¾ã™ã€‚

**æ“ä½œ**
ã€ŒAPI Proxyã€ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã€ã€ŒAccount Scheduling & Rotationã€ã‚«ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ã¦ã€æ¬¡ã®ãƒ¢ãƒ¼ãƒ‰ã® 1 ã¤ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š

- `Balance`ï¼šæ¨å¥¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€‚ã»ã¨ã‚“ã©ã®å ´åˆã‚ˆã‚Šå®‰å®šã—ã¦ã„ã¾ã™ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ + å¤±æ•—æ™‚ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã€‚
- `PerformanceFirst`ï¼šåŒæ™‚å®Ÿè¡Œæ€§ãŒé«˜ãã€ã‚¿ã‚¹ã‚¯ãŒçŸ­ãã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ˆã‚Šã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’é‡è¦–ã™ã‚‹å ´åˆã«é¸æŠã—ã¾ã™ã€‚
- `CacheFirst`ï¼šã€Œä¼šè©±ã‚’ã§ãã‚‹ã ã‘å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã«ã—ãŸã„å ´åˆã€ã“ã‚Œã‚’é¸æŠã§ãã¾ã™ï¼ˆç¾åœ¨ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ `Balance` ã¨å‹•ä½œã®é•ã„ãŒã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚

æ‰‹å‹•ã§è¨­å®šã‚’å¤‰æ›´ã™ã‚‹å ´åˆã€å¯¾å¿œã™ã‚‹ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã¯ï¼š

```json
{
  "proxy": {
    "scheduling": {
      "mode": "Balance",
      "max_wait_seconds": 60
    }
  }
}
```

**ç¢ºèªã™ã¹ãã‚‚ã®**ï¼šãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ã€ã™ãã« `gui_config.json` ã«æ›¸ãè¾¼ã¾ã‚Œã€ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè¡Œæ™‚ã«ç›´æ¥æœ‰åŠ¹ã«ãªã‚Šã¾ã™ï¼ˆå†èµ·å‹•ä¸è¦ï¼‰ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 3ï¼šã€Œå›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ã€ã‚’æœ‰åŠ¹ã«ã™ã‚‹ï¼ˆãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚ªãƒ•ã«ã™ã‚‹ï¼‰

**ç†ç”±**
ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã€ã¾ãŸã¯ç‰¹å®šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç‰¹å®šã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã€Œå›ºå®šã€ã•ã›ãŸã„å ´åˆã€å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ãŒæœ€ã‚‚ç›´æ¥çš„ãªæ‰‹æ®µã§ã™ã€‚

**æ“ä½œ**
åŒã˜ã‚«ãƒ¼ãƒ‰ã§ã€ŒFixed Account Modeã€ã‚’é–‹ãã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚

ãŠå¿˜ã‚Œãªãï¼šã“ã®ã‚¹ã‚¤ãƒƒãƒã¯ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒ“ã‚¹ãŒ Running ã®æ™‚ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ã€‚

**ç¢ºèªã™ã¹ãã‚‚ã®**ï¼šå¾Œç¶šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã™ã¹ã¦å„ªå…ˆçš„ã«ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ãã‚ŒãŒãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¾ãŸã¯ã‚¯ã‚©ãƒ¼ã‚¿ä¿è­·ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚

::: info å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ è¨­å®š
å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ã¯**ãƒ©ãƒ³ã‚¿ã‚¤ãƒ çŠ¶æ…‹**ï¼ˆGUI ã¾ãŸã¯ API ã§å‹•çš„ã«è¨­å®šï¼‰ã§ã‚ã‚Šã€`gui_config.json` ã«ã¯æ°¸ç¶šåŒ–ã•ã‚Œã¾ã›ã‚“ã€‚ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•ã™ã‚‹ã¨ã€å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ç©ºã«æˆ»ã‚Šã¾ã™ï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚Šã¾ã™ï¼‰ã€‚
:::

### ã‚¹ãƒ†ãƒƒãƒ— 4ï¼šå¿…è¦ã«å¿œã˜ã¦ã€Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã€ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹

**ç†ç”±**
ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ `session_id -> account_id` ã‚’ãƒ¡ãƒ¢ãƒªã«è¨˜éŒ²ã—ã¾ã™ã€‚åŒã˜ãƒã‚·ãƒ³ã§ç•°ãªã‚‹å®Ÿé¨“ã‚’è¡Œã£ã¦ã„ã‚‹å ´åˆï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ—ãƒ¼ãƒ«ã®åˆ‡ã‚Šæ›¿ãˆã€ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆãªã©ï¼‰ã€å¤ã„ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŒè¦³å¯Ÿã‚’å¦¨å®³ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**æ“ä½œ**
ã€ŒAccount Scheduling & Rotationã€ã‚«ãƒ¼ãƒ‰ã®å³ä¸Šéš…ã§ã€ŒClear bindingsã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚

**ç¢ºèªã™ã¹ãã‚‚ã®**ï¼šå¤ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å†å‰²ã‚Šå½“ã¦ã—ã¾ã™ï¼ˆæ¬¡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯å†åº¦ãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œã¾ã™ï¼‰ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 5ï¼šãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã§ã€Œã©ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¦ã„ã‚‹ã‹ã€ã‚’ç¢ºèªã™ã‚‹

**ç†ç”±**
ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãŒæœŸå¾…é€šã‚Šã‹ã‚’ç¢ºèªã—ãŸã„å ´åˆã€æœ€ã‚‚ä¿¡é ¼ã§ãã‚‹æ–¹æ³•ã¯ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã•ã‚ŒãŸã€Œç¾åœ¨ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè­˜åˆ¥å­ã€ã‚’å–å¾—ã™ã‚‹ã“ã¨ã§ã™ã€‚

**æ“ä½œ**
OpenAI äº’æ›ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«éã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã® `X-Account-Email` ã‚’è¦³å¯Ÿã—ã¦ãã ã•ã„ã€‚

```bash
  # ä¾‹ï¼šæœ€å°é™ã® OpenAI Chat Completions ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  # æ³¨æ„ï¼šmodel ã¯ç¾åœ¨ã®è¨­å®šã§åˆ©ç”¨å¯èƒ½/ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«åã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
curl -i "http://127.0.0.1:8045/v1/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-REPLACE_ME" \
  -d '{
    "model": "gemini-3-pro-high",
    "stream": false,
    "messages": [{"role": "user", "content": "hello"}]
  }'
```

**ç¢ºèªã™ã¹ãã‚‚ã®**ï¼šãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«æ¬¡ã®ã‚ˆã†ãªå†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆä¾‹ï¼‰ï¼š

```text
X-Account-Email: example@gmail.com
X-Mapped-Model: gemini-3-pro-high
```

## ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ âœ…

- `fixed account`ã€`sticky session`ã€`round-robin` ã® 3 ã¤ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã®ã©ã‚ŒãŒã©ã‚Œã‚’ä¸Šæ›¸ãã™ã‚‹ã‹ã‚’æ˜ç¢ºã«èª¬æ˜ã§ãã‚‹
- `session_id` ãŒã©ã†ã‚„ã£ã¦æ¥ã‚‹ã‹ã‚’çŸ¥ã£ã¦ã„ã‚‹ï¼ˆå„ªå…ˆ `metadata.user_id`ã€ãã‚Œä»¥å¤–ã¯æœ€åˆã® user ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒƒã‚·ãƒ¥ï¼‰
- 429/5xx ã«é­é‡ã—ãŸã¨ãã€ã‚·ã‚¹ãƒ†ãƒ ãŒå…ˆã«ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’è¨˜éŒ²ã—ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã¦å†è©¦è¡Œã™ã‚‹ã“ã¨ã‚’äºˆæ¸¬ã§ãã‚‹
- `X-Account-Email` ã‚’ä½¿ã£ã¦ç¾åœ¨ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã©ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã§ãã‚‹

## ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´

1) **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ—ãƒ¼ãƒ«ãŒ 1 ã¤ã—ã‹ãªã„å ´åˆã€ã€Œãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ•‘ã£ã¦ãã‚Œã‚‹ã€ã¨æœŸå¾…ã—ãªã„ã§ãã ã•ã„**
ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Œåˆ¥ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€ã ã‘ã§ã€ãƒ—ãƒ¼ãƒ«ã« 2 ã¤ç›®ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãªã„å ´åˆã€429/invalid_grant ã¯ã‚ˆã‚Šé »ç¹ã«æš´éœ²ã•ã‚Œã¾ã™ã€‚

2) **`CacheFirst` ã¯ã€Œåˆ©ç”¨å¯èƒ½ã«ãªã‚‹ã¾ã§å¾…ã¤ã€ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“**
ç¾åœ¨ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã¯ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é­é‡ã™ã‚‹ã¨ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’è§£é™¤ã—ã¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å‚¾å‘ãŒã‚ã‚Šã€é•·æœŸé–“ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦å¾…ã¤ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

3) **å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯çµ¶å¯¾çš„ã«å¼·åˆ¶ã§ã¯ã‚ã‚Šã¾ã›ã‚“**
å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¨ãƒãƒ¼ã‚¯ã•ã‚Œã¦ã„ã‚‹ã€ã¾ãŸã¯ã‚¯ã‚©ãƒ¼ã‚¿ä¿è­·ã«ãƒ’ãƒƒãƒˆã—ã¦ã„ã‚‹å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚

## ã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã®ã¾ã¨ã‚

- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒã‚§ãƒ¼ãƒ³ï¼šhandler ãŒ `session_id` ã‚’æŠ½å‡º â†’ `TokenManager::get_token` ãŒã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é¸æŠ â†’ ã‚¨ãƒ©ãƒ¼æ™‚ã« `attempt > 0` ã§å¼·åˆ¶çš„ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- æœ€ã‚‚ã‚ˆãä½¿ã† 2 ã¤ã®ã‚¹ã‚¤ãƒƒãƒï¼šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼/60ç§’å†åˆ©ç”¨ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ã©ã†ã‹ï¼‰+ å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç›´æ¥æŒ‡å®šï¼‰
- 429/5xx ã¯ã€Œãƒ¬ãƒ¼ãƒˆåˆ¶é™çŠ¶æ…‹ã€ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã€å¾Œç¶šã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã§ãã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€ãƒ­ãƒƒã‚¯æ™‚é–“ãŒæœŸé™åˆ‡ã‚Œã«ãªã‚‹ã¾ã§

## æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã®äºˆå‘Š

> æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ **ãƒ¢ãƒ‡ãƒ«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°** ã‚’è¦‹ã¾ã™ï¼šã€Œå®‰å®šã—ãŸãƒ¢ãƒ‡ãƒ«ã‚»ãƒƒãƒˆã€ã‚’å…¬é–‹ã—ãŸã„ã€ã¾ãŸã¯ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰/ãƒ—ãƒªã‚»ãƒƒãƒˆæˆ¦ç•¥ã‚’è¡Œã„ãŸã„å ´åˆã€ã©ã†è¨­å®šã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ã‹ã€‚

---

## ä»˜éŒ²ï¼šã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å‚è€ƒ

<details>
<summary><strong>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å ´æ‰€ã‚’å±•é–‹</strong></summary>

> æ›´æ–°æ—¥æ™‚ï¼š2026-01-23

| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | è¡Œç•ªå· |
| --- | --- | --- |
| ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã¨è¨­å®šæ§‹é€ ï¼ˆStickySessionConfigï¼‰ | [`src-tauri/src/proxy/sticky_config.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/sticky_config.rs#L1-L36) | 1-36 |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆç”Ÿæˆï¼ˆClaude/OpenAI/Geminiï¼‰ | [`src-tauri/src/proxy/session_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/session_manager.rs#L1-L159) | 1-159 |
| TokenManagerï¼šå›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨åˆæœŸåŒ– | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L27-L50) | 27-50 |
| TokenManagerï¼šã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆ/ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³/60ç§’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦/ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³/ã‚¯ã‚©ãƒ¼ã‚¿ä¿è­·ï¼‰ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L470-L940) | 470-940 |
| TokenManagerï¼šinvalid_grant è‡ªå‹•ç„¡åŠ¹åŒ–ã¨ãƒ—ãƒ¼ãƒ«ã‹ã‚‰ã®å‰Šé™¤ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L868-L878) | 868-878 |
| TokenManagerï¼šãƒ¬ãƒ¼ãƒˆåˆ¶é™è¨˜éŒ²ã¨æˆåŠŸæ™‚ã‚¯ãƒªã‚¢ API | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L1087-L1147) | 1087-1147 |
| TokenManagerï¼šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°è¨­å®šã®æ›´æ–° / ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®ã‚¯ãƒªã‚¢ / å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ setter | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L1419-L1461) | 1419-1461 |
| ProxyConfigï¼šscheduling ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | [`src-tauri/src/proxy/config.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/config.rs#L174-L257) | 174-257 |
| ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·èµ·å‹•æ™‚ã® scheduling è¨­å®šåŒæœŸ | [`src-tauri/src/commands/proxy.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/commands/proxy.rs#L70-L100) | 70-100 |
| ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°é–¢é€£ Tauri ã‚³ãƒãƒ³ãƒ‰ï¼ˆget/update/clear bindings/fixed accountï¼‰ | [`src-tauri/src/commands/proxy.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/commands/proxy.rs#L478-L551) | 478-551 |
| OpenAI handlerï¼šsession_id + å†è©¦è¡Œæ™‚å¼·åˆ¶çš„ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L160-L182) | 160-182 |
| OpenAI handlerï¼š429/5xx ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¨˜éŒ² + retry delay è§£æ | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L349-L367) | 349-367 |
| Gemini handlerï¼šsession_id + å†è©¦è¡Œæ™‚å¼·åˆ¶çš„ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ | [`src-tauri/src/proxy/handlers/gemini.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/gemini.rs#L62-L88) | 62-88 |
| Gemini handlerï¼š429/5xx ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¨˜éŒ²ã¨ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ | [`src-tauri/src/proxy/handlers/gemini.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/gemini.rs#L279-L299) | 279-299 |
| Claude handlerï¼šsession_id æŠ½å‡ºã¨ TokenManager ã¸ã®è»¢é€ | [`src-tauri/src/proxy/handlers/claude.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/claude.rs#L517-L524) | 517-524 |
| 429 retry delay è§£æï¼ˆRetryInfo.retryDelay / quotaResetDelayï¼‰ | [`src-tauri/src/proxy/upstream/retry.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/upstream/retry.rs#L37-L66) | 37-66 |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™åŸå› è­˜åˆ¥ã¨æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆRateLimitTrackerï¼‰ | [`src-tauri/src/proxy/rate_limit.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/rate_limit.rs#L154-L279) | 154-279 |

**ä¸»è¦ãªæ§‹é€ ä½“**ï¼š
- `StickySessionConfig`ï¼šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã¨è¨­å®šæ§‹é€ ï¼ˆ`mode`ã€`max_wait_seconds`ï¼‰
- `TokenManager`ï¼šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ—ãƒ¼ãƒ«ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã€å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒˆãƒ©ãƒƒã‚«ãƒ¼
- `SessionManager`ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ `session_id` ã‚’æŠ½å‡º

</details>
