---
title: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨èªè¨¼è¨­å®š | Antigravity-Manager"
sidebarTitle: "ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’éœ²å‡ºã•ã›ãªã„"
subtitle: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ï¼šauth_modeã€allow_lan_accessã€ãã—ã¦ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’æ¼ã‚‰ã•ãªã„ã€è¨­è¨ˆ'
description: "Antigravity Tools ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šæ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚auth_mode ã® 4 ç¨®é¡ã®ãƒ¢ãƒ¼ãƒ‰ã€allow_lan_access ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é•ã„ã€api_key è¨­å®šã¨ /healthz æ¤œè¨¼ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã®æ¼æ´©ã‚’å›é¿ã—ã¾ã™ã€‚"
tags:
  - "security"
  - "privacy"
  - "auth_mode"
  - "allow_lan_access"
  - "api_key"
prerequisite:
  - "start-getting-started"
  - "start-proxy-and-first-client"
duration: 16
order: 2
---

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ï¼šauth_modeã€allow_lan_accessã€ãã—ã¦ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’æ¼ã‚‰ã•ãªã„ã€è¨­è¨ˆ

Antigravity Tools ã‚’ã€Œãƒ­ãƒ¼ã‚«ãƒ« AI ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã€ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã¨ãã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã¯é€šå¸¸ 2 ã¤ã®ã“ã¨ã ã‘ã§ã™ï¼šã‚µãƒ¼ãƒ“ã‚¹ã‚’èª°ã«å…¬é–‹ã™ã‚‹ã‹ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ã‹ã€LAN/ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå…¨ä½“ã‹ï¼‰ã€ãã—ã¦å¤–éƒ¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã« API Key ã‚’æŒãŸã›ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã©ã†ã‹ã§ã™ã€‚ã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å†…ã®ãƒ«ãƒ¼ãƒ«ã‚’æ˜ç¢ºã«è§£èª¬ã—ã€ãã®ã¾ã¾ä½¿ãˆã‚‹æœ€å°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚

## å­¦ã‚“ã å¾Œã§ãã‚‹ã“ã¨

- é©åˆ‡ãª `allow_lan_access` ã‚’é¸æŠã§ãã‚‹ï¼šãƒªãƒƒã‚¹ãƒ³ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ`127.0.0.1` vs `0.0.0.0`ï¼‰ã«å½±éŸ¿ã™ã‚‹ã“ã¨ã‚’ç†è§£ã™ã‚‹
- é©åˆ‡ãª `auth_mode` ã‚’é¸æŠã§ãã‚‹ï¼š`off/strict/all_except_health/auto` ã®å®Ÿéš›ã®å‹•ä½œã‚’æ˜ç¢ºã«ã™ã‚‹
- `api_key` ã‚’è¨­å®šã—æ¤œè¨¼ã§ãã‚‹ï¼š`curl` ã‚’ä½¿ã£ã¦ã€Œèªè¨¼ãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã€ã‚’ä¸€ç›®ã§ç¢ºèªã§ãã‚‹
- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ã®å¢ƒç•Œã‚’ç†è§£ã§ãã‚‹ï¼šãƒ­ãƒ¼ã‚«ãƒ« proxy key ã¯ä¸Šæµã«è»¢é€ã•ã‚Œãªã„ï¼›API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¡ãƒ¼ãƒ«ã®æ¼æ´©ã‚’å›é¿ã™ã‚‹

## ç¾åœ¨ã®æ‚©ã¿

- ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³/åˆ¥ã® PC ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„ãŒã€LAN ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€Œéœ²å‡ºã€ã™ã‚‹ã®ã§ã¯ãªã„ã‹ã¨å¿ƒé…
- èªè¨¼ã‚’æœ‰åŠ¹ã«ã—ãŸã„ãŒã€`/healthz` ã‚’é™¤å¤–ã™ã¹ãã‹ã©ã†ã‹ä¸æ˜ã§ã€ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å¤±æ•—ã•ã›ã‚‹ã®ã§ã¯ãªã„ã‹ã¨å¿ƒé…
- ãƒ­ãƒ¼ã‚«ãƒ« keyã€cookieã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¡ãƒ¼ãƒ«ãŒå¤–éƒ¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ä¸Šæµãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«æ¼æ´©ã™ã‚‹ã“ã¨ã‚’å¿ƒé…

## ã“ã®æ–¹æ³•ã‚’ã„ã¤ä½¿ã†ã‹

- `allow_lan_access` ã‚’æœ‰åŠ¹ã«ã™ã‚‹æº–å‚™ã‚’ã—ã¦ã„ã‚‹å ´åˆï¼ˆNASã€å®¶åº­ LANã€ãƒãƒ¼ãƒ å†…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰
- cloudflared/ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ã£ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«å…¬é–‹ã™ã‚‹å ´åˆï¼ˆå…ˆã« **[Cloudflared ä¸€ç™ºãƒˆãƒ³ãƒãƒ«](/ja/lbjlaq/Antigravity-Manager/platforms/cloudflared/)** ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼‰
- `401` ã«é­é‡ã—ã€ã€Œkey ã‚’æŒã£ã¦ã„ãªã„ã€ã‹ã€Œãƒ¢ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¦ã„ãªã„ã€ã‹ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆ

## ğŸ’ å§‹ã‚ã‚‹å‰ã®æº–å‚™

::: warning å‰ææ¡ä»¶
- GUI ã§ API Proxy ã‚’èµ·å‹•ã§ãã‚‹ã“ã¨ï¼ˆã¾ã å‹•ä½œã—ã¦ã„ãªã„å ´åˆã¯ã€å…ˆã« **[ãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚’èµ·å‹•ã—ã¦æœ€åˆã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ¥ç¶š](/ja/lbjlaq/Antigravity-Manager/start/proxy-and-first-client/)** ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼‰ã€‚
- è‡ªåˆ†ãŒè§£æ±ºã—ãŸã„å•é¡Œã‚’çŸ¥ã£ã¦ã„ã‚‹ã“ã¨ï¼šãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ã‹ã€LAN/ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‹ã€‚
:::

::: info ã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§é »ç¹ã«ç™»å ´ã™ã‚‹ 3 ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- `allow_lan_access`ï¼šLAN ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ã‹ã©ã†ã‹ã€‚
- `auth_mode`ï¼šèªè¨¼æˆ¦ç•¥ï¼ˆã©ã®ãƒ«ãƒ¼ãƒˆã§ key ã‚’æŒã¤å¿…è¦ãŒã‚ã‚‹ã‹ã‚’æ±ºå®šï¼‰ã€‚
- `api_key`ï¼šãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ­ã‚­ã‚·ã® API Keyï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã®ã¿ã«ä½¿ç”¨ã•ã‚Œã€ä¸Šæµã«ã¯è»¢é€ã•ã‚Œã¾ã›ã‚“ï¼‰ã€‚
:::

## auth_mode ã¨ã¯ï¼Ÿ

**auth_mode** ã¯ Antigravity Tools ã®ã€Œãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã‚¹ã‚¤ãƒƒãƒ + é™¤å¤–æˆ¦ç•¥ã€ã§ã™ã€‚å¤–éƒ¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ­ã‚­ã‚·ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãã€ã©ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ `proxy.api_key` ã‚’æŒã¤å¿…è¦ãŒã‚ã‚Šã€`/healthz` ã®ã‚ˆã†ãªãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ«ãƒ¼ãƒˆãŒèªè¨¼ãªã—ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ã‹ã‚’æ±ºå®šã—ã¾ã™ã€‚

## ã‚³ã‚¢ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

1. ã¾ãšã€Œå…¬é–‹é¢ã€ã‚’æ±ºã‚ã‚‹ï¼š`allow_lan_access=false` ã®æ™‚ã¯ `127.0.0.1` ã®ã¿ãƒªãƒƒã‚¹ãƒ³ï¼›`true` ã®æ™‚ã¯ `0.0.0.0` ã‚’ãƒªãƒƒã‚¹ãƒ³ã€‚
2. æ¬¡ã«ã€Œå…¥ã‚Šå£ã‚­ãƒ¼ã€ã‚’æ±ºã‚ã‚‹ï¼š`auth_mode` ãŒ key ã‚’æŒã¤å¿…è¦ãŒã‚ã‚‹ã‹ã€ãŠã‚ˆã³ `/healthz` ã‚’é™¤å¤–ã™ã‚‹ã‹ã‚’æ±ºå®šã€‚
3. æœ€å¾Œã«ã€Œãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼åé›†ã€ã‚’ã™ã‚‹ï¼šãƒ­ãƒ¼ã‚«ãƒ« proxy key/cookie ã‚’ä¸Šæµã«è»¢é€ã—ãªã„ï¼›å¤–éƒ¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¡ãƒ¼ãƒ«ã‚’å«ã‚ãªã„ã€‚

## ã•ã‚ã‚„ã£ã¦ã¿ã‚ˆã†

### ã‚¹ãƒ†ãƒƒãƒ— 1ï¼šã¾ãš LAN ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ã©ã†ã‹ã‚’æ±ºã‚ã‚‹ï¼ˆallow_lan_accessï¼‰

**ç†ç”±**
ã€Œä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã€ãªæ™‚ã ã‘ LAN ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¹ãã§ã€ãã†ã§ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ãŒæœ€ã‚‚ç°¡å˜ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æˆ¦ç•¥ã§ã™ã€‚

`ProxyConfig` ã§ã¯ã€ãƒªãƒƒã‚¹ãƒ³ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ `allow_lan_access` ã§æ±ºã¾ã‚Šã¾ã™ï¼š

```rust
pub fn get_bind_address(&self) -> &str {
    if self.allow_lan_access {
        "0.0.0.0"
    } else {
        "127.0.0.1"
    }
}
```

GUI ã® `API Proxy` ãƒšãƒ¼ã‚¸ã§ã€å¿…è¦ã«å¿œã˜ã¦ã€ŒAllow LAN Accessã€ã‚¹ã‚¤ãƒƒãƒã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

**ç¢ºèªã™ã¹ãã‚‚ã®**
- ç„¡åŠ¹æ™‚ï¼šã€Œãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã€ã®æ„å‘³ã®ãƒ’ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆå…·ä½“çš„ãªæ–‡è¨€ã¯è¨€èªãƒ‘ãƒƒã‚¯ã«ã‚ˆã‚Šã¾ã™ï¼‰
- æœ‰åŠ¹æ™‚ï¼šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ç›®ç«‹ã¤ãƒªã‚¹ã‚¯è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆã“ã‚Œã¯ã€Œå…¬é–‹é¢ã®æ‹¡å¤§ã€ã§ã‚ã‚‹ã“ã¨ã‚’æé†’ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ— 2ï¼šauth_mode ã‚’é¸æŠã™ã‚‹ï¼ˆã¾ãšã¯ auto ã‚’æ¨å¥¨ï¼‰

**ç†ç”±**
`auth_mode` ã¯ã€Œèªè¨¼ã®ã‚ªãƒ³/ã‚ªãƒ•ã€ã ã‘ã§ãªãã€`/healthz` ã®ã‚ˆã†ãªãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’é™¤å¤–ã™ã‚‹ã‹ã©ã†ã‹ã‚‚æ±ºå®šã—ã¾ã™ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ 4 ç¨®é¡ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼ˆ`docs/proxy/auth.md` ã‹ã‚‰ï¼‰ï¼š

- `off`ï¼šã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆã§èªè¨¼ä¸è¦
- `strict`ï¼šã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆã§èªè¨¼å¿…è¦
- `all_except_health`ï¼š`/healthz` ã‚’é™¤ãã€ä»–ã®ãƒ«ãƒ¼ãƒˆã™ã¹ã¦ã§èªè¨¼å¿…è¦
- `auto`ï¼šè‡ªå‹•ãƒ¢ãƒ¼ãƒ‰ã€`allow_lan_access` ã«åŸºã¥ã„ã¦å®Ÿéš›ã®æˆ¦ç•¥ã‚’å°å‡º

`auto` ã®å°å‡ºãƒ­ã‚¸ãƒƒã‚¯ã¯ `ProxySecurityConfig::effective_auth_mode()` ã«ã‚ã‚Šã¾ã™ï¼š

```rust
match self.auth_mode {
    ProxyAuthMode::Auto => {
        if self.allow_lan_access {
            ProxyAuthMode::AllExceptHealth
        } else {
            ProxyAuthMode::Off
        }
    }
    ref other => other.clone(),
}
```

**æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**
- ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ï¼š`allow_lan_access=false` + `auth_mode=auto`ï¼ˆæœ€çµ‚çš„ã« `off` ã¨åŒç­‰ï¼‰
- LAN ã‚¢ã‚¯ã‚»ã‚¹ï¼š`allow_lan_access=true` + `auth_mode=auto`ï¼ˆæœ€çµ‚çš„ã« `all_except_health` ã¨åŒç­‰ï¼‰

**ç¢ºèªã™ã¹ãã‚‚ã®**
- `API Proxy` ãƒšãƒ¼ã‚¸ã§ã€ã€ŒAuth Modeã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã« `off/strict/all_except_health/auto` ã® 4 ã¤ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã“ã¨

### ã‚¹ãƒ†ãƒƒãƒ— 3ï¼šapi_key ã‚’ç¢ºèªã™ã‚‹ï¼ˆå¿…è¦ã«å¿œã˜ã¦å†ç”Ÿæˆï¼‰

**ç†ç”±**
ãƒ—ãƒ­ã‚­ã‚·ãŒå¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆLAN/ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼‰ã‚’å¿…è¦ã¨ã™ã‚‹å ´åˆã€`api_key` ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦ç®¡ç†ã™ã¹ãã§ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ `ProxyConfig::default()` ãŒ `sk-...` å½¢å¼ã® key ã‚’ç”Ÿæˆã—ã¾ã™ï¼š

```rust
api_key: format!("sk-{}", uuid::Uuid::new_v4().simple()),
```

`API Proxy` ãƒšãƒ¼ã‚¸ã§ã€ç¾åœ¨ã® `api_key` ã‚’ç·¨é›†ã€å†ç”Ÿæˆã€ã‚³ãƒ”ãƒ¼ã§ãã¾ã™ã€‚

**ç¢ºèªã™ã¹ãã‚‚ã®**
- ãƒšãƒ¼ã‚¸ã« `api_key` å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ãŠã‚ˆã³ç·¨é›†/å†ç”Ÿæˆ/ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ãŒã‚ã‚‹ã“ã¨

### ã‚¹ãƒ†ãƒƒãƒ— 4ï¼š/healthz ã§ã€Œé™¤å¤–æˆ¦ç•¥ã€ãŒæœŸå¾…é€šã‚Šã‹æ¤œè¨¼ã™ã‚‹

**ç†ç”±**
`/healthz` ã¯æœ€çŸ­ã®ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ãƒ«ãƒ¼ãƒ—ã§ã™ï¼šãƒ¢ãƒ‡ãƒ«ã‚’å®Ÿéš›ã«å‘¼ã³å‡ºã•ãªãã¦ã‚‚ã€ã€Œã‚µãƒ¼ãƒ“ã‚¹åˆ°é”å¯èƒ½ + èªè¨¼æˆ¦ç•¥ãŒæ­£ã—ã„ã€ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚

`<PORT>` ã‚’è‡ªåˆ†ã®ãƒãƒ¼ãƒˆã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ `8045`ï¼‰ï¼š

::: code-group

```bash [macOS/Linux]
curl -sS "http://127.0.0.1:<PORT>/healthz"
```

```powershell [Windows]
curl.exe -sS "http://127.0.0.1:<PORT>/healthz"
```

:::

**ç¢ºèªã™ã¹ãã‚‚ã®**

```json
{"status":"ok"}
```

::: details auth_mode ã‚’ strict ã«è¨­å®šã—ãŸå ´åˆ
`strict` ã¯ `/healthz` ã‚’é™¤å¤–ã—ã¾ã›ã‚“ã€‚key ã‚’æŒã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```bash
curl -sS "http://127.0.0.1:<PORT>/healthz" \
  -H "Authorization: Bearer <API_KEY>"
```
:::

### ã‚¹ãƒ†ãƒƒãƒ— 5ï¼šã€Œé health ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€ã§ 401 ã‚’æ¤œè¨¼ã™ã‚‹ï¼ˆkey ã‚’æŒã£ãŸå¾Œã¯ 401 ã§ãªã„ï¼‰

**ç†ç”±**
èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒæœ¬å½“ã«æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã„å ´åˆã€UI ã§ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ã‚‚å®Ÿéš›ã«ã¯æ©Ÿèƒ½ã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã¯æ„å›³çš„ã«ä¸å®Œå…¨ã«æ›¸ã‹ã‚Œã¦ãŠã‚Šã€ãã®ç›®çš„ã¯ã€Œå‘¼ã³å‡ºã—æˆåŠŸã€ã§ã¯ãªãã€èªè¨¼ã§ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ã§ã™ï¼š

```bash
#key ãªã—ï¼šauth_mode != off ã®æ™‚ã€ç›´æ¥ 401 ã«ãªã‚‹ã¯ãš
curl -i "http://127.0.0.1:<PORT>/v1/messages" \
  -H "Content-Type: application/json" \
  -d "{}"

#key ã‚ã‚Šï¼š401 ã§ãªããªã‚‹ã¯ãšï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ãŒä¸å®Œå…¨ãªã®ã§ 400/422 ãŒè¿”ã‚‹å¯èƒ½æ€§ï¼‰
curl -i "http://127.0.0.1:<PORT>/v1/messages" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <API_KEY>" \
  -d "{}"
```

**ç¢ºèªã™ã¹ãã‚‚ã®**
- key ãªã—ï¼š`HTTP/1.1 401 Unauthorized`
- key ã‚ã‚Šï¼šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãŒ 401 ã§ãªããªã‚‹

## ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ âœ…

- ç¾åœ¨ã®å…¬é–‹é¢ã‚’æ˜ç¢ºã«èª¬æ˜ã§ãã‚‹ï¼šãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ï¼ˆ127.0.0.1ï¼‰ã‹ LANï¼ˆ0.0.0.0ï¼‰ã‹
- `auth_mode=auto` ã®æ™‚ã€å®Ÿéš›ã®æœ‰åŠ¹ãƒ¢ãƒ¼ãƒ‰ã‚’äºˆæ¸¬ã§ãã‚‹ï¼ˆLAN â†’ `all_except_health`ã€ãƒ­ãƒ¼ã‚«ãƒ« â†’ `off`ï¼‰
- 2 ã¤ã® `curl` ã‚³ãƒãƒ³ãƒ‰ã§ã€Œkey ãªã—ã® 401ã€ã‚’å†ç¾ã§ãã‚‹

## ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´

::: warning é–“é•ã£ãŸæ–¹æ³• vs æ¨å¥¨æ–¹æ³•

| ã‚·ãƒŠãƒªã‚ª | âŒ ã‚ˆãã‚ã‚‹é–“é•ã„ | âœ“ æ¨å¥¨æ–¹æ³• |
|--- | --- | ---|
| LAN ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ | `allow_lan_access=true` ã ã‘ã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŒã€`auth_mode=off` | `auth_mode=auto` ã‚’ä½¿ç”¨ã—ã€å¼·åŠ›ãª `api_key` ã‚’è¨­å®šã™ã‚‹ |
| èªè¨¼ã‚’æœ‰åŠ¹ã«ã—ã¦ã‚‚å¸¸ã« 401 | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ key ã‚’æŒã£ã¦ã„ã‚‹ãŒã€ãƒ˜ãƒƒãƒ€ãƒ¼åãŒäº’æ›æ€§ãŒãªã„ | ãƒ—ãƒ­ã‚­ã‚·ã¯ `Authorization`/`x-api-key`/`x-goog-api-key` ã® 3 ç¨®é¡ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«äº’æ›æ€§ãŒã‚ã‚‹ |
| èªè¨¼ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹ãŒ key ã‚’è¨­å®šã—ã¦ã„ãªã„ | `api_key` ãŒç©ºã§ã‚‚èªè¨¼ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ç›´æ¥æ‹’å¦ã™ã‚‹ï¼ˆãƒ­ã‚°ã§ key ãŒç©ºã§ã‚ã‚‹ã“ã¨ãŒç¤ºã•ã‚Œã‚‹ï¼‰ |
:::

::: warning /healthz ã®é™¤å¤–ã¯ all_except_health ã§ã®ã¿æœ‰åŠ¹
ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¯ã€Œæœ‰åŠ¹ãƒ¢ãƒ¼ãƒ‰ã€ãŒ `all_except_health` ã§ãƒ‘ã‚¹ãŒ `/healthz` ã®æ™‚ã«é€šéã‚’è¨±å¯ã—ã¾ã™ï¼›ã“ã‚Œã‚’ã€Œãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ãƒˆã€ã¨ã—ã¦æ‰±ã„ã€ãƒ“ã‚¸ãƒã‚¹ API ã¨ã—ã¦ä½¿ã‚ãªã„ã§ãã ã•ã„ã€‚
:::

## ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’æ¼ã‚‰ã•ãªã„ã€è¨­è¨ˆ

### 1) ãƒ­ãƒ¼ã‚«ãƒ« proxy key ã¯ä¸Šæµã«è»¢é€ã•ã‚Œãªã„

èªè¨¼ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ­ã‚­ã‚·å…¥ã‚Šå£ã§ã®ã¿ç™ºç”Ÿï¼›`docs/proxy/auth.md` ã«ã¯æ˜è¨˜ã•ã‚Œã¦ã„ã¾ã™ï¼šproxy API key ã¯ä¸Šæµã«ã¯è»¢é€ã•ã‚Œã¾ã›ã‚“ã€‚

### 2) z.ai ã«è»¢é€ã™ã‚‹ã¨ãã€è»¢é€å¯èƒ½ãª header ã‚’æ„å›³çš„ã«åç¸®ã™ã‚‹

ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ z.aiï¼ˆAnthropic äº’æ›ï¼‰ã«è»¢é€ã•ã‚Œã‚‹ã¨ãã€ã‚³ãƒ¼ãƒ‰ã¯å°‘æ•°ã® header ã®ã¿ã‚’é€šéã•ã›ã€ãƒ­ãƒ¼ã‚«ãƒ« proxy key ã¾ãŸã¯ cookie ã‚’è»¢é€ã™ã‚‹ã“ã¨ã‚’å›é¿ã—ã¾ã™ï¼š

```rust
// Only forward a conservative set of headers to avoid leaking the local proxy key or cookies.
```

### 3) Token æ›´æ–°å¤±æ•—ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¡ãƒ¼ãƒ«ã‚’å«ã‚ãªã„

Token æ›´æ–°ãŒå¤±æ•—ã—ãŸã¨ãã€ãƒ­ã‚°ã«ã¯å…·ä½“çš„ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒè¨˜éŒ²ã•ã‚Œã¾ã™ãŒã€API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ã¯ãƒ¡ãƒ¼ãƒ«ã‚’å«ã¾ãªã„å½¢å¼ã«æ›¸ãæ›ãˆã‚‰ã‚Œã¾ã™ï¼š

```rust
// Avoid leaking account emails to API clients; details are still in logs.
last_error = Some(format!("Token refresh failed: {}", e));
```

## ã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã®ã¾ã¨ã‚

- ã¾ãšå…¬é–‹é¢ã‚’æ±ºã‚ã‚‹ï¼ˆ`allow_lan_access`ï¼‰ã€æ¬¡ã«å…¥ã‚Šå£ã‚­ãƒ¼ã‚’æ±ºã‚ã‚‹ï¼ˆ`auth_mode` + `api_key`ï¼‰
- `auth_mode=auto` ã®ãƒ«ãƒ¼ãƒ«ã¯ç°¡å˜ï¼šLAN ã¯å°‘ãªãã¨ã‚‚ `all_except_health`ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ã¯ `off`
- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã®ãƒœãƒˆãƒ ãƒ©ã‚¤ãƒ³ã¯ã€Œãƒ­ãƒ¼ã‚«ãƒ« key ã‚’å¤–éƒ¨ã«æŒãŸãªã„ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¡ãƒ¼ãƒ«ã¯å¤–éƒ¨ã‚¨ãƒ©ãƒ¼ã§æ¼ã‚‰ã•ãªã„ã€ã€è©³ç´°ã¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ä¸Šæµè»¢é€ã‚³ãƒ¼ãƒ‰ã«ã‚ã‚‹

## æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã®äºˆå‘Š

> æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ **[é«˜å¯ç”¨æ€§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ï¼šãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€å›ºå®šã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨å¤±æ•—æ™‚å†è©¦è¡Œ](/ja/lbjlaq/Antigravity-Manager/advanced/scheduling/)** ã‚’è¦‹ã¦ã€ã€Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å…¥ã‚Šå£ã€ã®å¾Œã®ã€Œå®‰å®šå‡ºå£ã€ã‚’è£œå®Œã—ã¾ã™ã€‚

---

## ä»˜éŒ²ï¼šã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å‚è€ƒ

<details>
<summary><strong>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å ´æ‰€ã‚’å±•é–‹</strong></summary>

> æ›´æ–°æ—¥æ™‚ï¼š2026-01-23

| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | è¡Œç•ªå· |
|--- | --- | ---|
| auth_mode ã® 4 ç¨®é¡ã®ãƒ¢ãƒ¼ãƒ‰ã¨ auto ã®æ„å‘³èª¬æ˜ | [`docs/proxy/auth.md`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/docs/proxy/auth.md#L10-L24) | 10-24 |
| ProxyAuthMode åˆ—æŒ™å‹ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ offï¼‰ | [`src-tauri/src/proxy/config.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/config.rs#L5-L18) | 5-18 |
| ProxyConfig ã®é‡è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆallow_lan_accessã€api_keyï¼‰ | [`src-tauri/src/proxy/config.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/config.rs#L174-L259) | 174-259 |
| ãƒªãƒƒã‚¹ãƒ³ã‚¢ãƒ‰ãƒ¬ã‚¹å°å‡ºï¼ˆ127.0.0.1 vs 0.0.0.0ï¼‰ | [`src-tauri/src/proxy/config.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/config.rs#L281-L292) | 281-292 |
|--- | --- | ---|
| èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆOPTIONS é€šéã€/healthz é™¤å¤–ã€3 ç¨®é¡ã® header äº’æ›ï¼‰ | [`src-tauri/src/proxy/middleware/auth.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/middleware/auth.rs#L14-L78) | 14-78 |
| UIï¼šallow_lan_access ã¨ auth_mode ã®ã‚¹ã‚¤ãƒƒãƒ/ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ | [`src/pages/ApiProxy.tsx`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src/pages/ApiProxy.tsx#L943-L1046) | 943-1046 |
| UIï¼šapi_key ã®ç·¨é›†/ãƒªã‚»ãƒƒãƒˆ/ã‚³ãƒ”ãƒ¼ | [`src/pages/ApiProxy.tsx`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src/pages/ApiProxy.tsx#L1048-L1120) | 1048-1120 |
| invalid_grant è‡ªå‹•ç„¡åŠ¹åŒ–ã¨ã€Œãƒ¡ãƒ¼ãƒ«æ¼æ´©å›é¿ã€ã‚¨ãƒ©ãƒ¼æ›¸ãæ›ãˆ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L841-L940) | 841-940 |
| disable_accountï¼šdisabled/disabled_at/disabled_reason ã‚’æ›¸ãè¾¼ã¿ã€ãƒ¡ãƒ¢ãƒªãƒ—ãƒ¼ãƒ«ã‹ã‚‰å‰Šé™¤ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L942-L969) | 942-969 |
| z.ai è»¢é€æ™‚è»¢é€å¯èƒ½ãª header åç¸®ï¼ˆãƒ­ãƒ¼ã‚«ãƒ« key/cookies ã®æ¼æ´©å›é¿ï¼‰ | [`src-tauri/src/proxy/providers/zai_anthropic.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/providers/zai_anthropic.rs#L70-L89) | 70-89 |
| ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ—ãƒ¼ãƒ«ç„¡åŠ¹åŒ–ã¨ UI è¡¨ç¤ºã®å‹•ä½œèª¬æ˜ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰ | [`docs/proxy/accounts.md`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/docs/proxy/accounts.md#L9-L44) | 9-44 |

</details>
