---
title: "ã‚¹ãƒˆãƒªãƒ¼ãƒ ä¸­æ–­: 0 Token ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | Antigravity-Manager"
sidebarTitle: "è‡ªå·±ä¿®å¾©ã‹æ‰‹å‹•ä»‹å…¥ã‹"
subtitle: "ã‚¹ãƒˆãƒªãƒ¼ãƒ ä¸­æ–­/0 Token/ç½²åç„¡åŠ¹ï¼šè‡ªå·±ä¿®å¾©ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ã‚¹"
description: "Antigravity Tools ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ä¸­æ–­ã€0 Token ã¨ç½²åç„¡åŠ¹ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ã‚¹ã‚’å­¦ã³ã¾ã™ã€‚/v1/messages ã¾ãŸã¯ Gemini ã‚¹ãƒˆãƒªãƒ¼ãƒ å‘¼ã³å‡ºã—ã‚’ç¢ºèªã—ã€peek å…ˆèª­ã¿ã¨é€€é¿å†è©¦è¡Œã‚’èª­ã¿è§£ãã€Proxy Monitor ã¨ãƒ­ã‚°ã‚’çµ„ã¿åˆã‚ã›ã¦åŸå› ã‚’ç´ æ—©ãç‰¹å®šã—ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã‹ã‚’åˆ¤æ–­ã—ã¾ã™ã€‚"
tags:
  - "faq"
  - "streaming"
  - "troubleshooting"
  - "retry"
prerequisite:
  - "start-getting-started"
  - "start-first-run-data"
  - "advanced-monitoring"
  - "advanced-scheduling"
order: 5
---
# ã‚¹ãƒˆãƒªãƒ¼ãƒ ä¸­æ–­/0 Token/ç½²åç„¡åŠ¹ï¼šè‡ªå·±ä¿®å¾©ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ã‚¹

Antigravity Tools ã§ `/v1/messages`ï¼ˆAnthropic äº’æ›ï¼‰ã¾ãŸã¯ Gemini ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å‘¼ã³å‡ºã™ã¨ãã€ã€Œã‚¹ãƒˆãƒªãƒ¼ãƒ å‡ºåŠ›ãŒä¸­æ–­ã€ã€Œ200 OK ã ãŒ 0 Tokenã€ã€ŒInvalid \`signature\`ã€ã®ã‚ˆã†ãªå•é¡Œã«é­é‡ã—ãŸå ´åˆã€ã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã¯ UI ã‹ã‚‰ãƒ­ã‚°ã¸ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

## å­¦ã‚“ã å¾Œã§ãã‚‹ã“ã¨

- 0 Token/ä¸­æ–­å•é¡ŒãŒãƒ—ãƒ­ã‚­ã‚·ã§é€šå¸¸ã€Œpeek å…ˆèª­ã¿ã€ã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã‚‹
- Proxy Monitor ã§ä»Šå›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ‡ãƒ«ï¼ˆ`X-Account-Email` / `X-Mapped-Model`ï¼‰ã‚’ç¢ºèªã§ãã‚‹
- ãƒ­ã‚°ã‹ã‚‰ã€Œã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒ æ—©å¤­ã€ã€Œé€€é¿å†è©¦è¡Œã€ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‹ã€Œç½²åä¿®å¾©å†è©¦è¡Œã€ã‹ã‚’åˆ¤æ–­ã§ãã‚‹
- ã©ã®çŠ¶æ³ãªã‚‰ãƒ—ãƒ­ã‚­ã‚·ã®è‡ªå·±ä¿®å¾©ã‚’å¾…ã¡ã€ã©ã®çŠ¶æ³ãªã‚‰æ‰‹å‹•ä»‹å…¥ã™ã¹ãã‹ã‚’çŸ¥ã£ã¦ã„ã‚‹

## ç¾åœ¨ã®æ‚©ã¿

ä»¥ä¸‹ã®ã€Œç¾è±¡ã€ã‚’è¦‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã©ã“ã‹ã‚‰æ‰‹ã‚’ä»˜ã‘ã‚‹ã‹ã‚ã‹ã‚‰ãªã„ï¼š

- ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡ºåŠ›ãŒé€”ä¸­ã§ä¸­æ–­ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã€Œãƒ•ãƒªãƒ¼ã‚ºã€ã—ãŸã‚ˆã†ã«ç¶šãã‚’ç¶šã‘ãªã„
- 200 OK ã ãŒã€`usage.output_tokens=0` ã¾ãŸã¯å†…å®¹ãŒç©º
- 400 ã‚¨ãƒ©ãƒ¼ã« `Invalid \`signature\``ã€`Corrupted thought signature`ã€`must be \`thinking\`` ãªã©ãŒç¾ã‚Œã‚‹

ã“ã‚Œã‚‰ã®å•é¡Œã®å¤šãã¯ã€Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é–“é•ãˆãŸã€ã®ã§ã¯ãªãã€ã‚¹ãƒˆãƒªãƒ¼ãƒ è»¢é€ã€ã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆåˆ¶é™/å¤‰å‹•ã€ã¾ãŸã¯å±¥æ­´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å«ã¾ã‚Œã‚‹ç½²åãƒ–ãƒ­ãƒƒã‚¯ãŒã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ æ¤œè¨¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ãŸã“ã¨ã§ã™ã€‚Antigravity Tools ã¯ãƒ—ãƒ­ã‚­ã‚·å±¤ã§è¤‡æ•°ã®é˜²è¡›ç·šã‚’æ•·ã„ã¦ãŠã‚Šã€ã‚ãªãŸã¯å›ºå®šãƒ‘ã‚¹ã«å¾“ã£ã¦å®Ÿéš›ã«ã©ã®ã‚¹ãƒ†ãƒƒãƒ—ã§è©°ã¾ã£ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ã ã‘ã§ã™ã€‚

## 0 Token ã¨ã¯ï¼Ÿ

**0 Token**ã¯é€šå¸¸ã€ä¸€å›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæœ€çµ‚çš„ã«è¿”ã—ãŸ `output_tokens=0` ã§ã€ã‹ã¤ã€Œã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒç”Ÿæˆã•ã‚Œã¦ã„ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹ã€ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚Antigravity Tools ã§ã¯ã€ã‚ˆã‚Šä¸€èˆ¬çš„ãªåŸå› ã¯ã€Œã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæœ¬å½“ã«å‡ºåŠ›å‰ã«çµ‚äº†/ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸã€ã“ã¨ã§ã€ãƒ¢ãƒ‡ãƒ«ãŒæœ¬å½“ã« 0 å€‹ã® token ã‚’ç”Ÿæˆã—ãŸã“ã¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ—ãƒ­ã‚­ã‚·ã¯ peek å…ˆèª­ã¿ã‚’ä½¿ã£ã¦ã“ã®ç¨®ã®ç©ºãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã€å†è©¦è¡Œã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚

## ãƒ—ãƒ­ã‚­ã‚·ãŒèƒŒå¾Œã§è¡Œã† 3 ã¤ã®ã“ã¨ï¼ˆã¾ãšå¿ƒã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½œã‚‹ï¼‰

### 1) éã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè‡ªå‹•çš„ã«ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å¤‰æ›ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

`/v1/messages` ãƒ‘ã‚¹ã§ã€ãƒ—ãƒ­ã‚­ã‚·ã¯å†…éƒ¨çš„ã«ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆéã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤‰æ›ã—ã¦ã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«è¦æ±‚ã—ã€SSE ã‚’å—ä¿¡ã—ãŸå¾Œã€JSON ã«é›†ç´„ã—ã¦è¿”ã—ã¾ã™ï¼ˆã“ã†ã™ã‚‹ç†ç”±ã¯ãƒ­ã‚°ã«ã€Œbetter quotaã€ã¨æ›¸ã„ã¦ã‚ã‚Šã¾ã™ï¼‰ã€‚

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è¨¼æ‹ ï¼š`src-tauri/src/proxy/handlers/claude.rs#L665-L913`ã€‚

### 2) Peek å…ˆèª­ã¿ï¼šã¾ãšã€Œæœ€åˆã®æœ‰åŠ¹ãƒ‡ãƒ¼ã‚¿ãƒ–ãƒ­ãƒƒã‚¯ã€ã‚’å¾…ã£ã¦ã‹ã‚‰ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ¸¡ã™

`/v1/messages` ã® SSE å‡ºåŠ›ã«å¯¾ã—ã€ãƒ—ãƒ­ã‚­ã‚·ã¯ã¾ãš `timeout + next()` ã§å…ˆèª­ã¿ã—ã€ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ/ã‚³ãƒ¡ãƒ³ãƒˆè¡Œï¼ˆ`:` ã§å§‹ã¾ã‚‹ã‚‚ã®ï¼‰ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã€æœ€åˆã®ã€Œç©ºã§ãªãã€ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã§ãªã„ã€ãƒ‡ãƒ¼ã‚¿ãƒ–ãƒ­ãƒƒã‚¯ã‚’å–å¾—ã—ã¦ã‹ã‚‰æ­£å¼ã«è»¢é€ã‚’é–‹å§‹ã—ã¾ã™ã€‚peek æ®µéšã§ã‚¨ãƒ©ãƒ¼/ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ/ã‚¹ãƒˆãƒªãƒ¼ãƒ çµ‚äº†ãŒå‡ºã‚‹ã¨ã€ç›´æ¥æ¬¡å›è©¦è¡Œã«å…¥ã‚Šã¾ã™ï¼ˆæ¬¡å›ã¯é€šå¸¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ï¼‰ã€‚

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è¨¼æ‹ ï¼š`src-tauri/src/proxy/handlers/claude.rs#L812-L926`ï¼›Gemini ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚‚åŒæ§˜ã® peek ãŒã‚ã‚Šã¾ã™ï¼š`src-tauri/src/proxy/handlers/gemini.rs#L117-L149`ã€‚

### 3) çµ±ä¸€é€€é¿å†è©¦è¡Œ + ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«åŸºã¥ã„ã¦ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‹ã©ã†ã‹ã€ã‚’æ±ºå®š

ãƒ—ãƒ­ã‚­ã‚·ã¯ä¸€èˆ¬çš„ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦æ˜ç¢ºãªé€€é¿æˆ¦ç•¥ã‚’è¡Œã„ã€ã©ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãŒã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã‹ã‚’å®šç¾©ã—ã¾ã—ãŸã€‚

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è¨¼æ‹ ï¼š`src-tauri/src/proxy/handlers/claude.rs#L117-L236`ã€‚

## ğŸ’ å§‹ã‚ã‚‹å‰ã®æº–å‚™

- Proxy Monitor ã‚’é–‹ã‘ã‚‹ï¼ˆ[Proxy Monitorï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°ã€ãƒ•ã‚£ãƒ«ã‚¿ã€è©³ç´°å¾©å…ƒã¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ](../../advanced/monitoring/) ã‚’å‚ç…§ï¼‰
- ãƒ­ã‚°ãŒãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `logs/` ã«ã‚ã‚‹ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã‚‹ï¼ˆ[åˆå›èµ·å‹•å¿…èª­ï¼šãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€ãƒ­ã‚°ã€ãƒˆãƒ¬ã‚¤ã¨è‡ªå‹•èµ·å‹•](../../start/first-run-data/) ã‚’å‚ç…§ï¼‰

## æ‰‹é †é€šã‚Šã«é€²ã‚ã‚‹

### ç¬¬ 1 ã‚¹ãƒ†ãƒƒãƒ—ï¼šã©ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèª

**ãªãœã‹**
`/v1/messages`ï¼ˆclaude handlerï¼‰ã¨ Gemini ãƒã‚¤ãƒ†ã‚£ãƒ–ï¼ˆgemini handlerï¼‰ã®è‡ªå·±ä¿®å¾©ã®è©³ç´°ã¯ç•°ãªã‚Šã€ã¾ãšãƒ‘ã‚¹ã‚’ç¢ºèªã™ã‚Œã°é–“é•ã£ãŸãƒ­ã‚°ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ç„¡é§„ãªæ™‚é–“ã‚’è²»ã‚„ã™ã“ã¨ã‚’å›é¿ã§ãã¾ã™ã€‚

Proxy Monitor ã‚’é–‹ãã€å¤±æ•—ã—ãŸãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¦‹ã¤ã‘ã€ã¾ãš Path ã‚’è¨˜éŒ²ï¼š

- `/v1/messages`ï¼š`src-tauri/src/proxy/handlers/claude.rs` ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¦‹ã‚‹
- `/v1beta/models/...:streamGenerateContent`ï¼š`src-tauri/src/proxy/handlers/gemini.rs` ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¦‹ã‚‹

**è¡¨ç¤ºã•ã‚Œã‚‹ã¹ãã‚‚ã®**ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨˜éŒ²ã§ URL/ãƒ¡ã‚½ãƒƒãƒ‰/ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆãŠã‚ˆã³ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‰€è¦æ™‚é–“ï¼‰ãŒè¦‹ãˆã¾ã™ã€‚

### ç¬¬ 2 ã‚¹ãƒ†ãƒƒãƒ—ï¼šãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆ + ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ‡ãƒ«ã€ã‚’æŠŠæ¡

**ãªãœã‹**
åŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å¤±æ•—/æˆåŠŸã¯ã€å¤šãã®å ´åˆã€Œä»Šå›ã©ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒé¸æŠã•ã‚ŒãŸã‹ã€ã€Œã©ã®ã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ¢ãƒ‡ãƒ«ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚ŒãŸã‹ã€ã«ä¾å­˜ã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚­ã‚·ã¯ã“ã® 2 ã¤ã®æƒ…å ±ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«æ›¸ãè¾¼ã¿ã€å…ˆã«è¨˜éŒ²ã—ã¦ãŠã‘ã°ã€å¾Œã§ãƒ­ã‚°ã‚’è¦‹ãŸæ™‚ã«å¯¾ç…§ã§ãã¾ã™ã€‚

å¤±æ•—ã—ãŸãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã€ã“ã‚Œã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ¢ã—ã¾ã™ï¼š

- `X-Account-Email`
- `X-Mapped-Model`

ã“ã® 2 ã¤ã¯ `/v1/messages` ã¨ Gemini handler ã§è¨­å®šã•ã‚Œã¾ã™ï¼ˆä¾‹ï¼š`/v1/messages` ã® SSE ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…ï¼š`src-tauri/src/proxy/handlers/claude.rs#L887-L896`ï¼›Gemini SSEï¼š`src-tauri/src/proxy/handlers/gemini.rs#L235-L245`ï¼‰ã€‚

**è¡¨ç¤ºã•ã‚Œã‚‹ã¹ãã‚‚ã®**ï¼š`X-Account-Email` ã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€`X-Mapped-Model` ã¯å®Ÿéš›ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸãƒ¢ãƒ‡ãƒ«åã€‚

### ç¬¬ 3 ã‚¹ãƒ†ãƒƒãƒ—ï¼šapp.log ã§ã€Œpeek æ®µéšã§å¤±æ•—ã€ã‹åˆ¤æ–­

**ãªãœã‹**
peek å¤±æ•—ã¯é€šå¸¸ã€Œã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒæœ‰åŠ¹ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã—å§‹ã‚ãªã‹ã£ãŸã€ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚ã“ã®ç¨®ã®å•é¡Œã®æœ€ã‚‚ä¸€èˆ¬çš„ãªå‡¦ç†æ–¹æ³•ã¯å†è©¦è¡Œ/ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€ãƒ—ãƒ­ã‚­ã‚·ãŒãƒˆãƒªã‚¬ãƒ¼ã—ãŸã‹ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã¾ãšãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰¹å®šï¼ˆãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `logs/` ã‹ã‚‰ã€æ—¥ã”ã¨ã«ãƒ­ãƒ¼ãƒ«ã—ã¦ `app.log*` ã«æ›¸ãè¾¼ã¿ï¼‰ã€‚

::: code-group

```bash [macOS/Linux]
ls -lt "$HOME/.antigravity_tools/logs" | head
```

```powershell [Windows]
Get-ChildItem -Force (Join-Path $HOME ".antigravity_tools\logs") | Sort-Object LastWriteTime -Descending | Select-Object -First 5
```

:::

æ¬¡ã«æœ€æ–°ã® `app.log*` ã§ã“ã‚Œã‚‰ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œç´¢ï¼š

- `/v1/messages`ï¼ˆclaude handlerï¼‰ï¼š`Stream error during peek` / `Stream ended during peek` / `Timeout waiting for first data`ï¼ˆ`src-tauri/src/proxy/handlers/claude.rs#L828-L864`ï¼‰
- Gemini ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼š`[Gemini] Empty first chunk received, retrying...` / `Stream error during peek` / `Stream ended immediately`ï¼ˆ`src-tauri/src/proxy/handlers/gemini.rs#L117-L144`ï¼‰

**è¡¨ç¤ºã•ã‚Œã‚‹ã¹ãã‚‚ã®**ï¼špeek å†è©¦è¡ŒãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ã¨ã€ãƒ­ã‚°ã«é¡ä¼¼ã®ã€Œretrying...ã€è­¦å‘ŠãŒç¾ã‚Œã€ãã®å¾Œæ¬¡å› attempt ã«å…¥ã‚Šã¾ã™ï¼ˆé€šå¸¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚‚ãŸã‚‰ã—ã¾ã™ï¼‰ã€‚

### ç¬¬ 4 ã‚¹ãƒ†ãƒƒãƒ—ï¼š400/Invalid `signature` ã®å ´åˆã€ãƒ—ãƒ­ã‚­ã‚·ãŒã€Œç½²åä¿®å¾©å†è©¦è¡Œã€ã‚’ã—ãŸã‹ã‚’ç¢ºèª

**ãªãœã‹**
ç½²åé¡ã‚¨ãƒ©ãƒ¼ã¯å±¥æ­´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã® Thinking ãƒ–ãƒ­ãƒƒã‚¯/ç½²åãƒ–ãƒ­ãƒƒã‚¯ãŒã‚¢ãƒƒãƒ—ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ãªã„ã“ã¨ã‹ã‚‰æ¥ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚Antigravity Tools ã¯ã€Œå±¥æ­´ thinking ãƒ–ãƒ­ãƒƒã‚¯ã®ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ + ä¿®å¾©ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ³¨å…¥ã€ã§å†è©¦è¡Œã‚’è©¦ã¿ã‚‹ã®ã§ã€ã¾ãšè‡ªå·±ä¿®å¾©ã‚’èµ°ã‚‰ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

2 ã¤ã®ä¿¡å·ã§ä¿®å¾©ãƒ­ã‚¸ãƒƒã‚¯ã«å…¥ã£ãŸã‹ã‚’åˆ¤æ–­ã§ãã¾ã™ï¼š

1. ãƒ­ã‚°ã« `Unexpected thinking signature error ... Retrying with all thinking blocks removed.` ãŒç¾ã‚Œã‚‹ï¼ˆ`src-tauri/src/proxy/handlers/claude.rs#L999-L1025`ï¼‰
2. ãã®å¾Œå±¥æ­´ `Thinking` ãƒ–ãƒ­ãƒƒã‚¯ã‚’ `Text` ã«å¤‰æ›ã—ã€æœ€å¾Œã® user message ã«ä¿®å¾©ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¿½åŠ ï¼ˆ`src-tauri/src/proxy/handlers/claude.rs#L1027-L1102`ï¼›Gemini handler ã‚‚ `contents[].parts` ã«åŒæ§˜ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¿½åŠ ï¼š`src-tauri/src/proxy/handlers/gemini.rs#L300-L325`ï¼‰

**è¡¨ç¤ºã•ã‚Œã‚‹ã¹ãã‚‚ã®**ï¼šãƒ—ãƒ­ã‚­ã‚·ã¯çŸ­ã„é…å»¶å¾Œã«è‡ªå‹•å†è©¦è¡Œï¼ˆ`FixedDelay`ï¼‰ã—ã€æ¬¡å›è©¦è¡Œã«å…¥ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ âœ…

- [ ] Proxy Monitor ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ã‚¹ï¼ˆ`/v1/messages` ã¾ãŸã¯ Gemini ãƒã‚¤ãƒ†ã‚£ãƒ–ï¼‰ã‚’ç¢ºèªã§ãã‚‹
- [ ] ä»Šå›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã® `X-Account-Email` ã¨ `X-Mapped-Model` ã‚’å–å¾—ã§ãã‚‹
- [ ] `logs/app.log*` ã§ peek/å†è©¦è¡Œé–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œç´¢ã§ãã‚‹
- [ ] 400 ç½²åã‚¨ãƒ©ãƒ¼ã«é­é‡ã—ãŸã¨ãã€ãƒ—ãƒ­ã‚­ã‚·ãŒã€Œä¿®å¾©ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ + thinking ãƒ–ãƒ­ãƒƒã‚¯ã‚¯ãƒªã‚¢ã€ã®å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ã«å…¥ã£ãŸã‹ç¢ºèªã§ãã‚‹

## ç½ ã®è­¦å‘Š

| ã‚·ãƒŠãƒªã‚ª | ã‚ãªãŸãŒã—ãã†ãªã“ã¨ï¼ˆâŒï¼‰ | æ¨å¥¨åšæ³•ï¼ˆâœ“ï¼‰ |
| --- | --- | --- |
| 0 Token ã‚’è¦‹ã¦ã™ãã«ä½•åº¦ã‚‚æ‰‹å‹•å†è©¦è¡Œ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å†è©¦è¡Œãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ç¶šã‘ã€ãƒ­ã‚°ã‚’å…¨ãè¦‹ãªã„ | ã¾ãšä¸€åº¦ Proxy Monitor + app.log ã‚’è¦‹ã¦ã€peek æ®µéšã§æ—©å¤­ã—ã¦ã„ã‚‹ã‹ï¼ˆè‡ªå‹•å†è©¦è¡Œ/ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã‚’ç¢ºèª |
| `Invalid \`signature\`` ã«é­é‡ã—ãŸã‚‰ã™ããƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¯ãƒªã‚¢ | `.antigravity_tools` å…¨éƒ¨å‰Šé™¤ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ/çµ±è¨ˆå…¨éƒ¨æ¶ˆãˆã‚‹ | ã¾ãšãƒ—ãƒ­ã‚­ã‚·ã«ä¸€åº¦ã€Œç½²åä¿®å¾©å†è©¦è¡Œã€ã‚’å®Ÿè¡Œã•ã›ã‚‹ã€‚ãƒ­ã‚°ãŒæ˜ç¢ºã«å›å¾©ä¸å¯ã¨æç¤ºã—ãŸæ™‚ã ã‘ã€æ‰‹å‹•ä»‹å…¥ã‚’è€ƒãˆã‚‹ |
| ã€Œã‚µãƒ¼ãƒãƒ¼å´å¤‰å‹•ã€ã‚’ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå£Šã‚ŒãŸã€ã¨é–“é•ãˆã‚‹ | 400/503/529 å…¨éƒ¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ | ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«ä¾å­˜ã™ã‚‹ã€‚ãƒ—ãƒ­ã‚­ã‚·è‡ªä½“ã« `should_rotate_account(...)` ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚‹ï¼ˆ`src-tauri/src/proxy/handlers/claude.rs#L226-L236`ï¼‰ |

## ãƒ¬ãƒƒã‚¹ãƒ³ã¾ã¨ã‚

- 0 Token/ã‚¹ãƒˆãƒªãƒ¼ãƒ ä¸­æ–­ã¯ãƒ—ãƒ­ã‚­ã‚·ã§é€šå¸¸å…ˆã« peek å…ˆèª­ã¿ã‚’çµŒã‚‹ï¼›peek æ®µéšãŒå¤±æ•—ã™ã‚‹ã¨å†è©¦è¡Œã‚’ãƒˆãƒªã‚¬ãƒ¼ã—æ¬¡å› attempt ã«å…¥ã‚‹
- `/v1/messages` ã¯éã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å†…éƒ¨çš„ã«ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å¤‰æ›ã—ã¦ã‹ã‚‰ JSON ã«é›†ç´„ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ã“ã‚ŒãŒã€Œãªãœã‚¹ãƒˆãƒªãƒ¼ãƒ å•é¡Œã«è¦‹ãˆã‚‹ã®ã‹ã€ã‚’ç†è§£ã™ã‚‹ã®ã«å½±éŸ¿ã™ã‚‹
- ç½²åç„¡åŠ¹é¡ 400 ã‚¨ãƒ©ãƒ¼ã¯ã€ãƒ—ãƒ­ã‚­ã‚·ãŒã€Œä¿®å¾©ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ + thinking ãƒ–ãƒ­ãƒƒã‚¯ã‚¯ãƒªã‚¢ã€ã§å†è©¦è¡Œã‚’è©¦ã¿ã‚‹ã®ã§ã€å„ªå…ˆçš„ã«ã“ã®è‡ªå·±ä¿®å¾©ãƒ‘ã‚¹ãŒé€šã£ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹

## æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³äºˆå‘Š

> æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ **[ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](../../appendix/endpoints/)** ã‚’å­¦ã³ã¾ã™

---

## ä»˜éŒ²ï¼šã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å‚ç…§

<details>
<summary><strong>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å ´æ‰€ã‚’å±•é–‹</strong></summary>

> æ›´æ–°æ™‚é–“ï¼š2026-01-23

| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | è¡Œç•ªå· |
| --- | --- | --- |
| Claude handlerï¼šé€€é¿å†è©¦è¡Œæˆ¦ç•¥ + ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ« | [`src-tauri/src/proxy/handlers/claude.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/claude.rs#L117-L236) | 117-236 |
| Claude handlerï¼šå†…éƒ¨çš„ã«éã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å¤‰æ›ï¼ˆbetter quotaï¼‰ | [`src-tauri/src/proxy/handlers/claude.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/claude.rs#L665-L776) | 665-776 |
| Claude handlerï¼špeek å…ˆèª­ã¿ï¼ˆãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ/ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã€ç©ºã‚¹ãƒˆãƒªãƒ¼ãƒ å›é¿ï¼‰ | [`src-tauri/src/proxy/handlers/claude.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/claude.rs#L812-L926) | 812-926 |
| Claude handlerï¼š400 ç½²å/ãƒ–ãƒ­ãƒƒã‚¯é †åºã‚¨ãƒ©ãƒ¼ã®ä¿®å¾©å†è©¦è¡Œ | [`src-tauri/src/proxy/handlers/claude.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/claude.rs#L999-L1102) | 999-1102 |
| Gemini handlerï¼špeek å…ˆèª­ã¿ï¼ˆç©ºã‚¹ãƒˆãƒªãƒ¼ãƒ  200 OK é˜²æ­¢ï¼‰ | [`src-tauri/src/proxy/handlers/gemini.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/gemini.rs#L117-L149) | 117-149 |
| Gemini handlerï¼š400 ç½²åã‚¨ãƒ©ãƒ¼ã®ä¿®å¾©ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ³¨å…¥ | [`src-tauri/src/proxy/handlers/gemini.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/gemini.rs#L300-L325) | 300-325 |
| ç½²åã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ3 å±¤ï¼štool/family/sessionã€TTL/æœ€å°é•·ã‚’å«ã‚€ï¼‰ | [`src-tauri/src/proxy/signature_cache.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/signature_cache.rs#L5-L207) | 5-207 |
| Claude SSE å¤‰æ›ï¼šç½²åã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ç½²åã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«æ›¸ãè¾¼ã¿ | [`src-tauri/src/proxy/mappers/claude/streaming.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/mappers/claude/streaming.rs#L639-L787) | 639-787 |

**é‡è¦ãªå®šæ•°**ï¼š
- `MAX_RETRY_ATTEMPTS = 3`ï¼šæœ€å¤§å†è©¦è¡Œå›æ•°ï¼ˆ`src-tauri/src/proxy/handlers/claude.rs#L27`ï¼‰
- `SIGNATURE_TTL = 2 * 60 * 60` ç§’ï¼šç½²åã‚­ãƒ£ãƒƒã‚·ãƒ¥ TTLï¼ˆ`src-tauri/src/proxy/signature_cache.rs#L6`ï¼‰
- `MIN_SIGNATURE_LENGTH = 50`ï¼šç½²åæœ€å°é•·ï¼ˆ`src-tauri/src/proxy/signature_cache.rs#L7`ï¼‰

**é‡è¦ãªé–¢æ•°**ï¼š
- `determine_retry_strategy(...)`ï¼šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«åŸºã¥ã„ã¦é€€é¿æˆ¦ç•¥ã‚’é¸æŠï¼ˆ`src-tauri/src/proxy/handlers/claude.rs#L117-L167`ï¼‰
- `should_rotate_account(...)`ï¼šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«åŸºã¥ã„ã¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‹æ±ºå®šï¼ˆ`src-tauri/src/proxy/handlers/claude.rs#L226-L236`ï¼‰
- `SignatureCache::cache_session_signature(...)`ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç½²åã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ`src-tauri/src/proxy/signature_cache.rs#L149-L188`ï¼‰

</details>
