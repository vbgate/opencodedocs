---
title: "iMessage ãƒãƒ£ãƒãƒ«è¨­å®šï¼šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€æ¨©é™è¨­å®šã€ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆ | Clawdbot ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«"
sidebarTitle: "iMessage ã§ãƒãƒ£ãƒƒãƒˆ"
subtitle: "iMessage ãƒãƒ£ãƒãƒ«è¨­å®š"
description: "Clawdbot ã® iMessage ãƒãƒ£ãƒãƒ«ï¼ˆmacOS å°‚ç”¨ï¼‰ã‚’è¨­å®šã—ã¾ã™ã€‚imsg CLI ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€æ¨©é™è¨­å®šã€ãƒ­ãƒ¼ã‚«ãƒ«/ãƒªãƒ¢ãƒ¼ãƒˆ Mac ã®è¨­å®šã€ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¯¾å¿œã€DM/ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã€è©³ç´°ãªãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ç¶²ç¾…ã—ã¾ã™ã€‚"
tags:
  - "platforms"
  - "imessage"
  - "macos"
prerequisite:
  - "start-getting-started"
order: 130
---

# iMessage ãƒãƒ£ãƒãƒ«è¨­å®š

## å­¦ç¿’å†…å®¹

- macOS ã§ iMessage ã‚’é€šã˜ã¦ AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¨ 1:1 ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒ£ãƒƒãƒˆã‚’è¡Œã†
- iMessage ã‚°ãƒ«ãƒ¼ãƒ—ã§ AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ï¼ˆ@ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
- ãƒœãƒƒãƒˆã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’åˆ†é›¢ã™ã‚‹å°‚ç”¨ Mac ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¨­å®šã™ã‚‹
- SSH/Tailscale ã‚’é€šã˜ã¦ãƒªãƒ¢ãƒ¼ãƒˆ Mac ä¸Šã® iMessage ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
- DM ãƒšã‚¢ãƒªãƒ³ã‚°ã¨ã‚°ãƒ«ãƒ¼ãƒ— allowlist ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’ãƒã‚¹ã‚¿ãƒ¼ã™ã‚‹

## ç¾åœ¨ã®èª²é¡Œ

macOS ã§ iMessage ã‚’é€šã˜ã¦ AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¨å¯¾è©±ã—ãŸã„ãŒã€ä»¥ä¸‹ã®æ–¹æ³•ãŒã‚ã‹ã‚‰ãªã„ï¼š

- `imsg` CLI ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š
- Clawdbot ã« Full Disk Access ãŠã‚ˆã³ Automation æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹
- ãƒ­ãƒ¼ã‚«ãƒ«ã¾ãŸã¯ãƒªãƒ¢ãƒ¼ãƒˆ Mac ã‚’ iMessage ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨ã—ã¦è¨­å®šã™ã‚‹
- è¤‡æ•°ã® iMessage ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹
- ãƒœãƒƒãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åˆ¶å¾¡ã™ã‚‹

## ã„ã¤ä½¿ç”¨ã™ã¹ãã‹

**iMessage ãƒãƒ£ãƒãƒ«ãŒé©ã—ã¦ã„ã‚‹ã‚·ãƒŠãƒªã‚ª**ï¼š

- ä¸»ã« macOS ã§ iMessage ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹
- ãƒ­ãƒ¼ã‚«ãƒ« iMessage ã‚’ä½¿ç”¨ã—ãŸã„ï¼ˆã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚µãƒ¼ãƒãƒ¼ã«ä¾å­˜ã—ãŸããªã„ï¼‰
- iMessage ã‚’é€šã˜ã¦ AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¨ãƒ†ã‚­ã‚¹ãƒˆãŠã‚ˆã³ãƒ¡ãƒ‡ã‚£ã‚¢ã®å¯¾è©±ãŒå¿…è¦
- ä»–ã®ãƒãƒ£ãƒãƒ«ï¼ˆWhatsAppã€Telegramï¼‰ã¨åŒã˜ä¼šè©±ä½“é¨“ã‚’ç¶­æŒã—ãŸã„

**é©ã•ãªã„ã‚·ãƒŠãƒªã‚ª**ï¼š

- macOS ä»¥å¤–ã®ã‚·ã‚¹ãƒ†ãƒ ï¼ˆiMessage ãƒãƒ£ãƒãƒ«ã¯ macOS ã®ã¿ã‚µãƒãƒ¼ãƒˆï¼‰
- ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åŒæœŸãŒå¿…è¦ï¼ˆWebChatã€Telegram ã®ä½¿ç”¨ã‚’æ¤œè¨ï¼‰
- ã‚°ãƒ«ãƒ¼ãƒ— @ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ãŒå¿…è¦ï¼ˆiMessage ã«ã¯ãƒã‚¤ãƒ†ã‚£ãƒ–ãª mention ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ãŒãªã„ãŸã‚ã€æ‰‹å‹•è¨­å®šãŒå¿…è¦ï¼‰

## ã‚³ã‚¢ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

iMessage ãƒãƒ£ãƒãƒ«ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼š

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant iMsg as Messages App
    participant IMsg as imsg CLI
    participant Clawdbot as Clawdbot Gateway

    User->>iMsg: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡/å—ä¿¡
    iMsg->>IMsg: chat.db ã‚’ç›£è¦–
    IMsg->>Clawdbot: JSON-RPC over stdio
    Clawdbot->>Clawdbot: æ¨©é™ãƒã‚§ãƒƒã‚¯ (DM/Group)
    Clawdbot->>Clawdbot: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç† (Agent)
    Clawdbot->>IMsg: ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€ä¿¡ (JSON-RPC)
    IMsg->>iMsg: Automation æ¨©é™
    iMsg->>User: è¿”ä¿¡ã‚’è¡¨ç¤º
```

**é‡è¦ãªæ¦‚å¿µ**ï¼š

| æ¦‚å¿µ | èª¬æ˜ |
| ------ | ------ |
| **imsg CLI** | JSON-RPC over stdio ã‚’é€šã˜ã¦ Messages ã¨å¯¾è©±ã™ã‚‹ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ„ãƒ¼ãƒ« |
| **Full Disk Access** | Clawdbot ãŒ Messages ã® chat.db ã‚’èª­ã¿å–ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ macOS æ¨©é™ |
| **Automation æ¨©é™** | imsg ãŒ Automation API ã‚’é€šã˜ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ macOS æ¨©é™ |
| **chat_id** | ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†é›¢ã«ä½¿ç”¨ã•ã‚Œã‚‹å®‰å®šã—ãŸãƒãƒ£ãƒƒãƒˆè­˜åˆ¥å­ |
| **pairing** | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® DM ä¿è­·ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã€‚æœªçŸ¥ã®é€ä¿¡è€…ã¯æ‰¿èªãŒå¿…è¦ |

::: tip ãƒ’ãƒ³ãƒˆ
iMessage ãƒãƒ£ãƒãƒ«ã¯ `imsg` CLI ã‚’é€šã˜ã¦å®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€Messages API ã‚’ç›´æ¥å‘¼ã³å‡ºã™ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`imsg` ã¯ JSON-RPC over stdio ã‚’é€šã˜ã¦ Clawdbot ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã€ãƒªãƒ¢ãƒ¼ãƒˆ Mac ä¸Šã§å®Ÿè¡Œã§ãã¾ã™ï¼ˆSSH çµŒç”±ï¼‰ã€‚
:::

## ğŸ’ äº‹å‰æº–å‚™

ä»¥ä¸‹ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- âœ… [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](../../start/getting-started/) ã‚’å®Œäº†ã—ã€Clawdbot ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- âœ… Gateway ãŒå®Ÿè¡Œä¸­ï¼ˆ`clawdbot gateway --port 18789`ï¼‰
- âœ… macOS ã§ Messages ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ï¼ˆiMessage æœ‰åŠ¹åŒ–ï¼‰
- âœ… Homebrew ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚ã‚Šï¼ˆ`imsg` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç”¨ï¼‰

::: warning è­¦å‘Š
iMessage ãƒãƒ£ãƒãƒ«ã¯ macOS ã®ã¿ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚Gateway ãŒ macOS ä¸Šã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ã€SSH/Tailscale ã‚’é€šã˜ã¦ãƒªãƒ¢ãƒ¼ãƒˆ Mac ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
:::

## å®Ÿè·µãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

### ã‚¹ãƒ†ãƒƒãƒ— 1ï¼šimsg CLI ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**ç›®çš„**
`imsg` ã¯ iMessage ãƒãƒ£ãƒãƒ«ã®ä¸­æ ¸ã¨ãªã‚‹ä¾å­˜é–¢ä¿‚ã§ã€JSON-RPC over stdio ã‚’é€šã˜ã¦ Messages ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨å¯¾è©±ã—ã¾ã™ã€‚

1. Homebrew ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š
   ```bash
   brew install steipete/tap/imsg
   ```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š
- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æˆåŠŸå¾Œã€`imsg` ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ç”¨å¯èƒ½
- `imsg --version` ã®å®Ÿè¡Œã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®æ¤œè¨¼**ï¼š

```bash
# imsg ãŒä½¿ç”¨å¯èƒ½ã‹ãƒ†ã‚¹ãƒˆ
imsg chats --limit 1
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š
- å°‘ãªãã¨ã‚‚ 1 ã¤ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´ãŒå‡ºåŠ›ã•ã‚Œã‚‹ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
- Full Disk Access æ¨©é™ã®ä»˜ä¸ã‚’æ±‚ã‚ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹

### ã‚¹ãƒ†ãƒƒãƒ— 2ï¼šFull Disk Access æ¨©é™ã‚’ä»˜ä¸

**ç›®çš„**
Clawdbot ãŒæ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç›£è¦–ã™ã‚‹ãŸã‚ã«ã€Messages ã® `chat.db` ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’èª­ã¿å–ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

1. **ã‚·ã‚¹ãƒ†ãƒ è¨­å®š** > **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** ã‚’é–‹ã
2. **ãƒ•ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ã‚¯ã‚»ã‚¹** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **+** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»¥ä¸‹ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼š
   - `/Applications/Clawdbot.app`ï¼ˆmacOS ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰
   - `/usr/local/bin/imsg` ã¾ãŸã¯ `imsg` ã®å®Ÿéš›ã®ãƒ‘ã‚¹
4. Gateway ã‚’å†èµ·å‹•

::: warning è­¦å‘Š
æ¨©é™ã®å¤‰æ›´å¾Œã¯ã€Gateway ã‚’å†èµ·å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼
:::

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š
- Gateway èµ·å‹•ãƒ­ã‚°ã«æ¨©é™ã‚¨ãƒ©ãƒ¼ãŒãªã„
- `imsg chats --limit 1` ãŒæ­£å¸¸ã«ãƒãƒ£ãƒƒãƒˆãƒªã‚¹ãƒˆã‚’å‡ºåŠ›ã™ã‚‹

### ã‚¹ãƒ†ãƒƒãƒ— 3ï¼šAutomation æ¨©é™ã‚’ä»˜ä¸

**ç›®çš„**
`imsg` ã¯ Apple Events Automation API ã‚’é€šã˜ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰¿èªãŒå¿…è¦ã§ã™ã€‚

1. åˆå›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ™‚ã€macOS ãŒæ¨©é™ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤º
2. **è¨±å¯** ã¾ãŸã¯ **OK** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. å°‚ç”¨ Mac ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ãƒ†ã‚¹ãƒˆã‚’ 1 å›å®Ÿè¡Œ

**Automation æ¨©é™ã®ãƒ†ã‚¹ãƒˆ**ï¼š

```bash
# ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ï¼ˆå®Ÿéš›ã®å—ä¿¡è€…ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
imsg send --to "+15555550123" "Test message"
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š
- macOS ãŒæ¨©é™ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤ºï¼ˆåˆå›ï¼‰
- æ¨©é™ã‚’ä»˜ä¸ã—ãŸå¾Œã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ­£å¸¸ã«é€ä¿¡ã•ã‚Œã‚‹
- Messages ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### ã‚¹ãƒ†ãƒƒãƒ— 4ï¼šClawdbot ã‚’è¨­å®š

**ç›®çš„**
Clawdbot ã«ã©ã® `imsg` ãƒ‘ã‚¹ã¨ Messages ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å ´æ‰€ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã‚’æŒ‡ç¤ºã—ã¾ã™ã€‚

**æ–¹æ³• Aï¼šã‚·ãƒ³ãƒ—ãƒ«ãªè¨­å®šï¼ˆãƒ­ãƒ¼ã‚«ãƒ« Macï¼‰**

`~/.clawdbot/clawdbot.json` ã‚’ç·¨é›†ï¼š

```json5
{
  channels: {
    imessage: {
      enabled: true,
      cliPath: "/usr/local/bin/imsg",
      dbPath: "/Users/<your-username>/Library/Messages/chat.db",
      dmPolicy: "pairing",
      groupPolicy: "allowlist"
    }
  }
}
```

::: info æƒ…å ±
`<your-username>` ã‚’å®Ÿéš›ã® macOS ãƒ¦ãƒ¼ã‚¶ãƒ¼åã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
:::

**æ–¹æ³• Bï¼šãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š**

```json5
{
  channels: {
    imessage: {
      enabled: true,
      accounts: {
        main: {
          name: "Main Account",
          enabled: true,
          cliPath: "/usr/local/bin/imsg",
          dbPath: "/Users/alice/Library/Messages/chat.db"
        },
        bot: {
          name: "Bot Account",
          enabled: true,
          cliPath: "/path/to/imsg-bot-wrapper",  // ã‚¹ãƒ†ãƒƒãƒ— 5 ã‚’å‚ç…§
          dbPath: "/Users/botuser/Library/Messages/chat.db"
        }
      }
    }
  }
}
```

**Gateway ã®å†èµ·å‹•**ï¼š

```bash
clawdbot gateway restart
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š
- Gateway ãŒèµ·å‹•ã—ã€"iMessage default: enabled, configured, ..." ã¨è¡¨ç¤ºã•ã‚Œã‚‹
- æ¨©é™ã¾ãŸã¯ãƒ‘ã‚¹ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒãªã„

### ã‚¹ãƒ†ãƒƒãƒ— 5ï¼šãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡

**ç›®çš„**
è¨­å®šãŒæ­£ã—ã„ã‹ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ­£å¸¸ã«è»¢é€ã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚

1. CLI ã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ï¼š
   ```bash
   clawdbot message --to imessage:+15555550123 "Hello from Clawdbot!"
   ```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š
- Messages ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡
- Gateway ãƒ­ã‚°ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- AI ãƒ¢ãƒ‡ãƒ«ã‚’è¨­å®šã—ã¦ã„ã‚‹å ´åˆã€AI ã‹ã‚‰ã®è¿”ä¿¡ã‚’å—ä¿¡

::: info æƒ…å ±
`imessage:+15555550123` å½¢å¼ã¯ã€iMessage ãƒãƒ£ãƒãƒ«ã‚’é€šã˜ã¦é›»è©±ç•ªå· `+15555550123` ã«é€ä¿¡ã™ã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ `imessage:user@example.com` ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚
:::

## ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ âœ…

è¨­å®šãŒæˆåŠŸã—ãŸã‹æ¤œè¨¼ï¼š

```bash
# ãƒãƒ£ãƒãƒ«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèª
clawdbot channels status

# ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšï¼š
# iMessage default: enabled, configured, rpc listening
```

::: info æƒ…å ±
ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã€`clawdbot channels status --probe` ã‚’å®Ÿè¡Œã—ã¦è©³ç´°ãªè¨ºæ–­æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
:::

## é«˜åº¦ãªè¨­å®š

### å°‚ç”¨ Mac ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

ç‹¬è‡ªã® iMessage ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½¿ç”¨ã—ãŸã„å ´åˆï¼ˆå€‹äººã® Messages ã«å½±éŸ¿ã‚’ä¸ãˆãŸããªã„ï¼‰ã€å°‚ç”¨ Mac ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã§ãã¾ã™ã€‚

**æ‰‹é †**ï¼š

1. **å°‚ç”¨ Apple ID ã‚’ä½œæˆ**ï¼š
   - [appleid.apple.com](https://appleid.apple.com) ã«ã‚¢ã‚¯ã‚»ã‚¹
   - æ–°ã—ã„ Apple ID ã‚’ä½œæˆï¼ˆä¾‹ï¼š`my-cool-bot@icloud.com`ï¼‰

2. **macOS ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ**ï¼š
   - **ã‚·ã‚¹ãƒ†ãƒ è¨­å®š** > **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚°ãƒ«ãƒ¼ãƒ—** ã‚’é–‹ã
   - **+** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆï¼ˆä¾‹ï¼š`botuser`ï¼‰
   - è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¨­å®šã™ã‚‹ã‹ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨˜æ†¶

3. **å°‚ç”¨ iMessage ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³**ï¼š
   - `botuser` ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆ
   - Messages ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ã
   - å°‚ç”¨ Apple ID ã§ iMessage ã«ãƒ­ã‚°ã‚¤ãƒ³

4. **ãƒªãƒ¢ãƒ¼ãƒˆãƒ­ã‚°ã‚¤ãƒ³ã‚’æœ‰åŠ¹åŒ–**ï¼š
   - **ã‚·ã‚¹ãƒ†ãƒ è¨­å®š** > **ä¸€èˆ¬** > **å…±æœ‰** ã‚’é–‹ã
   - **ãƒªãƒ¢ãƒ¼ãƒˆãƒ­ã‚°ã‚¤ãƒ³** ã‚’æœ‰åŠ¹åŒ–

5. **SSH éµèªè¨¼ã®è¨­å®š**ï¼š
   ```bash
   # ãƒ¡ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ SSH ã‚’ãƒ†ã‚¹ãƒˆ
   ssh botuser@localhost true

   # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ãªå ´åˆã€SSH éµã‚’è¨­å®šï¼š
   ssh-keygen -t ed25519
   ssh-copy-id botuser@localhost
   ```

6. **SSH wrapper ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ**ï¼š

   `~/.clawdbot/scripts/imsg-bot` ã‚’ä½œæˆï¼ˆ`chmod +x`ï¼‰ï¼š

   ```bash
   #!/usr/bin/env bash
   set -euo pipefail

   # ãƒ›ã‚¹ãƒˆã‚­ãƒ¼ã‚’å—ã‘å…¥ã‚Œã‚‹ãŸã‚ã« 1 å›ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ– SSH ã‚’å®Ÿè¡Œï¼š
   #   ssh botuser@localhost true
   exec /usr/bin/ssh -o BatchMode=yes -o ConnectTimeout=5 -T botuser@localhost \
     "/usr/local/bin/imsg" "$@"
   ```

7. **Clawdbot ã‚’è¨­å®š**ï¼š

   ```json5
   {
     channels: {
       imessage: {
         enabled: true,
         accounts: {
           bot: {
             name: "Bot",
             enabled: true,
             cliPath: "/Users/<your-username>/.clawdbot/scripts/imsg-bot",
             dbPath: "/Users/botuser/Library/Messages/chat.db"
           }
         }
       }
     }
   }
   ```

::: tip ãƒ’ãƒ³ãƒˆ
åˆå›è¨­å®šæ™‚ã€`botuser` ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ `imsg chats --limit 1` ã¾ãŸã¯ `imsg send ...` ã‚’ 1 å›å®Ÿè¡Œã—ã¦ã€Automation æ¨©é™ã‚’ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚
:::

### ãƒªãƒ¢ãƒ¼ãƒˆ Mac ã®è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

Gateway ãŒ Linux/VM ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ãŒ iMessage ã¯ Mac ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã€SSH çµŒç”±ã§ãƒªãƒ¢ãƒ¼ãƒˆæ¥ç¶šã§ãã¾ã™ã€‚

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          SSH (imsg rpc)          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gateway host (Linux/VM)      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Mac with Messages + imsg â”‚
â”‚ - clawdbot gateway           â”‚          SCP (attachments)        â”‚ - Messages signed in     â”‚
â”‚ - channels.imessage.cliPath  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ - Remote Login enabled   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–²
              â”‚ Tailscale tailnet (hostname or 100.x.y.z)
              â–¼
        user@remote-mac
```

**è¨­å®šæ‰‹é †**ï¼š

1. **SSH wrapper ã‚’ä½œæˆ**ï¼ˆ`~/.clawdbot/scripts/imsg-ssh`ï¼‰ï¼š

   ```bash
   #!/usr/bin/env bash
   exec ssh -T bot@remote-mac imsg "$@"
   ```

2. **Clawdbot ã‚’è¨­å®š**ï¼š

   ```json5
   {
     channels: {
       imessage: {
         enabled: true,
         cliPath: "/Users/<your-username>/.clawdbot/scripts/imsg-ssh",
         remoteHost: "bot@remote-mac",
         includeAttachments: true,
         dbPath: "/Users/bot/Library/Messages/chat.db"
       }
     }
   }
   ```

::: info æƒ…å ±
`remoteHost` ã¯ SCP æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚è¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€Clawdbot ã¯ SSH ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰è‡ªå‹•çš„ã«æ¤œå‡ºã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚æ˜ç¤ºçš„ãªè¨­å®šã®æ–¹ãŒä¿¡é ¼æ€§ãŒé«˜ã„ã§ã™ã€‚
:::

**Tailscale è¨­å®šä¾‹**ï¼š

```bash
# SSH wrapper
#!/usr/bin/env bash
exec ssh -T bot@mac-mini.tailnet-1234.ts.net imsg "$@"
```

```json5
{
  channels: {
    imessage: {
      enabled: true,
      cliPath: "~/.clawdbot/scripts/imsg-ssh",
      remoteHost: "bot@mac-mini.tailnet-1234.ts.net",
      includeAttachments: true,
      dbPath: "/Users/bot/Library/Messages/chat.db"
    }
  }
}
```

## è¨­å®šã®è©³ç´°

### åŸºæœ¬è¨­å®š

| è¨­å®šé …ç›® | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
| -------- | ------ | -------- | ------ |
| `enabled` | boolean | false | iMessage ãƒãƒ£ãƒãƒ«ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ |
| `cliPath` | string | "imsg" | imsg CLI ãƒ‘ã‚¹ï¼ˆSSH wrapper ã‚‚å¯ï¼‰ |
| `dbPath` | string | - | Messages chat.db ãƒ‘ã‚¹ |
| `remoteHost` | string | - | SSH ãƒ›ã‚¹ãƒˆï¼ˆSCP æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ç”¨ï¼‰ |

### DM ãƒãƒªã‚·ãƒ¼

| è¨­å®šé …ç›® | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
| -------- | ------ | -------- | ------ |
| `dmPolicy` | "pairing"|"allowlist"|"open"|"disabled" | "pairing" | DM ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ |
| `allowFrom` | array | [] | è¨±å¯ã•ã‚ŒãŸé€ä¿¡è€…ãƒªã‚¹ãƒˆï¼ˆhandlesã€emailsã€E.164ã€`chat_id:*`ï¼‰ |

**æ–°ã—ã„é€ä¿¡è€…ã‚’ãƒšã‚¢ãƒªãƒ³ã‚°**ï¼š

```bash
# ãƒšã‚¢ãƒªãƒ³ã‚°ã‚³ãƒ¼ãƒ‰ã‚’ãƒªã‚¹ãƒˆ
clawdbot pairing list imessage

# ãƒšã‚¢ãƒªãƒ³ã‚°ã‚’æ‰¿èª
clawdbot pairing approve imessage <CODE>
```

::: tip ãƒ’ãƒ³ãƒˆ
iMessage ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®æ¦‚å¿µãŒãªãã€handlesï¼ˆé›»è©±ç•ªå·ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã¾ãŸã¯ chat targetsï¼ˆ`chat_id`ã€`chat_guid`ã€`chat_identifier`ï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
:::

### ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒªã‚·ãƒ¼

| è¨­å®šé …ç›® | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
| -------- | ------ | -------- | ------ |
| `groupPolicy` | "allowlist"|"open"|"disabled" | "allowlist" | ã‚°ãƒ«ãƒ¼ãƒ—ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ |
| `groupAllowFrom` | array | [] | ã‚°ãƒ«ãƒ¼ãƒ—ã§ AI ã‚’ãƒˆãƒªã‚¬ãƒ¼ã§ãã‚‹é€ä¿¡è€… |
| `groups` | object | {} | chat_id ã«ã‚ˆã‚‹ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®š |

**ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®šä¾‹**ï¼š

```json5
{
  channels: {
    imessage: {
      groupPolicy: "allowlist",
      groupAllowFrom: ["+15555550123", "alice@example.com"],
      groups: {
        "42": {
          requireMention: false,
          allowFrom: ["bob@example.com"]
        }
      }
    }
  }
}
```

### ãƒ¡ãƒ‡ã‚£ã‚¢ã¨ãƒ†ã‚­ã‚¹ãƒˆã®åˆ¶é™

| è¨­å®šé …ç›® | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
| -------- | ------ | -------- | ------ |
| `includeAttachments` | boolean | false | æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å«ã‚ã‚‹ã‹ |
| `mediaMaxMb` | number | 16 | æœ€å¤§ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆMBï¼‰ |
| `textChunkLimit` | number | 4000 | é€ä¿¡ãƒ†ã‚­ã‚¹ãƒˆã®ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºï¼ˆæ–‡å­—æ•°ï¼‰ |
| `chunkMode` | "length"|"newline" | "length" | ãƒãƒ£ãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼šé•·ã•ã¾ãŸã¯ç©ºè¡Œã§åˆ†å‰² |

### å±¥æ­´

| è¨­å®šé …ç›® | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
| -------- | ------ | -------- | ------ |
| `historyLimit` | number | - | ã‚°ãƒ«ãƒ¼ãƒ—ã®æœ€å¤§å±¥æ­´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ï¼ˆ0 ã§ç„¡åŠ¹åŒ–ï¼‰ |
| `dmHistoryLimit` | number | - | DM å±¥æ­´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ¶é™ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å¾€å¾©æ•°ï¼‰ |
| `dms["<handle>"].historyLimit` | number | - | handle ã«ã‚ˆã‚‹ DM å±¥æ­´åˆ¶é™ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ |

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### imsg rpc ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ç”¨ã§ããªã„

**ç—‡çŠ¶**ï¼šGateway ãƒ­ã‚°ã« "imsg CLI does not support 'rpc' subcommand" ã¨è¡¨ç¤ºã•ã‚Œã‚‹

**åŸå› **ï¼š`imsg` ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ãã€`rpc` ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**ï¼š

1. `imsg` ã‚’æ›´æ–°ï¼š
   ```bash
   brew upgrade steipete/tap/imsg
   ```

2. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ¤œè¨¼ï¼š
   ```bash
   imsg rpc --help
   ```

### Full Disk Access æ¨©é™ã®å•é¡Œ

**ç—‡çŠ¶**ï¼š`imsg chats --limit 1` ãŒå‡ºåŠ›ã•ã‚Œãªã„ã€ã¾ãŸã¯ "Permission denied" ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ

**è§£æ±ºæ–¹æ³•**ï¼š

1. Clawdbot ã¨ `imsg` ãŒãƒ•ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
2. Gateway ã‚’å†èµ·å‹•
3. å•é¡ŒãŒç¶™ç¶šã™ã‚‹å ´åˆã€Mac ã‚’å†èµ·å‹•

### Automation æ¨©é™ã®å•é¡Œ

**ç—‡çŠ¶**ï¼šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã«åå¿œãŒãªã„ã€Gateway ãƒ­ã‚°ã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹

**åŸå› **ï¼šmacOS ãŒ Automation æ¨©é™ã‚’ä»˜ä¸ã—ã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**ï¼š

1. Messages ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§æ‰‹å‹•ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ 1 ä»¶é€ä¿¡
2. macOS ãŒæ¨©é™ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã¯ãš
3. **è¨±å¯** ã‚’ã‚¯ãƒªãƒƒã‚¯
4. å°‚ç”¨ Mac ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆã¦æ‰‹é †ã‚’ç¹°ã‚Šè¿”ã™

### ãƒªãƒ¢ãƒ¼ãƒˆ Mac æ¥ç¶šã®å¤±æ•—

**ç—‡çŠ¶**ï¼šSSH wrapper ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹ã€ã¾ãŸã¯æ¥ç¶šãŒæ‹’å¦ã•ã‚Œã‚‹

**è§£æ±ºæ–¹æ³•**ï¼š

1. SSH æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆï¼š
   ```bash
   ssh -T bot@remote-mac imsg --version
   ```

2. ãƒªãƒ¢ãƒ¼ãƒˆ Mac ã§ Remote Login ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

3. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¨ãƒãƒ¼ãƒˆè¨­å®šã‚’ç¢ºèª

4. Tailscale ã‚’ä½¿ç”¨ã—ã¦å†…ç¶²ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç°¡ç´ åŒ–

## ã¾ã¨ã‚

- `imsg` CLI ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ
- Full Disk Access ãŠã‚ˆã³ Automation æ¨©é™ã‚’è¨­å®šã—ãŸ
- ãƒ­ãƒ¼ã‚«ãƒ«ãŠã‚ˆã³ãƒªãƒ¢ãƒ¼ãƒˆ Mac ã®è¨­å®šæ–¹æ³•ã‚’å­¦ã‚“ã 
- DM ãƒšã‚¢ãƒªãƒ³ã‚°ã¨ã‚°ãƒ«ãƒ¼ãƒ— allowlist ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ãŸ
- chat_idã€chat_guidã€chat_identifier ã®é•ã„ã‚’ç†è§£ã—ãŸ
- 1:1 ãŠã‚ˆã³ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ†ã‚¹ãƒˆã—ãŸ

## æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³

> æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ **[LINE ãƒãƒ£ãƒãƒ«](../line/)** ã‚’å­¦ç¿’ã—ã¾ã™ã€‚
>
> å­¦ç¿’å†…å®¹ï¼š
> - LINE Messaging API ã®èªè¨¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹æ–¹æ³•
> - LINE Bot ã® Webhook ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹
> - LINE ãƒãƒ£ãƒãƒ«ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼ã¨åˆ¶é™
> - iMessage ãƒãƒ£ãƒãƒ«ã¨ã®è¨­å®šã®é•ã„

---

## ä»˜éŒ²ï¼šã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å‚ç…§

<details>
<summary><strong>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å ´æ‰€ã‚’å±•é–‹</strong></summary>

> æ›´æ–°æ—¥æ™‚ï¼š2026-01-27

| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | è¡Œç•ªå· |
| ------ | --------- | ---- |
| iMessage è¨­å®šå‹å®šç¾© | [`src/config/types.imessage.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/config/types.imessage.ts) | 1-80 |
| iMessage ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè§£æ | [`src/imessage/accounts.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/imessage/accounts.ts) | 1-83 |
| iMessage ãƒ—ãƒ­ãƒ¼ãƒ– | [`src/imessage/probe.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/imessage/probe.ts) | 1-92 |
| iMessage é€ä¿¡ | [`src/imessage/send.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/imessage/send.ts) | 1-135 |
| iMessage ãƒ¢ãƒ‹ã‚¿ãƒ¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ | [`src/imessage/monitor/monitor-provider.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/imessage/monitor/monitor-provider.ts) | 1-600+ |
| ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹è§£æ | [`src/imessage/targets.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/imessage/targets.ts) | 1-200+ |
| Onboarding ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ | [`src/channels/plugins/onboarding/imessage.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/channels/plugins/onboarding/imessage.ts) | 1-262 |
| iMessage ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | [`docs/channels/imessage.md`](https://github.com/clawdbot/clawdbot/blob/main/docs/channels/imessage.md) | 1-262 |

**é‡è¦ãªå‹**ï¼š
- `IMessageConfig`: å®Œå…¨ãª iMessage è¨­å®šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- `IMessageAccountConfig`: å˜ä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š
- `IMessageService`: "imessage" | "sms" | "auto"
- `IMessageTargetKind`: "chat_id" | "chat_guid" | "chat_identifier" | "handle"

**é‡è¦ãªè¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**ï¼š
- `cliPath`: imsg CLI ãƒ‘ã‚¹ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‘ã‚¹ã¾ãŸã¯ SSH wrapper ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨å¯èƒ½
- `dbPath`: Messages chat.db ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹
- `remoteHost`: SSH ãƒ›ã‚¹ãƒˆï¼ˆSCP æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ç”¨ï¼‰ã€‚è‡ªå‹•æ¤œå‡ºã¾ãŸã¯æ˜ç¤ºçš„ãªè¨­å®š
- `dmPolicy`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ "pairing"ã€‚æœªçŸ¥ã® DM ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡
- `groupPolicy`: ã‚°ãƒ«ãƒ¼ãƒ—ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã€‚"allowlist" ã¾ãŸã¯ "open"
- `groups`: `chat_id` ã«ã‚ˆã‚‹ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®šã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†é›¢ã¨ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆ

**é‡è¦ãªé–¢æ•°**ï¼š
- `probeIMessage()`: imsg CLI ãŒä½¿ç”¨å¯èƒ½ã§ rpc ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã‹æ¤œè¨¼ï¼ˆ`probe.ts`ï¼‰
- `sendMessageIMessage()`: iMessage ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã€‚ãƒ†ã‚­ã‚¹ãƒˆã¨ãƒ¡ãƒ‡ã‚£ã‚¢ã‚’ã‚µãƒãƒ¼ãƒˆï¼ˆ`send.ts`ï¼‰
- `monitorIMessageProvider()`: iMessage ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ç›£è¦–ï¼ˆ`monitor-provider.ts`ï¼‰
- `parseIMessageTarget()`: ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è§£æï¼ˆchat_idã€handleã€email ãªã©ï¼‰ï¼ˆ`targets.ts`ï¼‰

**é€šä¿¡ãƒ¡ã‚«ãƒ‹ã‚ºãƒ **ï¼š
- `imsg rpc` ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’é€šã˜ã¦ JSON-RPC over stdio é€šä¿¡ã‚’å®Ÿç¾
- å„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¯ç‹¬ç«‹ã—ãŸ RPC ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚‹ï¼ˆ`createIMessageRpcClient`ï¼‰
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¤ãƒ™ãƒ³ãƒˆã¯ `monitor-provider.ts` ã‚’é€šã˜ã¦ Gateway ã«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°è»¢é€ã•ã‚Œã‚‹
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ™‚ã€`chat_id`ï¼ˆæ¨å¥¨ï¼‰ã€`chat_guid`ã€`chat_identifier`ã€ã¾ãŸã¯ç›´æ¥ handle ã‚’ã‚µãƒãƒ¼ãƒˆ

**ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¯¾å¿œ**ï¼š
- `channels.imessage.accounts` ãƒãƒƒãƒ—ã‚’ä½¿ç”¨ã—ã¦è¤‡æ•°ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¨­å®š
- å„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¯ç‹¬ç«‹ã—ãŸ `cliPath`ã€`dbPath`ã€ãŠã‚ˆã³ãƒãƒªã‚·ãƒ¼è¨­å®šãŒã‚ã‚‹
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ ID ã¯ "default"ã€‚`accountId` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§æŒ‡å®šå¯èƒ½

</details>
