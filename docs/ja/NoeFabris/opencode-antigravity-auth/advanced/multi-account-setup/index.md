---
title: "ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š: ã‚¯ã‚©ãƒ¼ã‚¿ãƒ—ãƒ¼ãƒªãƒ³ã‚°ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚° | opencode-antigravity-auth"
sidebarTitle: "ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è©¦ã™"
subtitle: "ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šï¼šã‚¯ã‚©ãƒ¼ã‚¿ãƒ—ãƒ¼ãƒªãƒ³ã‚°ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°"
description: "è¤‡æ•°ã® Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¨­å®šã—ã¦ã‚¯ã‚©ãƒ¼ã‚¿ãƒ—ãƒ¼ãƒªãƒ³ã‚°ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¯ã‚©ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠæˆ¦ç•¥ã€PID ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨­å®šã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã€API ã‚¯ã‚©ãƒ¼ã‚¿ã®åˆ©ç”¨ç‡ã‚’æœ€å¤§åŒ–ã—ã¾ã—ã‚‡ã†ã€‚"
tags:
  - "advanced"
  - "multi-account"
  - "load-balancing"
  - "quota-management"
prerequisite:
  - "start-quick-install"
  - "start-first-auth-login"
order: 4
---

# ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šï¼šã‚¯ã‚©ãƒ¼ã‚¿ãƒ—ãƒ¼ãƒªãƒ³ã‚°ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°

## ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§å­¦ã¹ã‚‹ã“ã¨

- è¤‡æ•°ã® Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¦ã€ç·ã‚¯ã‚©ãƒ¼ã‚¿ä¸Šé™ã‚’å¼•ãä¸Šã’ã‚‹
- ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¯ã‚©ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã‚’ç†è§£ã—ã€Antigravity ã¨ Gemini CLI ã®ã‚¯ã‚©ãƒ¼ã‚¿ãƒ—ãƒ¼ãƒ«ã‚’åŠ¹æœçš„ã«æ´»ç”¨ã™ã‚‹
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•°ã¨åˆ©ç”¨ã‚·ãƒ¼ãƒ³ã«å¿œã˜ãŸæœ€é©ãªãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°æˆ¦ç•¥ã‚’é¸æŠã™ã‚‹
- ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã§ã‚ˆãã‚ã‚‹å•é¡Œã‚’ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹

## ä»Šã‚ãªãŸãŒç›´é¢ã—ã¦ã„ã‚‹èª²é¡Œ

ã‚·ãƒ³ã‚°ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ä½¿ç”¨ã—ã¦ã„ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå•é¡Œã«é­é‡ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼š

- 429 ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼ãŒé »ç™ºã—ã€ã‚¯ã‚©ãƒ¼ã‚¿å›å¾©ã‚’å¾…ãŸãªã‘ã‚Œã°ãªã‚‰ãªã„
- é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤šã™ãã¦ã€1 ã¤ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã¯å¯¾å¿œã—ãã‚Œãªã„
- Gemini 3 Pro ã‚„ Claude Opus ãƒ¢ãƒ‡ãƒ«ã®ã‚¯ã‚©ãƒ¼ã‚¿ã‚’ä½¿ã„åˆ‡ã‚‹ã¨ã€ç¿Œæ—¥ã¾ã§å¾…ã¤ã—ã‹ãªã„
- è¤‡æ•°ã® OpenCode ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚„ oh-my-opencode ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé–“ã§ç«¶åˆãŒç™ºç”Ÿã™ã‚‹

## ã©ã‚“ãªæ™‚ã«ã“ã®æ–¹æ³•ã‚’ä½¿ã†ã¹ãã‹

ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã¯ä»¥ä¸‹ã®ã‚·ãƒ¼ãƒ³ã«é©ã—ã¦ã„ã¾ã™ï¼š

| ã‚·ãƒ¼ãƒ³ | æ¨å¥¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•° | ç†ç”± |
| --- | --- | --- |
| å€‹äººé–‹ç™º | 2ã€œ3 å€‹ | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ä¸­æ–­ã‚’å›é¿ |
| ãƒãƒ¼ãƒ é–‹ç™º | 3ã€œ5 å€‹ | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’åˆ†æ•£ã—ã€ç«¶åˆã‚’è»½æ¸› |
| é«˜é »åº¦ API å‘¼ã³å‡ºã— | 5 å€‹ä»¥ä¸Š | ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã§ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæœ€å¤§åŒ– |
| ä¸¦åˆ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | 3 å€‹ä»¥ä¸Š + PID ã‚ªãƒ•ã‚»ãƒƒãƒˆ | å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ç‹¬ç«‹ã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆ |

::: warning å‰ææ¡ä»¶ã®ç¢ºèª
ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’å§‹ã‚ã‚‹å‰ã«ã€ä»¥ä¸‹ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
- âœ… opencode-antigravity-auth ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- âœ… OAuth èªè¨¼ã«æˆåŠŸã—ã€æœ€åˆã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¿½åŠ æ¸ˆã¿
- âœ… Antigravity ãƒ¢ãƒ‡ãƒ«ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã§ãã‚‹çŠ¶æ…‹

[ã‚¯ã‚¤ãƒƒã‚¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«](../../start/quick-install/) | [åˆå›ãƒ­ã‚°ã‚¤ãƒ³](../../start/first-auth-login/)
:::

## åŸºæœ¬çš„ãªä»•çµ„ã¿

ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã®æ ¸ã¨ãªã‚‹ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ï¼š

1. **ã‚¯ã‚©ãƒ¼ã‚¿ãƒ—ãƒ¼ãƒªãƒ³ã‚°**ï¼šå„ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¯ç‹¬ç«‹ã—ãŸã‚¯ã‚©ãƒ¼ã‚¿ãŒã‚ã‚Šã€è¤‡æ•°ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¯ã‚©ãƒ¼ã‚¿ã‚’åˆç®—ã™ã‚‹ã“ã¨ã§ã‚ˆã‚Šå¤§ããªãƒ—ãƒ¼ãƒ«ã‚’å½¢æˆ
2. **ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°**ï¼šãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒè‡ªå‹•çš„ã«åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é¸æŠã—ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã—ãŸã‚‰æ¬¡ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«åˆ‡ã‚Šæ›¿ãˆ
3. **ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¯ã‚©ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ **ï¼ˆGemini ã®ã¿ï¼‰ï¼šå„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ Antigravity ã¨ Gemini CLI ã® 2 ã¤ã®ç‹¬ç«‹ã—ãŸã‚¯ã‚©ãƒ¼ã‚¿ãƒ—ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
4. **ã‚¹ãƒãƒ¼ãƒˆãƒªã‚«ãƒãƒª**ï¼šãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®é‡è¤‡æ’é™¤ï¼ˆ2 ç§’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰+ æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã§ã€ç„¡é§„ãªãƒªãƒˆãƒ©ã‚¤ã‚’å›é¿

**ã‚¯ã‚©ãƒ¼ã‚¿è¨ˆç®—ã®ä¾‹**ï¼š

å„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã® Claude ã‚¯ã‚©ãƒ¼ã‚¿ãŒ 1000 ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†ã®å ´åˆï¼š

| ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•° | ç†è«–ä¸Šã®ç·ã‚¯ã‚©ãƒ¼ã‚¿ | å®Ÿéš›ã«åˆ©ç”¨å¯èƒ½ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥è€ƒæ…®ï¼‰ |
| --- | --- | --- |
| 1 | 1000/min | 1000/min |
| 3 | 3000/min | ç´„ 2500/minï¼ˆsticky æˆ¦ç•¥ï¼‰ |
| 5 | 5000/min | ç´„ 4000/minï¼ˆround-robinï¼‰ |

> ğŸ’¡ **ãªãœ sticky æˆ¦ç•¥ã ã¨åˆ©ç”¨å¯èƒ½ã‚¯ã‚©ãƒ¼ã‚¿ãŒå°‘ãªããªã‚‹ã®ã‹ï¼Ÿ**
>
> sticky æˆ¦ç•¥ã¯ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã™ã‚‹ã¾ã§åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ã„ç¶šã‘ã‚‹ãŸã‚ã€ä»–ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¯ã‚©ãƒ¼ã‚¿ãŒéŠä¼‘çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚ãŸã ã—ã€Anthropic ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¶­æŒã§ãã‚‹ãŸã‚ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦ãŒå‘ä¸Šã™ã‚‹ã¨ã„ã†ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚

## å®Ÿè·µæ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ— 1ï¼š2 ã¤ç›®ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹

**ãªãœå¿…è¦ã‹**
2 ã¤ç›®ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹ã¨ã€ãƒ¡ã‚¤ãƒ³ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã—ãŸéš›ã«ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒè‡ªå‹•çš„ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«åˆ‡ã‚Šæ›¿ãˆã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å¤±æ•—ã‚’é˜²ãã¾ã™ã€‚

**æ“ä½œæ‰‹é †**

OAuth ãƒ­ã‚°ã‚¤ãƒ³ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

```bash
opencode auth login
```

ã™ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆã€ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
1 account(s) saved:
  1. user1@gmail.com

(a)dd new account(s) or (f)resh start? [a/f]:
```

`a` ã‚’å…¥åŠ›ã—ã¦ Enter ã‚’æŠ¼ã™ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒè‡ªå‹•çš„ã« Google èªè¨¼ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã™ã€‚

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ Google OAuth èªè¨¼ãƒšãƒ¼ã‚¸ãŒé–‹ã
2. 2 ã¤ç›®ã® Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é¸æŠã¾ãŸã¯ãƒ­ã‚°ã‚¤ãƒ³
3. èªè¨¼ã‚’è¨±å¯ã™ã‚‹ã¨ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼š

```
Account added successfully!

2 account(s) saved:
  1. user1@gmail.com
  2. user2@gmail.com
```

::: tip
ãƒ–ãƒ©ã‚¦ã‚¶ãŒè‡ªå‹•çš„ã«é–‹ã‹ãªã„å ´åˆã¯ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è¡¨ç¤ºã•ã‚ŒãŸ OAuth URL ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€æ‰‹å‹•ã§ãƒ–ãƒ©ã‚¦ã‚¶ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚
:::

### ã‚¹ãƒ†ãƒƒãƒ— 2ï¼šãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹

**ãªãœå¿…è¦ã‹**
ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒæ­£ã—ãè¿½åŠ ã•ã‚Œã€åˆ©ç”¨å¯èƒ½ãªçŠ¶æ…‹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

**æ“ä½œæ‰‹é †**

ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¾ã™ï¼š

```bash
cat ~/.config/opencode/antigravity-accounts.json
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š

```json
{
  "version": 3,
  "accounts": [
    {
      "email": "user1@gmail.com",
      "refreshToken": "1//0abc...",
      "projectId": "project-id-123",
      "addedAt": 1737609600000,
      "lastUsed": 1737609600000
    },
    {
      "email": "user2@gmail.com",
      "refreshToken": "1//0xyz...",
      "addedAt": 1737609700000,
      "lastUsed": 1737609700000
    }
  ],
  "activeIndex": 0,
  "activeIndexByFamily": {
    "claude": 0,
    "gemini": 0
  }
}
```

::: warning ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹æ³¨æ„
`antigravity-accounts.json` ã«ã¯ OAuth ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒç­‰ã®æ©Ÿå¯†æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„ã€‚
:::

### ã‚¹ãƒ†ãƒƒãƒ— 3ï¼šã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ‡ã‚Šæ›¿ãˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹

**ãªãœå¿…è¦ã‹**
ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

**æ“ä½œæ‰‹é †**

è¤‡æ•°ã®ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ï¼š

```bash
# macOS/Linux
for i in {1..10}; do
  opencode run "Test $i" --model=google/antigravity-claude-sonnet-4-5 &
done
wait

# Windows PowerShell
1..10 | ForEach-Object {
  Start-Process -FilePath "opencode" -ArgumentList "run","Test $_","--model=google/antigravity-claude-sonnet-4-5"
}
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š

1. æœ€åˆã® N ä»¶ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ 1ï¼ˆuser1@gmail.comï¼‰ã‚’ä½¿ç”¨
2. 429 ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ 2ï¼ˆuser2@gmail.comï¼‰ã«åˆ‡ã‚Šæ›¿ãˆ
3. é€šçŸ¥ãŒæœ‰åŠ¹ãªå ´åˆã€ã€ŒSwitched to account 2ã€ã¨ã„ã†ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œã‚‹

::: info ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ‡ã‚Šæ›¿ãˆé€šçŸ¥
`quiet_mode: false`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ‡ã‚Šæ›¿ãˆé€šçŸ¥ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚åˆå›ã®åˆ‡ã‚Šæ›¿ãˆã§ã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã€ä»¥é™ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ã¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
:::

### ã‚¹ãƒ†ãƒƒãƒ— 4ï¼šãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¯ã‚©ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­å®šã™ã‚‹ï¼ˆGemini å°‚ç”¨ï¼‰

**ãªãœå¿…è¦ã‹**
ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¯ã‚©ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€Antigravity ã®ã‚¯ã‚©ãƒ¼ã‚¿ãŒæ¯æ¸‡ã—ãŸéš›ã«ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒè‡ªå‹•çš„ã« Gemini CLI ã®ã‚¯ã‚©ãƒ¼ã‚¿ã‚’è©¦è¡Œã—ã¾ã™ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

**æ“ä½œæ‰‹é †**

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã™ï¼š

```bash
# macOS/Linux
nano ~/.config/opencode/antigravity.json

# Windows
notepad %APPDATA%\opencode\antigravity.json
```

ä»¥ä¸‹ã®è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ï¼š

```json
{
  "$schema": "https://raw.githubusercontent.com/NoeFabris/opencode-antigravity-auth/main/assets/antigravity.schema.json",
  "quota_fallback": true
}
```

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã€OpenCode ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š

1. Gemini ãƒ¢ãƒ‡ãƒ«ä½¿ç”¨æ™‚ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯å„ªå…ˆçš„ã« Antigravity ã‚¯ã‚©ãƒ¼ã‚¿ã‚’ä½¿ç”¨
2. Antigravity ãŒ 429 ã‚’è¿”ã™ã¨ã€åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã® Gemini CLI ã‚¯ã‚©ãƒ¼ã‚¿ã«è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ
3. ä¸¡æ–¹ã®ã‚¯ã‚©ãƒ¼ã‚¿ãŒãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã—ãŸå ´åˆã€æ¬¡ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«åˆ‡ã‚Šæ›¿ãˆ

::: tip ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¯ã‚©ãƒ¼ã‚¿ vs ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- **ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¯ã‚©ãƒ¼ã‚¿**ï¼šåŒä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã® 2 ã¤ã®ç‹¬ç«‹ã—ãŸã‚¯ã‚©ãƒ¼ã‚¿ãƒ—ãƒ¼ãƒ«ï¼ˆAntigravity + Gemini CLIï¼‰
- **ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ï¼šè¤‡æ•°ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¯ã‚©ãƒ¼ã‚¿ãƒ—ãƒ¼ãƒ«ã‚’åˆç®—
- ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ï¼šã¾ãšãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¯ã‚©ãƒ¼ã‚¿ã‚’æœ‰åŠ¹ã«ã—ã€ãã®å¾Œãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¿½åŠ 
:::

### ã‚¹ãƒ†ãƒƒãƒ— 5ï¼šã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠæˆ¦ç•¥ã‚’é¸ã¶

**ãªãœå¿…è¦ã‹**
ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•°ã‚„åˆ©ç”¨ã‚·ãƒ¼ãƒ³ã«ã‚ˆã£ã¦æœ€é©ãªæˆ¦ç•¥ãŒç•°ãªã‚Šã€é©åˆ‡ãªé¸æŠã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€å¤§åŒ–ã§ãã¾ã™ã€‚

**æ“ä½œæ‰‹é †**

`antigravity.json` ã§æˆ¦ç•¥ã‚’è¨­å®šã—ã¾ã™ï¼š

```json
{
  "account_selection_strategy": "hybrid"
}
```

ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•°ã«å¿œã˜ã¦é¸æŠã—ã¦ãã ã•ã„ï¼š

| ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•° | æ¨å¥¨æˆ¦ç•¥ | è¨­å®šå€¤ | ç†ç”± |
| --- | --- | --- | --- |
| 1 | sticky | `"sticky"` | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¶­æŒ |
| 2ã€œ5 | hybrid | `"hybrid"` | ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒãƒ©ãƒ³ã‚¹ |
| 5 ä»¥ä¸Š | round-robin | `"round-robin"` | ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæœ€å¤§åŒ– |

**æˆ¦ç•¥ã®è©³ç´°**ï¼š

- **sticky**ï¼ˆã‚·ãƒ³ã‚°ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ï¼šãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã™ã‚‹ã¾ã§åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ã„ç¶šã‘ã‚‹ã€‚å˜ä¸€ã®é–‹ç™ºã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æœ€é©
- **round-robin**ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«æ¬¡ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€‚ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæœ€å¤§åŒ–ã ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯çŠ ç‰²ã«
- **hybrid**ï¼ˆãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ï¼šãƒ˜ãƒ«ã‚¹ã‚¹ã‚³ã‚¢ + ãƒˆãƒ¼ã‚¯ãƒ³ãƒã‚±ãƒƒãƒˆ + LRU ã«åŸºã¥ãç·åˆçš„ãªåˆ¤æ–­

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š

1. `hybrid` æˆ¦ç•¥ä½¿ç”¨æ™‚ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯è‡ªå‹•çš„ã«æœ€é©ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é¸æŠ
2. `round-robin` æˆ¦ç•¥ä½¿ç”¨æ™‚ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å‡ç­‰ã«åˆ†æ•£
3. `sticky` æˆ¦ç•¥ä½¿ç”¨æ™‚ã€åŒä¸€ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ã¯å¸¸ã«åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨

### ã‚¹ãƒ†ãƒƒãƒ— 6ï¼šPID ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹ï¼ˆä¸¦åˆ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‘ã‘ï¼‰

**ãªãœå¿…è¦ã‹**
è¤‡æ•°ã® OpenCode ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚„ oh-my-opencode ä¸¦åˆ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã™ã‚‹éš›ã€ç•°ãªã‚‹ãƒ—ãƒ­ã‚»ã‚¹ãŒåŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é¸æŠã—ã¦ç«¶åˆãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**æ“ä½œæ‰‹é †**

`antigravity.json` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```json
{
  "pid_offset_enabled": true
}
```

ä¿å­˜ã—ã¦ OpenCode ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š

1. ç•°ãªã‚‹ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆç•°ãªã‚‹ PIDï¼‰ã¯ç•°ãªã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‹ã‚‰é–‹å§‹
2. ä¸¦åˆ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç«¶åˆãŒè»½æ¸›
3. å…¨ä½“çš„ãªã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆãŒå‘ä¸Š

::: tip PID ã‚ªãƒ•ã‚»ãƒƒãƒˆã®ä»•çµ„ã¿
PID ã‚ªãƒ•ã‚»ãƒƒãƒˆã¯ãƒ—ãƒ­ã‚»ã‚¹ ID ã‚’ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚ªãƒ•ã‚»ãƒƒãƒˆã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¾ã™ã€‚ä¾‹ï¼š
- PID 100 â†’ ã‚ªãƒ•ã‚»ãƒƒãƒˆ 0 â†’ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ 0 ã‹ã‚‰é–‹å§‹
- PID 101 â†’ ã‚ªãƒ•ã‚»ãƒƒãƒˆ 1 â†’ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ 1 ã‹ã‚‰é–‹å§‹
- PID 102 â†’ ã‚ªãƒ•ã‚»ãƒƒãƒˆ 2 â†’ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ 2 ã‹ã‚‰é–‹å§‹
:::

## ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ âœ…

ä¸Šè¨˜ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

- [ ] `opencode auth login` ã§è¤‡æ•°ã® Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¿½åŠ 
- [ ] `antigravity-accounts.json` ã§è¤‡æ•°ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã™ã‚‹ã¨ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒè‡ªå‹•çš„ã«æ¬¡ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«åˆ‡ã‚Šæ›¿ãˆ
- [ ] Gemini ãƒ¢ãƒ‡ãƒ«ã§ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¯ã‚©ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æœ‰åŠ¹åŒ–
- [ ] ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•°ã«å¿œã˜ãŸé©åˆ‡ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠæˆ¦ç•¥ã‚’é¸æŠ
- [ ] ä¸¦åˆ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ãƒ¼ãƒ³ã§ PID ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’æœ‰åŠ¹åŒ–

## ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã¨è§£æ±ºç­–

### ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã—ãŸ

**ç—‡çŠ¶**ï¼šã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ 429 ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¶šè¡Œã§ããªã„

**åŸå› **ï¼šã‚¯ã‚©ãƒ¼ã‚¿æ¯æ¸‡ã¾ãŸã¯ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤šã™ãã‚‹

**è§£æ±ºç­–**ï¼š

1. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒè‡ªå‹•çš„ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã¾ã§å¾…ã¤ï¼ˆé€šå¸¸ 1ã€œ5 åˆ†ï¼‰
2. é•·æœŸçš„ã«å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å ´åˆã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¿½åŠ 
3. è¨­å®šã® `max_rate_limit_wait_seconds` ã‚’ç¢ºèªã—ã€é©åˆ‡ãªå¾…æ©Ÿä¸Šé™ã‚’è¨­å®š

### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ‡ã‚Šæ›¿ãˆãŒé »ç¹ã™ãã‚‹

**ç—‡çŠ¶**ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã€åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½¿ç”¨ã•ã‚Œãªã„

**åŸå› **ï¼šæˆ¦ç•¥ã®é¸æŠãŒä¸é©åˆ‡ã€ã¾ãŸã¯ãƒ˜ãƒ«ã‚¹ã‚¹ã‚³ã‚¢ã®ç•°å¸¸

**è§£æ±ºç­–**ï¼š

1. æˆ¦ç•¥ã‚’ `sticky` ã«å¤‰æ›´
2. `health_score` è¨­å®šã‚’ç¢ºèªã—ã€`min_usable` ã¨ `rate_limit_penalty` ã‚’èª¿æ•´
3. é »ç¹ãª 429 ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚Šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä¸å¥å…¨ã¨ãƒãƒ¼ã‚¯ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª

### Gemini CLI æ¨©é™ã‚¨ãƒ©ãƒ¼ï¼ˆ403ï¼‰

**ç—‡çŠ¶**ï¼šGemini CLI ãƒ¢ãƒ‡ãƒ«ä½¿ç”¨æ™‚ã« `Permission denied` ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã‚‹

**åŸå› **ï¼šã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«æœ‰åŠ¹ãª Project ID ãŒãªã„

**è§£æ±ºç­–**ï¼š

1. å„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« `projectId` ã‚’æ‰‹å‹•ã§è¿½åŠ ï¼š

```json
{
  "accounts": [
    {
      "email": "your@email.com",
      "refreshToken": "...",
      "projectId": "your-project-id"
    }
  ]
}
```

2. [Google Cloud Console](https://console.cloud.google.com/) ã§ Gemini for Google Cloud API ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

### ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹ï¼ˆinvalid_grantï¼‰

**ç—‡çŠ¶**ï¼šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒè‡ªå‹•çš„ã«å‰Šé™¤ã•ã‚Œã€`invalid_grant` ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**åŸå› **ï¼šGoogle ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã€ã¾ãŸã¯ãƒˆãƒ¼ã‚¯ãƒ³ã®æœŸé™åˆ‡ã‚Œ

**è§£æ±ºç­–**ï¼š

1. ç„¡åŠ¹ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¦å†èªè¨¼ï¼š

```bash
rm ~/.config/opencode/antigravity-accounts.json
opencode auth login
```

2. é »ç¹ã«ç™ºç”Ÿã™ã‚‹å ´åˆã¯ã€ã‚ˆã‚Šå®‰å®šã—ãŸ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½¿ç”¨ã‚’æ¤œè¨

## ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ã¾ã¨ã‚

- ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã«ã‚ˆã‚Šã€ç·ã‚¯ã‚©ãƒ¼ã‚¿ä¸Šé™ã¨ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å®šæ€§ãŒå‘ä¸Š
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¿½åŠ ã¯ç°¡å˜ã§ã€`opencode auth login` ã‚’ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã™ã‚‹ã ã‘
- ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¯ã‚©ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šã€å„ Gemini ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åˆ©ç”¨å¯èƒ½ã‚¯ã‚©ãƒ¼ã‚¿ãŒ 2 å€ã«
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠæˆ¦ç•¥ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•°ã¨åˆ©ç”¨ã‚·ãƒ¼ãƒ³ã«å¿œã˜ã¦èª¿æ•´ã™ã¹ã
- PID ã‚ªãƒ•ã‚»ãƒƒãƒˆã¯ä¸¦åˆ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ãƒ¼ãƒ³ã§éå¸¸ã«é‡è¦

## æ¬¡ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

> æ¬¡ã¯ **[ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠæˆ¦ç•¥](../account-selection-strategies/)** ã‚’å­¦ã³ã¾ã™ã€‚
>
> å­¦ã¹ã‚‹å†…å®¹ï¼š
> - stickyã€round-robinã€hybrid ã® 3 ã¤ã®æˆ¦ç•¥ã®è©³ç´°ãªå‹•ä½œåŸç†
> - ã‚·ãƒ¼ãƒ³ã«å¿œã˜ãŸæœ€é©ãªæˆ¦ç•¥ã®é¸ã³æ–¹
> - ãƒ˜ãƒ«ã‚¹ã‚¹ã‚³ã‚¢ã¨ãƒˆãƒ¼ã‚¯ãƒ³ãƒã‚±ãƒƒãƒˆã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°æ–¹æ³•

---

## ä»˜éŒ²ï¼šã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å‚ç…§

<details>
<summary><strong>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å ´æ‰€ã‚’è¡¨ç¤º</strong></summary>

> æ›´æ–°æ—¥ï¼š2026-01-23

| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | è¡Œç•ªå· |
| --- | --- | --- |
| AccountManager ã‚¯ãƒ©ã‚¹ | [`src/plugin/accounts.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/accounts.ts#L174-L250) | 174-250 |
| ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°æˆ¦ç•¥ | [`src/plugin/rotation.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/rotation.ts) | å…¨ä½“ |
| è¨­å®šã‚¹ã‚­ãƒ¼ãƒ | [`src/plugin/config/schema.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/config/schema.ts) | å…¨ä½“ |
| ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | [`src/plugin/storage.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/storage.ts) | å…¨ä½“ |

**ä¸»è¦ãªå®šæ•°**ï¼š

| å®šæ•°å | å€¤ | èª¬æ˜ |
| --- | --- | --- |
| `QUOTA_EXHAUSTED_BACKOFFS` | `[60000, 300000, 1800000, 7200000]` | ã‚¯ã‚©ãƒ¼ã‚¿æ¯æ¸‡æ™‚ã®ãƒãƒƒã‚¯ã‚ªãƒ•æ™‚é–“ï¼ˆ1åˆ†â†’5åˆ†â†’30åˆ†â†’2æ™‚é–“ï¼‰ |
| `RATE_LIMIT_EXCEEDED_BACKOFF` | `30000` | ãƒ¬ãƒ¼ãƒˆåˆ¶é™æ™‚ã®ãƒãƒƒã‚¯ã‚ªãƒ•æ™‚é–“ï¼ˆ30ç§’ï¼‰ |
| `MIN_BACKOFF_MS` | `2000` | æœ€å°ãƒãƒƒã‚¯ã‚ªãƒ•æ™‚é–“ï¼ˆ2ç§’ï¼‰ |

**ä¸»è¦ãªé–¢æ•°**ï¼š

- `calculateBackoffMs(reason, consecutiveFailures, retryAfterMs)`ï¼šãƒãƒƒã‚¯ã‚ªãƒ•é…å»¶ã‚’è¨ˆç®—
- `getQuotaKey(family, headerStyle, model)`ï¼šã‚¯ã‚©ãƒ¼ã‚¿ã‚­ãƒ¼ã‚’ç”Ÿæˆï¼ˆãƒ¢ãƒ‡ãƒ«ãƒ¬ãƒ™ãƒ«ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’ã‚µãƒãƒ¼ãƒˆï¼‰
- `isRateLimitedForQuotaKey(account, key)`ï¼šç‰¹å®šã®ã‚¯ã‚©ãƒ¼ã‚¿ã‚­ãƒ¼ãŒãƒ¬ãƒ¼ãƒˆåˆ¶é™ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
- `selectHybridAccount(accounts, family)`ï¼šhybrid æˆ¦ç•¥ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠãƒ­ã‚¸ãƒƒã‚¯

**è¨­å®šé …ç›®**ï¼ˆschema.ts ã‚ˆã‚Šï¼‰ï¼š

| è¨­å®šé …ç›® | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
| --- | --- | --- | --- |
| `account_selection_strategy` | enum | `"hybrid"` | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠæˆ¦ç•¥ |
| `quota_fallback` | boolean | `false` | Gemini ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¯ã‚©ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æœ‰åŠ¹åŒ– |
| `pid_offset_enabled` | boolean | `false` | PID ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’æœ‰åŠ¹åŒ– |
| `switch_on_first_rate_limit` | boolean | `true` | åˆå›ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã§å³åº§ã«åˆ‡ã‚Šæ›¿ãˆ |

</details>
