---
title: "Настройка Provider: Многопользовательская стратегия | oh-my-opencode"
sidebarTitle: "Настройка Provider"
subtitle: "Настройка Provider: Многопользовательская стратегия | oh-my-opencode"
description: "Настройте несколько AI Providerов (Anthropic, OpenAI, Google, GitHub Copilot). Освойте автоматический механизм отката и приоритет Provider для выбора оптимальной модели."
tags:
  - "configuration"
  - "providers"
  - "models"
prerequisite:
  - "start-installation"
order: 40
---

# Настройка Provider: Многопользовательская стратегия моделей

## Что вы узнаете

- Настройте несколько AI Providerов: Anthropic Claude, OpenAI, Google Gemini, GitHub Copilot
- Поймите, как работает механизм автоматического отката и приоритет Provider
- Назначьте модель, используемую системой по умолчанию
- Используйте команду `doctor` для диагностики настройки и проверки разрешенных моделей

## Ваши текущие проблемы

Вы установили oh-my-opencode, но не уверены:
- Как добавить несколько AI Providerов (Claude, OpenAI, Gemini и т.д.)
- Почему агенты иногда используют модели, которые вы не ожидали
- Как настроить разные модели для разных задач (например, использовать более дешевые модели для исследований, более мощные модели для кодирования)
- Как система автоматически переключается на резервную модель, когда Provider недоступен
- Как работает конфигурация модели в `opencode.json` и `oh-my-opencode.json`

**Что вам нужно** — это "умное" руководство, позволяющее вам быстро настроить несколько Providerов и понять, как работает система автоматически выбирает оптимальную модель.

## Когда использовать это руководство

- **Первая настройка**: Только что закончили установку и нужно добавить или настроить Provider
- **Новая подписка**: Например, когда вы только что купили Claude Max или ChatGPT Plus
- **Смена среды разработки**: Настройка среды разработки на новой машине
- **При проблемах с подключением Provider**: Устрановляйте проблемы с настройкой через диагностические команды

## Основные концепции

oh-my-opencode использует **многопользовательскую систему выбора моделей**. Эта система позволяет вам настроить несколько Providerов одновременно, и система будет автоматически выбирать наиболее подходящую модель на основе типа задачи и приоритета.

**Почему нужны несколько моделей?**

Разные модели имеют разные преимущества:

| Модель | Преимущество | Когда использовать |
|--- | --- | --- | ---|
| **Claude Opus 4.5** | Сложные рассуждения и архитектурный дизайн | Высокая стоимость, но превосходное качество | Главный оркестратор, сложные задачи |
| **GPT-5.2** | Кодовая отладка и стратегическая консультация | Оптимизация производительности, анализ архитектурных решений | Oracle, планирование |
| **Gemini 3 Pro** | Визуальные возможности и сильный визуальный интеллект | Frontend, UI/UX, дизайн, анализ медиа | Multimodal Looker, анализ изображений |
| **GPT-5 Nano** | Быстрый и бесплатный | Поиск кода, простые изменения, быстрая операция | Explore, тестирование |

Интеллект oh-my-opencode заключается в том, чтобы **каждая задача использовала наиболее подходящую модель**, а не одну и ту же модель для всех задач.

## Конфигурационные файлы

oh-my-opencode поддерживает два уровня конфигурации:

| Расположение | Путь | Приоритет |
|--- | --- | --- | ---|
| **Пользовательская конфигурация** | `~/.config/opencode/oh-my-opencode.json` | Высокий | Глобальная конфигурация (общая для всех проектов) |
| **Проектная конфигурация** | `.opencode/oh-my-opencode.json` | Низкий | Конфигурация для конкретного проекта (фиксируется с кодом) |

**Правило слияния**: Пользовательская конфигурация переопределяет проектную конфигурацию.

::: tip Включите автозаполнение
Добавьте `$schema` поле в начало вашей конфигурационного файла для получения полного автозаполнения и проверки типов:

```json
{
  // Добавьте эту строку для включения автозаполнения
  "$schema": "https://raw.githubusercontent.com/code-yeongyu/oh-my-opencode/master/assets/oh-my-opencode.schema.json",
  
  // Включите автозаполнение для всех доступных полей и типов
}
```

::: tip Рекомендуемая структура конфигурационного файла

```jsonc
{
  "$schema": "https://raw.githubusercontent.com/code-yeongyu/oh-my-opencode/master/assets/oh-my-opencode.schema.json",

  "agents": {
    // Агент-модельные переопределения
    "sisyphus": {
      "model": "anthropic/claude-opus-4-5"
    },
    "oracle": {
      "model": "openai/gpt-5.2"
    },
    "librarian": {
      "model": "zai-coding-plan-glm-4.7"
    },
    "explore": {
      "model": "opencode/gpt-5-nano"
    }
  },
  
  "categories": {
    // Переопределения категорий
    "visual-engineering": {
      "model": "google/gemini-3-pro",
      "temperature": 0.7
    },
    "quick": {
      "model": "anthropic/claude-haiku-4-5",
      "temperature": 0.1
    }
  }
}
```

## Настройка Providerов

### Anthropic Claude (Рекомендуется)

**Использование**: Главный оркестратор и большинство основных агентов

**Шаги настройки**:

```bash
# Запустите аутентификацию OpenCode
opencode auth login
```

Затем следуйте подсказкам:
1. **Выберите Provider**: Выберите `Anthropic`
2. **Выберите метод входа**: Выберите `Claude Pro/Max`
3. **Завершите поток OAuth**: Войдите в браузер и авторизуйтесь
4. **Дождитесь завершения**: Терминал отобразит успешную аутентификацию

**Что вы должны увидеть**:
```
✓ Аутентификация успешна
✓ Provider Anthropic настроен
```

**Модельное сопоставление** (по умолчанию):

| Агент | Модель | Назначение |
|--- | --- | --- | ---|
| **Sisyphus** | `anthropic/claude-opus-4-5` | Главный оркестратор |
| **Prometheus** | `anthropic/claude-opus-4-5` | Планировщик |
| **Metis** | `anthropic/claude-sonnet-4-5` | Предпланировочный анализ |
| **Momus** | ``anthropic/claude-sonnet-4-5` | Проверщик плана |
| **Atlas** | `anthropic/claude-opus-4-5` | Менеджер TODO |
| **Oracle** | `openai/gpt-5.2` | Архитектор |
| **Librarian** | `zai-coding-plan-glm-4.7` (если Z.ai доступен) или `opencode/big-pickle` | Исследователь документации |
| **Explore** | `opencode/gpt-5-nano` | Поиск кода |
| **Multimodal Looker** | `google/gemini-3-pro` | Анализ медиа |

### OpenAI (ChatGPT Plus)

**Использование**: Oracle (архитектурный консультант)

**Шаги настройки**:

```bash
opencode auth login
```

Затем следуйте подсказкам:
1. **Выберите Provider**: Выберите `OpenAI`
2. **Выберите метод входа**: Выберите OAuth или API Key
3. **Завершите поток OAuth**: Войдите в браузер и авторизуйтесь
4. **Дождитесь завершения**: Терминал отобразит успешную аутентификацию

**Что вы должны увидеть**:
```
✓ Аутентификация успешна
✓ Provider OpenAI настроен
```

**Модельное сопоставление** (по умолчанию):

| Агент | Модель | Назначение |
|--- | --- | --- | ---|
| **Sisyphus** | `openai/gpt-5.2` | (если Anthropic недоступен) |
| **Prometheus** | `openai/gpt-5.2` | (если Anthropic недоступен) |
| **Metis** | `openai/gpt-5.2` | (если Anthropic недоступен) |
| **Momus** | `openai/gpt-5.2` | (если Anthropic недоступен) |
| **Atlas** | `openai/gpt-5.2` | (если Anthropic недоступен) |
| **Oracle** | `openai/gpt-5.2` | Архитектор |
| **Librarian** | `zai-coding-plan-glm-4.7` (если Z.ai доступен) или `opencode/big-pickle` | Исследователь документации |
| **Explore** | `opencode/gpt-5-nano` | (если Anthropic недоступен) |
| **Multimodal Looker** | `google/gemini-3-pro` | (если Anthropic недоступен) |

### Google Gemini

**Использование**: Multimodal Looker (анализ медиа) и Frontend UI/UX

**Шаги настройки**:

**Шаг 1: Добавьте плагин Antigravity Auth**

Отредактируйте `~/.config/opencode/opencode.json`, добавьте `opencode-antigravity-auth@latest` в массив `plugin`:

```json
{
  "plugin": [
    "oh-my-opencode",
    "opencode-antigravity-auth@latest"
  ]
}
```

**Шаг 2: Настройте модели Gemini**

Скопируйте полную конфигурацию модели из [документации opencode-antigravity-auth](https://github.com/NoeFabris/oh-my-opencode-antigravity-auth), аккуратно объедините ее в `~/.config/opencode/oh-my-opencode.json`, чтобы не сломать существующую настройку.

Плагин использует **систему вариантов** — модели такие как `antigravity-gemini-3-pro` поддерживают варианты `low`/`high`, а не отдельные записи `-low`/`-high`.

**Доступные модели (квота Antigravity)**:

| Модель | Варианты | Назначение |
|--- | --- | --- | ---|
| | `google/antigravity-gemini-3-pro` | — варианты: `low`, `high` | Анализ медиа |
| | `google/antigravity-gemini-3-flash` — варианты: `minimal`, `low`, `medium`, `high` | Быстрый анализ |
| | `google/antigravity-claude-sonnet-4-5-thinking` — варианты: `low`, `max` | Глубокое мышление |
| | `google/antigravity-claude-opus-4-5-thinking` — варианты: `low`, `max` | Глубокое мышление |

**Шаг 3: Переопределите агента модели**

Переопределите агента Multimodal Looker в `oh-my-opencode.json` (или `.opencode/oh-my-opencode.json`):

```jsonc
{
  "agents": {
    "multimodal-looker": {
      "model": "google/antigravity-gemini-3-flash"
    }
  }
}
```

### GitHub Copilot (Provider отката)

**Использование**: Резервный Provider, когда нативные Providerы недоступны

**Приоритет**: `Native (anthropic/, openai/, google/) > GitHub Copilot > OpenCode Zen > Z.ai Coding Plan`

**Модельное сопоставление** (когда GitHub Copilot является лучшим доступным Providerом):

| Агент | Модель | Назначение |
|--- | --- | --- | ---|
| **Sisyphus** | `github-copilot/claude-opus-4.5` | Главный оркестратор |
| **Prometheus** | `github-copilot/gpt-5.2` | Планировщик |
| **Metis** | `github-copilot/gpt-5.2` | Предплановочный анализ |
| **Momus** | `github-copilot/gpt-5.2` | Предплановочный анализ |
| **Atlas** | `github-copilot/claude-opus-4-5` | Менеджер TODO |
| **Oracle** | `github-copilot/gpt-5.2` | Архитектор |
| **Librarian** | `zai-coding-plan-glm-4.7` (если Z.ai доступен) | `opencode/big-pickle` | Исследователь документации |
| **Explore** | `opencode/gpt-5-nano` | Быстрый поиск |

### Z.ai Coding Plan (Опционально)

**Использование**: Librarian (исследователь документации)

**Приоритет**: `Native (anthropic/, openai/, google/) > GitHub Copilot > OpenCode Zen > Z.ai Coding Plan`

**Модельное сопоставление** (когда Z.ai доступен):

| Агент | Модель | Назначение |
|--- | --- | --- | ---|
| **Sisyphus** | `zai-coding-plan-glm-4.7` | Главный оркестратор |
| **Prometheus** | `zai-coding-plan-glm-4.7` | Планировщик |
| **Metis** | `zai-coding-plan-glm-4.7` | Предплановочный анализ |
| **Momus** | `zai-coding-plan-glm-4.7` | Предплановочный анализ |
| **Atlas** | `zai-coding-plan-glm-4.7` | Менеджер TODO |
| **Oracle** | `zai-coding-plan-glm-4.7` | Архитектор |
| **Librarian** | `zai-coding-plan-glm-4.7` | Исследователь документации |
| **Explore** | `opencode/gpt-5-nano` | Быстрый поиск |

### OpenCode Zen (Опционально)

**Использование**: Модели с префиксом `opencode/`

**Приоритет**: `Native (anthropic/, openai/, google/) > GitHub Copilot > OpenCode Zen > Z.ai Coding Plan`

**Модельное сопоставление** (когда OpenCode Zen доступен):

| Агент | Модель | Назначение |
|--- | --- | --- | ---|
| **Sisyphus** | `opencode/claude-opus-4-5` | (если Anthropic недоступен) |
| **Prometheus** | `opencode/claude-opus-4-5` | (если Anthropic недоступен) |
| **Metis** | `opencode/claude-opus-4-5` | (если Anthropic недоступен) |
| **Momus** | `opencode/claude-opus-4-5` | (если Anthropic недоступен) |
| **Atlas** | `opencode/claude-opus-4-5` | (если Anthropic недоступен) |
| **Oracle** | `opencode/big-pickle` | Модель для Oracle | Архитектор |
| **Librarian** | `opencode/big-pickle` | Исследователь документации |
| **Explore** | `opencode/gpt-5-nano` | Быстрый поиск |

## Система разрешения моделей

oh-my-opencode использует **трехэтапный механизм разрешения моделей** для определения, какая модель используется каждым агентом и категорией. Этот механизм гарантирует, что система всегда найдет доступную модель.

### Шаг 1: Переопределение пользователя

Если вы явно указали модель в `oh-my-opencode.json`, система использует эту модель напрямую.

**Пример**:

```jsonc
{
  "agents": {
    "oracle": {
      "model": "openai/gpt-5.2"  // Явно указали модель
    }
  }
}
```

В этом случае:
- ✅ Используется `openai/gpt-5.2` напрямую
- ❌ Пропускается Provider fallback
- ❌ Системное значение по умолчанию не используется

### Шаг 2: Откат Provider

Если пользовательская модель не указана явно, система пробует каждый Provider в порядке приоритета до тех пор, пока не найдет доступной модели.

**Цепочка приоритета для Sisyphusа**:

```
anthropic → github-copilot → opencode → antigravity → google → opencode → zai-coding-plan
```

**Цепочка приоритета для Oracle**:

```
openai → anthropic → google → github-copilot → opencode → zai-coding-plan
```

**Цепочка приоритета для Librarian**:

```
zai-coding-plan → opencode → github-copilot
```

### Шаг 3: Системное значение по умолчанию

Если все Providerы недоступны, система использует модель по умолчанию OpenCode (читается из `opencode.json`).

::: tip Приоритет Provider
GitHub Copilot является удобным резервным Providerом. Вы можете настроить его так, чтобы система автоматически переключалась на него, когда нативные Providerы недоступны.
:::

## Проверка настройки

### Шаг 1: Проверьте файл конфигурации

```bash
# Проверьте, что плагин зарегистрирован
cat ~/.config/opencode/oh-my-opencode.json
```

**Ожидаемый результат**: Смейте `"oh-my-opencode"` в массиве `plugin`.

```json
{
  "plugin": [
    "oh-my-opencode",
    "opencode-antigravity-auth@latest"
  ]
}
```

### Шаг 2: Проверьте версию OpenCode

```bash
opencode --version
```

**Ожидаемый результат**: Отображает `1.0.150` или выше версии.

::: warning Требование к версии OpenCode
Если вы используете версию 1.0.132 или ранее, ошибки OpenCode могут повредить вашу настройку.
>
> Это исправление было объединено после 1.0.132—используйте более новую версию.
> Интересный факт: Этот PR был обнаружен и исправлен благодаря OhMyOpenCode's Librarian, Explore и Oracle настройкам.
:::

### Шаг 3: Просмотр доступные модели

```bash
# Просмотр доступные модели
opencode models
```

**Что вы должны увидеть**: Список всех доступных моделей, Provider, к которому они подключены.

## Настройка агента модели

Если вы хотите, чтобы Oracle использовал более дешевую модель, переопределите агента в `oh-my-opencode.json`:

```jsonc
{
  "agents": {
    "oracle": {
      "model": "openai/o3"  // Используем более дешевую модель
    }
  }
}
```

## Настройка категории модели

Вы также можете настроить модели для разных типов задач через категории. Категории — это абстракция моделей, позволяющая быстро выбирать оптимальную модель для конкретного типа задачи.

**Встроенные категории**:

| Категория | Модель по умолчанию | Температура | Назначение |
|--- | --- | --- | ---|
| **visual-engineering** | `google/gemini-3-pro` (0.7) | Frontend, UI/UX, дизайн | Frontend UI/UX, дизайн |
| **ultrabrain** | `openai/gpt-5.2-codex` (xhigh) | Высокий IQ рассуждения, сложные архитектурные решения |
| **artistry** | `google/gemini-3-pro` (max) | Творчество и искусство | Креативные и художественные задачи |
| **quick** | `anthropic/claude-haiku-4-5` (0.1) | Быстрый и бесплатный | Поиск кода, простые изменения |
| **unspecified-low** | `anthropic/claude-sonnet-4-5` (0.1) | Средние задачи, не подходящие под другие категории |
| **unspecified-high** | `anthropic/claude-opus-4-5` (max) | Высококачественные задачи, не подходящие под другие категории |
| **writing** | `google/gemini-3-flash` (0.1) | Документация и письма | Документация и письма |

**Пример использования**:

```typescript
// Использование категории для быстройого UI
delegate_task(
  category="visual-engineering",
  prompt="Создайте отзывчивый компонент дашборда"
)

// Использование категории для быстройого кода
delegate_task(category="quick", skills=["git-master"], prompt="Зафиксируйте изменения")
```

::: tip Преимущества категорий
Категории позволяют оптимизировать расходы — используйте более дешевые модели для простых задач и более мощные модели для сложных задач.
:::

## Резюме

- **Многопользовательская система**: oh-my-opencode поддерживает несколько Providerов одновременно, автоматически выбирая оптимальную модель
- **Трехэтапный механизм отката**: Автоматически выбирает подходящую модель на основе типа задачи и приоритета
- **Приоритет Provider**: GitHub Copilot > OpenCode Zen > Z.ai Coding Plan
- **Конфигурационные файлы**: Пользовательская и проектная конфигурации поддерживают комментарии и конечные запятые

- **Гибкая гибкость**: Вы можете настроить несколько Providerов, чтобы система автоматически переключалась на резервную модель при недоступности основного
- **Кастомизация**: Используйте `doctor` команду для диагностики настройки и проверки разрешенных моделей
- **Советы**: Используйте категории для оптимизации расходов (используйте дешевые модели для простых задач)

## Следующие шаги

1. Планруйте ваши подписки
2. Настройте несколько Providerов
3. Запустите `oh-my-opencode doctor --verbose`
4. Проверьте разрешенные модели
5. Используйте категории для разных типов задач