---
title: "智谱: 查询额度 | opencode-mystatus"
sidebarTitle: "智谱额度"
subtitle: "智谱: 查询额度"
description: "Научитесь использовать opencode-mystatus для запроса лимита Token за 5 часов и ежемесячной квоты MCP 智谱 AI и Z.ai. Овладейте интерпретацией индикаторов прогресса и расчётом времени сброса."
tags:
  - "智谱 AI"
  - "Z.ai"
  - "Запрос квоты"
  - "Лимит Token"
  - "Квота MCP"
prerequisite:
  - "start-quick-start"
order: 2
---

# Запрос квоты 智谱 AI и Z.ai: лимит Token за 5 часов и ежемесячная квота MCP

## Что вы научитесь делать

- Просмотреть **лимит Token за 5 часов** и **ежемесячную квоту MCP** **智谱 AI** и **Z.ai**
- Поймите значение **ежемесячной квоты MCP** и правила сброса
- Поймите информацию о лимитах в выводе квоты：индикаторы прогресса、использованное количество、общее количество и т. д.
- Знайте, когда будет вызвано **предупреждение об использовании**

## Ваша текущая проблема

Вы используете 智谱 AI или Z.ai для разработки приложений, но часто сталкиваетесь с следующими проблемами:

- Не знаете, сколько осталось **лимита Token за 5 часов**
- После превышения лимита запрос не удаётся, влияя на прогресс разработки
- Не знаете конкретное значение **ежемесячной квоты MCP**
- Нужно входить на две платформы по отдельности для просмотра квоты, что очень хлопотно

## Когда использовать этот метод

Когда вы:

- Используете API 智谱 AI / Z.ai для разработки приложений
- Нужно контролировать использование Token, избегать превышения
- Хотите понимать ежемесячную квоту поиска MCP
- Одновременно используете 智谱 AI и Z.ai, хотите унифицированное управление квотой

## Основная идея

Квотная система **智谱 AI** и **Z.ai** разделена на два типа:

| Тип квоты | Значение | Период сброса |
| -------- | ---- | -------- |
| **Лимит Token за 5 часов** | Лимит использования Token для вызовов API | Автоматический сброс каждые 5 часов |
| **Ежемесячная квота MCP** | Ежемесячный лимит количества поиска MCP | Сброс ежемесячно |

Плагин вызывает официальный API для реального времени запроса этих данных и использует **индикатор прогресса** и **процент** для интуитивного отображения оставшейся квоты.

::: info Что такое MCP?

**MCP** (Model Context Protocol) — это протокол контекста модели, предоставляемый 智谱 AI, который позволяет моделям AI искать и ссылаться на внешние ресурсы. Ежемесячная квота MCP ограничивает количество поисков, которые можно выполнять каждый месяц.

:::

## Следуйте за мной

### Шаг 1: Настройка учётной записи 智谱 AI / Z.ai

**Почему**
Плагину нужен API Key для запроса вашей квоты. 智谱 AI и Z.ai используют **метод аутентификации API Key**.

**Действия**

1. Откройте файл `~/.local/share/opencode/auth.json`

2. Добавьте конфигурацию API Key 智谱 AI или Z.ai:

```json
{
  "zhipuai-coding-plan": {
    "type": "api",
    "key": "ваш_API_Key_智谱_AI"
  },
  "zai-coding-plan": {
    "type": "api",
    "key": "ваш_API_Key_Z.ai"
  }
}
```

**Что вы должны видеть**:
- В конфигурационном файле есть поле `zhipuai-coding-plan` или `zai-coding-plan`
- Каждое поле имеет `type: "api"` и поле `key`

### Шаг 2: Запрос квоты

**Почему**
Вызов официального API для получения информации о квоте в реальном времени.

**Действия**

В OpenCode выполните команду слеша:

```bash
/mystatus
```

Или задайте вопрос на естественном языке:

```
Посмотреть мою квоту 智谱 AI
```

**Что вы должны видеть** похожее на следующее содержание:

```
## 智谱 AI Account Quota

Account:        9c89****AQVM (Coding Plan)

5 小时 Token 限额
███████████████████████████ 剩余 95%
已用: 0.5M / 10.0M
重置: 4小时后

MCP 月度配额
██████████████████░░░░░░ 剩余 60%
已用: 200 / 500

## Z.ai Account Quota

Account:        9c89****AQVM (Z.ai)

5 小时 Token 限额
███████████████████████████ 剩余 95%
已用: 0.5M / 10.0M
重置: 4小时后
```

### Шаг 3: Интерпретация вывода

**Почему**
Понять значение каждой строки вывода, чтобы эффективно управлять квотой.

**Действия**

Проверьте свой вывод по следующему описанию:

| Поле вывода | Значение | Пример |
| -------- | ---- | ---- |
| **Account** | Маскированный API Key и тип учётной записи | `9c89****AQVM (Coding Plan)` |
| **5 小时 Token 限额** | Использование Token в текущем 5-часовом периоде | Индикатор прогресса + процент |
| **已用: X / Y** | Использованное количество / Общая квота | `0.5M / 10.0M` |
| **重置: X小时后** | Обратный отсчёт до следующего сброса | `4小时后` |
| **MCP 月度配额** | Использование поиска MCP текущего месяца | Индикатор прогресса + процент |
| **已用: X / Y** | Использованное количество / Общая квота | `200 / 500` |

**Что вы должны видеть**:
- В части «5 小时 Token 限额» есть **обратный отсчёт времени сброса**
- В части «MCP 月度配额» **нет обратного отсчёта времени** (так как сброс ежемесячный)
- Если использование превышает 80%, внизу отобразится **предупреждение**

## Контрольная точка ✅

Подтвердите, что вы понимаете следующее:

- [ ] Лимит Token за 5 часов имеет обратный отсчёт времени сброса
- [ ] Ежемесячная квота MCP сбрасывается ежемесячно, не отображает обратный отсчёт
- [ ] При использовании более 80% будет вызвано предупреждение
- [ ] API Key маскирован и отображен (показывает только первые и последние 4 символа)

## Предупреждения о ловушках

### ❌ Частая ошибка 1: отсутствие поля `type` в конфигурационном файле

**Ошибка**: при запросе появляется подсказка «Не найдено ни одной настроенной учётной записи»

**Причина**: в `auth.json` отсутствует поле `type: "api"`

**Исправление**:

```json
// ❌ Ошибка
{
  "zhipuai-coding-plan": {
    "key": "ваш API Key"
  }
}

// ✅ Правильно
{
  "zhipuai-coding-plan": {
    "type": "api",
    "key": "ваш API Key"
  }
}
```

### ❌ Частая ошибка 2: API Key истёк или недействителен

**Ошибка**: отображается «API запрос неудачен» или «Сбой аутентификации»

**Причина**: API Key истёк или был отозван

**Исправление**:
- Войдите в консоль 智谱 AI или Z.ai
- Повторно сгенерируйте API Key
- Обновите поле `key` в `auth.json`

### ❌ Частая ошибка 3: путаница двух типов квоты

**Ошибка**: думали, что лимит Token и квота MCP — это одно и то же

**Исправление**:
- **Лимит Token**: использование Token для вызовов API, сброс каждые 5 часов
- **Квота MCP**: количество поисков MCP, сброс ежемесячно
- Это **два независимых лимита**, не влияющих друг на друга

## Итог урока

В этом уроке вы научились использовать opencode-mystatus для запроса квоты 智谱 AI и Z.ai:

**Основные понятия**:
- Лимит Token за 5 часов: лимит вызовов API, есть обратный отсчёт времени сброса
- Ежемесячная квота MCP: количество поисков MCP, сброс ежемесячно

**Действия**:
1. Настройте `zhipuai-coding-plan` или `zai-coding-plan` в `auth.json`
2. Выполните `/mystatus` для запроса квоты
3. Интерпретируйте индикаторы прогресса、использованное количество、время сброса в выводе

**Ключевые моменты**:
- При использовании более 80% будет вызвано предупреждение
- API Key автоматически маскирован и отображен
- Лимит Token и квота MCP — это два независимых лимита

## Предварительный обзор следующего урока

> На следующем уроке мы изучим **[Запрос квоты GitHub Copilot](../copilot-usage/)**。
>
> Вы узнаете:
> - Как просмотреть использование Premium Requests
> - Разницу в ежемесячной квоте разных типов подписок
> - Интерпретацию деталей использования моделей

---

## Приложение: справочник по исходному коду

<details>
<summary><strong>Нажмите для просмотра местоположения исходного кода</strong></summary>

> Время обновления: 2026-01-23

| Функция | Путь к файлу | Номер строки |
| --- | --- | --- |
| Запрос квоты 智谱 AI | [`source/vbgate/opencode-mystatus/plugin/lib/zhipu.ts`](https://github.com/vbgate/opencode-mystatus/blob/main/plugin/lib/zhipu.ts) | 213-217 |
| Запрос квоты Z.ai | [`source/vbgate/opencode-mystatus/plugin/lib/zhipu.ts`](https://github.com/vbgate/opencode-mystatus/blob/main/plugin/lib/zhipu.ts) | 224-228 |
| Форматирование вывода | [`source/vbgate/opencode-mystatus/plugin/lib/zhipu.ts`](https://github.com/vbgate/opencode-mystatus/blob/main/plugin/lib/zhipu.ts) | 115-177 |
| Конфигурация конечной точки API | [`source/vbgate/opencode-mystatus/plugin/lib/zhipu.ts`](https://github.com/vbgate/opencode-mystatus/blob/main/plugin/lib/zhipu.ts) | 62-76 |
| Определение типа ZhipuAuthData | [`source/vbgate/opencode-mystatus/plugin/lib/types.ts`](https://github.com/vbgate/opencode-mystatus/blob/main/plugin/lib/types.ts) | 38-41 |
| Порог предупреждения высокого использования | [`source/vbgate/opencode-mystatus/plugin/lib/types.ts`](https://github.com/vbgate/opencode-mystatus/blob/main/plugin/lib/types.ts) | 110-111 |

**Ключевые константы**:
- `HIGH_USAGE_THRESHOLD = 80`：при использовании более 80% отображается предупреждение (`types.ts:111`)

**Ключевые функции**:
- `queryZhipuUsage(authData)`: запрос квоты учётной записи 智谱 AI (`zhipu.ts:213-217`)
- `queryZaiUsage(authData)`: запрос квоты учётной записи Z.ai (`zhipu.ts:224-228`)
- `formatZhipuUsage(data, apiKey, accountLabel)`: форматирование вывода квоты (`zhipu.ts:115-177`)
- `fetchUsage(apiKey, config)`: вызов официального API для получения данных квоты (`zhipu.ts:81-106`)

**Конечные точки API**:
- 智谱 AI: `https://bigmodel.cn/api/monitor/usage/quota/limit` (`zhipu.ts:63`)
- Z.ai: `https://api.z.ai/api/monitor/usage/quota/limit` (`zhipu.ts:64`)

</details>
