---
title: "Режимы Diff: Многоракурсный анализ изменений | Plannotator"
sidebarTitle: "5 режимов просмотра diff"
subtitle: "Режимы Diff: Многоракурсный анализ изменений"
description: "Узнайте, как переключать типы diff в Plannotator для код-ревью. Выбирайте uncommitted, staged, last commit или branch в выпадающем меню для анализа изменений с разных ракурсов."
tags:
  - "code-review"
  - "git"
  - "diff"
  - "tutorial"
prerequisite:
  - "code-review-basics"
order: 6
---

# Переключение режимов Diff

## Чему вы научитесь

При проведении код-ревью вы сможете:
- Быстро переключаться между 5 режимами diff через выпадающее меню
- Понимать, какой диапазон изменений показывает каждый режим
- Выбирать подходящий тип diff в зависимости от задачи ревью
- Избегать пропуска важных изменений из-за неправильного выбора режима

## Типичные проблемы

**При ревью видите только рабочую директорию и пропускаете staged-файлы**:

Вы запускаете команду `/plannotator-review`, видите изменения кода, добавляете комментарии. Но после коммита обнаруживаете, что в ревью не попали файлы, уже добавленные в staging area через `git add` — они вообще не отображались в diff.

**Хотите увидеть общую разницу между текущей веткой и main**:

Вы разрабатываете feature-ветку несколько недель и хотите посмотреть все изменения в целом, но режим «незакоммиченные изменения» по умолчанию показывает только правки за последние дни.

**Хотите сравнить два конкретных коммита**:

Вам нужно убедиться, что баг-фикс корректен, и сравнить код до и после исправления, но вы не знаете, как заставить Plannotator показать diff исторических коммитов.

## Когда это пригодится

- **При полном ревью**: одновременный просмотр изменений в рабочей директории и staging area
- **Перед слиянием ветки**: проверка всех изменений текущей ветки относительно main/master
- **При ревью отката**: проверка, какие файлы изменил последний коммит
- **При командной работе**: проверка кода коллег, добавленного в staging, но ещё не закоммиченного

## Ключевая идея

У команды git diff много вариантов, каждый показывает разный диапазон кода. Plannotator собрал их в одном выпадающем меню, чтобы вам не нужно было запоминать сложные git-команды.

::: info Справочник типов Git Diff

| Тип diff | Диапазон | Типичный сценарий |
| --- | --- | --- |
| Uncommitted changes | Рабочая директория + staging | Ревью всех изменений текущей разработки |
| Staged changes | Только staging | Проверка перед коммитом |
| Unstaged changes | Только рабочая директория | Ревью изменений без `git add` |
| Last commit | Последний коммит | Откат или проверка недавнего коммита |
| vs main | Текущая ветка vs основная | Полная проверка перед слиянием |

:::

Опции в выпадающем меню динамически меняются в зависимости от состояния Git:
- Если вы не на основной ветке, появится опция «vs main»
- Если нет staged-файлов, режим Staged покажет «No staged changes»

## Пошаговая инструкция

### Шаг 1: Запустите код-ревью

**Зачем**

Сначала нужно открыть интерфейс код-ревью Plannotator.

**Действие**

Выполните в терминале:

```bash
/plannotator-review
```

**Ожидаемый результат**

В браузере откроется страница код-ревью. Над деревом файлов слева будет выпадающее меню с текущим типом diff (обычно «Uncommitted changes»).

### Шаг 2: Переключитесь на режим Staged

**Зачем**

Чтобы увидеть файлы, добавленные через `git add`, но ещё не закоммиченные.

**Действие**

1. Нажмите на выпадающее меню над деревом файлов слева
2. Выберите «Staged changes»

**Ожидаемый результат**

- Если есть staged-файлы, они отобразятся в дереве файлов
- Если staged-файлов нет, в основной области появится: «No staged changes. Stage some files with git add.»

### Шаг 3: Переключитесь на режим Last Commit

**Зачем**

Чтобы проверить только что закоммиченный код и убедиться в отсутствии проблем.

**Действие**

1. Снова откройте выпадающее меню
2. Выберите «Last commit»

**Ожидаемый результат**

- Отобразятся все файлы, изменённые в последнем коммите
- Содержимое diff — это разница `HEAD~1..HEAD`

### Шаг 4: Переключитесь на режим vs main (если доступен)

**Зачем**

Чтобы увидеть все изменения текущей ветки относительно основной.

**Действие**

1. Проверьте, есть ли в выпадающем меню опция «vs main» или «vs master»
2. Если есть, выберите её

**Ожидаемый результат**

- В дереве файлов отобразятся все файлы с различиями между текущей и основной веткой
- Содержимое diff — полные изменения `main..HEAD`

::: tip Проверка текущей ветки

Если не видите опцию «vs main», значит вы на основной ветке. Проверьте текущую ветку командой:

```bash
git rev-parse --abbrev-ref HEAD
```

Переключитесь на feature-ветку и попробуйте снова:

```bash
git checkout feature-branch
```

:::

## Контрольный список ✅

Убедитесь, что вы освоили:

- [ ] Умеете находить и открывать выпадающее меню типов diff
- [ ] Понимаете разницу между «Uncommitted», «Staged» и «Last commit»
- [ ] Знаете, когда появляется опция «vs main»
- [ ] Понимаете, какой тип diff использовать в каждом сценарии

## Типичные ошибки

### Ошибка 1: При ревью смотрите только Uncommitted и пропускаете Staged-файлы

**Симптом**

После коммита обнаруживаете, что в ревью пропустили некоторые staged-файлы.

**Причина**

Режим Uncommitted показывает все изменения в рабочей директории и staging area (`git diff HEAD`), staged-файлы тоже включены.

**Решение**

Перед ревью сначала проверьте режим Staged или используйте Uncommitted (включает staging area).

### Ошибка 2: Перед слиянием ветки не сравнили с main

**Симптом**

После слияния в main обнаруживаете, что попали несвязанные изменения.

**Причина**

Смотрели только коммиты за последние дни, не сравнивая всю ветку с main.

**Решение**

Перед слиянием проведите полную проверку в режиме «vs main».

### Ошибка 3: Боитесь, что переключение режима удалит комментарии

**Симптом**

Не решаетесь переключать тип diff, опасаясь потери добавленных комментариев.

**Причина**

Неправильное понимание механизма переключения.

**На самом деле**

При переключении типа diff Plannotator сохраняет предыдущие комментарии — они могут остаться актуальными, или вы можете вручную удалить неактуальные.

## Итоги урока

5 типов diff, поддерживаемых Plannotator:

| Тип | Git-команда | Сценарий |
| --- | --- | --- |
| Uncommitted | `git diff HEAD` | Ревью всех изменений текущей разработки |
| Staged | `git diff --staged` | Проверка staging area перед коммитом |
| Unstaged | `git diff` | Ревью изменений в рабочей директории |
| Last commit | `git diff HEAD~1..HEAD` | Откат или проверка последнего коммита |
| vs main | `git diff main..HEAD` | Полная проверка перед слиянием ветки |

Переключение режимов не удаляет комментарии — вы можете просматривать те же или новые комментарии с разных ракурсов.

## Анонс следующего урока

> В следующем уроке мы изучим **[Шаринг по URL](../../advanced/url-sharing/)**.
>
> Вы узнаете:
> - Как сжать содержимое ревью в URL для отправки коллегам
> - Как получатель открывает общую ссылку на ревью
> - Ограничения и особенности режима шаринга

---

## Приложение: Справочник по исходному коду

<details>
<summary><strong>Нажмите, чтобы посмотреть расположение в исходном коде</strong></summary>

> Дата обновления: 2026-01-24

| Функциональность | Путь к файлу | Строки |
| --- | --- | --- |
| Определение типов Diff | [`packages/server/git.ts`](https://github.com/backnotprop/plannotator/blob/main/packages/server/git.ts#L10-L15) | 10-15 |
| Получение Git-контекста | [`packages/server/git.ts`](https://github.com/backnotprop/plannotator/blob/main/packages/server/git.ts#L79-L96) | 79-96 |
| Выполнение Git Diff | [`packages/server/git.ts`](https://github.com/backnotprop/plannotator/blob/main/packages/server/git.ts#L101-L147) | 101-147 |
| Обработка переключения Diff | [`packages/review-editor/App.tsx`](https://github.com/backnotprop/plannotator/blob/main/packages/review-editor/App.tsx#L300-L331) | 300-331 |
| Рендеринг опций Diff в дереве файлов | [`packages/review-editor/components/FileTree.tsx`](https://github.com/backnotprop/plannotator/blob/main/packages/review-editor/components/FileTree.tsx) | - |

**Ключевые типы**:

- `DiffType`: `'uncommitted' | 'staged' | 'unstaged' | 'last-commit' | 'branch'`

**Ключевые функции**:

- `getGitContext()`: Получение текущей ветки, основной ветки и доступных опций diff
- `runGitDiff(diffType, defaultBranch)`: Выполнение соответствующей git-команды в зависимости от типа diff

**Ключевые API**:

- `POST /api/diff/switch`: Переключение типа diff, возврат новых данных diff

</details>
