---
title: "Полные параметры конфигурации: 30+ настроек | Antigravity Auth"
sidebarTitle: "30+ параметров настройки"
subtitle: "Полный справочник по параметрам конфигурации Antigravity Auth"
description: "Изучите 30+ параметров конфигурации плагина Antigravity Auth. Полное руководство по общим настройкам, восстановлению сессий, стратегиям выбора аккаунтов, ограничениям скорости, обновлению токенов и лучшим практикам."
tags:
  - "Справочник по конфигурации"
  - "Расширенная конфигурация"
  - "Полное руководство"
  - "Antigravity"
  - "OpenCode"
prerequisite:
  - "quick-install"
order: 1
---

# Полный справочник по параметрам конфигурации Antigravity Auth

## Что вы сможете делать после изучения

- Находить и изменять все параметры конфигурации плагина Antigravity Auth
- Понимать назначение каждого параметра и сценарии его применения
- Выбирать оптимальные комбинации настроек под ваши задачи
- Переопределять настройки файла конфигурации через переменные окружения

## Основная концепция

Плагин Antigravity Auth управляет практически всем поведением через файл конфигурации: от уровня логирования до стратегий выбора аккаунтов, от восстановления сессий до механизмов обновления токенов.

::: info Расположение файла конфигурации (приоритет от высокого к низкому)
1. **Конфигурация проекта**: `.opencode/antigravity.json`
2. **Пользовательская конфигурация**:
   - Linux/Mac: `~/.config/opencode/antigravity.json`
   - Windows: `%APPDATA%\opencode\antigravity.json`
:::

::: tip Приоритет переменных окружения
Все параметры конфигурации можно переопределить через переменные окружения, которые имеют **более высокий** приоритет, чем файл конфигурации.
:::

## Обзор конфигурации

| Категория | Количество параметров | Основные сценарии |
|---|---|---|
| Общие настройки | 3 | Логи, режим отладки |
| Блоки рассуждений | 1 | Сохранение процесса рассуждения |
| Восстановление сессий | 3 | Автоматическое восстановление ошибок |
| Кэш подписей | 4 | Персистентность подписей блоков рассуждений |
| Повтор при пустом ответе | 2 | Обработка пустых ответов |
| Восстановление ID инструментов | 1 | Сопоставление инструментов |
| Предотвращение галлюцинаций | 1 | Предотвращение ошибок параметров |
| Обновление токенов | 3 | Проактивный механизм обновления |
| Ограничение скорости | 5 | Ротация аккаунтов и ожидание |
| Оценка здоровья | 7 | Оценка для стратегии Hybrid |
| Ведро токенов | 3 | Токены для стратегии Hybrid |
| Автообновление | 1 | Автообновление плагина |
| Веб-поиск | 2 | Поиск Gemini |

---

## Общие настройки

### `quiet_mode`

**Тип**: `boolean`  
**Значение по умолчанию**: `false`  
**Переменная окружения**: `OPENCODE_ANTIGRAVITY_QUIET=1`

Отключает большинство уведомлений toast (ограничение скорости, переключение аккаунтов и др.). Уведомления о восстановлении (успешное восстановление сессии) всегда отображаются.

**Сценарии применения**:
- Сценарии с множественными аккаунтами и высокой частотой использования для избежания частых уведомлений
- Использование в автоматизированных скриптах или фоновых сервисах

**Пример**:
```json
{
  "quiet_mode": true
}
```

### `debug`

**Тип**: `boolean`  
**Значение по умолчанию**: `false`  
**Переменная окружения**: `OPENCODE_ANTIGRAVITY_DEBUG=1`

Включает запись отладочных логов в файл. Файлы логов по умолчанию хранятся в `~/.config/opencode/antigravity-logs/`.

**Сценарии применения**:
- Включение при диагностике проблем
- Предоставление подробных логов при отправке отчетов об ошибках

::: danger Отладочные логи могут содержать конфиденциальную информацию
Файлы логов содержат ответы API, индексы аккаунтов и другую информацию. Пожалуйста, удалите конфиденциальные данные перед отправкой.
:::

### `log_dir`

**Тип**: `string`  
**Значение по умолчанию**: Каталог конфигурации ОС + `/antigravity-logs`  
**Переменная окружения**: `OPENCODE_ANTIGRAVITY_LOG_DIR=/path/to/logs`

Настраиваемый каталог для хранения файлов отладочных логов.

**Сценарии применения**:
- Необходимость хранения логов в определенном месте (например, сетевой общий ресурс)
- Скрипты ротации и архивации логов

---

## Настройки блоков рассуждений

### `keep_thinking`

**Тип**: `boolean`  
**Значение по умолчанию**: `false`  
**Переменная окружения**: `OPENCODE_ANTIGRAVITY_KEEP_THINKING=1`

::: warning Экспериментальная функция
Сохраняет блоки рассуждений модели Claude (через кэш подписей).

**Описание поведения**:
- `false` (по умолчанию): Удаляет блоки рассуждений для предотвращения ошибок подписи, приоритет надежности
- `true`: Сохраняет полный контекст (включая блоки рассуждений), но может вызывать ошибки подписи

**Сценарии применения**:
- Необходимость просмотра полного процесса рассуждения модели
- Частое использование рассуждений в диалоге

**Нерекомендуемые сценарии**:
- Продакшен-среды (приоритет надежности)
- Многошаговые диалоги (легко вызывают конфликты подписей)

::: tip Используйте с `signature_cache`
При включении `keep_thinking` рекомендуется также настроить `signature_cache` для повышения вероятности совпадения подписей.
:::

---

## Восстановление сессий

### `session_recovery`

**Тип**: `boolean`  
**Значение по умолчанию**: `true`

Автоматическое восстановление сессий при ошибках `tool_result_missing`. При включении отображаются уведомления toast при восстановлении.

**Типы ошибок для восстановления**:
- `tool_result_missing`: Отсутствие результата инструмента (прерывание ESC, таймаут, сбой)
- `Expected thinking but found text`: Ошибка порядка блоков рассуждений

**Сценарии применения**:
- Все сценарии использования инструментов (рекомендуется включать по умолчанию)
- Длительные диалоги или частое использование инструментов

### `auto_resume`

**Тип**: `boolean`  
**Значение по умолчанию**: `false`

Автоматическая отправка подсказки "continue" для восстановления сессии. Работает только при включенном `session_recovery`.

**Описание поведения**:
- `false`: Отображается только уведомление toast, пользователь должен вручную отправить "continue"
- `true`: Автоматически отправляется "continue" для продолжения сессии

**Сценарии применения**:
- Автоматизированные скрипты или сценарии без присмотра
- Полностью автоматизированный процесс восстановления

**Нерекомендуемые сценарии**:
- Необходимость ручной проверки результатов восстановления
- После прерывания выполнения инструмента требуется проверка состояния

### `resume_text`

**Тип**: `string`  
**Значение по умолчанию**: `"continue"`

Пользовательский текст для автоматического восстановления. Используется только при включенном `auto_resume`.

**Сценарии применения**:
- Многоязычные среды (например, изменить на "продолжить", "please continue")
- Сценарии, требующие дополнительных подсказок

**Пример**:
```json
{
  "auto_resume": true,
  "resume_text": "Пожалуйста, продолжите выполнение предыдущей задачи"
}
```

---

## Кэш подписей

> Работает только при включенном `keep_thinking`

### `signature_cache.enabled`

**Тип**: `boolean`  
**Значение по умолчанию**: `true`

Включает кэширование подписей блоков рассуждений на диск.

**Назначение**: Кэширование подписей позволяет избежать ошибок, связанных с повторной подписью в многошаговых диалогах.

### `signature_cache.memory_ttl_seconds`

**Тип**: `number` (диапазон: 60-86400)  
**Значение по умолчанию**: `3600` (1 час)

Время жизни кэша в памяти (в секундах).

### `signature_cache.disk_ttl_seconds`

**Тип**: `number` (диапазон: 3600-604800)  
**Значение по умолчанию**: `172800` (48 часов)

Время жизни кэша на диске (в секундах).

### `signature_cache.write_interval_seconds`

**Тип**: `number` (диапазон: 10-600)  
**Значение по умолчанию**: `60`

Интервал фоновой записи на диск (в секундах).

**Пример**:
```json
{
  "keep_thinking": true,
  "signature_cache": {
    "enabled": true,
    "memory_ttl_seconds": 7200,
    "disk_ttl_seconds": 259200,
    "write_interval_seconds": 120
  }
}
```

---

## Повтор при пустом ответе

Автоматический повтор запроса, когда Antigravity возвращает пустой ответ (без candidates/choices).

### `empty_response_max_attempts`

**Тип**: `number` (диапазон: 1-10)  
**Значение по умолчанию**: `4`

Максимальное количество попыток повтора.

### `empty_response_retry_delay_ms`

**Тип**: `number` (диапазон: 500-10000)  
**Значение по умолчанию**: `2000` (2 секунды)

Задержка между попытками (в миллисекундах).

**Сценарии применения**:
- Нестабильное сетевое соединение (увеличить количество попыток)
- Необходимость быстрого отказа (уменьшить количество попыток и задержку)

---

## Восстановление ID инструментов

### `tool_id_recovery`

**Тип**: `boolean`  
**Значение по умолчанию**: `true`

Включает восстановление изолированных ID инструментов. Когда ID инструмента в ответе не совпадает (из-за сжатия контекста), пытается выполнить сопоставление по имени функции или создать placeholder.

**Назначение**: Повышение надежности вызовов инструментов в многошаговых диалогах.

**Сценарии применения**:
- Сценарии длительных диалогов (рекомендуется включать)
- Частое использование инструментов

---

## Предотвращение галлюцинаций инструментов

### `claude_tool_hardening`

**Тип**: `boolean`  
**Значение по умолчанию**: `true`

Включает предотвращение галлюцинаций инструментов для моделей Claude. При включении автоматически добавляются:
- Сигнатуры параметров в описания инструментов
- Строгие правила использования инструментов в системных инструкциях

**Назначение**: Предотвращение использования Claude имен параметров из обучающих данных вместо фактических параметров из схемы.

**Сценарии применения**:
- Использование MCP-плагинов или пользовательских инструментов (рекомендуется включать)
- Сложные схемы инструментов

**Нерекомендуемые сценарии**:
- Подтвержденное полное соответствие вызовов инструментов схеме (можно отключить для уменьшения дополнительных подсказок)

---

## Проактивное обновление токенов

### `proactive_token_refresh`

**Тип**: `boolean`  
**Значение по умолчанию**: `true`

Включает проактивное фоновое обновление токенов. При включении токены автоматически обновляются до истечения срока, обеспечивая отсутствие блокировки запросов из-за обновления.

**Назначение**: Предотвращение задержек запросов, связанных с ожиданием обновления токенов.

### `proactive_refresh_buffer_seconds`

**Тип**: `number` (диапазон: 60-7200)  
**Значение по умолчанию**: `1800` (30 минут)

За сколько секунд до истечения срока токена запускать проактивное обновление.

### `proactive_refresh_check_interval_seconds`

**Тип**: `number` (диапазон: 30-1800)  
**Значение по умолчанию**: `300` (5 минут)

Интервал проверки проактивного обновления (в секундах).

**Сценарии применения**:
- Высокочастотные запросы (рекомендуется включать проактивное обновление)
- Снижение риска сбоев обновления (увеличение времени buffer)

---

## Ограничение скорости и выбор аккаунтов

### `max_rate_limit_wait_seconds`

**Тип**: `number` (диапазон: 0-3600)  
**Значение по умолчанию**: `300` (5 минут)

Максимальное время ожидания, когда все аккаунты ограничены по скорости (в секундах). Если минимальное время ожидания всех аккаунтов превышает этот порог, плагин быстро завершится с ошибкой вместо ожидания.

**Установка в 0**: Отключение таймаута, бесконечное ожидание.

**Сценарии применения**:
- Сценарии, требующие быстрого отказа (уменьшение времени ожидания)
- Сценарии, допускающие длительное ожидание (увеличение времени ожидания)

### `quota_fallback`

**Тип**: `boolean`  
**Значение по умолчанию**: `false`

Включает резервирование квоты для моделей Gemini. Когда основной пул квот (Gemini CLI или Antigravity) исчерпан, пытается использовать резервный пул квот того же аккаунта.

**Сценарии применения**:
- Высокочастотное использование моделей Gemini (рекомендуется включать)
- Максимизация использования квоты каждого аккаунта

::: tip Работает только без явного указания суффикса квоты
Если имя модели явно содержит `:antigravity` или `:gemini-cli`, всегда будет использоваться указанный пул квот без резервирования.
:::

### `account_selection_strategy`

**Тип**: `string` (перечисление: `sticky`, `round-robin`, `hybrid`)  
**Значение по умолчанию**: `"hybrid"`  
**Переменная окружения**: `OPENCODE_ANTIGRAVITY_ACCOUNT_SELECTION_STRATEGY`

Стратегия выбора аккаунтов.

| Стратегия | Описание | Сценарии применения |
|---|---|---|
| `sticky` | Использование одного аккаунта до ограничения скорости, сохранение кэша подсказок | Одиночные сессии, чувствительные к кэшу |
| `round-robin` | Переключение на следующий аккаунт при каждом запросе, максимальная пропускная способность | Многоаккаунтные высокопроизводительные сценарии |
| `hybrid` | Детерминированный выбор на основе оценки здоровья + ведро токенов + LRU | Универсальная рекомендация, баланс производительности и надежности |

::: info Подробное описание
Подробности см. в разделе [Стратегии выбора аккаунтов](/ru/NoeFabris/opencode-antigravity-auth/advanced/account-selection-strategies/).
:::

### `pid_offset_enabled`

**Тип**: `boolean`  
**Значение по умолчанию**: `false`  
**Переменная окружения**: `OPENCODE_ANTIGRAVITY_PID_OFFSET_ENABLED=1`

Включает смещение аккаунтов на основе PID. При включении разные сессии (PID) предпочтительно выбирают разные стартовые аккаунты, что помогает распределять нагрузку при запуске нескольких параллельных агентов.

**Описание поведения**:
- `false` (по умолчанию): Все сессии начинают с одного и того же индекса аккаунта, сохраняется кэш подсказок Anthropic (рекомендуется для одиночных сессий)
- `true`: Стартовый аккаунт смещается в зависимости от PID, распределение нагрузки (рекомендуется для параллельных сессий)

**Сценарии применения**:
- Запуск нескольких параллельных сессий OpenCode
- Использование дочерних агентов или параллельных задач

### `switch_on_first_rate_limit`

**Тип**: `boolean`  
**Значение по умолчанию**: `true`

Немедленное переключение аккаунта при первом ограничении скорости (с задержкой 1 секунда). При отключении сначала выполняется повторная попытка с тем же аккаунтом, переключение происходит только при втором ограничении.

**Сценарии применения**:
- Желание быстрого переключения аккаунтов (рекомендуется включать)
- Желание максимизации квоты одного аккаунта (отключить)

---

## Оценка здоровья (стратегия Hybrid)

> Работает только при `account_selection_strategy` установленном в `hybrid`

### `health_score.initial`

**Тип**: `number` (диапазон: 0-100)  
**Значение по умолчанию**: `70`

Начальная оценка здоровья аккаунта.

### `health_score.success_reward`

**Тип**: `number` (диапазон: 0-10)  
**Значение по умолчанию**: `1`

Оценка здоровья, добавляемая при каждом успешном запросе.

### `health_score.rate_limit_penalty`

**Тип**: `number` (диапазон: -50-0)  
**Значение по умолчанию**: `-10`

Оценка здоровья, вычитаемая при каждом ограничении скорости.

### `health_score.failure_penalty`

**Тип**: `number` (диапазон: -100-0)  
**Значение по умолчанию**: `-20`

Оценка здоровья, вычитаемая при каждом сбое.

### `health_score.recovery_rate_per_hour`

**Тип**: `number` (диапазон: 0-20)  
**Значение по умолчанию**: `2`

Оценка здоровья, восстанавливаемая в час.

### `health_score.min_usable`

**Тип**: `number` (диапазон: 0-100)  
**Значение по умолчанию**: `50`

Минимальный порог оценки здоровья для использования аккаунта.

### `health_score.max_score`

**Тип**: `number` (диапазон: 50-100)  
**Значение по умолчанию**: `100`

Максимальная оценка здоровья.

**Сценарии применения**:
- Настройки по умолчанию подходят для большинства сценариев
- В средах с высокой частотой ограничений скорости можно уменьшить `rate_limit_penalty` или увеличить `recovery_rate_per_hour`
- Для более быстрого переключения аккаунтов можно уменьшить `min_usable`

**Пример**:
```json
{
  "account_selection_strategy": "hybrid",
  "health_score": {
    "initial": 80,
    "success_reward": 2,
    "rate_limit_penalty": -5,
    "failure_penalty": -15,
    "recovery_rate_per_hour": 5,
    "min_usable": 40,
    "max_score": 100
  }
}
```

---

## Ведро токенов (стратегия Hybrid)

> Работает только при `account_selection_strategy` установленном в `hybrid`

### `token_bucket.max_tokens`

**Тип**: `number` (диапазон: 1-1000)  
**Значение по умолчанию**: `50`

Максимальная емкость ведра токенов.

### `token_bucket.regeneration_rate_per_minute`

**Тип**: `number` (диапазон: 0.1-60)  
**Значение по умолчанию**: `6`

Количество токенов, генерируемых в минуту.

### `token_bucket.initial_tokens`

**Тип**: `number` (диапазон: 1-1000)  
**Значение по умолчанию**: `50`

Начальное количество токенов аккаунта.

**Сценарии применения**:
- Для высокочастотных запросов можно увеличить `max_tokens` и `regeneration_rate_per_minute`
- Для более быстрой ротации аккаунтов можно уменьшить `initial_tokens`

---

## Автообновление

### `auto_update`

**Тип**: `boolean`  
**Значение по умолчанию**: `true`

Включает автоматическое обновление плагина.

**Сценарии применения**:
- Желание автоматического получения новых функций (рекомендуется включать)
- Необходимость фиксации версии (отключить)

---

## Веб-поиск (Gemini Grounding)

### `web_search.default_mode`

**Тип**: `string` (перечисление: `auto`, `off`)  
**Значение по умолчанию**: `"off"`

Режим веб-поиска по умолчанию (когда не указан через variant).

| Режим | Описание |
|---|---|
| `auto` | Модель сама решает, когда выполнять поиск (динамический поиск) |
| `off` | Поиск отключен по умолчанию |

### `web_search.grounding_threshold`

**Тип**: `number` (диапазон: 0-1)  
**Значение по умолчанию**: `0.3`

Порог динамического поиска (от 0.0 до 1.0). Чем выше значение, тем реже модель выполняет поиск (требуется более высокая уверенность для запуска поиска). Работает только в режиме `auto`.

**Сценарии применения**:
- Уменьшение ненужных поисков (повышение порога, например, 0.5)
- Стимулирование модели к более частому поиску (понижение порога, например, 0.2)

**Пример**:
```json
{
  "web_search": {
    "default_mode": "auto",
    "grounding_threshold": 0.4
  }
}
```

---

## Примеры конфигурации

### Базовая конфигурация с одним аккаунтом

```json
{
  "quiet_mode": false,
  "debug": false,
  "keep_thinking": false,
  "session_recovery": true,
  "auto_resume": false,
  "account_selection_strategy": "sticky"
}
```

### Высокопроизводительная конфигурация с несколькими аккаунтами

```json
{
  "quiet_mode": true,
  "debug": false,
  "session_recovery": true,
  "auto_resume": true,
  "account_selection_strategy": "hybrid",
  "quota_fallback": true,
  "switch_on_first_rate_limit": true,
  "max_rate_limit_wait_seconds": 120,
  "health_score": {
    "initial": 70,
    "min_usable": 40
  },
  "token_bucket": {
    "max_tokens": 100,
    "regeneration_rate_per_minute": 10
  }
}
```

### Конфигурация для отладки и диагностики

```json
{
  "debug": true,
  "log_dir": "/tmp/antigravity-logs",
  "quiet_mode": false,
  "session_recovery": true,
  "auto_resume": true,
  "tool_id_recovery": true
}
```

### Конфигурация для сохранения блоков рассуждений

```json
{
  "keep_thinking": true,
  "signature_cache": {
    "enabled": true,
    "memory_ttl_seconds": 7200,
    "disk_ttl_seconds": 259200,
    "write_interval_seconds": 120
  },
  "session_recovery": true
}
```

---

## Часто задаваемые вопросы

### В: Как временно отключить определенную настройку?

**О**: Используйте переменную окружения для переопределения, без изменения файла конфигурации.

```bash
# Временное включение режима отладки
OPENCODE_ANTIGRAVITY_DEBUG=1 opencode

# Временное включение тихого режима
OPENCODE_ANTIGRAVITY_QUIET=1 opencode
```

### В: Нужно ли перезапускать OpenCode после изменения конфигурации?

**О**: Да, файл конфигурации загружается при запуске OpenCode, после изменения требуется перезапуск.

### В: Как проверить, применилась ли конфигурация?

**О**: Включите режим `debug` и проверьте информацию о загрузке конфигурации в файле логов.

```json
{
  "debug": true
}
```

В логах будет отображаться загруженная конфигурация:
```
[config] Loaded configuration: {...}
```

### В: Какие параметры чаще всего требуют изменения?

**О**:
- `account_selection_strategy`: Выбор подходящей стратегии для многоаккаунтных сценариев
- `quiet_mode`: Снижение частоты уведомлений
- `session_recovery` / `auto_resume`: Управление поведением восстановления сессий
- `debug`: Включение при диагностике проблем

### В: Есть ли у файла конфигурации проверка JSON Schema?

**О**: Да, добавление поля `$schema` в файл конфигурации включает автодополнение и проверку в IDE:

```json
{
  "$schema": "https://raw.githubusercontent.com/NoeFabris/opencode-antigravity-auth/main/assets/antigravity.schema.json",
  ...
}
```

---

## Приложение: Справка по исходному коду

<details>
<summary><strong>Нажмите, чтобы развернуть информацию о расположении исходного кода</strong></summary>

> Обновлено: 2026-01-23

| Функция | Путь к файлу | Номера строк |
|---|---|---|
| Определение схемы конфигурации | [`src/plugin/config/schema.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/config/schema.ts) | 1-373 |
| JSON Schema | [`assets/antigravity.schema.json`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/assets/antigravity.schema.json) | 1-157 |
| Загрузка конфигурации | [`src/plugin/config/loader.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/config/loader.ts) | - |

**Ключевые константы**:
- `DEFAULT_CONFIG`: Объект конфигурации по умолчанию (`schema.ts:328-372`)

**Ключевые типы**:
- `AntigravityConfig`: Основной тип конфигурации (`schema.ts:322`)
- `SignatureCacheConfig`: Тип конфигурации кэша подписей (`schema.ts:323`)
- `AccountSelectionStrategy`: Тип стратегии выбора аккаунтов (`schema.ts:22`)

</details>
