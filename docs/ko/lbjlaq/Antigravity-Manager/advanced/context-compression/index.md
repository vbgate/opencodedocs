---
title: "ì»¨í…ìŠ¤íŠ¸ ì••ì¶•: ì•ˆì •ì ì¸ ê¸´ ì„¸ì…˜ | Antigravity-Manager"
sidebarTitle: "ê¸´ ì„¸ì…˜ì´ ì¶©ëŒí•˜ì§€ ì•Šê²Œ"
subtitle: "ì»¨í…ìŠ¤íŠ¸ ì••ì¶•: ì•ˆì •ì ì¸ ê¸´ ì„¸ì…˜"
description: "Antigravityì˜ ì„¸ ë ˆì´ì–´ ì»¨í…ìŠ¤íŠ¸ ì••ì¶• ë©”ì»¤ë‹ˆì¦˜ì„ í•™ìŠµí•©ë‹ˆë‹¤. íˆ´ ë¼ìš´ë“œ íŠ¸ë¦¬ë°, Thinking ì••ì¶•, ì„œëª… ìºì‹œë¥¼ í†µí•´ 400 ì˜¤ë¥˜ì™€ Promptê°€ ë„ˆë¬´ ê¸´ ì‹¤íŒ¨ë¥¼ ì¤„ì…ë‹ˆë‹¤."
tags:
  - "ì»¨í…ìŠ¤íŠ¸ ì••ì¶•"
  - "ì„œëª… ìºì‹œ"
  - "Thinking"
  - "Tool Result"
  - "ì•ˆì •ì„±"
prerequisite:
  - "start-proxy-and-first-client"
  - "advanced-monitoring"
order: 8
---

# ê¸´ ì„¸ì…˜ ì•ˆì •ì„±: ì»¨í…ìŠ¤íŠ¸ ì••ì¶•, ì„œëª… ìºì‹œ ë° íˆ´ ê²°ê³¼ ì••ì¶•

Claude Code / Cherry Studio ê°™ì€ í´ë¼ì´ì–¸íŠ¸ë¡œ ê¸´ ì„¸ì…˜ì„ ì‹¤í–‰í•  ë•Œ, ê°€ì¥ ì„±ê°€ì‹  ê²ƒì€ ëª¨ë¸ì´ ì¶©ë¶„íˆ ë˜‘ë˜‘í•˜ì§€ ì•Šì€ ê²ƒì´ ì•„ë‹ˆë¼, ëŒ€í™”ê°€ ì§„í–‰ë˜ë‹¤ê°€ ê°‘ìê¸° ì˜¤ë¥˜ë¥¼ ì‹œì‘í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤: `Prompt is too long`, 400 ì„œëª… ì˜¤ë¥˜, íˆ´ í˜¸ì¶œ ì²´ì¸ ëŠê¹€, ë˜ëŠ” íˆ´ ë£¨í”„ê°€ ê°ˆìˆ˜ë¡ ëŠë ¤ì§‘ë‹ˆë‹¤.

ì´ ìˆ˜ì—…ì—ì„œëŠ” Antigravity Toolsê°€ ì´ ë¬¸ì œë“¤ì„ ìœ„í•´ í•œ ì„¸ ê°€ì§€ ì¼ì„ ëª…í™•íˆ ì„¤ëª…í•©ë‹ˆë‹¤: ì»¨í…ìŠ¤íŠ¸ ì••ì¶•(ì„¸ ë ˆì´ì–´ ë‹¨ê³„ì ìœ¼ë¡œ ê°œì…), ì„œëª… ìºì‹œ(Thinkingì˜ ì„œëª… ì²´ì¸ì„ ì´ì–´ì¤Œ), íˆ´ ê²°ê³¼ ì••ì¶•(íˆ´ ì¶œë ¥ì´ ì»¨í…ìŠ¤íŠ¸ë¥¼ í„°ëœ¨ë¦¬ì§€ ì•Šë„ë¡ í•¨).

## ì´ ìˆ˜ì—…ì„ ë§ˆì¹˜ë©´ í•  ìˆ˜ ìˆëŠ” ê²ƒ

- ì„¸ ë ˆì´ì–´ ì ì§„ì  ì»¨í…ìŠ¤íŠ¸ ì••ì¶•ì´ ê°ê° ë¬´ì—‡ì„ í•˜ëŠ”ì§€, ê°ê°ì˜ ë¹„ìš©ì´ ë¬´ì—‡ì¸ì§€ ëª…í™•íˆ ì„¤ëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- ì„œëª… ìºì‹œê°€ ë¬´ì—‡ì„ ì €ì¥í•˜ëŠ”ì§€(Tool/Family/Session ì„¸ ë ˆì´ì–´)ì™€ 2ì‹œê°„ TTLì˜ ì˜í–¥ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤
- íˆ´ ê²°ê³¼ ì••ì¶• ê·œì¹™ì„ ì´í•´í•©ë‹ˆë‹¤: ì–¸ì œ base64 ì´ë¯¸ì§€ë¥¼ ë²„ë¦¬ê³ , ì–¸ì œ ë¸Œë¼ìš°ì € ìŠ¤ëƒ…ìƒ·ì„ ë¨¸ë¦¬+ê¼¬ë¦¬ ìš”ì•½ìœ¼ë¡œ ë³€í™˜í•˜ëŠ”ì§€
- í•„ìš”í•  ë•Œ `proxy.experimental`ì˜ ì„ê³„ê°’ ìŠ¤ìœ„ì¹˜ë¡œ ì••ì¶• íŠ¸ë¦¬ê±° íƒ€ì´ë°ì„ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

## í˜„ì¬ì˜ ë¬¸ì œì 

- ê¸´ ëŒ€í™” í›„ ê°‘ìê¸° 400ì´ ì‹œì‘ë©ë‹ˆë‹¤: ì„œëª…ì´ ë§Œë£Œëœ ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì„œëª…ì´ ì–´ë””ì„œ ì˜¤ëŠ”ì§€, ì–´ë””ì„œ ìƒì–´ë²„ë¦¬ëŠ”ì§€ ëª¨ë¦…ë‹ˆë‹¤
- íˆ´ í˜¸ì¶œì´ ì ì  ë§ì•„ì§€ê³ , ì—­ì‚¬ì  tool_resultê°€ ì—…ìŠ¤íŠ¸ë¦¼ì—ì„œ ì§ì ‘ ê±°ë¶€ë˜ê±°ë‚˜(ì•„ì£¼ ëŠë ¤ì§)
- ì••ì¶•ìœ¼ë¡œ êµ¬ì›í•˜ê³  ì‹¶ì§€ë§Œ, Prompt Cacheë¥¼ ê¹¨íŠ¸ë¦¬ê±°ë‚˜, ì¼ê´€ì„±ì— ì˜í–¥ì„ ì£¼ê±°ë‚˜, ëª¨ë¸ì´ ì •ë³´ë¥¼ ìƒëŠ” ê²ƒì„ ê±±ì •í•©ë‹ˆë‹¤

## ì–¸ì œ ì´ ë°©ë²•ì„ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?

- ê¸´ ì²´ì¸ íˆ´ ì‘ì—…ì„ ì‹¤í–‰í•  ë•Œ(ê²€ìƒ‰/íŒŒì¼ ì½ê¸°/ë¸Œë¼ìš°ì € ìŠ¤ëƒ…ìƒ·/ë‹¤ì¤‘ ë¼ìš´ë“œ íˆ´ ë£¨í”„)
- Thinking ëª¨ë¸ë¡œ ë³µì¡í•œ ì¶”ë¡ ì„ í•˜ê³  ìˆê³ , ì„¸ì…˜ì´ ìì£¼ ìˆ˜ì‹­ ë¼ìš´ë“œë¥¼ ì´ˆê³¼í•  ë•Œ
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¬í˜„ ê°€ëŠ¥í•˜ì§€ë§Œ ì™œì¸ì§€ ì„¤ëª…í•  ìˆ˜ ì—†ëŠ” ì•ˆì •ì„± ë¬¸ì œë¥¼ í•´ê²°í•  ë•Œ

## ì»¨í…ìŠ¤íŠ¸ ì••ì¶•ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?

**ì»¨í…ìŠ¤íŠ¸ ì••ì¶•**ì€ í”„ë¡ì‹œê°€ ì»¨í…ìŠ¤íŠ¸ ì••ë ¥ì´ ë„ˆë¬´ ë†’ë‹¤ê³  ê°ì§€í–ˆì„ ë•Œ, ì—­ì‚¬ ë©”ì‹œì§€ì— ëŒ€í•´ ìˆ˜í–‰í•˜ëŠ” ìë™ ë…¸ì´ì¦ˆ ê°ì†Œì™€ ìŠ¬ë¦¼í™”ì…ë‹ˆë‹¤: ë¨¼ì € ì˜¤ë˜ëœ íˆ´ ë¼ìš´ë“œë¥¼ ìë¥´ê³ , ê·¸ ë‹¤ìŒ ì˜¤ë˜ëœ Thinking í…ìŠ¤íŠ¸ë¥¼ í”Œë ˆì´ìŠ¤í™€ë”ë¡œ ì••ì¶•í•˜ì§€ë§Œ ì„œëª…ì€ ìœ ì§€í•˜ê³ , ë§ˆì§€ë§‰ìœ¼ë¡œ ê·¹ë‹¨ì ì¸ ê²½ìš° XML ìš”ì•½ì„ ìƒì„±í•˜ê³  ìƒˆ ì„¸ì…˜ì„ Forkí•˜ì—¬ ëŒ€í™”ë¥¼ ê³„ì†í•¨ìœ¼ë¡œì¨, `Prompt is too long`ê³¼ ì„œëª… ì²´ì¸ ë‹¨ì ˆë¡œ ì¸í•œ ì‹¤íŒ¨ë¥¼ ì¤„ì…ë‹ˆë‹¤.

::: info ì»¨í…ìŠ¤íŠ¸ ì••ë ¥ì€ ì–´ë–»ê²Œ ê³„ì‚°ë˜ë‚˜ìš”?
Claude í”„ë¡œì„¸ì„œëŠ” `ContextManager::estimate_token_usage()`ìœ¼ë¡œ ê°€ë²¼ìš´ ì¶”ì •ì„ í•˜ê³ , `estimation_calibrator`ë¡œ ë³´ì •í•œ ë‹¤ìŒ, `usage_ratio = estimated_usage / context_limit`ìœ¼ë¡œ ì••ë ¥ í¼ì„¼íŠ¸ë¥¼ ì–»ìŠµë‹ˆë‹¤(ë¡œê·¸ì— raw/calibrated ê°’ì´ ì¸ì‡„ë¨).
:::

## ğŸ’ ì‹œì‘ ì „ ì¤€ë¹„

- ì´ë¯¸ ë¡œì»¬ í”„ë¡ì‹œë¥¼ ì‹¤í–‰í–ˆê³ , í´ë¼ì´ì–¸íŠ¸ê°€ ì‹¤ì œë¡œ `/v1/messages` ì²´ì¸ì„ ê±°ì¹˜ê³  ìˆìŠµë‹ˆë‹¤(ë¡œì»¬ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì‹œì‘ ë° ì²« ë²ˆì§¸ í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì°¸ì¡°)
- í”„ë¡ì‹œ ë¡œê·¸ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤(ê°œë°œì ë””ë²„ê¹… ë˜ëŠ” ë¡œì»¬ ë¡œê·¸ íŒŒì¼). ë¦¬í¬ì§€í† ë¦¬ì˜ í…ŒìŠ¤íŠ¸ ê³„íšì€ ì˜ˆì œ ë¡œê·¸ ê²½ë¡œì™€ grep ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤(`docs/testing/context_compression_test_plan.md` ì°¸ì¡°)

::: tip Proxy Monitorì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ë” ì˜ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
ì••ì¶• íŠ¸ë¦¬ê±°ë¥¼ ì–´ë–¤ ìš”ì²­/ì–´ë–¤ ê³„ì •/ì–´ë–¤ ë¼ìš´ë“œ íˆ´ í˜¸ì¶œì— ëŒ€ì‘ì‹œí‚¤ë ¤ë©´, Proxy Monitorë¥¼ ë™ì‹œì— ì—¬ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
:::

## í•µì‹¬ ì•„ì´ë””ì–´

ì´ ì•ˆì •ì„± ì„¤ê³„ëŠ” ì—­ì‚¬ë¥¼ ëª¨ë‘ ì§€ìš°ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë¹„ìš©ì´ ë‚®ì€ ê²ƒì—ì„œ ë†’ì€ ê²ƒìœ¼ë¡œ ë‹¨ê³„ì ìœ¼ë¡œ ê°œì…í•©ë‹ˆë‹¤:

| ë ˆì´ì–´ | íŠ¸ë¦¬ê±° ì§€ì (êµ¬ì„± ê°€ëŠ¥) | í•˜ëŠ” ì¼ | ë¹„ìš©/ë¶€ì‘ìš© |
|--- | --- | --- | ---|
| Layer 1 | `proxy.experimental.context_compression_threshold_l1`(ê¸°ë³¸ê°’ 0.4) | íˆ´ ë¼ìš´ë“œë¥¼ ì‹ë³„í•˜ê³ , ìµœê·¼ N ë¼ìš´ë“œ(ì½”ë“œì—ì„œëŠ” 5)ë§Œ ìœ ì§€í•˜ë©°, ë” ì˜¤ë˜ëœ tool_use/tool_result ìŒì„ ì‚­ì œí•¨ | ë‚¨ì€ ë©”ì‹œì§€ ë‚´ìš©ì„ ìˆ˜ì •í•˜ì§€ ì•Šì•„ Prompt Cacheì— ë” ì¹œí™”ì  |
| Layer 2 | `proxy.experimental.context_compression_threshold_l2`(ê¸°ë³¸ê°’ 0.55) | ì˜¤ë˜ëœ Thinking í…ìŠ¤íŠ¸ë¥¼ `"..."`ë¡œ ì••ì¶•í•˜ì§€ë§Œ `signature`ëŠ” ìœ ì§€í•˜ê³ , ìµœê·¼ 4ê°œ ë©”ì‹œì§€ëŠ” ë³´í˜¸í•¨ | ì—­ì‚¬ ë‚´ìš©ì„ ìˆ˜ì •í•˜ë©°, ì£¼ì„ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ cacheë¥¼ ê¹¬ë‹¤ê³  í•˜ì§€ë§Œ, ì„œëª… ì²´ì¸ì„ ë³´í˜¸í•  ìˆ˜ ìˆìŒ |
| Layer 3 | `proxy.experimental.context_compression_threshold_l3`(ê¸°ë³¸ê°’ 0.7) | ë°±ê·¸ë¼ìš´ë“œ ëª¨ë¸ì„ í˜¸ì¶œí•˜ì—¬ XML ìš”ì•½ì„ ìƒì„±í•œ ë‹¤ìŒ, ìƒˆ ë©”ì‹œì§€ ì‹œí€€ìŠ¤ë¥¼ Forkí•˜ì—¬ ëŒ€í™”ë¥¼ ê³„ì†í•¨ | ë°±ê·¸ë¼ìš´ë“œ ëª¨ë¸ í˜¸ì¶œì— ì˜ì¡´í•¨; ì‹¤íŒ¨í•˜ë©´ 400ì„ ë°˜í™˜í•¨(ì¹œì ˆí•œ í”„ë¡¬í”„íŠ¸ ìˆìŒ) |

ë‹¤ìŒìœ¼ë¡œ ì„¸ ë ˆì´ì–´ë¥¼ ë‚˜ëˆ„ì–´ ì„¤ëª…í•˜ë©´ì„œ, ì„œëª… ìºì‹œì™€ íˆ´ ê²°ê³¼ ì••ì¶•ë„ í•¨ê»˜ ì„¤ëª…í•©ë‹ˆë‹¤.

### Layer 1: íˆ´ ë¼ìš´ë“œ íŠ¸ë¦¬ë°(Trim Tool Messages)

Layer 1ì˜ í•µì‹¬ í¬ì¸íŠ¸ëŠ” íˆ´ ìƒí˜¸ì‘ìš© ì „ì²´ ë¼ìš´ë“œë§Œ ì‚­ì œí•˜ì—¬, ë°˜ìª½ ì‚­ì œë¡œ ì¸í•œ ì»¨í…ìŠ¤íŠ¸ ë¶ˆì¼ì¹˜ë¥¼ í”¼í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

- í•œ ë¼ìš´ë“œ íˆ´ ìƒí˜¸ì‘ìš© ì‹ë³„ ê·œì¹™ì€ `identify_tool_rounds()`ì— ìˆìŠµë‹ˆë‹¤: `assistant`ì—ì„œ `tool_use`ê°€ ë‚˜íƒ€ë‚˜ë©´ í•œ ë¼ìš´ë“œê°€ ì‹œì‘ë˜ê³ , í›„ì† `user`ì—ì„œ `tool_result`ê°€ ë‚˜íƒ€ë‚˜ë„ ì—¬ì „íˆ ì´ ë¼ìš´ë“œë¡œ ê³„ì‚°í•˜ë©°, ì¼ë°˜ user í…ìŠ¤íŠ¸ë¥¼ ë§Œë‚  ë•Œê¹Œì§€ ì´ ë¼ìš´ë“œê°€ ëë‚©ë‹ˆë‹¤.
- ì‹¤ì œë¡œ íŠ¸ë¦¬ë°ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì€ `ContextManager::trim_tool_messages(&mut messages, 5)`ì…ë‹ˆë‹¤: ì—­ì‚¬ íˆ´ ë¼ìš´ë“œê°€ 5 ë¼ìš´ë“œë¥¼ ì´ˆê³¼í•˜ë©´, ë” ì˜¤ë˜ëœ ë¼ìš´ë“œì— ê´€ë ¨ëœ ë©”ì‹œì§€ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.

### Layer 2: Thinking ì••ì¶•í•˜ì§€ë§Œ ì„œëª… ìœ ì§€

ë§ì€ 400 ë¬¸ì œëŠ” Thinkingì´ ë„ˆë¬´ ê¸´ ê²ƒì´ ì•„ë‹ˆë¼, Thinkingì˜ ì„œëª… ì²´ì¸ì´ ëŠì–´ì§„ ê²ƒì…ë‹ˆë‹¤. Layer 2ì˜ ì „ëµì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- `assistant` ë©”ì‹œì§€ì˜ `ContentBlock::Thinking { thinking, signature, .. }`ë§Œ ì²˜ë¦¬í•©ë‹ˆë‹¤
- `signature.is_some()`ì´ê³  `thinking.len() > 10`ì¼ ë•Œë§Œ ì••ì¶•í•˜ë©°, `thinking`ì„ ì§ì ‘ `"..."`ë¡œ ë³€ê²½í•©ë‹ˆë‹¤
- ìµœê·¼ `protected_last_n = 4`ê°œ ë©”ì‹œì§€ëŠ” ì••ì¶•í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤(ëŒ€ëµ ìµœê·¼ 2 ë¼ìš´ë“œ user/assistant)

ì´ë ‡ê²Œ í•˜ë©´ ë§ì€ í† í°ì„ ì ˆì•½í•  ìˆ˜ ìˆì§€ë§Œ, ì—¬ì „íˆ `signature`ë¥¼ ì—­ì‚¬ì— ë‚¨ê²¨ë‘ì–´, íˆ´ ì²´ì¸ì´ ì„œëª…ì„ ì±„ì›Œì•¼ í•  ë•Œ ë³µêµ¬í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

### Layer 3: Fork + XML ìš”ì•½(ê·¹ë‹¨ì å…œåº•)

ì••ë ¥ì´ ê³„ì† ë†’ì•„ì§ˆ ë•Œ, Claude í”„ë¡œì„¸ì„œëŠ” ì„¸ì…˜ì„ ë‹¤ì‹œ ì—´ì§€ë§Œ í•µì‹¬ ì •ë³´ë¥¼ ìƒì§€ ì•Šìœ¼ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤:

1. ì›ë˜ ë©”ì‹œì§€ì—ì„œ ë§ˆì§€ë§‰ ìœ íš¨í•œ Thinking ì„œëª…ì„ ì¶”ì¶œí•©ë‹ˆë‹¤(`ContextManager::extract_last_valid_signature()`)
2. ì „ì²´ ì—­ì‚¬ + `CONTEXT_SUMMARY_PROMPT`ë¥¼ XML ìš”ì•½ì„ ìƒì„±í•˜ëŠ” ìš”ì²­ìœ¼ë¡œ ì´ì–´ ë¶™ì´ê³ , ëª¨ë¸ì„ `BACKGROUND_MODEL_LITE`(í˜„ì¬ ì½”ë“œëŠ” `gemini-2.5-flash`)ë¡œ ê³ ì •í•©ë‹ˆë‹¤
3. ìš”ì•½ì— `<latest_thinking_signature>`ì„ í¬í•¨í•˜ë„ë¡ ìš”êµ¬í•˜ì—¬, í›„ì† ì„œëª… ì²´ì¸ ì—°ì†ì— ì‚¬ìš©í•©ë‹ˆë‹¤
4. ìƒˆ ë©”ì‹œì§€ ì‹œí€€ìŠ¤ë¥¼ Forkí•©ë‹ˆë‹¤:
   - `User: Context has been compressed... + XML summary`
   - `Assistant: I have reviewed...`
   - ì›ë˜ ìš”ì²­ì˜ ë§ˆì§€ë§‰ user ë©”ì‹œì§€ë¥¼ ì²¨ë¶€í•©ë‹ˆë‹¤(ë§Œì•½ ê·¸ê²ƒì´ ë°©ê¸ˆì˜ ìš”ì•½ ëª…ë ¹ì´ ì•„ë‹ˆë¼ë©´)

Fork + ìš”ì•½ì´ ì‹¤íŒ¨í•˜ë©´, `StatusCode::BAD_REQUEST`ë¥¼ ì§ì ‘ ë°˜í™˜í•˜ê³ , `/compact`ë‚˜ `/clear` ê°™ì€ ë°©ë²•ìœ¼ë¡œ ìˆ˜ë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ë¼ê³  ì•Œë ¤ì¤ë‹ˆë‹¤(í”„ë¡œì„¸ì„œê°€ ë°˜í™˜í•˜ëŠ” error JSON ì°¸ì¡°).

### ì‚¬ì´ë“œ ë¼ì¸ 1: ì„¸ ë ˆì´ì–´ ì„œëª… ìºì‹œ(Tool / Family / Session)

ì„œëª… ìºì‹œëŠ” ì»¨í…ìŠ¤íŠ¸ ì••ì¶•ì˜ í“¨ì¦ˆì…ë‹ˆë‹¤, íŠ¹íˆ í´ë¼ì´ì–¸íŠ¸ê°€ ì„œëª… í•„ë“œë¥¼ íŠ¸ë¦¬ë°/ë²„ë¦´ ë•Œ ë”ìš± ê·¸ë ‡ìŠµë‹ˆë‹¤.

- TTL: `SIGNATURE_TTL = 2 * 60 * 60`(2ì‹œê°„)
- Layer 1: `tool_use_id -> signature`(íˆ´ ì²´ì¸ ë³µêµ¬)
- Layer 2: `signature -> model family`(í¬ë¡œìŠ¤ ëª¨ë¸ í˜¸í™˜ì„± ì²´í¬, Claude ì„œëª…ì´ Gemini íŒ¨ë°€ë¦¬ ëª¨ë¸ë¡œ ê°€ëŠ” ê²ƒì„ ë°©ì§€)
- Layer 3: `session_id -> latest signature`(ì„¸ì…˜ ë ˆë²¨ ê²©ë¦¬, ë‹¤ë¥¸ ëŒ€í™” ì˜¤ì—¼ ë°©ì§€)

ì´ ì„¸ ë ˆì´ì–´ ìºì‹œëŠ” Claude SSE ìŠ¤íŠ¸ë¦¬ë° íŒŒì‹±ê³¼ ìš”ì²­ ë³€í™˜ ì‹œ ì“°ê¸°/ì½ê¸°ë©ë‹ˆë‹¤:

- ìŠ¤íŠ¸ë¦¬ë° íŒŒì‹±ì—ì„œ thinkingì˜ `signature`ë¥¼ ë§Œë‚˜ë©´ Session Cache(ë° ìºì‹œ íŒ¨ë°€ë¦¬)ì— ì”ë‹ˆë‹¤
- ìŠ¤íŠ¸ë¦¬ë° íŒŒì‹±ì—ì„œ tool_useì˜ `signature`ë¥¼ ë§Œë‚˜ë©´ Tool Cache + Session Cacheì— ì”ë‹ˆë‹¤
- Claude íˆ´ í˜¸ì¶œì„ Gemini `functionCall`ìœ¼ë¡œ ë³€í™˜í•  ë•Œ, Session Cacheë‚˜ Tool Cacheì—ì„œ ìš°ì„ ì ìœ¼ë¡œ ì„œëª…ì„ ì±„ì›Œë„£ìŠµë‹ˆë‹¤

### ì‚¬ì´ë“œ ë¼ì¸ 2: íˆ´ ê²°ê³¼ ì••ì¶•(Tool Result Compressor)

íˆ´ ê²°ê³¼ëŠ” ì±„íŒ… í…ìŠ¤íŠ¸ë³´ë‹¤ ì»¨í…ìŠ¤íŠ¸ë¥¼ í„°ëœ¨ë¦¬ê¸° ì‰¬ìš°ë¯€ë¡œ, ìš”ì²­ ë³€í™˜ ë‹¨ê³„ì—ì„œ tool_resultì— ëŒ€í•´ ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì‚­ì œë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

í•µì‹¬ ê·œì¹™(ëª¨ë‘ `tool_result_compressor.rs`ì— ìˆìŒ):

- ì´ ë¬¸ì ìƒí•œ: `MAX_TOOL_RESULT_CHARS = 200_000`
- base64 ì´ë¯¸ì§€ ë¸”ë¡ì€ ì§ì ‘ ì œê±°(í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸ë¥¼ ì¶”ê°€)
- ì¶œë ¥ì´ íŒŒì¼ì— ì €ì¥ë˜ì—ˆë‹¤ëŠ” í”„ë¡¬í”„íŠ¸ë¥¼ ê°ì§€í•˜ë©´, í•µì‹¬ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ê³  `[tool_result omitted ...]`ë¡œ í”Œë ˆì´ìŠ¤í™€ë”
- ë¸Œë¼ìš°ì € ìŠ¤ëƒ…ìƒ·(`page snapshot` / `ref=` ë“± íŠ¹ì§• í¬í•¨)ì„ ê°ì§€í•˜ë©´, ë¨¸ë¦¬+ê¼¬ë¦¬ ìš”ì•½ìœ¼ë¡œ ë³€ê²½í•˜ê³ , ìƒëµëœ ë¬¸ì ìˆ˜ë¥¼ í‘œì‹œ
- ì…ë ¥ì´ HTML ê°™ìœ¼ë©´, `<style>`/`<script>`/base64 ì¡°ê°ì„ ë¨¼ì € ì œê±°í•œ ë‹¤ìŒ íŠ¸ë ì¼€ì´ì…˜ì„ ìˆ˜í–‰

## ë”°ë¼í•´ ë³´ì„¸ìš”

### 1ë‹¨ê³„: ì••ì¶• ì„ê³„ê°’ í™•ì¸(ë° ê¸°ë³¸ê°’)

**ì™œ í•„ìš”í•œê°€ìš”?**
ì••ì¶• íŠ¸ë¦¬ê±° ì§€ì ì€ í•˜ë“œì½”ë”©ëœ ê²ƒì´ ì•„ë‹ˆë¼, `proxy.experimental.*`ì—ì„œ ì˜µë‹ˆë‹¤. í˜„ì¬ ì„ê³„ê°’ì„ ë¨¼ì € ì•Œì•„ì•¼, ì™œ ì´ë ‡ê²Œ ì¼ì°/ëŠ¦ê²Œ ê°œì…í•˜ëŠ”ì§€ íŒë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê¸°ë³¸ê°’(Rust ì¸¡ `ExperimentalConfig::default()`):

```json
{
  "proxy": {
    "experimental": {
      "enable_signature_cache": true,
      "enable_tool_loop_recovery": true,
      "enable_cross_model_checks": true,
      "enable_usage_scaling": true,
      "context_compression_threshold_l1": 0.4,
      "context_compression_threshold_l2": 0.55,
      "context_compression_threshold_l3": 0.7
    }
  }
}
```

**ë³´ì•„ì•¼ í•  ê²ƒ**: ì„¤ì •ì— `proxy.experimental`ê°€ ìˆê³ (í•„ë“œ ì´ë¦„ì€ ìœ„ì™€ ì¼ì¹˜), ì„ê³„ê°’ì´ `0.x` ê°™ì€ ë¹„ìœ¨ ê°’ì…ë‹ˆë‹¤.

::: warning ì„¤ì • íŒŒì¼ ìœ„ì¹˜ëŠ” ì´ ìˆ˜ì—…ì—ì„œ ë°˜ë³µí•˜ì§€ ì•ŠìŒ
ì„¤ì • íŒŒì¼ì˜ ì €ì¥ ìœ„ì¹˜ì™€ ìˆ˜ì • í›„ ì¬ì‹œì‘ì´ í•„ìš”í•œì§€ ì—¬ë¶€ëŠ” ì„¤ì • ê´€ë¦¬ ë²”ì£¼ì…ë‹ˆë‹¤. ì´ íŠœí† ë¦¬ì–¼ ì‹œìŠ¤í…œì— ë”°ë¼, ìš°ì„  ì„¤ì • ì™„ë²½ ê°€ì´ë“œ: AppConfig/ProxyConfig, ì €ì¥ ìœ„ì¹˜ ë° í•« ë¦¬ë¡œë“œ ì˜ë¯¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤.
:::

### 2ë‹¨ê³„: ë¡œê·¸ë¡œ Layer 1/2/3 íŠ¸ë¦¬ê±° ì—¬ë¶€ í™•ì¸

**ì™œ í•„ìš”í•œê°€ìš”?**
ì´ ì„¸ ë ˆì´ì–´ëŠ” ëª¨ë‘ í”„ë¡ì‹œ ë‚´ë¶€ ë™ì‘ì´ë¯€ë¡œ, ê°€ì¥ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê²€ì¦ ë°©ë²•ì€ ë¡œê·¸ì— `[Layer-1]` / `[Layer-2]` / `[Layer-3]`ì´ ë‚˜íƒ€ë‚˜ëŠ”ì§€ ë³´ëŠ” ê²ƒì…ë‹ˆë‹¤.

ë¦¬í¬ì§€í† ë¦¬ì˜ í…ŒìŠ¤íŠ¸ ê³„íšì€ ì˜ˆì œ ëª…ë ¹ì„ ì œê³µí•©ë‹ˆë‹¤(ë¨¸ì‹ ì˜ ì‹¤ì œ ë¡œê·¸ ê²½ë¡œë¡œ í•„ìš”ì— ë”°ë¼ ì¡°ì •):

```bash
tail -f ~/Library/Application\ Support/com.antigravity.tools/logs/antigravity.log | grep -E "Layer-[123]"
```

**ë³´ì•„ì•¼ í•  ê²ƒ**: ì••ë ¥ì´ ë†’ì•„ì§ˆ ë•Œ, ë¡œê·¸ì— `Tool trimming triggered`, `Thinking compression triggered`, `Fork successful` ê°™ì€ ê¸°ë¡ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤(êµ¬ì²´ì ì¸ í•„ë“œëŠ” ë¡œê·¸ ì›ë¬¸ì„ ê¸°ì¤€ìœ¼ë¡œ í•¨).

### 3ë‹¨ê³„: ì •í™”ì™€ ì••ì¶•ì˜ ì°¨ì´ ì´í•´(ê¸°ëŒ€ë¥¼ í˜¼ë™í•˜ì§€ ë§ê¸°)

**ì™œ í•„ìš”í•œê°€ìš”?**
ì¼ë¶€ ë¬¸ì œ(ì˜ˆ: Thinkingì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ëª¨ë¸ë¡œ ê°•ì œ ë‹¤ìš´ê·¸ë ˆì´ë“œ)ëŠ” ì••ì¶•ì´ ì•„ë‹ˆë¼ ì •í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì •í™”ëŠ” Thinking blockì„ ì§ì ‘ ì‚­ì œí•©ë‹ˆë‹¤; ì••ì¶•ì€ ì„œëª… ì²´ì¸ì„ ìœ ì§€í•©ë‹ˆë‹¤.

Claude í”„ë¡œì„¸ì„œì—ì„œ, ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ë‹¤ìš´ê·¸ë ˆì´ë“œëŠ” `ContextManager::purify_history(..., PurificationStrategy::Aggressive)`ë¥¼ ê±°ì¹˜ë©°, ì´ê²ƒì€ ì—­ì‚¬ Thinking blockì„ ì§ì ‘ ì œê±°í•©ë‹ˆë‹¤.

**ë³´ì•„ì•¼ í•  ê²ƒ**: ë‘ ê°€ì§€ ë™ì‘ì„ êµ¬ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ì •í™”ëŠ” Thinking blockì„ ì‚­ì œí•©ë‹ˆë‹¤
- Layer 2 ì••ì¶•ì€ ì˜¤ë˜ëœ Thinking í…ìŠ¤íŠ¸ë¥¼ `"..."`ë¡œ êµì²´í•˜ì§€ë§Œ, ì„œëª…ì€ ì—¬ì „íˆ ìˆìŠµë‹ˆë‹¤

### 4ë‹¨ê³„: 400 ì„œëª… ì˜¤ë¥˜ë¥¼ ë§Œë‚¬ì„ ë•Œ, ë¨¼ì € Session Cache ì ì¤‘ ì—¬ë¶€ í™•ì¸

**ì™œ í•„ìš”í•œê°€ìš”?**
ë§ì€ 400ì˜ ê·¼ë³¸ ì›ì¸ì€ ì„œëª…ì´ ì—†ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì„œëª…ì´ ë©”ì‹œì§€ë¥¼ ë”°ë¼ê°€ì§€ ì•ŠëŠ” ê²ƒì…ë‹ˆë‹¤. ìš”ì²­ ë³€í™˜ ì‹œ Session Cacheì—ì„œ ìš°ì„ ì ìœ¼ë¡œ ì„œëª…ì„ ì±„ì›ë‹ˆë‹¤.

ë‹¨ì„œ(ìš”ì²­ ë³€í™˜ ë‹¨ê³„ì˜ ë¡œê·¸ëŠ” SESSION/TOOL cacheì—ì„œ ì„œëª…ì„ ë³µêµ¬í•œë‹¤ê³  ì•Œë ¤ì¤Œ):

- `[Claude-Request] Recovered signature from SESSION cache ...`
- `[Claude-Request] Recovered signature from TOOL cache ...`

**ë³´ì•„ì•¼ í•  ê²ƒ**: í´ë¼ì´ì–¸íŠ¸ê°€ ì„œëª…ì„ ë²„ë¦¬ì§€ë§Œ í”„ë¡ì‹œ ìºì‹œê°€ ì—¬ì „íˆ ìˆì„ ë•Œ, ë¡œê·¸ì— Recovered signature from ... cache ê¸°ë¡ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

### 5ë‹¨ê³„: íˆ´ ê²°ê³¼ ì••ì¶•ì´ ë¬´ì—‡ì„ ìƒëŠ”ì§€ ì´í•´

**ì™œ í•„ìš”í•œê°€ìš”?**
íˆ´ì´ ëŒ€ìš©ëŸ‰ HTML / ë¸Œë¼ìš°ì € ìŠ¤ëƒ…ìƒ· / base64 ì´ë¯¸ì§€ë¥¼ ëŒ€í™”ì— ë‹¤ì‹œ ë„£ê²Œ í•˜ë©´, í”„ë¡ì‹œê°€ ìë™ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤. ì–´ë–¤ ë‚´ìš©ì´ í”Œë ˆì´ìŠ¤í™€ë”ë¡œ êµì²´ë ì§€ ë¯¸ë¦¬ ì•Œì•„ì•¼, ëª¨ë¸ì´ ëª» ë³¸ ê²ƒìœ¼ë¡œ ì˜¤í•´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì„¸ ê°€ì§€ë§Œ ê¸°ì–µí•˜ì„¸ìš”:

1. base64 ì´ë¯¸ì§€ëŠ” ì œê±°ë©ë‹ˆë‹¤(í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸ë¡œ ë³€ê²½)
2. ë¸Œë¼ìš°ì € ìŠ¤ëƒ…ìƒ·ì€ ë¨¸ë¦¬/ê¼¬ë¦¬ ìš”ì•½ì´ ë©ë‹ˆë‹¤(ìƒëµëœ ë¬¸ì ìˆ˜ í¬í•¨)
3. 200,000 ë¬¸ìë¥¼ ì´ˆê³¼í•˜ë©´ íŠ¸ë ì¼€ì´ì…˜ë˜ê³  `...[truncated ...]` í”„ë¡¬í”„íŠ¸ê°€ ì¶”ê°€ë©ë‹ˆë‹¤

**ë³´ì•„ì•¼ í•  ê²ƒ**: `tool_result_compressor.rs`ì—ì„œ ì´ ê·œì¹™ë“¤ì€ ëª¨ë‘ ëª…í™•í•œ ìƒìˆ˜ì™€ ë¶„ê¸°ë¡œ ë˜ì–´ ìˆìœ¼ë©°, ê²½í—˜ìœ¼ë¡œ ì‚­ì œí•˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤.

## ì²´í¬í¬ì¸íŠ¸

- L1/L2/L3ì˜ íŠ¸ë¦¬ê±° ì§€ì ì´ `proxy.experimental.context_compression_threshold_*`ì—ì„œ ì˜¨ë‹¤ëŠ” ê²ƒì„ ë§í•  ìˆ˜ ìˆê³ , ê¸°ë³¸ê°’ì€ `0.4/0.55/0.7`ì…ë‹ˆë‹¤
- ì™œ Layer 2ê°€ cacheë¥¼ ê¹¬ë‹¤ê³  ì„¤ëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: ì—­ì‚¬ thinking í…ìŠ¤íŠ¸ ë‚´ìš©ì„ ìˆ˜ì •í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤
- ì™œ Layer 3ì„ Forkë¼ê³  í•˜ëŠ”ì§€ ì„¤ëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: ëŒ€í™”ë¥¼ XML ìš”ì•½ + í™•ì¸ + ìµœì‹  user ë©”ì‹œì§€ì˜ ìƒˆ ì‹œí€€ìŠ¤ë¡œ ë§Œë“¤ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤
- íˆ´ ê²°ê³¼ ì••ì¶•ì´ base64 ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ê³ , ë¸Œë¼ìš°ì € ìŠ¤ëƒ…ìƒ·ì„ ë¨¸ë¦¬/ê¼¬ë¦¬ ìš”ì•½ìœ¼ë¡œ ë§Œë“ ë‹¤ê³  ì„¤ëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

## ì¼ë°˜ì ì¸ ì‹¤ìˆ˜

| í˜„ìƒ | ê°€ëŠ¥í•œ ì›ì¸ | í•  ìˆ˜ ìˆëŠ” ê²ƒ |
|--- | --- | ---|
| Layer 2 íŠ¸ë¦¬ê±° í›„ ì»¨í…ìŠ¤íŠ¸ê°€ ëœ ì•ˆì •í•´ ë³´ì„ | Layer 2ëŠ” ì—­ì‚¬ ë‚´ìš©ì„ ìˆ˜ì •í•˜ë©°, ì£¼ì„ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ cacheë¥¼ ê¹¬ë‹¤ê³  í•¨ | Prompt Cache ì¼ê´€ì„±ì— ì˜ì¡´í•œë‹¤ë©´, L1ì´ ë¨¼ì € ë¬¸ì œë¥¼ í•´ê²°í•˜ê²Œ í•˜ê±°ë‚˜, L2 ì„ê³„ê°’ì„ ë†’ì„ |
| Layer 3 íŠ¸ë¦¬ê±° í›„ ì§ì ‘ 400 ë°˜í™˜ | Fork + ìš”ì•½ ë°±ê·¸ë¼ìš´ë“œ ëª¨ë¸ í˜¸ì¶œ ì‹¤íŒ¨(ë„¤íŠ¸ì›Œí¬/ê³„ì •/ì—…ìŠ¤íŠ¸ë¦¼ ì˜¤ë¥˜ ë“±) | ë¨¼ì € error JSONì˜ ì œì•ˆì— ë”°ë¼ `/compact`ë‚˜ `/clear` ì‚¬ìš©; ë™ì‹œì— ë°±ê·¸ë¼ìš´ë“œ ëª¨ë¸ í˜¸ì¶œ ì²´ì¸ í™•ì¸ |
| íˆ´ ì¶œë ¥ì—ì„œ ì´ë¯¸ì§€/ëŒ€ìš©ëŸ‰ ë‚´ìš©ì´ ì‚¬ë¼ì§ | tool_resultëŠ” base64 ì´ë¯¸ì§€ë¥¼ ì œê±°í•˜ê³ , ì´ˆì¥ ì¶œë ¥ì„ íŠ¸ë ì¼€ì´ì…˜í•¨ | ì¤‘ìš”í•œ ë‚´ìš©ì„ ë¡œì»¬ íŒŒì¼/ë§í¬ì— ì €ì¥í•œ ë‹¤ìŒ ì°¸ì¡°; 10ë§Œ í–‰ í…ìŠ¤íŠ¸ë¥¼ ëŒ€í™”ì— ì§ì ‘ ë„£ëŠ” ê²ƒì„ ê¸°ëŒ€í•˜ì§€ ë§ˆì„¸ìš” |
| ëª…í™•íˆ Gemini ëª¨ë¸ì¸ë° Claude ì„œëª…ì„ ê°€ì ¸ì™€ì„œ ì˜¤ë¥˜ | ì„œëª…ì´ í¬ë¡œìŠ¤ ëª¨ë¸ì— í˜¸í™˜ë˜ì§€ ì•ŠìŒ(ì½”ë“œì— family ì²´í¬ ìˆìŒ) | ì„œëª… ì†ŒìŠ¤ í™•ì¸; í•„ìš”ì‹œ í”„ë¡ì‹œê°€ retry ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ì—­ì‚¬ ì„œëª…ì„ ì œê±°í•˜ê²Œ í•¨(ìš”ì²­ ë³€í™˜ ë¡œì§ ì°¸ì¡°) |

## ì´ ìˆ˜ì—… ìš”ì•½

- ì„¸ ë ˆì´ì–´ ì••ì¶•ì˜ í•µì‹¬ì€ ë¹„ìš©ìœ¼ë¡œ ë¶„ë¥˜í•˜ëŠ” ê²ƒ: ë¨¼ì € ì˜¤ë˜ëœ íˆ´ ë¼ìš´ë“œë¥¼ ì‚­ì œí•˜ê³ , ë‹¤ìŒ ì˜¤ë˜ëœ Thinkingì„ ì••ì¶•í•˜ê³ , ë§ˆì§€ë§‰ìœ¼ë¡œ Fork + XML ìš”ì•½
- ì„œëª… ìºì‹œëŠ” íˆ´ ì²´ì¸ì´ ê³„ì†ë˜ë„ë¡ í•˜ëŠ” í•µì‹¬: Session/Tool/Family ì„¸ ë ˆì´ì–´ê°€ ê°ê° í•œ ìœ í˜•ì˜ ë¬¸ì œë¥¼ ê´€ë¦¬í•˜ë©°, TTLì€ 2ì‹œê°„ì…ë‹ˆë‹¤
- íˆ´ ê²°ê³¼ ì••ì¶•ì€ íˆ´ ì¶œë ¥ì´ ì»¨í…ìŠ¤íŠ¸ë¥¼ í„°ëœ¨ë¦¬ì§€ ì•Šë„ë¡ í•˜ëŠ” í•˜ë“œ ì œí•œ: 200,000 ë¬¸ì ìƒí•œ + ìŠ¤ëƒ…ìƒ·/ëŒ€ìš©ëŸ‰ íŒŒì¼ í”„ë¡¬í”„íŠ¸ íŠ¹í™”

## ë‹¤ìŒ ìˆ˜ì—… ì˜ˆê³ 

> ë‹¤ìŒ ìˆ˜ì—…ì—ì„œëŠ” ì‹œìŠ¤í…œ ëŠ¥ë ¥ì„ ì´ì•¼ê¸°í•©ë‹ˆë‹¤: ë‹¤êµ­ì–´/í…Œë§ˆ/ì—…ë°ì´íŠ¸/ì‹œì‘ ìë™ ì‹œì‘/HTTP API Server.

---

## ë¶€ë¡: ì†ŒìŠ¤ ì½”ë“œ ì°¸ì¡°

<details>
<summary><strong>í´ë¦­í•˜ì—¬ ì†ŒìŠ¤ ì½”ë“œ ìœ„ì¹˜ í™•ì¸</strong></summary>

> ì—…ë°ì´íŠ¸ ì‹œê°„: 2026-01-23

| ê¸°ëŠ¥ | íŒŒì¼ ê²½ë¡œ | ë¼ì¸ |
|--- | --- | ---|
| ì‹¤í—˜ì  ì„¤ì •: ì••ì¶• ì„ê³„ê°’ê³¼ ìŠ¤ìœ„ì¹˜ ê¸°ë³¸ê°’ | `src-tauri/src/proxy/config.rs` | 119-168 |
| ì»¨í…ìŠ¤íŠ¸ ì¶”ì •: ë‹¤êµ­ì–´ ë¬¸ì ì¶”ì • + 15% ì—¬ìœ  | `src-tauri/src/proxy/mappers/context_manager.rs` | 9-37 |
| í† í° ì‚¬ìš©ëŸ‰ ì¶”ì •: system/messages/tools/thinking ìˆœíšŒ | `src-tauri/src/proxy/mappers/context_manager.rs` | 103-198 |
| Layer 1: íˆ´ ë¼ìš´ë“œ ì‹ë³„ + ì˜¤ë˜ëœ ë¼ìš´ë“œ íŠ¸ë¦¬ë° | `src-tauri/src/proxy/mappers/context_manager.rs` | 311-439 |
| Layer 2: Thinking ì••ì¶•í•˜ì§€ë§Œ ì„œëª… ìœ ì§€(ìµœê·¼ Nê°œ ë³´í˜¸) | `src-tauri/src/proxy/mappers/context_manager.rs` | 200-271 |
| Layer 3 ë³´ì¡°: ë§ˆì§€ë§‰ ìœ íš¨í•œ ì„œëª… ì¶”ì¶œ | `src-tauri/src/proxy/mappers/context_manager.rs` | 73-109 |
| ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ë‹¤ìš´ê·¸ë ˆì´ë“œ: Aggressive Thinking block ì •í™” | `src-tauri/src/proxy/handlers/claude.rs` | 540-583 |
| ì„¸ ë ˆì´ì–´ ì••ì¶• ë©”ì¸ í”Œë¡œìš°: ì¶”ì •, ë³´ì •, ì„ê³„ê°’ì— ë”°ë¼ L1/L2/L3 íŠ¸ë¦¬ê±° | `src-tauri/src/proxy/handlers/claude.rs` | 379-731 |
| Layer 3: XML ìš”ì•½ + Fork ì„¸ì…˜ êµ¬í˜„ | `src-tauri/src/proxy/handlers/claude.rs` | 1560-1687 |
| ì„œëª… ìºì‹œ: TTL/ì„¸ ë ˆì´ì–´ ìºì‹œ êµ¬ì¡°(Tool/Family/Session) | `src-tauri/src/proxy/signature_cache.rs` | 5-88 |
| ì„œëª… ìºì‹œ: Session ì„œëª… ì“°ê¸°/ì½ê¸° | `src-tauri/src/proxy/signature_cache.rs` | 141-223 |
| SSE ìŠ¤íŠ¸ë¦¬ë° íŒŒì‹±: thinking/toolì˜ ì„œëª…ì„ Session/Tool cacheì— ìºì‹œ | `src-tauri/src/proxy/mappers/claude/streaming.rs` | 766-776 |
|--- | --- | ---|
| ìš”ì²­ ë³€í™˜: tool_use ìš°ì„  Session/Tool cacheì—ì„œ ì„œëª… ë³µêµ¬ | `src-tauri/src/proxy/mappers/claude/request.rs` | 1045-1142 |
| ìš”ì²­ ë³€í™˜: tool_result íŠ¸ë¦¬ê±° íˆ´ ê²°ê³¼ ì••ì¶• | `src-tauri/src/proxy/mappers/claude/request.rs` | 1159-1225 |
| íˆ´ ê²°ê³¼ ì••ì¶•: ì…êµ¬ `compact_tool_result_text()` | `src-tauri/src/proxy/mappers/tool_result_compressor.rs` | 28-69 |
| íˆ´ ê²°ê³¼ ì••ì¶•: ë¸Œë¼ìš°ì € ìŠ¤ëƒ…ìƒ· ë¨¸ë¦¬/ê¼¬ë¦¬ ìš”ì•½ | `src-tauri/src/proxy/mappers/tool_result_compressor.rs` | 123-178 |
| íˆ´ ê²°ê³¼ ì••ì¶•: base64 ì´ë¯¸ì§€ ì œê±° + ì´ ë¬¸ì ìƒí•œ | `src-tauri/src/proxy/mappers/tool_result_compressor.rs` | 247-320 |
| í…ŒìŠ¤íŠ¸ ê³„íš: ì„¸ ë ˆì´ì–´ ì••ì¶• íŠ¸ë¦¬ê±°ì™€ ë¡œê·¸ ê²€ì¦ | `docs/testing/context_compression_test_plan.md` | 1-116 |

</details>
