---
title: "å®‰å…¨èˆ‡æ²™ç®±éš”é›¢ï¼šé™åˆ¶ AI åŠ©æ‰‹çš„æª”æ¡ˆç³»çµ±å’Œç¶²è·¯å­˜å– | Clawdbot æ•™ç¨‹"
sidebarTitle: "é™åˆ¶ AI å­˜å–ç¯„åœ"
subtitle: "å®‰å…¨èˆ‡æ²™ç®±éš”é›¢ï¼šé™åˆ¶ AI åŠ©æ‰‹çš„æª”æ¡ˆç³»çµ±å’Œç¶²è·¯å­˜å– | Clawdbot æ•™ç¨‹"
description: "å­¸ç¿’å¦‚ä½•é…ç½® Clawdbot çš„å®‰å…¨æ¨¡å‹ã€å·¥å…·æ¬Šé™æ§åˆ¶ã€æ²™ç®±éš”é›¢ï¼Œä¿è­·ä½ çš„ AI åŠ©æ‰‹å…å—æ”»æ“Šã€‚é€éå­˜å–æ§åˆ¶ã€æ¬Šé™é™åˆ¶å’Œå®¹å™¨éš”é›¢ï¼Œåœ¨äº«å—å¼·å¤§ AI èƒ½åŠ›çš„åŒæ™‚æœ€å°åŒ–å®‰å…¨é¢¨éšªã€‚"
tags:
  - "security"
  - "sandbox"
  - "permissions"
prerequisite:
  - "start-gateway-startup"
order: 290
---

# å®‰å…¨èˆ‡æ²™ç®±éš”é›¢ï¼šä¿è­·ä½ çš„ AI åŠ©æ‰‹

## å­¸å®Œä½ èƒ½åšä»€éº¼

- é…ç½®å¤šå±¤å®‰å…¨ç­–ç•¥ï¼Œå¾å­˜å–æ§åˆ¶åˆ°å·¥å…·æ¬Šé™
- ä½¿ç”¨æ²™ç®±éš”é›¢é™åˆ¶ AI åŠ©æ‰‹çš„æª”æ¡ˆç³»çµ±å’Œç¶²è·¯å­˜å–
- åŸ·è¡Œå®‰å…¨ç¨½æ ¸ï¼Œå‘ç°ä¸¦ä¿®å¾©å¸¸è§çš„å®‰å…¨éšæ‚£
- æ ¹æ®ä¸åŒå ´æ™¯ï¼ˆå€‹äºº/å®¶åº­/å…¬é–‹ï¼‰è°ƒæ•´å®‰å…¨ç­‰çº§

## ä½ ç°åœ¨çš„å›°å¢ƒ

Clawdbot è®©ä½ çš„ AI åŠ©æ‰‹å˜å¾—å¼·å¤§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ–°çš„å®‰å…¨æŒ‘æˆ˜ï¼š

- **Shell å­˜å–**ï¼šAI å¯ä»¥åŸ·è¡Œä»»æ„æŒ‡ä»¤ï¼Œè¯»å†™æª”æ¡ˆ
- **ç¶²è·¯å­˜å–**ï¼šAI å¯ä»¥å­˜å–ä»»æ„ URL å’Œæœå‹™
- **è¨Šæ¯ç™¼é€**ï¼šAI å¯ä»¥å‘ä»»ä½•äººç™¼é€è¨Šæ¯ï¼ˆå¦‚é…ç½®äº† WhatsAppï¼‰
- **è¿œç¨‹æ§åˆ¶**ï¼šé€éç€è¦½å™¨å·¥å…·æ§åˆ¶æœ¬åœ°ç€è¦½å™¨
- **è³‡æ–™æš´éœ²**ï¼šæ‰€æœ‰å°è©±å†å²å­˜å‚¨åœ¨ç£ç¢Ÿä¸Š

æ²¡æœ‰é€‚å½“çš„é˜²æŠ¤ï¼Œä¸€å€‹è¢«æ“çºµçš„ AI æ¨¡å‹å¯èƒ½å¯¼è‡´ç¾éš¾æ€§çš„å¾Œæœã€‚

## ä»€éº¼æ™‚å€™ç”¨é€™ä¸€æ‹›

- âœ… ä½ éœ€è¦åŸ·è¡Œ AI åŠ©æ‰‹åœ¨è‡ªæœ‰è£ç½®ä¸Šï¼Œæ‹…å¿ƒå®‰å…¨é¢¨éšª
- âœ… ä½ æƒ³å°† AI åŠ©æ‰‹æš´éœ²ç»™å¤šäººä½¿ç”¨ï¼ˆå®¶åº­æˆå‘˜ã€å›¢é˜Ÿï¼‰
- âœ… ä½ éœ€è¦é™åˆ¶ AI å­˜å–ç‰¹å®šæª”æ¡ˆæˆ–ç›®éŒ„
- âœ… ä½ å¸Œæœ›éš”é›¢ä¸åŒä½¿ç”¨è€…/æœƒè©±çš„å­˜å–ç¯„åœ
- âœ… ä½ éœ€è¦è®© AI åŠ©æ‰‹åœ¨å—é™ç¯å¢ƒä¸­åŸ·è¡Œï¼ˆæ²™ç®±ï¼‰

::: info
**é‡è¦æ¦‚å¿µ**ï¼šå®‰å…¨æ˜¯åˆ†å±¤çš„ï¼Œå¾"èª°èƒ½å­˜å–"åˆ°"èƒ½åšä»€éº¼"ï¼Œæœ€å¾Œæ‰æ˜¯"æ¨¡å‹å®‰å…¨"ã€‚
:::

## ğŸ’ é–‹å§‹å‰çš„å‡†å¤‡

### å‰ç½®æ£€æŸ¥

- [x] å·²å®Œæˆ[å¿«é€Ÿé–‹å§‹](../../start/getting-started/)ï¼Œäº†è§£å¦‚ä½•å¯åŠ¨ Gateway
- [ ] å·²é…ç½®è‡³å°‘ä¸€å€‹ AI æ¨¡å‹ï¼ˆAnthropicã€OpenAI æˆ– Ollamaï¼‰
- [ ] äº†è§£ä½ çš„ä½¿ç”¨å ´æ™¯ï¼ˆå€‹äººä½¿ç”¨ã€å®¶åº­å…±äº«ã€å…¬é–‹æœå‹™ï¼‰
- [ ] äº†è§£ Linux æª”æ¡ˆæ¬Šé™æ¦‚å¿µï¼ˆchmodï¼‰

### æ¨è–¦å·¥å…·

- æŒ‡ä»¤è¡Œå·¥å…·ï¼šTerminal æˆ– SSH
- ç·¨è¼¯å™¨ï¼šä½ å–œæ¬¢çš„ç¨‹å¼ç¢¼ç·¨è¼¯å™¨
- Dockerï¼šç”¨äºåŸ·è¡Œæ²™ç®±å®¹å™¨ï¼ˆå¯é€‰ï¼‰

---

## æ ¸å¿ƒæ€è·¯

Clawdbot çš„å®‰å…¨æ¨¡å‹åŸºæ–¼ä¸€å€‹æ ¸å¿ƒå“²å­¸ï¼š**å­˜å–æ§åˆ¶å„ªå…ˆï¼Œé™åˆ¶å¾Œç½®å®‰å…¨**ã€‚

### å®‰å…¨åˆ†å±¤

```mermaid
graph TB
    A[å­˜å–æ§åˆ¶] --> B[æ¬Šé™æ§åˆ¶]
    B --> C[å·¥å…·é™åˆ¶]
    C --> D[æ²™ç®±éš”é›¢]
    D --> E[ç¨½æ ¸èˆ‡ä¿®å¾©]
```

1. **å­˜å–æ§åˆ¶**ï¼šæ±ºå®šèª°èƒ½èˆ‡ä½ çš„ AI åŠ©æ‰‹å°è©±
2. **æ¬Šé™æ§åˆ¶**ï¼šæ±ºå®š AI åŠ©æ‰‹èƒ½å‘¼å«å“ªäº›å·¥å…·
3. **æ²™ç®±éš”é›¢**ï¼šæ±ºå®šå·¥å…·åŸ·è¡Œåœ¨ä»€éº¼ç¯å¢ƒä¸­ï¼ˆä¸»æœºæˆ–å®¹å™¨ï¼‰
4. **ç¨½æ ¸èˆ‡ä¿®å¾©**ï¼šæŒçºŒæ£€æŸ¥å’Œä¿®å¾©å®‰å…¨é…ç½®

é€™å€‹åˆ†å±¤è®¾è®¡ç¡®ä¿å³ä½¿æ¨¡å‹è¢«æ“çºµï¼Œæ”»æ“Šç¯„åœä¹Ÿè¢«é™åˆ¶åœ¨å·²å®šä¹‰çš„è¾¹ç•Œå…§ã€‚

### å­˜å–æ§åˆ¶çš„ä¸‰å±¤ä¿è­·

Clawdbot æä¾›ä¸‰å±¤å­˜å–æ§åˆ¶ï¼š

| å±¤çº§ | ä¿è­·å…§å®¹ | é…ç½®ä½ç½® |
|--- | --- | ---|
| **Gateway èªè­‰** | WebSocket é€£ç·š | `gateway.auth` |
| **DM ç­–ç•¥** | ç§èŠè¨Šæ¯ | `channels.*.dmPolicy` |
| **Group ç­–ç•¥** | ç¾¤ç»„è¨Šæ¯ | `channels.*.groupPolicy` / `channels.*.groups` |

æ¯ä¸€å±¤éƒ½å¯ä»¥ç‹¬ç«‹é…ç½®ï¼Œå½¢æˆçºµæ·±é˜²ç¦¦ã€‚

---

## å®‰å…¨ç¨½æ ¸ï¼šå‘ç°é¢¨éšª

Clawdbot æä¾›å…§ç½®çš„å®‰å…¨ç¨½æ ¸å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿå‘ç°å¸¸è§çš„å®‰å…¨éšæ‚£ã€‚

### åŸ·è¡Œç¨½æ ¸

```bash
# åŸºç¡€ç¨½æ ¸
clawdbot security audit

# æ·±åº¦ç¨½æ ¸ï¼ˆå¥—ä»¶æ‹¬ Gateway æ¢æµ‹ï¼‰
clawdbot security audit --deep

# è‡ªåŠ¨ä¿®å¾©å®‰å…¨å»ºè­°
clawdbot security audit --fix
```

### ç¨½æ ¸æ£€æŸ¥çš„å…§å®¹

ç¨½æ ¸å·¥å…·ä¼šæ£€æŸ¥ä»¥ä¸‹æ–¹é¢ï¼š

| æ£€æŸ¥é¡åˆ¥åˆ« | å…·é«”å°ˆæ¡ˆ | é¢¨éšªç­‰çº§ |
|--- | --- | ---|
| **å…¥ç«™å­˜å–** | Gateway èªè­‰ã€DM ç­–ç•¥ã€Group ç­–ç•¥ | Critical / Warn |
| **å·¥å…·å­˜å–** | Elevated exec å…è¨±æ¸…å–®ã€å·¥å…· allow/deny | Critical / Warn |
| **ç¶²è·¯æš´éœ²** | Gateway ç¹«çµæ¨¡å¼ã€Tailscale Serve/Funnel | Critical / Info |
| **ç€è¦½å™¨æ§åˆ¶** | è¿œç¨‹ç€è¦½å™¨æ§åˆ¶èªè­‰ã€URL å”å®š | Critical / Warn |
| **æª”æ¡ˆæ¬Šé™** | é…ç½®æª”æ¡ˆæ¬Šé™ã€ç‹€æ…‹ç›®éŒ„æ¬Šé™ | Critical / Warn |
| **æ’ä»¶ä¿¡ä»»** | æœªæ˜¾å¼å…è¨±çš„æ’ä»¶ | Warn |

### ç†è§£ç¨½æ ¸è¾“å‡º

ç¨½æ ¸æŠ¥å‘Šä¼šæŒ‰ä¸¥é‡çº§åˆ«åˆ†é¡åˆ¥ï¼š

- **Criticalï¼ˆçº¢è‰²ï¼‰**ï¼šç«‹å³ä¿®å¾©ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ç¨‹å¼ç¢¼åŸ·è¡Œæˆ–è³‡æ–™å¤–æ´©
- **Warnï¼ˆé»„è‰²ï¼‰**ï¼šå»ºè­°ä¿®å¾©ï¼Œé™ä½å®‰å…¨è¾¹ç•Œ
- **Infoï¼ˆè“è‰²ï¼‰**ï¼šè³‡è¨Šæç¤ºï¼Œéå®‰å…¨é—®é¢˜

### è‡ªåŠ¨ä¿®å¾©

ä½¿ç”¨ `--fix` æ ‡å¿—æ™‚ï¼Œç¨½æ ¸å·¥å…·ä¼šå®‰å…¨åœ°æ‡‰ç”¨ä»¥ä¸‹ä¿®å¾©ï¼š

- å°† `groupPolicy="open"` æ”¹ä¸º `allowlist`
- å°† `logging.redactSensitive="off"` æ”¹ä¸º `"tools"`
- ä¿®å¾©æª”æ¡ˆæ¬Šé™ï¼ˆé…ç½®æª”æ¡ˆ 600ï¼Œç›®éŒ„ 700ï¼‰

::: tip
**æœ€ä½³å¯¦è¸**ï¼šå®šæœŸåŸ·è¡Œç¨½æ ¸ï¼Œå°¤å…¶æ˜¯åœ¨æ›´æ”¹é…ç½®æˆ–æ›´æ–° Gateway å¾Œã€‚
:::

---

## å­˜å–æ§åˆ¶ï¼šèª°èƒ½å­˜å–ä½ çš„ AI åŠ©æ‰‹

å­˜å–æ§åˆ¶æ˜¯ç¬¬ä¸€é“é˜²ç·šï¼Œæ±ºå®šèª°èƒ½èˆ‡ä½ çš„ AI åŠ©æ‰‹äº¤äº’ã€‚

### Gateway èªè­‰

é è¨­æƒ…å†µä¸‹ï¼ŒGateway éœ€è¦èªè­‰æ‰èƒ½æ¥å— WebSocket é€£ç·šã€‚

#### é…ç½®èªè­‰æ–¹å¼

```json5
{
  "gateway": {
    "auth": {
      "mode": "token",  // æˆ– "password"
      "token": "your-long-random-token-please-change-me"
    }
  }
}
```

**èªè­‰æ¨¡å¼**ï¼š

| æ¨¡å¼ | ç”¨é€” | æ¨è–¦å ´æ™¯ |
|--- | --- | ---|
| `token` | å…±äº« bearer token | å¤§å¤šæ•°æƒ…å†µï¼Œæ¨è–¦ |
| `password` | å¯†ç èªè­‰ | æœ¬åœ°é–‹å‘ï¼Œæ–¹ä¾¿å¿«é€Ÿæµ‹è¯• |
| Tailscale Identity | Tailscale Serve | è¿œç¨‹å­˜å–é€é Tailscale |

::: warning
**é‡è¦**ï¼šå¦‚æœ `gateway.bind` è¨­å®šä¸ºé loopbackï¼ˆå¦‚ `lan`ã€`tailnet`ï¼‰ï¼Œå¿…é¡»é…ç½®èªè­‰ï¼Œå¦åˆ™æ‹’çµ•é€£ç·šã€‚
:::

### DM ç­–ç•¥ï¼šç§èŠä¿è­·

DM ç­–ç•¥æ§åˆ¶é™Œç”Ÿä½¿ç”¨è€…æ˜¯å¦èƒ½ç›´æ¥èˆ‡ä½ çš„ AI åŠ©æ‰‹å°è©±ã€‚

| ç­–ç•¥ | è¡Œä¸º | æ¨è–¦å ´æ™¯ |
|--- | --- | ---|
| `pairing`ï¼ˆé è¨­ï¼‰ | æœªçŸ¥ç™¼é€è€…æ”¶åˆ°é…å¯¹ç¨‹å¼ç¢¼ï¼Œé…å¯¹å‰ä¸å¤„ç† | å€‹äººä½¿ç”¨ï¼Œæ¨è–¦ |
| `allowlist` | æœªçŸ¥ç™¼é€è€…è¢«æ‹’çµ• | å¤šäººå¯ä¿¡ç¯å¢ƒ |
| `open` | å…è¨±ä»»ä½•äºº | å…¬é–‹æœå‹™ï¼ˆéœ€ `allowFrom` å¥—ä»¶å« `"*"`ï¼‰ |
| `disabled` | å¿½ç•¥æ‰€æœ‰ç§èŠ | ä»…ä½¿ç”¨ç¾¤ç»„åŠŸèƒ½ |

#### é…ç½®ç¤ºä¾‹

```json5
{
  "channels": {
    "whatsapp": {
      "dmPolicy": "pairing"
    },
    "telegram": {
      "dmPolicy": "allowlist",
      "allowFrom": ["user123", "user456"]
    }
  }
}
```

#### ç®¡ç†é…å¯¹

```bash
# æŸ¥çœ‹å¾…æ‰¹å‡†çš„é…å¯¹è«‹æ±‚
clawdbot pairing list whatsapp

# æ‰¹å‡†é…å¯¹
clawdbot pairing approve whatsapp <é…å¯¹ç¨‹å¼ç¢¼>
```

::: tip
**æœ€ä½³å¯¦è¸**ï¼šé è¨­ `pairing` æ¨¡å¼æä¾›äº†è‰¯å¥½çš„ä½¿ç”¨è€…é«”éªŒå’Œå®‰å…¨æ€§å¹³è¡¡ã€‚ä»…åœ¨ä½ æ˜ç¡®ä¿¡ä»»æ‰€æœ‰ä½¿ç”¨è€…æ™‚æ‰ä½¿ç”¨ `allowlist` æˆ– `open`ã€‚
:::

### Group ç­–ç•¥ï¼šç¾¤ç»„è¨Šæ¯æ§åˆ¶

Group ç­–ç•¥æ±ºå®š AI åŠ©æ‰‹å¦‚ä½•åœ¨ç¾¤ç»„ä¸­å›æ‡‰è¨Šæ¯ã€‚

| ç­–ç•¥ | è¡Œä¸º | é…ç½®ä½ç½® |
|--- | --- | ---|
| `allowlist` | ä»…æ¥å—ç™½åå•ä¸­çš„ç¾¤ç»„ | `channels.whatsapp.groups` |
| `disabled` | å¿½ç•¥æ‰€æœ‰ç¾¤ç»„è¨Šæ¯ | `channels.telegram.groups` |
| `requireMention` | ä»…åœ¨è¢« @ æåŠæˆ–æŒ‡ä»¤è§¦å‘æ™‚å›æ‡‰ | `channels.*.groups.*` |

#### é…ç½®ç¤ºä¾‹

```json5
{
  "channels": {
    "whatsapp": {
      "groups": {
        "*": {
          "requireMention": true
        }
      }
    },
    "discord": {
      "guilds": {
        "your-guild-id": {
          "users": ["user1", "user2"]
        }
      }
    }
  }
}
```

::: tip
**æœ€ä½³å¯¦è¸**ï¼šåœ¨å…¬å…±ç¾¤ç»„ä¸­å•Ÿç”¨ `requireMention`ï¼Œé¿å… AI åŠ©æ‰‹è¢«æ¶æ„ä½¿ç”¨è€…æ“æ§ã€‚
:::

### æœƒè©±éš”é›¢ï¼šé˜²æ­¢ä¸Šä¸‹æ–‡å¤–æ´©

é è¨­æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç§èŠè¨Šæ¯éƒ½è·¯ç”±åˆ°åŒä¸€å€‹ä¸»æœƒè©±ã€‚å½“å¤šå€‹ä½¿ç”¨è€…å¯ä»¥å­˜å– AI åŠ©æ‰‹æ™‚ï¼Œé€™å¯èƒ½å¯¼è‡´ä¸Šä¸‹æ–‡å¤–æ´©ã€‚

```json5
{
  "session": {
    "dmScope": "per-channel-peer"  // ä¸ºæ¯å€‹æ¸ é“-ç™¼é€è€…å»ºç«‹ç‹¬ç«‹æœƒè©±
  }
}
```

---

## å·¥å…·æ¬Šé™æ§åˆ¶ï¼šé™åˆ¶ AI èƒ½åšä»€éº¼

å·¥å…·æ¬Šé™æ§åˆ¶æ˜¯ç¬¬äºŒé“é˜²ç·šï¼Œæ±ºå®š AI åŠ©æ‰‹èƒ½å‘¼å«å“ªäº›å·¥å…·ã€‚

### å·¥å…· Allow/Deny æ¸…å–®

ä½ å¯ä»¥å…¨å±€æˆ–æ¯å€‹ Agent é…ç½®å·¥å…·çš„ç™½åå•å’Œé»‘åå•ã€‚

```json5
{
  "agents": {
    "defaults": {
      "tools": {
        "allow": ["read", "write", "web_search"],
        "deny": ["exec", "browser", "web_fetch"]
      }
    },
    "list": [
      {
        "id": "read-only",
        "tools": {
          "allow": ["read"],
          "deny": ["write", "edit", "apply_patch", "exec", "browser"]
        }
      }
    ]
  }
}
```

### å¸¸ç”¨å·¥å…·åˆ†é¡åˆ¥

| å·¥å…·é¡åˆ¥åˆ« | å…·é«”å·¥å…· | é¢¨éšªç­‰çº§ |
|--- | --- | ---|
| **æª”æ¡ˆæ“ä½œ** | `read`ã€`write`ã€`edit`ã€`apply_patch` | ä¸­ç­‰ |
| **Shell åŸ·è¡Œ** | `exec`ã€`process` | é«˜ |
| **ç€è¦½å™¨æ§åˆ¶** | `browser` | é«˜ |
| **ç¶²è·¯å­˜å–** | `web_search`ã€`web_fetch` | ä¸­ç­‰ |
| **Canvas å¯è§†åŒ–** | `canvas` | ä¸­ç­‰ |
| **èŠ‚é»æ“ä½œ** | `nodes_invoke` | é«˜ |
| **Cron å®šæ™‚ä»»å‹™** | `cron` | ä¸­ç­‰ |
| **è¨Šæ¯ç™¼é€** | `message`ã€`sessions_*` | ä½ |

### Elevated æ¨¡å¼ï¼šä¸»æœºåŸ·è¡Œçš„é€ƒç”Ÿå£

Elevated exec æ˜¯ä¸€å€‹ç‰¹æ®Šçš„é€ƒç”Ÿå£ï¼Œå…è¨±å·¥å…·åœ¨ä¸»æœºä¸ŠåŸ·è¡Œï¼Œç»•è¿‡æ²™ç®±ã€‚

```json5
{
  "tools": {
    "elevated": {
      "enabled": true,
      "allowFrom": {
        "whatsapp": ["your-trusted-user-id"]
      },
      "security": "allowlist",
      "ask": "on"  // æ¯æ¬¡åŸ·è¡Œå‰è¯¢é—®ç¢ºèª
    }
  }
}
```

::: danger
**é‡è¦è­¦å‘Š**ï¼šElevated exec ç»•è¿‡æ²™ç®±é™åˆ¶ã€‚ä»…åœ¨ä½ å®Œå…¨ä¿¡ä»»å…è¨±çš„ä½¿ç”¨è€…å’Œå ´æ™¯æ™‚å•Ÿç”¨ã€‚
:::

::: tip
**æœ€ä½³å¯¦è¸**ï¼šå¯¹äºå¤§å¤šæ•°å ´æ™¯ï¼Œåœç”¨ elevated execï¼Œç›¸ä¾æ²™ç®±éš”é›¢å’Œä¸¥æ ¼çš„å·¥å…·ç™½åå•ã€‚
:::

---

## æ²™ç®±éš”é›¢ï¼šåŸ·è¡Œåœ¨å—é™ç¯å¢ƒä¸­

æ²™ç®±éš”é›¢è®©å·¥å…·åŸ·è¡Œåœ¨ Docker å®¹å™¨ä¸­ï¼Œé™åˆ¶æª”æ¡ˆç³»çµ±å’Œç¶²è·¯å­˜å–ã€‚

### æ²™ç®±æ¨¡å¼

| æ¨¡å¼ | è¡Œä¸º | æ¨è–¦å ´æ™¯ |
|--- | --- | ---|
| `off` | æ‰€æœ‰å·¥å…·åœ¨ä¸»æœºä¸ŠåŸ·è¡Œ | å€‹äººå¯ä¿¡ç¯å¢ƒ |
| `non-main`ï¼ˆæ¨è–¦ï¼‰ | ä¸»æœƒè©±åœ¨ä¸»æœºï¼Œå…¶ä»–æœƒè©±åœ¨æ²™ç®± | å¹³è¡¡æ€§èƒ½å’Œå®‰å…¨ |
| `all` | æ‰€æœ‰æœƒè©±åœ¨æ²™ç®± | å¤šäººç¯å¢ƒã€å…¬é–‹æœå‹™ |

```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "mode": "non-main"
      }
    }
  }
}
```

### å·¥ä½œåŒºå­˜å–

å·¥ä½œåŒºå­˜å–æ±ºå®šæ²™ç®±å®¹å™¨èƒ½çœ‹åˆ°ä¸»æœºçš„å“ªäº›ç›®éŒ„ã€‚

| å­˜å–çº§åˆ« | è¡Œä¸º | æ¨è–¦å ´æ™¯ |
|--- | --- | ---|
| `none`ï¼ˆé è¨­ï¼‰ | æ²™ç®±å·¥ä½œåŒº `~/.clawdbot/sandboxes` | æœ€å¤§éš”é›¢ |
| `ro` | ä»£ç†å·¥ä½œåŒºåªè¯»æ›è¼‰åœ¨ `/agent` | è®€å–ä½†ä¸å¯«å…¥æª”æ¡ˆ |
| `rw` | ä»£ç†å·¥ä½œåŒºè¯»å†™æ›è¼‰åœ¨ `/workspace` | éœ€è¦å¯«å…¥æª”æ¡ˆçš„ Agent |

```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "workspaceAccess": "none"
      }
    }
  }
}
```

### æ²™ç®±ç¯„åœ

æ²™ç®±ç¯„åœæ±ºå®šå®¹å™¨éš”é›¢ç²’åº¦ã€‚

| ç¯„åœ | è¡Œä¸º | å®¹å™¨æ•°é‡ |
|--- | --- | ---|
| `session`ï¼ˆé è¨­ï¼‰ | æ¯å€‹æœƒè©±ä¸€å€‹å®¹å™¨ | è¾ƒå¤šå®¹å™¨ï¼Œæ›´å¥½éš”é›¢ |
| `agent` | æ¯å€‹ Agent ä¸€å€‹å®¹å™¨ | å¹³è¡¡éš”é›¢å’Œèµ„æº |
| `shared` | æ‰€æœ‰æœƒè©±å…±äº«ä¸€å€‹å®¹å™¨ | èŠ‚çœèµ„æºï¼Œéš”é›¢æ€§æœ€ä½ |

### Docker é…ç½®

```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "docker": {
          "image": "clawdbot-sandbox:bookworm-slim",
          "containerPrefix": "clawdbot-sbx-"
        }
      }
    }
}
```

### è‡ªå®šä¹‰æ›è¼‰

ä½ å¯ä»¥å°†ä¸»æœºçš„é¢å¤–ç›®éŒ„æ›è¼‰åˆ°æ²™ç®±å®¹å™¨ã€‚

```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "docker": {
          "binds": [
            "/home/user/source:/source:ro",
            "/var/run/docker.sock:/var/run/docker.sock"
          ]
        }
      }
    }
  }
}
```

::: warning
**å®‰å…¨æç¤º**ï¼šæ›è¼‰ç»•è¿‡æ²™ç®±æª”æ¡ˆç³»çµ±éš”é›¢ã€‚æ•æ„Ÿæ›è¼‰ï¼ˆå¦‚ docker.sockï¼‰åº”ä½¿ç”¨ `:ro`ï¼ˆåªè¯»ï¼‰æ¨¡å¼ã€‚
:::

### æ²™ç®±åŒ–ç€è¦½å™¨

æ²™ç®±åŒ–ç€è¦½å™¨å°† Chrome åŸ·è¡Œå€‹é«”åŸ·è¡Œåœ¨å®¹å™¨ä¸­ï¼Œéš”é›¢ç€è¦½å™¨æ“ä½œã€‚

```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "browser": {
          "enabled": true,
          "autoStart": true,
          "autoStartTimeoutMs": 10000
        }
      }
    }
  }
}
```

::: tip
**æœ€ä½³å¯¦è¸**ï¼šæ²™ç®±åŒ–ç€è¦½å™¨å¯ä»¥é˜²æ­¢ AI åŠ©æ‰‹å­˜å–ä½ æ—¥å¸¸ç€è¦½å™¨çš„ç™»å½•æœƒè©±å’Œæ•æ„Ÿè³‡æ–™ã€‚
:::

---

## å¤š Agent å®‰å…¨é…ç½®

ä¸åŒ Agent å¯ä»¥æœ‰ä¸åŒçš„å®‰å…¨é…ç½®ã€‚

### å ´æ™¯ç¤ºä¾‹

#### å ´æ™¯ 1ï¼šå€‹äºº Agentï¼ˆå®Œå…¨ä¿¡ä»»ï¼‰

```json5
{
  "agents": {
    "list": [
      {
        "id": "personal",
        "sandbox": { "mode": "off" },
        "tools": {
          "allow": ["*"],
          "deny": []
        }
      }
    ]
  }
}
```

#### å ´æ™¯ 2ï¼šå®¶åº­ Agentï¼ˆåªè¯»ï¼‰

```json5
{
  "agents": {
    "list": [
      {
        "id": "family",
        "workspace": "~/clawd-family",
        "sandbox": {
          "mode": "all",
          "scope": "agent",
          "workspaceAccess": "ro"
        },
        "tools": {
          "allow": ["read"],
          "deny": ["write", "edit", "apply_patch", "exec", "browser"]
        }
      }
    ]
  }
}
```

#### å ´æ™¯ 3ï¼šå…¬é–‹ Agentï¼ˆæ²™ç®± + ä¸¥æ ¼é™åˆ¶ï¼‰

```json5
{
  "agents": {
    "list": [
      {
        "id": "public",
        "workspace": "~/clawd-public",
        "sandbox": {
          "mode": "all",
          "scope": "agent",
          "workspaceAccess": "none"
        },
        "tools": {
          "allow": ["web_search", "sessions_list"],
          "deny": ["read", "write", "edit", "apply_patch", "exec", "browser", "web_fetch", "canvas", "nodes", "cron", "gateway", "image"]
        }
      }
    ]
  }
}
```

---

## Docker åŒ–ï¼šå®Œå…¨éš”é›¢ Gateway

é™¤äº†å·¥å…·çº§åˆ«çš„æ²™ç®±ï¼Œä½ è¿˜å¯ä»¥å°†æ•´å€‹ Gateway åŸ·è¡Œåœ¨ Docker å®¹å™¨ä¸­ã€‚

### å®Œå…¨ Docker åŒ–çš„ä¼˜åŠ¿

- å®Œå…¨éš”é›¢ Gateway ç¨‹åº
- é¿å…åœ¨ä¸»æœºä¸Šå®‰è£ç›¸ä¾
- ä¾¿äºéƒ¨ç½²å’Œç®¡ç†
- æä¾›é¢å¤–çš„å®‰å…¨è¾¹ç•Œ

::: tip
ä½•æ™‚ä½¿ç”¨ Docker åŒ– vs å·¥å…·æ²™ç®±ï¼š
- **å·¥å…·æ²™ç®±**ï¼šå¤§å¤šæ•°å ´æ™¯ï¼Œå¹³è¡¡æ€§èƒ½å’Œå®‰å…¨
- **Docker åŒ–**ï¼šç”Ÿäº§ç¯å¢ƒã€å¤šç§Ÿæˆ·éƒ¨ç½²ã€éœ€è¦å®Œå…¨éš”é›¢
:::

### Docker å®‰è£å‚è€ƒ

### Docker å®‰è£å‚è€ƒ

è¯¦ç»†çš„ Docker å®‰è£è¯´æ˜ï¼Œè¯·å‚è€ƒï¼š[éƒ¨ç½²é¸é …](../../appendix/deployment/)ã€‚

---

## è¸©å‘æé†’

### å¸¸è§éŒ¯èª¤

#### âŒ å¿˜è®°é…ç½® Gateway èªè­‰

**éŒ¯èª¤é…ç½®**ï¼š
```json5
{
  "gateway": {
    "bind": "lan"  // å±é™©ï¼
    "auth": {}
  }
}
```

**å¾Œæœ**ï¼šä»»ä½•èƒ½é€£ç·šåˆ°ä½ å€åŸŸç¶²è·¯çš„äººéƒ½èƒ½æ§åˆ¶ä½ çš„ AI åŠ©æ‰‹ã€‚

**æ­£ç¡®é…ç½®**ï¼š
```json5
{
  "gateway": {
    "bind": "loopback",  // æˆ–é…ç½®å¼·èªè­‰
    "auth": {
      "mode": "token",
      "token": "your-secure-token"
    }
  }
}
```

#### âŒ ä½¿ç”¨ `dmPolicy: "open"` ä½†å¿˜è®° `allowFrom`

**éŒ¯èª¤é…ç½®**ï¼š
```json5
{
  "channels": {
    "whatsapp": {
      "dmPolicy": "open"  // å±é™©ï¼
    }
  }
}
```

**å¾Œæœ**ï¼šä»»ä½•äººéƒ½èƒ½ç»™ä½ çš„ AI åŠ©æ‰‹å‘è¨Šæ¯ã€‚

**æ­£ç¡®é…ç½®**ï¼š
```json5
{
  "channels": {
    "whatsapp": {
      "dmPolicy": "open",
      "allowFrom": ["*"]  // å¿…é¡»æ˜¾å¼å…è¨±
    }
  }
}
```

#### âŒ å•Ÿç”¨ Elevated exec ä½†æ²¡æœ‰é…ç½® allowFrom

**éŒ¯èª¤é…ç½®**ï¼š
```json5
{
  "tools": {
    "elevated": {
      "enabled": true  // å±é™©ï¼
    }
  }
}
```

**å¾Œæœ**ï¼šä»»ä½•ä½¿ç”¨è€…éƒ½èƒ½åŸ·è¡Œä¸»æœºæŒ‡ä»¤ã€‚

**æ­£ç¡®é…ç½®**ï¼š
```json5
{
  "tools": {
    "elevated": {
      "enabled": true,
      "allowFrom": {
        "discord": ["your-user-id"]  // é™åˆ¶å…è¨±çš„ä½¿ç”¨è€…
      },
      "security": "allowlist",
      "ask": "on"  // è¦æ±‚ç¢ºèª
    }
  }
}
```

#### âŒ æ•æ„Ÿæ›è¼‰ä½¿ç”¨è¯»å†™æ¨¡å¼

**éŒ¯èª¤é…ç½®**ï¼š
```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "docker": {
          "binds": [
            "/var/run/docker.sock:/var/run/docker.sock"  // å±é™©ï¼
          ]
        }
      }
    }
  }
}
```

**å¾Œæœ**ï¼šæ²™ç®±å¯ä»¥æ§åˆ¶ Docker å®ˆæŠ¤ç¨‹åºã€‚

**æ­£ç¡®é…ç½®**ï¼š
```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "docker": {
          "binds": [
            "/var/run/docker.sock:/var/run/docker.sock:ro"  // åªè¯»
          ]
        }
      }
    }
}
```

### æœ€ä½³å¯¦è¸æ€»ç»“

| å¯¦è¸ | åŸå›  |
|--- | ---|
| é è¨­ä½¿ç”¨ `pairing` æ¨¡å¼ | å¹³è¡¡ä½¿ç”¨è€…é«”éªŒå’Œå®‰å…¨ |
| ç¾¤ç»„è¨Šæ¯ä½¿ç”¨ `requireMention` | é¿å…è¢«æ“æ§ |
| ä½¿ç”¨å·¥å…·ç™½åå•è€Œéé»‘åå• | æœ€å°æ¬Šé™åŸåˆ™ |
| å•Ÿç”¨æ²™ç®±ä½†è¨­å®š `workspaceAccess: "none"` | éš”é›¢å·¥ä½œåŒºå­˜å– |
| å®šæœŸåŸ·è¡Œå®‰å…¨ç¨½æ ¸ | æŒçºŒå®‰å…¨ç›£æ§ |
| å°†æ•æ„Ÿå¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æª”æ¡ˆä¸­ | é¿å…ç¨‹å¼ç¢¼å¤–æ´© |

---

## æœ¬è¯¾å°ç»“

æœ¬è¯¾ä»‹ç»äº† Clawdbot çš„å®‰å…¨æ¨¡å‹å’Œæ²™ç®±éš”é›¢åŠŸèƒ½ï¼š

**æ ¸å¿ƒè¦é»**ï¼š

1. **å®‰å…¨åˆ†å±¤**ï¼šå­˜å–æ§åˆ¶ â†’ æ¬Šé™æ§åˆ¶ â†’ æ²™ç®±éš”é›¢ â†’ ç¨½æ ¸èˆ‡ä¿®å¾©
2. **å­˜å–æ§åˆ¶**ï¼šGateway èªè­‰ã€DM ç­–ç•¥ã€Group ç­–ç•¥
3. **å·¥å…·æ¬Šé™**ï¼šallow/deny æ¸…å–®ã€Elevated æ¨¡å¼
4. **æ²™ç®±éš”é›¢**ï¼šæ¨¡å¼ã€ç¯„åœã€å·¥ä½œåŒºå­˜å–ã€Docker é…ç½®
5. **å®‰å…¨ç¨½æ ¸**ï¼š`clawdbot security audit` å‘ç°å’Œä¿®å¾©é—®é¢˜

**å®‰å…¨ç¬¬ä¸€åŸåˆ™**ï¼š
- å¾æœ€å°æ¬Šé™é–‹å§‹ï¼Œä»…åœ¨å¿…è¦æ™‚æ”¾å®½
- ä½¿ç”¨æ²™ç®±éš”é›¢é™åˆ¶æ”»æ“Šç¯„åœ
- å®šæœŸç¨½æ ¸å’Œæ›´æ–°é…ç½®
- å¯¹æ•æ„ŸåŠŸèƒ½ï¼ˆå¦‚ Elevated execï¼‰ä¿æŒè°¨æ…

---

## ä¸‹ä¸€è¯¾é¢„å‘Š

> ä¸‹ä¸€è¯¾æˆ‘ä»¬å°†å­¸ç¿’ **[è¿œç¨‹ Gateway èˆ‡ Tailscale](../remote-gateway/)**ã€‚
>
> ä½ ä¼šå­¸åˆ°ï¼š
> - é€é Tailscale Serve æš´éœ² Gateway åˆ°ä½ çš„ Tailnet
> - ä½¿ç”¨ Tailscale Funnel å…¬é–‹å­˜å–ï¼ˆéœ€è°¨æ…ï¼‰
> - SSH éš§é“å’Œåå‘ä»£ç†é…ç½®
> - è¿œç¨‹å­˜å–çš„å®‰å…¨æœ€ä½³å¯¦è¸

---

## é™„å½•ï¼šæºç å‚è€ƒ

<details>
<summary><strong>é»å‡»å±•é–‹æŸ¥çœ‹æºç ä½ç½®</strong></summary>

> æ›´æ–°æ™‚é–“ï¼š2026-01-27

| åŠŸèƒ½ | æª”æ¡ˆè·¯å¾‘ | è¡Œå· |
|--- | --- | ---|
| å®‰å…¨ç¨½æ ¸ | [`src/security/audit.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/security/audit.ts#L1-L910) | 1-910 |
| å®‰å…¨ä¿®å¾© | [`src/security/fix.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/security/fix.ts#L1-L385) | 1-385 |
| æª”æ¡ˆæ¬Šé™æ£€æŸ¥ | [`src/security/audit-fs.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/security/audit-fs.ts) | å…¨æª”æ¡ˆ |
| Gateway é…ç½® Schema | [`src/config/zod-schema.core.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/config/zod-schema.core.ts) | å…¨æª”æ¡ˆ |
| Agent Defaults Schema | [`src/config/zod-schema.agent-defaults.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/config/zod-schema.agent-defaults.ts) | 1-172 |
| Sandbox Schema | [`src/config/zod-schema.agent-runtime.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/config/zod-schema.agent-runtime.ts) | 82-511 |
| æ²™ç®±ç®¡ç† | [`src/agents/sandbox.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/agents/sandbox.ts) | å…¨æª”æ¡ˆ |
| æ²™ç®±é…ç½®è§£æ | [`src/agents/sandbox/config.js`](https://github.com/clawdbot/clawdbot/blob/main/src/agents/sandbox/config.js) | å…¨æª”æ¡ˆ |
| Docker è¨­å®š | [`src/agents/sandbox/docker.js`](https://github.com/clawdbot/clawdbot/blob/main/src/agents/sandbox/docker.js) | å…¨æª”æ¡ˆ |
| å®‰å…¨æ–‡æ¡£ | [`docs/gateway/security.md`](https://github.com/clawdbot/clawdbot/blob/main/docs/gateway/security.md) | å…¨æª”æ¡ˆ |
| æ²™ç®±æ–‡æ¡£ | [`docs/gateway/sandboxing.md`](https://github.com/clawdbot/clawdbot/blob/main/docs/gateway/sandboxing.md) | å…¨æª”æ¡ˆ |
| æ²™ç®± CLI | [`docs/cli/sandbox.md`](https://github.com/clawdbot/clawdbot/blob/main/docs/cli/sandbox.md) | å…¨æª”æ¡ˆ |

**é—œé”®é…ç½®æ¬„ä½**ï¼š

```typescript
// Sandbox é…ç½®
sandbox: {
  mode: "off" | "non-main" | "all",  // æ²™ç®±æ¨¡å¼
  workspaceAccess: "none" | "ro" | "rw",  // å·¥ä½œåŒºå­˜å–
  scope: "session" | "agent" | "shared",  // æ²™ç®±ç¯„åœ
  docker: {
    image: string,  // Docker æ˜ åƒæª”
    binds: string[],  // ä¸»æœºæ›è¼‰
    network: "bridge" | "none" | "custom"  // ç¶²è·¯æ¨¡å¼
  },
  browser: {
    enabled: boolean,  // æ˜¯å¦æ²™ç®±åŒ–ç€è¦½å™¨
    autoStart: boolean,  // è‡ªåŠ¨å¯åŠ¨
  },
  prune: {
    idleHours: number,  // ç©ºé—²å¾Œè‡ªåŠ¨åˆªé™¤
    maxAgeDays: number,  // æœ€å¤§ä¿ç•™å¤©æ•°
  }
}

// å·¥å…·æ¬Šé™
tools: {
  allow: string[],  // å…è¨±çš„å·¥å…·
  deny: string[],  // æ‹’çµ•çš„å·¥å…·
  elevated: {
    enabled: boolean,  // æ˜¯å¦å•Ÿç”¨ä¸»æœºåŸ·è¡Œ
    allowFrom: {  // æ¯å€‹æ¸ é“çš„å…è¨±æ¸…å–®
      [provider: string]: string[] | number[]
    },
    security: "deny" | "allowlist" | "full",  // å®‰å…¨ç­–ç•¥
    ask: "off" | "on-miss" | "always",  // ç¢ºèªç­–ç•¥
  }
}

// DM ç­–ç•¥
dmPolicy: "pairing" | "allowlist" | "open" | "disabled"

// Group ç­–ç•¥
groupPolicy: "allowlist" | "open" | "disabled"
```

**é—œé”®å¸¸é‡**ï¼š

- `DEFAULT_SANDBOX_IMAGE`: `"clawdbot-sandbox:bookworm-slim"` - é è¨­æ²™ç®±æ˜ åƒæª”
- `DEFAULT_SANDBOX_COMMON_IMAGE`: é è¨­é€šç”¨æ²™ç®±æ˜ åƒæª”

**é—œé”®å‡½å¼**ï¼š

- `runSecurityAudit()`: åŸ·è¡Œå®‰å…¨ç¨½æ ¸
- `fixSecurityFootguns()`: æ‡‰ç”¨å®‰å…¨ä¿®å¾©
- `resolveSandboxConfigForAgent()`: è§£æ Agent çš„æ²™ç®±é…ç½®
- `buildSandboxCreateArgs()`: æ„å»ºæ²™ç®±å®¹å™¨å»ºç«‹å‚æ•°

</details>
