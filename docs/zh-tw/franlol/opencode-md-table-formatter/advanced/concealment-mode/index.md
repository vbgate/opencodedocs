---
title: "éš±è—æ¨¡å¼: å¯¬åº¦è¨ˆç®—åŸç† | opencode-md-table-formatter"
sidebarTitle: "å¯¬åº¦è¨ˆç®—ä¸‰æ­¥èµ°"
subtitle: "éš±è—æ¨¡å¼åŸç†ï¼šç‚ºä»€éº¼å¯¬åº¦è¨ˆç®—å¦‚æ­¤é‡è¦"
description: "å­¸ç¿’ OpenCode éš±è—æ¨¡å¼çš„å·¥ä½œåŸç†ã€‚æŒæ¡å¤–æ›é¡¯ç¤ºå¯¬åº¦è¨ˆç®—æ–¹æ³•ï¼Œäº†è§£ Markdown ç¬¦è™Ÿå‰é›¢ã€ç¨‹å¼ç¢¼å€å¡Šä¿è­·ã€Bun.stringWidth çš„ä½¿ç”¨ã€‚"
tags:
  - "concealment-mode"
  - "é¡¯ç¤ºå¯¬åº¦è¨ˆç®—"
  - "Markdown ç¬¦è™Ÿå‰é›¢"
  - "Bun.stringWidth"
prerequisite:
  - "start-features"
order: 30
---

# éš±è—æ¨¡å¼åŸç†ï¼šç‚ºä»€éº¼å¯¬åº¦è¨ˆç®—å¦‚æ­¤é‡è¦

::: info å­¸å®Œä½ èƒ½åšä»€éº¼
- ç†è§£ OpenCode éš±è—æ¨¡å¼çš„å·¥ä½œåŸç†
- çŸ¥é“ç‚ºä»€éº¼æ™®é€šæ ¼å¼åŒ–å·¥å…·åœ¨éš±è—æ¨¡å¼ä¸‹æœƒå°é½ŠéŒ¯ä½
- æŒæ¡å¤–æ›çš„å¯¬åº¦è¨ˆç®—æ¼”ç®—æ³•ï¼ˆä¸‰æ­¥èµ°ï¼‰
- äº†è§£ `Bun.stringWidth` çš„ä½œç”¨
:::

## ä½ ç¾åœ¨çš„å›°å¢ƒ

ä½ ç”¨ OpenCode å¯«ç¨‹å¼ç¢¼ï¼ŒAI ç”Ÿæˆäº†ä¸€å€‹æ¼‚äº®çš„è¡¨æ ¼ï¼š

```markdown
| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|--- | --- | ---|
| **name** | string | ä½¿ç”¨è€…åç¨± |
| age | number | å¹´é½¡ |
```

åœ¨åŸå§‹ç¢¼è¦–åœ–è£¡çœ‹è‘—æŒºæ•´é½Šã€‚ä½†åˆ‡åˆ°é è¦½æ¨¡å¼ï¼Œè¡¨æ ¼å»éŒ¯ä½äº†ï¼š

```
| æ¬„ä½     | é¡å‹   | èªªæ˜   |
|--- | --- | ---|
| name | string | ä½¿ç”¨è€…åç¨± |    â† æ€éº¼çŸ­äº†ï¼Ÿ
| age      | number | å¹´é½¡   |
```

å•é¡Œå‡ºåœ¨å“ªï¼Ÿ**éš±è—æ¨¡å¼**ã€‚

## ä»€éº¼æ˜¯éš±è—æ¨¡å¼

OpenCode é è¨­é–‹å•Ÿ**éš±è—æ¨¡å¼ï¼ˆConcealment Modeï¼‰**ï¼Œå®ƒæœƒåœ¨æ¸²æŸ“æ™‚éš±è— Markdown èªæ³•ç¬¦è™Ÿï¼š

| åŸå§‹ç¢¼ | éš±è—æ¨¡å¼ä¸‹é¡¯ç¤º |
|--- | ---|
| `**ç²—é«”**` | ç²—é«”ï¼ˆ4 å€‹å­—å…ƒï¼‰ |
| `*æ–œé«”*` | æ–œé«”ï¼ˆ4 å€‹å­—å…ƒï¼‰ |
| `~~åˆªé™¤ç·š~~` | åˆªé™¤ç·šï¼ˆ6 å€‹å­—å…ƒï¼‰ |
| `` `ç¨‹å¼ç¢¼` `` | `ç¨‹å¼ç¢¼`ï¼ˆ4 å€‹å­—å…ƒ + èƒŒæ™¯è‰²ï¼‰ |

::: tip éš±è—æ¨¡å¼çš„å¥½è™•
è®“ä½ å°ˆæ³¨æ–¼å…§å®¹æœ¬èº«ï¼Œè€Œä¸æ˜¯è¢«ä¸€å † `**`ã€`*` ç¬¦è™Ÿå¹²æ“¾è¦–ç·šã€‚
:::

## ç‚ºä»€éº¼æ™®é€šæ ¼å¼åŒ–å·¥å…·æœƒå‡ºå•é¡Œ

æ™®é€šçš„è¡¨æ ¼æ ¼å¼åŒ–å·¥å…·è¨ˆç®—å¯¬åº¦æ™‚ï¼ŒæœƒæŠŠ `**name**` ç•¶ä½œ 8 å€‹å­—å…ƒï¼š

```
** n a m e ** = 8 å­—å…ƒ
```

ä½†åœ¨éš±è—æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨è€…çœ‹åˆ°çš„æ˜¯ `name`ï¼Œåªæœ‰ 4 å€‹å­—å…ƒã€‚

çµæœå°±æ˜¯ï¼šæ ¼å¼åŒ–å·¥å…·æŒ‰ 8 å­—å…ƒå°é½Šï¼Œä½¿ç”¨è€…çœ‹åˆ°çš„å»æ˜¯ 4 å­—å…ƒï¼Œè¡¨æ ¼è‡ªç„¶å°±éŒ¯ä½äº†ã€‚

## æ ¸å¿ƒæ€è·¯ï¼šè¨ˆç®—"é¡¯ç¤ºå¯¬åº¦"è€Œé"å­—å…ƒé•·åº¦"

é€™å€‹å¤–æ›çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼š**è¨ˆç®—ä½¿ç”¨è€…å¯¦éš›çœ‹åˆ°çš„å¯¬åº¦ï¼Œè€Œä¸æ˜¯åŸå§‹ç¢¼çš„å­—å…ƒæ•¸**ã€‚

æ¼”ç®—æ³•åˆ†ä¸‰æ­¥ï¼š

```
ç¬¬ 1 æ­¥ï¼šä¿è­·ç¨‹å¼ç¢¼å€å¡Šï¼ˆç¨‹å¼ç¢¼å€å¡Šè£¡çš„ç¬¦è™Ÿä¸å‰é›¢ï¼‰
ç¬¬ 2 æ­¥ï¼šå‰é›¢ Markdown ç¬¦è™Ÿï¼ˆ**ã€*ã€~~ ç­‰ï¼‰
ç¬¬ 3 æ­¥ï¼šç”¨ Bun.stringWidth è¨ˆç®—æœ€çµ‚å¯¬åº¦
```

## è·Ÿæˆ‘åšï¼šç†è§£ä¸‰æ­¥æ¼”ç®—æ³•

### ç¬¬ 1 æ­¥ï¼šä¿è­·ç¨‹å¼ç¢¼å€å¡Š

**ç‚ºä»€éº¼**

è¡Œå…§ç¨‹å¼ç¢¼ï¼ˆç”¨åå¼•è™ŸåŒ…è£¹ï¼‰è£¡çš„ Markdown ç¬¦è™Ÿæ˜¯"å­—é¢é‡"ï¼Œä½¿ç”¨è€…æœƒçœ‹åˆ° `**bold**` é€™ 8 å€‹å­—å…ƒï¼Œè€Œä¸æ˜¯ `bold` é€™ 4 å€‹å­—å…ƒã€‚

æ‰€ä»¥åœ¨å‰é›¢ Markdown ç¬¦è™Ÿä¹‹å‰ï¼Œè¦å…ˆæŠŠç¨‹å¼ç¢¼å€å¡Šå…§å®¹"è—èµ·ä¾†"ã€‚

**åŸå§‹ç¢¼å¯¦ä½œ**

```typescript
// ç¬¬ 1 æ­¥ï¼šæå–ä¸¦ä¿è­·è¡Œå…§ç¨‹å¼ç¢¼
const codeBlocks: string[] = []
let textWithPlaceholders = text.replace(/`(.+?)`/g, (match, content) => {
  codeBlocks.push(content)
  return `\x00CODE${codeBlocks.length - 1}\x00`
})
```

**å·¥ä½œåŸç†**

| è¼¸å…¥ | è™•ç†å¾Œ | codeBlocks é™£åˆ— |
|--- | --- | ---|
| `` `**bold**` `` | `\x00CODE0\x00` | `["**bold**"]` |
| `` `a` and `b` `` | `\x00CODE0\x00 and \x00CODE1\x00` | `["a", "b"]` |

ç”¨ `\x00CODE0\x00` é€™ç¨®ç‰¹æ®Šä½”ä½ç¬¦æ›¿æ›ç¨‹å¼ç¢¼å€å¡Šï¼Œå¾Œé¢å‰é›¢ Markdown ç¬¦è™Ÿæ™‚å°±ä¸æœƒèª¤å‚·å®ƒå€‘ã€‚

### ç¬¬ 2 æ­¥ï¼šå‰é›¢ Markdown ç¬¦è™Ÿ

**ç‚ºä»€éº¼**

éš±è—æ¨¡å¼ä¸‹ï¼Œ`**ç²—é«”**` é¡¯ç¤ºç‚º `ç²—é«”`ï¼Œ`*æ–œé«”*` é¡¯ç¤ºç‚º `æ–œé«”`ã€‚è¨ˆç®—å¯¬åº¦æ™‚è¦æŠŠé€™äº›ç¬¦è™Ÿå»æ‰ã€‚

**åŸå§‹ç¢¼å¯¦ä½œ**

```typescript
// ç¬¬ 2 æ­¥ï¼šå‰é›¢éç¨‹å¼ç¢¼éƒ¨åˆ†çš„ Markdown ç¬¦è™Ÿ
let visualText = textWithPlaceholders
let previousText = ""

while (visualText !== previousText) {
  previousText = visualText
  visualText = visualText
    .replace(/\*\*\*(.+?)\*\*\*/g, "$1") // ***ç²—æ–œé«”*** â†’ æ–‡å­—
    .replace(/\*\*(.+?)\*\*/g, "$1")     // **ç²—é«”** â†’ ç²—é«”
    .replace(/\*(.+?)\*/g, "$1")         // *æ–œé«”* â†’ æ–œé«”
    .replace(/~~(.+?)~~/g, "$1")         // ~~åˆªé™¤ç·š~~ â†’ åˆªé™¤ç·š
    .replace(/!\[([^\]]*)\]\(([^)]+)\)/g, "$1")     // ![alt](url) â†’ alt
    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, "$1 ($2)") // [text](url) â†’ text (url)
}
```

**ç‚ºä»€éº¼ç”¨ while è¿´åœˆï¼Ÿ**

è™•ç†å·¢ç‹€èªæ³•ã€‚æ¯”å¦‚ `***ç²—æ–œé«”***`ï¼š

```
ç¬¬ 1 è¼ªï¼š***ç²—æ–œé«”*** â†’ **ç²—æ–œé«”**ï¼ˆå‰é›¢æœ€å¤–å±¤ ***ï¼‰
ç¬¬ 2 è¼ªï¼š**ç²—æ–œé«”** â†’ *ç²—æ–œé«”*ï¼ˆå‰é›¢ **ï¼‰
ç¬¬ 3 è¼ªï¼š*ç²—æ–œé«”* â†’ ç²—æ–œé«”ï¼ˆå‰é›¢ *ï¼‰
ç¬¬ 4 è¼ªï¼šç²—æ–œé«” = ç²—æ–œé«”ï¼ˆç„¡è®ŠåŒ–ï¼Œé€€å‡ºè¿´åœˆï¼‰
```

::: details åœ–ç‰‡å’Œé€£çµçš„è™•ç†
- **åœ–ç‰‡** `![alt](url)`ï¼šOpenCode åªé¡¯ç¤º alt æ–‡å­—ï¼Œæ‰€ä»¥æ›¿æ›ç‚º `alt`
- **é€£çµ** `[text](url)`ï¼šé¡¯ç¤ºç‚º `text (url)`ï¼Œä¿ç•™ URL è³‡è¨Š
:::

### ç¬¬ 3 æ­¥ï¼šæ¢å¾©ç¨‹å¼ç¢¼å€å¡Š + è¨ˆç®—å¯¬åº¦

**ç‚ºä»€éº¼**

ç¨‹å¼ç¢¼å€å¡Šå…§å®¹è¦æ”¾å›å»ï¼Œç„¶å¾Œç”¨ `Bun.stringWidth` è¨ˆç®—æœ€çµ‚çš„é¡¯ç¤ºå¯¬åº¦ã€‚

**åŸå§‹ç¢¼å¯¦ä½œ**

```typescript
// ç¬¬ 3 æ­¥ï¼šæ¢å¾©ç¨‹å¼ç¢¼å€å¡Šå…§å®¹
visualText = visualText.replace(/\x00CODE(\d+)\x00/g, (match, index) => {
  return codeBlocks[parseInt(index)]
})

return Bun.stringWidth(visualText)
```

**ç‚ºä»€éº¼ç”¨ Bun.stringWidthï¼Ÿ**

`Bun.stringWidth` èƒ½æ­£ç¢ºè¨ˆç®—ï¼š

| å­—å…ƒé¡å‹ | ç¯„ä¾‹ | å­—å…ƒæ•¸ | é¡¯ç¤ºå¯¬åº¦ |
|--- | --- | --- | ---|
| ASCII | `abc` | 3 | 3 |
| ä¸­æ–‡ | `ä½ å¥½` | 2 | 4ï¼ˆæ¯å€‹ä½” 2 æ ¼ï¼‰ |
| Emoji | `ğŸ˜€` | 1 | 2ï¼ˆä½” 2 æ ¼ï¼‰ |
| é›¶å¯¬å­—å…ƒ | `a\u200Bb` | 3 | 2ï¼ˆé›¶å¯¬å­—å…ƒä¸ä½”ä½ï¼‰ |

æ™®é€šçš„ `text.length` åªèƒ½æ•¸å­—å…ƒå€‹æ•¸ï¼Œç„¡æ³•è™•ç†é€™äº›ç‰¹æ®Šæƒ…æ³ã€‚

## å®Œæ•´ç¯„ä¾‹

å‡è¨­å„²å­˜æ ¼å…§å®¹æ˜¯ï¼š`` **`code`** and *text* ``

**ç¬¬ 1 æ­¥ï¼šä¿è­·ç¨‹å¼ç¢¼å€å¡Š**

```
è¼¸å…¥ï¼š**`code`** and *text*
è¼¸å‡ºï¼š**\x00CODE0\x00** and *text*
codeBlocks = ["code"]
```

**ç¬¬ 2 æ­¥ï¼šå‰é›¢ Markdown ç¬¦è™Ÿ**

```
ç¬¬ 1 è¼ªï¼š**\x00CODE0\x00** and *text* â†’ \x00CODE0\x00 and text
ç¬¬ 2 è¼ªï¼šç„¡è®ŠåŒ–ï¼Œé€€å‡º
```

**ç¬¬ 3 æ­¥ï¼šæ¢å¾©ç¨‹å¼ç¢¼å€å¡Š + è¨ˆç®—å¯¬åº¦**

```
æ¢å¾©å¾Œï¼šcode and text
å¯¬åº¦ï¼šBun.stringWidth("code and text") = 13
```

æœ€çµ‚ï¼Œå¤–æ›æŒ‰ 13 å­—å…ƒçš„å¯¬åº¦ä¾†å°é½Šé€™å€‹å„²å­˜æ ¼ï¼Œè€Œä¸æ˜¯åŸå§‹ç¢¼çš„ 22 å­—å…ƒã€‚

## æª¢æŸ¥é»

å®Œæˆæœ¬èª²å¾Œï¼Œä½ æ‡‰è©²èƒ½å›ç­”ï¼š

- [ ] éš±è—æ¨¡å¼æœƒéš±è—å“ªäº›ç¬¦è™Ÿï¼Ÿï¼ˆç­”ï¼š`**`ã€`*`ã€`~~` ç­‰ Markdown èªæ³•ç¬¦è™Ÿï¼‰
- [ ] ç‚ºä»€éº¼è¦å…ˆä¿è­·ç¨‹å¼ç¢¼å€å¡Šï¼Ÿï¼ˆç­”ï¼šç¨‹å¼ç¢¼å€å¡Šè£¡çš„ç¬¦è™Ÿæ˜¯å­—é¢é‡ï¼Œä¸æ‡‰è¢«å‰é›¢ï¼‰
- [ ] ç‚ºä»€éº¼ç”¨ while è¿´åœˆå‰é›¢ç¬¦è™Ÿï¼Ÿï¼ˆç­”ï¼šè™•ç†å·¢ç‹€èªæ³•ï¼Œå¦‚ `***ç²—æ–œé«”***`ï¼‰
- [ ] `Bun.stringWidth` æ¯” `text.length` å¥½åœ¨å“ªï¼Ÿï¼ˆç­”ï¼šèƒ½æ­£ç¢ºè¨ˆç®—ä¸­æ–‡ã€Emojiã€é›¶å¯¬å­—å…ƒçš„é¡¯ç¤ºå¯¬åº¦ï¼‰

## è¸©å‘æé†’

::: warning å¸¸è¦‹èª¤è§£
**èª¤è§£**ï¼šç¨‹å¼ç¢¼å€å¡Šè£¡çš„ `**` ä¹Ÿæœƒè¢«å‰é›¢

**äº‹å¯¦**ï¼šä¸æœƒã€‚å¤–æ›æœƒå…ˆç”¨ä½”ä½ç¬¦ä¿è­·ç¨‹å¼ç¢¼å€å¡Šå…§å®¹ï¼Œå‰é›¢å®Œå…¶ä»–éƒ¨åˆ†çš„ç¬¦è™Ÿå¾Œå†æ¢å¾©ã€‚

æ‰€ä»¥ `` `**bold**` `` çš„å¯¬åº¦æ˜¯ 8ï¼ˆ`**bold**`ï¼‰ï¼Œä¸æ˜¯ 4ï¼ˆ`bold`ï¼‰ã€‚
:::

## æœ¬èª²å°çµ

| æ­¥é©Ÿ | ä½œç”¨ | é—œéµç¨‹å¼ç¢¼ |
|--- | --- | ---|
| ä¿è­·ç¨‹å¼ç¢¼å€å¡Š | é˜²æ­¢ç¨‹å¼ç¢¼å€å¡Šå…§çš„ç¬¦è™Ÿè¢«èª¤å‰é›¢ | `text.replace(/\`(.+?)\`/g, ...)` |
| å‰é›¢ Markdown | è¨ˆç®—éš±è—æ¨¡å¼ä¸‹çš„å¯¦éš›é¡¯ç¤ºå…§å®¹ | å¤šè¼ªæ­£å‰‡æ›¿æ› |
| è¨ˆç®—å¯¬åº¦ | è™•ç†ä¸­æ–‡ã€Emoji ç­‰ç‰¹æ®Šå­—å…ƒ | `Bun.stringWidth()` |

## ä¸‹ä¸€èª²é å‘Š

> ä¸‹ä¸€èª²æˆ‘å€‘å­¸ç¿’ **[è¡¨æ ¼è¦ç¯„](../table-spec/)**ã€‚
>
> ä½ æœƒå­¸åˆ°ï¼š
> - ä»€éº¼æ¨£çš„è¡¨æ ¼èƒ½è¢«æ ¼å¼åŒ–
> - è¡¨æ ¼é©—è­‰çš„ 4 æ¢è¦å‰‡
> - å¦‚ä½•é¿å…"ç„¡æ•ˆè¡¨æ ¼"éŒ¯èª¤

---

## é™„éŒ„ï¼šåŸå§‹ç¢¼åƒè€ƒ

<details>
<summary><strong>é»æ“Šå±•é–‹æŸ¥çœ‹åŸå§‹ç¢¼ä½ç½®</strong></summary>

> æ›´æ–°æ™‚é–“ï¼š2026-01-26

| åŠŸèƒ½ | æª”æ¡ˆè·¯å¾‘ | è¡Œè™Ÿ |
|--- | --- | ---|
| é¡¯ç¤ºå¯¬åº¦è¨ˆç®—å…¥å£ | [`index.ts`](https://github.com/franlol/opencode-md-table-formatter/blob/main/index.ts#L151-L159) | 151-159 |
| ç¨‹å¼ç¢¼å€å¡Šä¿è­· | [`index.ts`](https://github.com/franlol/opencode-md-table-formatter/blob/main/index.ts#L168-L173) | 168-173 |
| Markdown ç¬¦è™Ÿå‰é›¢ | [`index.ts`](https://github.com/franlol/opencode-md-table-formatter/blob/main/index.ts#L175-L188) | 175-188 |
| ç¨‹å¼ç¢¼å€å¡Šæ¢å¾© | [`index.ts`](https://github.com/franlol/opencode-md-table-formatter/blob/main/index.ts#L190-L193) | 190-193 |
| Bun.stringWidth å‘¼å« | [`index.ts`](https://github.com/franlol/opencode-md-table-formatter/blob/main/index.ts#L195) | 195 |

**é—œéµå‡½æ•¸**ï¼š
- `calculateDisplayWidth()`ï¼šå¸¶å¿«å–çš„å¯¬åº¦è¨ˆç®—å…¥å£
- `getStringWidth()`ï¼šæ ¸å¿ƒæ¼”ç®—æ³•ï¼Œå‰é›¢ Markdown ç¬¦è™Ÿä¸¦è¨ˆç®—é¡¯ç¤ºå¯¬åº¦

**é—œéµå¸¸æ•¸**ï¼š
- `\x00CODE{n}\x00`ï¼šç¨‹å¼ç¢¼å€å¡Šä½”ä½ç¬¦æ ¼å¼

</details>
