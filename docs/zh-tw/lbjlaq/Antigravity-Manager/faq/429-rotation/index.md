---
title: "429æ’æŸ¥: å¸³è™Ÿè¼ªæ›èˆ‡éŒ¯èª¤è™•ç† | Antigravity-Manager"
sidebarTitle: "429éŒ¯èª¤ï¼šè‡ªå‹•è¼ªæ›å¸³è™Ÿ"
subtitle: "429æ’æŸ¥: å¸³è™Ÿè¼ªæ›èˆ‡éŒ¯èª¤è™•ç†"
description: "å­¸ç¿’ Antigravity Tools çš„ 429 éŒ¯èª¤æ’æŸ¥æ–¹æ³•ã€‚æŒæ¡ QUOTA_EXHAUSTEDã€RATE_LIMIT_EXCEEDED ç­‰éŒ¯èª¤çš„è­˜åˆ¥èˆ‡è™•ç†ï¼Œä½¿ç”¨ Monitor å’Œ X-Account-Email å¿«é€Ÿå®šä½å•é¡Œã€‚"
tags:
  - "FAQ"
  - "éŒ¯èª¤æ’æŸ¥"
  - "å¸³è™Ÿèª¿åº¦"
  - "429éŒ¯èª¤"
prerequisite:
  - "start-getting-started"
  - "advanced-scheduling"
order: 3
---
# 429/å®¹é‡éŒ¯èª¤ï¼šå¸³è™Ÿè¼ªæ›çš„æ­£ç¢ºé æœŸèˆ‡æ¨¡å‹å®¹é‡è€—ç›¡çš„èª¤å€

## å­¸å®Œä½ èƒ½åšä»€éº¼

- æ­£ç¢ºå€åˆ†ã€Œé…é¡ä¸è¶³ã€å’Œã€Œä¸Šæ¸¸é™æµã€ï¼Œé¿å…èª¤åˆ¤
- ç†è§£ Antigravity Tools çš„è‡ªå‹•è¼ªæ›æ©Ÿåˆ¶å’Œé æœŸè¡Œç‚º
- é‡åˆ° 429 éŒ¯èª¤æ™‚ï¼ŒçŸ¥é“å¦‚ä½•å¿«é€Ÿå®šä½å•é¡Œä¸¦å„ªåŒ–è¨­å®š

## ä½ ç¾åœ¨çš„å›°å¢ƒ

- çœ‹åˆ°è¿”å› 429 éŒ¯èª¤ï¼Œèª¤ä»¥ç‚ºæ˜¯ã€Œæ¨¡å‹æ²’å®¹é‡äº†ã€
- é…äº†å¤šå€‹å¸³è™Ÿï¼Œå»é‚„æ˜¯é »ç¹é‡åˆ° 429ï¼Œä¸çŸ¥é“æ˜¯è¨­å®šå•é¡Œé‚„æ˜¯å¸³è™Ÿå•é¡Œ
- ä¸æ¸…æ¥šç³»çµ±ä»€éº¼æ™‚å€™æœƒè‡ªå‹•åˆ‡æ›å¸³è™Ÿï¼Œä»€éº¼æ™‚å€™æœƒã€Œå¡ä½ã€

## æ ¸å¿ƒæ€è·¯

### ä»€éº¼æ˜¯ 429 éŒ¯èª¤ï¼Ÿ

**429 Too Many Requests** æ˜¯ HTTP ç‹€æ…‹ç¢¼ã€‚åœ¨ Antigravity Tools è£¡ï¼Œ429 ä¸åªä»£è¡¨ã€Œè«‹æ±‚å¤ªé »ç¹ã€ï¼Œé‚„å¯èƒ½æ˜¯é…é¡è€—ç›¡ã€æ¨¡å‹æš«æ™‚éè¼‰ç­‰ä¸€é¡ã€Œä½ æš«æ™‚ç”¨ä¸äº†ã€çš„è¨Šè™Ÿã€‚

::: info ä»£ç†æœƒå˜—è©¦è­˜åˆ¥ 429 çš„åŸå› 

ä»£ç†æœƒå¾éŸ¿æ‡‰é«”è£¡å˜—è©¦è§£æ `error.details[0].reason` æˆ– `error.message`ï¼ŒæŠŠ 429 ç²—åˆ†ç‚ºå¹¾é¡ï¼ˆå¯¦éš›ä»¥è¿”å›ç‚ºæº–ï¼‰ï¼š

| ä»£ç†è­˜åˆ¥çš„é¡å‹ | å¸¸è¦‹ reason / ç·šç´¢ | å…¸å‹ç‰¹å¾µ |
|--- | --- | ---|
| **é…é¡è€—ç›¡** | `QUOTA_EXHAUSTED` / æ–‡å­—åŒ…å« `exhausted`ã€`quota` | å¯èƒ½éœ€è¦ç­‰åˆ°é…é¡åˆ·æ–° |
| **é€Ÿç‡é™åˆ¶** | `RATE_LIMIT_EXCEEDED` / æ–‡å­—åŒ…å« `per minute`ã€`rate limit`ã€`too many requests` | é€šå¸¸æ˜¯å¹¾åç§’ç­‰ç´šçš„å†·å» |
| **æ¨¡å‹å®¹é‡ä¸è¶³** | `MODEL_CAPACITY_EXHAUSTED` / æ–‡å­—åŒ…å« `model_capacity` | å¸¸è¦‹æ˜¯çŸ­æš«éè¼‰ï¼Œç¨å¾Œå¯æ¢å¾© |
| **æœªçŸ¥** | ç„¡æ³•è§£æ | èµ°é è¨­å†·å»ç­–ç•¥ |

:::

### Antigravity Tools çš„è‡ªå‹•è™•ç†

ç•¶ä¸€æ¬¡è«‹æ±‚é‡åˆ° 429ï¼ˆä»¥åŠéƒ¨åˆ† 5xx/éè¼‰ç‹€æ…‹ï¼‰æ™‚ï¼Œä»£ç†é€šå¸¸æœƒåœ¨ä¼ºæœå™¨ç«¯åšå…©ä»¶äº‹ï¼š

1. **è¨˜éŒ„å†·å»æ™‚é–“**ï¼šæŠŠé€™æ¬¡éŒ¯èª¤å¯«å…¥ `RateLimitTracker`ï¼Œå¾ŒçºŒé¸å¸³è™Ÿæ™‚æœƒä¸»å‹•é¿é–‹ã€Œä»åœ¨å†·å»ã€çš„å¸³è™Ÿã€‚
2. **åœ¨é‡è©¦è£¡è¼ªæ›å¸³è™Ÿ**ï¼šHandlers æœƒåœ¨å–®æ¬¡è«‹æ±‚å…§é€²è¡Œå¤šæ¬¡å˜—è©¦ï¼Œé‡è©¦æ™‚æœƒ `force_rotate=true`ï¼Œå¾è€Œè§¸ç™¼ TokenManager é¸æ“‡ä¸‹ä¸€å€‹å¯ç”¨å¸³è™Ÿã€‚

::: tip ä½ æ€éº¼çŸ¥é“å®ƒæœ‰æ²’æœ‰æ›è™Ÿï¼Ÿ
å³ä½¿ä½ çš„è«‹æ±‚ body ä¸è®Šï¼ŒéŸ¿æ‡‰è£¡é€šå¸¸æœƒå¸¶ `X-Account-Email`ï¼ˆä»¥åŠ `X-Mapped-Model`ï¼‰ï¼Œä½ å¯ä»¥ç”¨å®ƒé©—è­‰ã€Œé€™æ¬¡è«‹æ±‚åˆ°åº•ç”¨çš„æ˜¯å“ªå€‹å¸³è™Ÿã€ã€‚
:::

## ä»€éº¼æ™‚å€™æœƒé‡åˆ° 429 éŒ¯èª¤ï¼Ÿ

### å ´æ™¯ 1ï¼šå–®å€‹å¸³è™Ÿè«‹æ±‚éå¿«

**ç¾è±¡**ï¼šå³ä½¿åªæœ‰ä¸€å€‹å¸³è™Ÿï¼ŒçŸ­æ™‚é–“å…§ç™¼é€å¤§é‡è«‹æ±‚ä¹Ÿæœƒè§¸ç™¼ 429ã€‚

**åŸå› **ï¼šæ¯å€‹å¸³è™Ÿéƒ½æœ‰è‡ªå·±çš„é€Ÿç‡é™åˆ¶ï¼ˆRPM/TPMï¼‰ï¼Œè¶…éå°±æœƒé™æµã€‚

**è§£æ±º**ï¼š
- å¢åŠ å¸³è™Ÿæ•¸é‡
- é™ä½è«‹æ±‚é »ç‡
- ä½¿ç”¨å›ºå®šå¸³è™Ÿæ¨¡å¼åˆ†æ•£å£“åŠ›ï¼ˆè©³è¦‹ã€Œå›ºå®šå¸³è™Ÿæ¨¡å¼ã€ï¼‰

### å ´æ™¯ 2ï¼šæ‰€æœ‰å¸³è™ŸåŒæ™‚é™æµ

**ç¾è±¡**ï¼šæœ‰å¤šå€‹å¸³è™Ÿï¼Œä½†æ‰€æœ‰å¸³è™Ÿéƒ½è¿”å› 429ã€‚

**åŸå› **ï¼š
- å¸³è™Ÿç¸½æ•¸ä¸è¶³ä»¥æ”¯æ’ä½ çš„è«‹æ±‚é »ç‡
- æ‰€æœ‰å¸³è™Ÿå¹¾ä¹åŒæ™‚è§¸ç™¼é™æµ/éè¼‰

**è§£æ±º**ï¼š
- å¢åŠ æ›´å¤šå¸³è™Ÿ
- èª¿æ•´èª¿åº¦æ¨¡å¼ç‚ºã€Œæ•ˆèƒ½å„ªå…ˆã€ï¼ˆè·³éé»æ€§æœƒè©±èˆ‡ 60s è¦–çª—è¤‡ç”¨ï¼‰
- æª¢æŸ¥é…é¡ä¿è­·æ˜¯å¦èª¤å°‡å¯ç”¨å¸³è™Ÿæ’é™¤

### å ´æ™¯ 3ï¼šå¸³è™Ÿè¢«é…é¡ä¿è­·èª¤åˆ¤

**ç¾è±¡**ï¼šæŸå€‹å¸³è™Ÿçš„é…é¡å¾ˆå……è¶³ï¼Œä½†ç³»çµ±ä¸€ç›´è·³éå®ƒã€‚

**åŸå› **ï¼š
- é–‹å•Ÿäº†**é…é¡ä¿è­·**ï¼Œé–¾å€¼è¨­å®šåé«˜
- è©²å¸³è™Ÿçš„ç‰¹å®šæ¨¡å‹é…é¡ä½æ–¼é–¾å€¼
- å¸³è™Ÿè¢«æ‰‹å‹•æ¨™è¨˜ç‚º `proxy_disabled`

**è§£æ±º**ï¼š
- æª¢æŸ¥é…é¡ä¿è­·è¨­å®šï¼ˆSettings â†’ Quota Protectionï¼‰ï¼ŒæŒ‰ä½ çš„ä½¿ç”¨å¼·åº¦èª¿æ•´é–¾å€¼èˆ‡ç›£æ§æ¨¡å‹
- åœ¨å¸³è™Ÿè³‡æ–™ä¸­æª¢æŸ¥ `protected_models`ï¼Œç¢ºèªæ˜¯ä¸æ˜¯è¢«ä¿è­·ç­–ç•¥è·³é

## è·Ÿæˆ‘åš

### ç¬¬ 1 æ­¥ï¼šè­˜åˆ¥ 429 éŒ¯èª¤é¡å‹

**ç‚ºä»€éº¼**ï¼šä¸åŒé¡å‹çš„ 429 éŒ¯èª¤éœ€è¦ä¸åŒçš„è™•ç†æ–¹å¼ã€‚

åœ¨ Proxy Monitor ä¸­æŸ¥çœ‹ 429 éŒ¯èª¤çš„éŸ¿æ‡‰é«”ï¼Œé‡é»çœ‹å…©é¡è³‡è¨Šï¼š

- **åŸå› **ï¼š`error.details[0].reason`ï¼ˆä¾‹å¦‚ `RATE_LIMIT_EXCEEDED`ã€`QUOTA_EXHAUSTED`ï¼‰æˆ– `error.message`
- **ç­‰å¾…æ™‚é–“**ï¼š`RetryInfo.retryDelay` æˆ– `details[0].metadata.quotaResetDelay`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

```json
{
  "error": {
    "details": [
      {
        "reason": "RATE_LIMIT_EXCEEDED",
        "metadata": {
          "quotaResetDelay": "42s"
        }
      }
    ]
  }
}
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼š
- å¦‚æœéŸ¿æ‡‰é«”è£¡èƒ½æ‰¾åˆ°ç­‰å¾…æ™‚é–“ï¼ˆä¾‹å¦‚ `RetryInfo.retryDelay` æˆ– `quotaResetDelay`ï¼‰ï¼Œä»£ç†é€šå¸¸æœƒå…ˆç­‰å¾…ä¸€å°æ®µæ™‚é–“å†é‡è©¦ã€‚
- å¦‚æœæ²’æœ‰ç­‰å¾…æ™‚é–“ï¼Œä»£ç†æœƒæŒ‰å…§å»ºç­–ç•¥çµ¦é€™å€‹å¸³è™ŸåŠ ä¸€å€‹ã€Œå†·å»æœŸã€ï¼Œä¸¦åœ¨é‡è©¦è£¡ç›´æ¥æ›ä¸‹ä¸€å€‹å¸³è™Ÿã€‚

### ç¬¬ 2 æ­¥ï¼šæª¢æŸ¥å¸³è™Ÿèª¿åº¦è¨­å®š

**ç‚ºä»€éº¼**ï¼šèª¿åº¦è¨­å®šç›´æ¥å½±éŸ¿å¸³è™Ÿè¼ªæ›é »ç‡å’Œå„ªå…ˆç´šã€‚

é€²å…¥ **API Proxy** é é¢ï¼ŒæŸ¥çœ‹èª¿åº¦ç­–ç•¥ï¼š

| è¨­å®šé … | èªªæ˜ | é è¨­å€¼/å»ºè­° |
|--- | --- | ---|
| **Scheduling Mode** | èª¿åº¦æ¨¡å¼ | `Balance`ï¼ˆé è¨­ï¼‰ |
| **Preferred Account** | å›ºå®šå¸³è™Ÿæ¨¡å¼ | æœªé¸å–ï¼ˆé è¨­ï¼‰ |

**èª¿åº¦æ¨¡å¼å°æ¯”**ï¼š

| æ¨¡å¼ | å¸³è™Ÿè¤‡ç”¨ç­–ç•¥ | é™æµè™•ç† | é©ç”¨å ´æ™¯ |
|--- | --- | --- | ---|
| **CacheFirst** | å•Ÿç”¨é»æ€§æœƒè©±èˆ‡ 60s è¦–çª—è¤‡ç”¨ | **å„ªå…ˆç­‰å¾…**ï¼Œæ¥µå¤§æå‡ Prompt Caching å‘½ä¸­ç‡ | å°è©±é¡/éœ€è¦é«˜å¿«å–å‘½ä¸­ç‡ |
| **Balance** | å•Ÿç”¨é»æ€§æœƒè©±èˆ‡ 60s è¦–çª—è¤‡ç”¨ | **ç«‹å³åˆ‡æ›**åˆ°å‚™é¸å¸³è™Ÿï¼Œå…¼é¡§æˆåŠŸç‡å’Œæ•ˆèƒ½ | é€šç”¨å ´æ™¯ï¼Œé è¨­ |
| **PerformanceFirst** | è·³éé»æ€§æœƒè©±èˆ‡ 60s è¦–çª—è¤‡ç”¨ï¼Œç´”è¼ªè©¢æ¨¡å¼ | ç«‹å³åˆ‡æ›ï¼Œå¸³è™Ÿè² è¼‰æœ€å‡è¡¡ | é«˜ä½µç™¼ã€ç„¡ç‹€æ…‹è«‹æ±‚ |

::: tip å¿«å–å„ªå…ˆ vs å¹³è¡¡æ¨¡å¼
å¦‚æœä½ ä½¿ç”¨ Prompt Caching ä¸”å¸Œæœ›æå‡å¿«å–å‘½ä¸­ç‡ï¼Œé¸æ“‡ `CacheFirst` â€”â€” é™æµæ™‚å®ƒæœƒå„ªå…ˆç­‰å¾…è€Œä¸æ˜¯ç«‹å³æ›è™Ÿã€‚å¦‚æœä½ æ›´çœ‹é‡è«‹æ±‚æˆåŠŸç‡è€Œä¸æ˜¯å¿«å–ï¼Œé¸æ“‡ `Balance` â€”â€” é™æµæ™‚å®ƒæœƒç«‹å³æ›è™Ÿã€‚
:::

::: tip æ•ˆèƒ½å„ªå…ˆæ¨¡å¼
å¦‚æœä½ çš„è«‹æ±‚æ˜¯ç„¡ç‹€æ…‹çš„ï¼ˆå¦‚åœ–ç‰‡ç”Ÿæˆã€ç¨ç«‹æŸ¥è©¢ï¼‰ï¼Œå¯ä»¥è©¦è©¦ `PerformanceFirst`ã€‚å®ƒæœƒè·³éé»æ€§æœƒè©±èˆ‡ 60s è¦–çª—è¤‡ç”¨ï¼Œè®“é€£çºŒè«‹æ±‚æ›´å®¹æ˜“è½åˆ°ä¸åŒå¸³è™Ÿã€‚
:::

### ç¬¬ 3 æ­¥ï¼šé©—è­‰å¸³è™Ÿè¼ªæ›æ˜¯å¦æ­£å¸¸å·¥ä½œ

**ç‚ºä»€éº¼**ï¼šç¢ºèªç³»çµ±èƒ½å¤ è‡ªå‹•åˆ‡æ›å¸³è™Ÿã€‚

**æ–¹æ³• 1ï¼šçœ‹éŸ¿æ‡‰ Header**

ç”¨ curl æˆ–ä½ è‡ªå·±çš„å®¢æˆ¶ç«¯æŠŠéŸ¿æ‡‰é ­å°å‡ºä¾†ï¼Œè§€å¯Ÿ `X-Account-Email` æ˜¯å¦æœƒè®ŠåŒ–ã€‚

**æ–¹æ³• 2ï¼šæŸ¥çœ‹æ—¥èªŒ**

æ‰“é–‹æ—¥èªŒæª”æ¡ˆï¼ˆæ ¹æ“šä½ çš„ç³»çµ±ä½ç½®ï¼‰ï¼Œæœå°‹ `ğŸ”„ [Token Rotation]`ï¼š

```
ğŸ”„ [Token Rotation] Accounts: [
  "account1@example.com(protected=[])",
  "account2@example.com(protected=[])",
  "account3@example.com(protected=[])"
]
```

**æ–¹æ³• 3ï¼šä½¿ç”¨ Proxy Monitor**

åœ¨ **Monitor** é é¢æŸ¥çœ‹è«‹æ±‚æ—¥èªŒï¼Œé—œæ³¨ï¼š
- **Account** æ¬„ä½æ˜¯å¦åœ¨ä¸åŒå¸³è™Ÿé–“åˆ‡æ›
- **Status** ç‚º 429 çš„è«‹æ±‚å¾Œï¼Œæ˜¯å¦æœ‰æˆåŠŸçš„è«‹æ±‚ä½¿ç”¨äº†ä¸åŒå¸³è™Ÿ

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼š
- ç•¶æŸå€‹å¸³è™Ÿè¿”å› 429 å¾Œï¼Œå¾ŒçºŒè«‹æ±‚è‡ªå‹•åˆ‡æ›åˆ°å…¶ä»–å¸³è™Ÿ
- å¦‚æœçœ‹åˆ°å¤šå€‹è«‹æ±‚ä½¿ç”¨åŒä¸€å¸³è™Ÿä¸”éƒ½å¤±æ•—ï¼Œå¯èƒ½æ˜¯èª¿åº¦è¨­å®šå•é¡Œ

### ç¬¬ 4 æ­¥ï¼šå„ªåŒ–å¸³è™Ÿå„ªå…ˆç´š

**ç‚ºä»€éº¼**ï¼šè®“ç³»çµ±å„ªå…ˆä½¿ç”¨é«˜é…é¡/é«˜ç­‰ç´šå¸³è™Ÿï¼Œæ¸›å°‘ 429 æ©Ÿç‡ã€‚

åœ¨ TokenManager è£¡ï¼Œç³»çµ±æœƒåœ¨é¸æ“‡å¸³è™Ÿå‰å°å¸³è™Ÿæ± åšä¸€æ¬¡æ’åºï¼ˆæœƒåˆ—å° `ğŸ”„ [Token Rotation] Accounts: ...`ï¼‰ï¼š

1. **è¨‚é–±ç­‰ç´šå„ªå…ˆ**ï¼šULTRA > PRO > FREE
2. **é…é¡ç™¾åˆ†æ¯”å„ªå…ˆ**ï¼šåŒç­‰ç´šå…§ï¼Œé…é¡é«˜çš„åœ¨å‰
3. **æ’åºå…¥å£**ï¼šé€™å€‹æ’åºç™¼ç”Ÿåœ¨ä»£ç†å´ï¼Œæœ€çµ‚ç”¨å“ªå€‹å¸³è™Ÿä»¥ä»£ç†å´æ’åº+å¯ç”¨æ€§åˆ¤æ–·ç‚ºæº–ã€‚

::: info æ™ºæ…§æ’åºåŸç†ï¼ˆä»£ç†å´ï¼‰
å„ªå…ˆç´šæ˜¯ `ULTRA > PRO > FREE`ï¼›åŒä¸€è¨‚é–±ç­‰ç´šå…§æŒ‰ `remaining_quota`ï¼ˆå¸³è™Ÿæœ€å¤§å‰©é¤˜é…é¡ç™¾åˆ†æ¯”ï¼‰é™åºã€‚
:::

**æ“ä½œ**ï¼š
- æ‹–æ›³å¸³è™Ÿèª¿æ•´é¡¯ç¤ºé †åºï¼ˆå¯é¸ï¼‰
- åˆ·æ–°é…é¡ï¼ˆAccounts â†’ åˆ·æ–°æ‰€æœ‰é…é¡ï¼‰
- æª¢æŸ¥å¸³è™Ÿçš„è¨‚é–±ç­‰ç´šå’Œé…é¡

## è¸©å‘æé†’

### âŒ éŒ¯èª¤ 1ï¼šèª¤å°‡ 429 ç•¶æˆã€Œæ¨¡å‹æ²’å®¹é‡ã€

**ç¾è±¡**ï¼šçœ‹åˆ° 429 éŒ¯èª¤å°±ä»¥ç‚ºæ¨¡å‹æ²’å®¹é‡äº†ã€‚

**æ­£ç¢ºç†è§£**ï¼š
- 429 æ˜¯**é™æµ**ï¼Œä¸æ˜¯å®¹é‡å•é¡Œ
- å¢åŠ å¸³è™Ÿå¯ä»¥é™ä½ 429 æ©Ÿç‡
- èª¿æ•´èª¿åº¦æ¨¡å¼å¯ä»¥æå‡åˆ‡æ›é€Ÿåº¦

### âŒ éŒ¯èª¤ 2ï¼šé…é¡ä¿è­·é–¾å€¼è¨­å®šéé«˜

**ç¾è±¡**ï¼šé…é¡å……è¶³ä½†ç³»çµ±ä¸€ç›´è·³éå¸³è™Ÿã€‚

**åŸå› **ï¼šQuota Protection æœƒæŠŠä½æ–¼é–¾å€¼çš„æ¨¡å‹åŠ å…¥å¸³è™Ÿçš„ `protected_models`ï¼Œä»£ç†åœ¨èª¿åº¦æ™‚æœƒè·³éã€Œè¢«ä¿è­·çš„æ¨¡å‹ã€ã€‚é–¾å€¼éé«˜æ™‚ï¼Œå¯èƒ½å°è‡´å¯ç”¨å¸³è™Ÿè¢«éåº¦æ’é™¤ã€‚

**ä¿®æ­£**ï¼š
- å›åˆ° **Settings â†’ Quota Protection**ï¼Œèª¿æ•´ç›£æ§æ¨¡å‹èˆ‡é–¾å€¼
- å¦‚æœä½ æƒ³ææ¸…æ¥šå®ƒåˆ°åº•ä¿è­·äº†å“ªäº›æ¨¡å‹ï¼Œå»å¸³è™Ÿè³‡æ–™è£¡çœ‹ `protected_models`

### âŒ éŒ¯èª¤ 3ï¼šå›ºå®šå¸³è™Ÿæ¨¡å¼å°è‡´ç„¡æ³•è¼ªæ›

**ç¾è±¡**ï¼šè¨­å®šäº† `Preferred Account`ï¼Œä½†è©²å¸³è™Ÿé™æµå¾Œç³»çµ±ã€Œå¡ä½ã€ã€‚

**åŸå› **ï¼šå›ºå®šå¸³è™Ÿæ¨¡å¼ä¸‹ï¼Œç³»çµ±å„ªå…ˆä½¿ç”¨æŒ‡å®šå¸³è™Ÿï¼Œåªæœ‰åœ¨å¸³è™Ÿä¸å¯ç”¨æ™‚æ‰é™ç´šåˆ°è¼ªè©¢ã€‚

**ä¿®æ­£**ï¼š
- å¦‚æœä¸éœ€è¦å›ºå®šå¸³è™Ÿï¼Œæ¸…ç©º `Preferred Account`
- æˆ–ç¢ºä¿å›ºå®šå¸³è™Ÿçš„é…é¡å……è¶³ï¼Œé¿å…é™æµ

## æª¢æŸ¥é» âœ…

- [ ] èƒ½å€åˆ†é…é¡ä¸è¶³å’Œä¸Šæ¸¸é™æµ
- [ ] çŸ¥é“å¦‚ä½•åœ¨ Proxy Monitor ä¸­æŸ¥çœ‹ 429 éŒ¯èª¤è©³æƒ…
- [ ] ç†è§£ä¸‰ç¨®èª¿åº¦æ¨¡å¼çš„å€åˆ¥å’Œä½¿ç”¨å ´æ™¯
- [ ] çŸ¥é“å¦‚ä½•æª¢æŸ¥å¸³è™Ÿè¼ªæ›æ˜¯å¦æ­£å¸¸å·¥ä½œ
- [ ] èƒ½å„ªåŒ–å¸³è™Ÿå„ªå…ˆç´šä¸¦æª¢æŸ¥é…é¡ä¿è­·ç­–ç•¥

## å¸¸è¦‹å•é¡Œ

### Q1ï¼šç‚ºä»€éº¼æˆ‘æœ‰å¤šå€‹å¸³è™Ÿï¼Œé‚„æ˜¯æœƒé‡åˆ° 429ï¼Ÿ

Aï¼šå¯èƒ½çš„åŸå› ï¼š
1. æ‰€æœ‰å¸³è™ŸåŒæ™‚è§¸ç™¼é™æµï¼ˆè«‹æ±‚é »ç‡éé«˜ï¼‰
2. é€£çºŒè«‹æ±‚åœ¨ã€Œ60s è¦–çª—è¤‡ç”¨ã€ä¸‹ååè¦†è¤‡ç”¨åŒä¸€å¸³è™Ÿï¼Œæ›´å®¹æ˜“æŠŠå–®å¸³è™Ÿæ‰“åˆ°é™æµ
3. é…é¡ä¿è­·èª¤å°‡å¯ç”¨å¸³è™Ÿæ’é™¤
4. å¸³è™Ÿç¸½æ•¸ä¸è¶³ä»¥æ”¯æ’ä½ çš„è«‹æ±‚é »ç‡

**è§£æ±º**ï¼š
- å¢åŠ æ›´å¤šå¸³è™Ÿ
- ä½¿ç”¨ `PerformanceFirst` æ¨¡å¼
- æª¢æŸ¥ Quota Protection æ˜¯å¦æŠŠä½ è¦ç”¨çš„æ¨¡å‹åŠ å…¥äº† `protected_models`ï¼ˆå¿…è¦æ™‚èª¿æ•´ç›£æ§æ¨¡å‹èˆ‡é–¾å€¼ï¼‰
- é™ä½è«‹æ±‚é »ç‡

### Q2ï¼š429 éŒ¯èª¤æœƒè‡ªå‹•é‡è©¦å—ï¼Ÿ

Aï¼šæœƒåœ¨å–®æ¬¡è«‹æ±‚å…§è‡ªå‹•é‡è©¦ã€‚**é‡è©¦æ¬¡æ•¸ä¸Šé™é€šå¸¸æ˜¯ 3 æ¬¡**ï¼Œå…·é«”è¨ˆç®—æ–¹å¼ç‚º `min(3, å¸³è™Ÿæ± å¤§å°)`ï¼Œä¸”è‡³å°‘å˜—è©¦ 1 æ¬¡ã€‚

**é‡è©¦æ¬¡æ•¸ç¯„ä¾‹**ï¼š
- å¸³è™Ÿæ±  1 å€‹å¸³è™Ÿ â†’ å˜—è©¦ 1 æ¬¡ï¼ˆä¸é‡è©¦ï¼‰
- å¸³è™Ÿæ±  2 å€‹å¸³è™Ÿ â†’ å˜—è©¦ 2 æ¬¡ï¼ˆé‡è©¦ 1 æ¬¡ï¼‰
- å¸³è™Ÿæ±  3 å€‹æˆ–æ›´å¤šå¸³è™Ÿ â†’ å˜—è©¦ 3 æ¬¡ï¼ˆé‡è©¦ 2 æ¬¡ï¼‰

**å¤§è‡´æµç¨‹**ï¼š
1. è¨˜éŒ„é™æµ/éè¼‰è³‡è¨Šï¼ˆé€²å…¥ `RateLimitTracker`ï¼‰
2. å¦‚æœèƒ½è§£æåˆ°ç­‰å¾…æ™‚é–“ï¼ˆä¾‹å¦‚ `RetryInfo.retryDelay` / `quotaResetDelay`ï¼‰ï¼Œæœƒå…ˆç­‰å¾…ä¸€å°æ®µæ™‚é–“å†ç¹¼çºŒ
3. é‡è©¦æ™‚å¼·åˆ¶è¼ªæ›å¸³è™Ÿï¼ˆ`attempt > 0` æ™‚ `force_rotate=true`ï¼‰ï¼Œå˜—è©¦ç”¨ä¸‹ä¸€å€‹å¯ç”¨å¸³è™Ÿç™¼èµ·ä¸Šæ¸¸è«‹æ±‚

å¦‚æœæ‰€æœ‰å˜—è©¦éƒ½å¤±æ•—ï¼Œä»£ç†æœƒæŠŠéŒ¯èª¤è¿”å›çµ¦å®¢æˆ¶ç«¯ï¼›åŒæ™‚ä½ ä»ç„¶å¯ä»¥å¾éŸ¿æ‡‰é ­ï¼ˆå¦‚ `X-Account-Email`ï¼‰æˆ– Proxy Monitor çœ‹åˆ°å¯¦éš›ä½¿ç”¨éçš„å¸³è™Ÿã€‚

### Q3ï¼šå¦‚ä½•æŸ¥çœ‹æŸå€‹å¸³è™Ÿè¢«é™æµäº†å¤šä¹…ï¼Ÿ

Aï¼šæœ‰å…©ç¨®æ–¹å¼ï¼š

**æ–¹å¼ 1**ï¼šæŸ¥çœ‹æ—¥èªŒï¼Œæœå°‹ `rate-limited`

```
ğŸ”’ [FIX #820] Preferred account xxx@gmail.com is rate-limited, falling back to round-robin
```

**æ–¹å¼ 2**ï¼šæ—¥èªŒä¸­æœƒé¡¯ç¤ºå‰©é¤˜ç­‰å¾…æ™‚é–“

```
All accounts are currently limited. Please wait 30s.
```

### Q4ï¼šé…é¡ä¿è­·å’Œé™æµæ˜¯ä¸€å›äº‹å—ï¼Ÿ

Aï¼šä¸æ˜¯ã€‚

| ç‰¹æ€§ | é…é¡ä¿è­· | é™æµè¿½è¹¤ |
|--- | --- | ---|
| **è§¸ç™¼æ¢ä»¶** | æ¨¡å‹é…é¡ä½æ–¼é–¾å€¼ | æ”¶åˆ° 429 éŒ¯èª¤ |
| **ä½œç”¨ç¯„åœ** | ç‰¹å®šæ¨¡å‹ | æ•´å€‹å¸³è™Ÿ |
| **æŒçºŒæ™‚é–“** | ç›´åˆ°é…é¡æ¢å¾© | ç”±ä¸Šæ¸¸æ±ºå®šï¼ˆé€šå¸¸å¹¾ç§’åˆ°å¹¾åˆ†é˜ï¼‰ |
| **è¡Œç‚º** | è·³éè©²æ¨¡å‹ | è·³éè©²å¸³è™Ÿ |

### Q5ï¼šå¦‚ä½•å¼·åˆ¶ç«‹å³åˆ‡æ›å¸³è™Ÿï¼Ÿ

Aï¼šå¯ä»¥å¾ã€Œè®“ä¸‹ä¸€æ¬¡è«‹æ±‚æ›´å®¹æ˜“æ›è™Ÿã€çš„è§’åº¦å…¥æ‰‹ï¼š

1. **èª¿åº¦å±¤é¢**ï¼šåˆ‡åˆ° `PerformanceFirst`ï¼Œè·³éé»æ€§æœƒè©±èˆ‡ 60s è¦–çª—è¤‡ç”¨
2. **å›ºå®šå¸³è™Ÿ**ï¼šå¦‚æœå•Ÿç”¨äº† `Preferred Account`ï¼Œå…ˆæ¸…ç©ºå®ƒï¼Œå¦å‰‡æœƒå„ªå…ˆç”¨å›ºå®šå¸³è™Ÿï¼ˆç›´åˆ°å®ƒé™æµ/è¢«ä¿è­·ï¼‰
3. **å¸³è™Ÿæ± **ï¼šå¢åŠ å¸³è™Ÿæ•¸é‡ï¼Œå–®å¸³è™Ÿè¢«é™æµæ™‚æ›´å®¹æ˜“æ‰¾åˆ°æ›¿ä»£å¸³è™Ÿ

å–®æ¬¡è«‹æ±‚è£¡ï¼Œä»£ç†æœ¬èº«ä¹Ÿæœƒåœ¨é‡è©¦æ™‚å¼·åˆ¶è¼ªæ›ï¼ˆ`attempt > 0` æœƒè§¸ç™¼ `force_rotate=true`ï¼‰ï¼Œä½†é‡è©¦æ¬¡æ•¸å—ä¸Šé™æ§åˆ¶ã€‚

## æœ¬èª²å°çµ

- 429 åœ¨ Antigravity Tools è£¡æ˜¯ä¸€é¡ã€Œä¸Šæ¸¸æš«æ™‚ä¸å¯ç”¨ã€çš„è¨Šè™Ÿï¼Œå¯èƒ½æ˜¯é€Ÿç‡é™åˆ¶ã€é…é¡è€—ç›¡ã€æ¨¡å‹å®¹é‡ä¸è¶³ç­‰åŸå› 
- ä»£ç†æœƒè¨˜éŒ„å†·å»æ™‚é–“ï¼Œä¸¦åœ¨å–®æ¬¡è«‹æ±‚çš„é‡è©¦è£¡å˜—è©¦è¼ªæ›å¸³è™Ÿï¼ˆä½†é‡è©¦æ¬¡æ•¸æœ‰é™ï¼‰
- èª¿åº¦æ¨¡å¼ã€Quota Protectionã€å¸³è™Ÿæ•¸é‡éƒ½æœƒå½±éŸ¿ä½ é‡åˆ° 429 çš„æ©Ÿç‡èˆ‡æ¢å¾©é€Ÿåº¦
- ç”¨ Proxy Monitorã€éŸ¿æ‡‰é ­ `X-Account-Email` å’Œæ—¥èªŒå¯ä»¥å¿«é€Ÿå®šä½å•é¡Œ

## ä¸‹ä¸€èª²é å‘Š

> ä¸‹ä¸€èª²æˆ‘å€‘å­¸ç¿’ **[404/è·¯å¾‘ä¸ç›¸å®¹ï¼šBase URLã€/v1 å‰ç¶´èˆ‡ã€Œç–Šè·¯å¾‘ã€å®¢æˆ¶ç«¯](../404-base-url/)**ã€‚
>
> ä½ æœƒå­¸åˆ°ï¼š
> - æœ€å¸¸è¦‹çš„æ¥å…¥éŒ¯èª¤ï¼ˆ404ï¼‰æ˜¯å¦‚ä½•ç”¢ç”Ÿçš„
> - ä¸åŒå®¢æˆ¶ç«¯å° base_url çš„æ‹¼æ¥å·®ç•°
> - å¦‚ä½•å¿«é€Ÿä¿®å¾© 404 å•é¡Œ

---

## é™„éŒ„ï¼šåŸå§‹ç¢¼åƒè€ƒ

<details>
<summary><strong>é»æ“Šå±•é–‹æŸ¥çœ‹åŸå§‹ç¢¼ä½ç½®</strong></summary>

> æ›´æ–°æ™‚é–“ï¼š2026-01-23

| åŠŸèƒ½ | æª”æ¡ˆè·¯å¾‘ | è¡Œè™Ÿ |
|--- | --- | ---|
| 429 é‡è©¦å»¶é²è§£æï¼ˆRetryInfo / quotaResetDelayï¼‰ | [`src-tauri/src/proxy/upstream/retry.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/upstream/retry.rs#L38-L67) | 38-67 |
| Duration è§£æå·¥å…· | [`src-tauri/src/proxy/upstream/retry.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/upstream/retry.rs#L11-L35) | 11-35 |
| èª¿åº¦æ¨¡å¼åˆ—èˆ‰ï¼ˆCacheFirst/Balance/PerformanceFirstï¼‰ | [`src-tauri/src/proxy/sticky_config.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/sticky_config.rs#L3-L12) | 3-12 |
| é™æµåŸå› è§£æèˆ‡é è¨­å†·å»ç­–ç•¥ | [`src-tauri/src/proxy/rate_limit.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/rate_limit.rs#L5-L258) | 5-258 |
| MAX_RETRY_ATTEMPTS å¸¸æ•¸å®šç¾©ï¼ˆOpenAI handlerï¼‰ | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L14) | 14 |
| é‡è©¦æ¬¡æ•¸è¨ˆç®—ï¼ˆmax_attempts = min(MAX_RETRY_ATTEMPTS, pool_size)ï¼‰ | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L830) | 830 |
| OpenAI handlerï¼š429/5xx æ™‚æ¨™è¨˜é™æµä¸¦é‡è©¦/è¼ªæ› | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L349-L389) | 349-389 |
| å¸³è™Ÿæ’åºå„ªå…ˆç´šï¼ˆULTRA > PRO > FREE + remaining_quotaï¼‰ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L504-L538) | 504-538 |
| 60s è¦–çª—è¤‡ç”¨ + é¿é–‹é™æµ/é…é¡ä¿è­· | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L624-L739) | 624-739 |
| é™æµè¨˜éŒ„å…¥å£ï¼ˆmark_rate_limitedï¼‰ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L1089-L1113) | 1089-1113 |
| 429 ç²¾ç¢ºé–å®š/å³æ™‚é…é¡åˆ·æ–°/é™ç´šç­–ç•¥ï¼ˆmark_rate_limited_asyncï¼‰ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L1258-L1417) | 1258-1417 |

**é—œéµå¸¸æ•¸**ï¼š
- `MAX_RETRY_ATTEMPTS = 3`ï¼šå–®æ¬¡è«‹æ±‚å…§æœ€å¤§é‡è©¦æ¬¡æ•¸ï¼ˆOpenAI/Gemini handlerï¼‰
- `60`ï¼š60 ç§’è¦–çª—è¤‡ç”¨ï¼ˆåƒ…åœ¨ `PerformanceFirst` ä¹‹å¤–çš„æ¨¡å¼å•Ÿç”¨ï¼‰
- `5`ï¼šToken ç²å–é€¾æ™‚æ™‚é–“ï¼ˆç§’ï¼‰
- `300`ï¼šToken æå‰åˆ·æ–°é–¾å€¼ï¼ˆç§’ï¼Œ5 åˆ†é˜ï¼‰

**é—œéµå‡½æ•¸**ï¼š
- `parse_retry_delay()`ï¼šå¾ 429 éŒ¯èª¤éŸ¿æ‡‰ä¸­æå–é‡è©¦å»¶é²
- `get_token_internal()`ï¼šå¸³è™Ÿé¸æ“‡èˆ‡è¼ªæ›çš„æ ¸å¿ƒé‚è¼¯
- `mark_rate_limited()`ï¼šæ¨™è¨˜å¸³è™Ÿç‚ºé™æµç‹€æ…‹

</details>
