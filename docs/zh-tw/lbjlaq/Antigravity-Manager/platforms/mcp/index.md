---
title: "MCP ç«¯é»ï¼šæš´éœ²å·¥å…· | Antigravity-Manager"
sidebarTitle: "è®“ Claude ç”¨ä¸Š z.ai èƒ½åŠ›"
subtitle: "MCP ç«¯é»ï¼šæŠŠ Web Search/Reader/Vision ä½œç‚ºå¯èª¿ç”¨å·¥å…·æš´éœ²å‡ºå»"
description: "å­¸ç¿’ Antigravity Manager çš„ MCP ç«¯é»é…ç½®ã€‚å•Ÿç”¨ Web Search/Reader/Visionï¼Œé©—è­‰å·¥å…·èª¿ç”¨ï¼Œå°æ¥å¤–éƒ¨å®¢æˆ¶ç«¯ï¼ŒæŒæ¡å¸¸è¦‹éŒ¯èª¤æ’æŸ¥æ–¹æ³•ã€‚"
tags:
  - "MCP"
  - "Web Search"
  - "Web Reader"
  - "Vision"
  - "z.ai"
  - "Antigravity Tools"
prerequisite:
  - "start-proxy-and-first-client"
  - "start-add-account"
order: 6
---
# MCP ç«¯é»ï¼šæŠŠ Web Search/Reader/Vision ä½œç‚ºå¯èª¿ç”¨å·¥å…·æš´éœ²å‡ºå»

ä½ æœƒç”¨é€™å¥— **MCP ç«¯é»**æŠŠ z.ai çš„æœå°‹ã€é–±è®€ã€è¦–è¦ºèƒ½åŠ›æš´éœ²çµ¦å¤–éƒ¨ MCP å®¢æˆ¶ç«¯ï¼Œé‡é»ææ¸…æ¥šã€Œé ç«¯åå‘ä»£ç†ã€å’Œã€Œå…§å»ºä¼ºæœå™¨ã€çš„å€åˆ¥ï¼Œä»¥åŠå¦‚ä½•å•Ÿç”¨ä¸¦èª¿ç”¨é€™äº›ç«¯é»ã€‚

## å­¸å®Œä½ èƒ½åšä»€éº¼

- ç†è§£ä¸‰ç¨® MCP ç«¯é»çš„å·¥ä½œåŸç†ï¼ˆé ç«¯åå‘ä»£ç† vs å…§å»ºä¼ºæœå™¨ï¼‰
- åœ¨ Antigravity Tools ä¸­å•Ÿç”¨ Web Search/Web Reader/Vision MCP ç«¯é»
- è®“å¤–éƒ¨ MCP å®¢æˆ¶ç«¯ï¼ˆå¦‚ Claude Desktopã€Cursorï¼‰é€éæœ¬æ©Ÿé–˜é“èª¿ç”¨é€™äº›èƒ½åŠ›
- æŒæ¡æœƒè©±ç®¡ç†ï¼ˆVision MCPï¼‰å’Œé‘‘æ¬Šæ¨¡å‹

## ä½ ç¾åœ¨çš„å›°å¢ƒ

å¾ˆå¤š AI å·¥å…·é–‹å§‹æ”¯æ´ MCPï¼ˆModel Context Protocolï¼‰ï¼Œä½†éœ€è¦é…ç½®ä¸Šæ¸¸ API Key å’Œ URLã€‚z.ai çš„ MCP ä¼ºæœå™¨ä¹Ÿæä¾›äº†å¼·å¤§çš„èƒ½åŠ›ï¼ˆæœå°‹ã€é–±è®€ã€è¦–è¦ºåˆ†æï¼‰ï¼Œä½†ç›´æ¥é…ç½®æ„å‘³è‘—è¦åœ¨æ¯å€‹å®¢æˆ¶ç«¯æš´éœ² z.ai Keyã€‚

Antigravity Tools çš„æ–¹æ¡ˆæ˜¯ï¼šåœ¨æœ¬æ©Ÿé–˜é“å±¤é¢çµ±ä¸€ç®¡ç† z.ai Keyï¼ŒæŠŠ MCP ç«¯é»æš´éœ²å‡ºä¾†ï¼Œå®¢æˆ¶ç«¯åªéœ€é€£æœ¬æ©Ÿé–˜é“ï¼Œç„¡éœ€çŸ¥é“ z.ai Keyã€‚

## ä»€éº¼æ™‚å€™ç”¨é€™ä¸€æ‹›

- ä½ æœ‰å¤šå€‹ MCP å®¢æˆ¶ç«¯ï¼ˆClaude Desktopã€Cursorã€è‡ªç ”å·¥å…·ï¼‰ï¼Œæƒ³çµ±ä¸€ç”¨ä¸€å¥— z.ai Key
- ä½ å¸Œæœ›æŠŠ z.ai çš„ Web Search/Web Reader/Vision èƒ½åŠ›ä½œç‚ºå·¥å…·æš´éœ²çµ¦ AI ä½¿ç”¨
- ä½ ä¸æƒ³åœ¨å¤šå€‹åœ°æ–¹é‡è¤‡é…ç½®å’Œè¼ªæ› z.ai Key

## ğŸ’ é–‹å§‹å‰çš„æº–å‚™

::: warning å‰ç½®æ¢ä»¶
- ä½ å·²ç¶“åœ¨ Antigravity Tools çš„ "API Proxy" é é¢å•Ÿå‹•äº†åä»£æœå‹™
- ä½ å·²ç¶“ç²å–äº† z.ai API Keyï¼ˆå¾ z.ai æ§åˆ¶å°ï¼‰
- ä½ çŸ¥é“åä»£çš„ç«¯å£ï¼ˆé è¨­ `8045`ï¼‰
:::

::: info ä»€éº¼æ˜¯ MCPï¼Ÿ
MCPï¼ˆModel Context Protocolï¼‰æ˜¯ä¸€å€‹é–‹æ”¾å”è­°ï¼Œè®“ AI å®¢æˆ¶ç«¯å¯ä»¥èª¿ç”¨å¤–éƒ¨å·¥å…·/è³‡æ–™æºã€‚

å…¸å‹çš„ MCP äº¤äº’æµç¨‹ï¼š
1. å®¢æˆ¶ç«¯ï¼ˆå¦‚ Claude Desktopï¼‰å‘ MCP Server ç™¼é€ `tools/list` è«‹æ±‚ï¼Œç²å–å¯ç”¨å·¥å…·åˆ—è¡¨
2. å®¢æˆ¶ç«¯æ ¹æ“šä¸Šä¸‹æ–‡é¸æ“‡å·¥å…·ï¼Œç™¼é€ `tools/call` è«‹æ±‚
3. MCP Server åŸ·è¡Œå·¥å…·ä¸¦è¿”å›çµæœï¼ˆæ–‡å­—ã€åœ–åƒã€è³‡æ–™ç­‰ï¼‰

Antigravity Tools æä¾›äº†ä¸‰ç¨® MCP ç«¯é»ï¼š
- **é ç«¯åå‘ä»£ç†**ï¼šç›´æ¥è½‰ç™¼åˆ° z.ai MCP ä¼ºæœå™¨ï¼ˆWeb Search/Web Readerï¼‰
- **å…§å»ºä¼ºæœå™¨**ï¼šæœ¬åœ°å¯¦ä½œ JSON-RPC 2.0 å”è­°ï¼Œè™•ç†å·¥å…·èª¿ç”¨ï¼ˆVisionï¼‰
:::

## ä»€éº¼æ˜¯ MCP ç«¯é»ï¼Ÿ

**MCP ç«¯é»**æ˜¯ Antigravity Tools æš´éœ²çš„ä¸€çµ„ HTTP è·¯ç”±ï¼Œè®“å¤–éƒ¨ MCP å®¢æˆ¶ç«¯å¯ä»¥èª¿ç”¨ z.ai çš„èƒ½åŠ›ï¼ŒåŒæ™‚ç”± Antigravity Tools çµ±ä¸€ç®¡ç†é‘‘æ¬Šå’Œé…ç½®ã€‚

### ç«¯é»åˆ†é¡

| ç«¯é»é¡å‹ | å¯¦ä½œæ–¹å¼ | æœ¬åœ°è·¯å¾‘ | ä¸Šæ¸¸ç›®æ¨™ |
|--- | --- | --- | ---|
| **Web Search** | é ç«¯åå‘ä»£ç† | `/mcp/web_search_prime/mcp` | `https://api.z.ai/api/mcp/web_search_prime/mcp` |
| **Web Reader** | é ç«¯åå‘ä»£ç† | `/mcp/web_reader/mcp` | `https://api.z.ai/api/mcp/web_reader/mcp` |
| **Vision MCP** | å…§å»ºä¼ºæœå™¨ï¼ˆJSON-RPC 2.0ï¼‰ | `/mcp/zai-mcp-server/mcp` | å…§éƒ¨èª¿ç”¨ z.ai PaaS API |

### é—œéµå€åˆ¥

::: info é ç«¯åå‘ä»£ç† vs å…§å»ºä¼ºæœå™¨
**é ç«¯åå‘ä»£ç†**ï¼ˆWeb Search/Web Readerï¼‰ï¼š
- ä»£ç†æœƒä¿ç•™éƒ¨åˆ†è«‹æ±‚æ¨™é ­ï¼ˆ`content-type`ã€`accept`ã€`user-agent`ï¼‰ä¸¦æ³¨å…¥ `Authorization` æ¨™é ­
- ä»£ç†æœƒè½‰ç™¼ä¸Šæ¸¸çš„éŸ¿æ‡‰é«”å’Œç‹€æ…‹ç¢¼ï¼Œä½†åªä¿ç•™ `CONTENT_TYPE` éŸ¿æ‡‰æ¨™é ­
- ç„¡ç‹€æ…‹ï¼Œç„¡éœ€æœƒè©±ç®¡ç†

**å…§å»ºä¼ºæœå™¨**ï¼ˆVision MCPï¼‰ï¼š
- å®Œæ•´å¯¦ä½œ JSON-RPC 2.0 å”è­°ï¼ˆ`initialize`ã€`tools/list`ã€`tools/call`ï¼‰
- æœ‰ç‹€æ…‹ï¼šå»ºç«‹æœƒè©±ï¼ˆ`mcp-session-id`ï¼‰ï¼ŒGET ç«¯é»è¿”å› SSE keepalive
- å·¥å…·é‚è¼¯åœ¨æœ¬åœ°å¯¦ä½œï¼Œèª¿ç”¨ z.ai PaaS API åŸ·è¡Œè¦–è¦ºåˆ†æ
:::

## æ ¸å¿ƒæ€è·¯

Antigravity Tools çš„ MCP ç«¯é»éµå¾ªä»¥ä¸‹è¨­è¨ˆåŸå‰‡ï¼š

1. **çµ±ä¸€é‘‘æ¬Š**ï¼šç”± Antigravity ç®¡ç† z.ai Keyï¼Œå®¢æˆ¶ç«¯ç„¡éœ€é…ç½®
2. **å¯é–‹é—œ**ï¼šä¸‰å€‹ç«¯é»å¯ä»¥ç¨ç«‹å•Ÿç”¨/åœç”¨
3. **æœƒè©±éš”é›¢**ï¼šVision MCP ä½¿ç”¨ `mcp-session-id` éš”é›¢ä¸åŒå®¢æˆ¶ç«¯
4. **éŒ¯èª¤é€æ˜**ï¼šä¸Šæ¸¸çš„éŸ¿æ‡‰é«”å’Œç‹€æ…‹ç¢¼æœƒåŸæ¨£è½‰ç™¼ï¼ˆéŸ¿æ‡‰æ¨™é ­æœƒéæ¿¾ï¼‰

### é‘‘æ¬Šæ¨¡å‹

```
MCP å®¢æˆ¶ç«¯ â†’ Antigravity æœ¬æ©Ÿä»£ç† â†’ z.ai ä¸Šæ¸¸
               â†“
           [å¯é¸] proxy.auth_mode
               â†“
           [è‡ªå‹•] æ³¨å…¥ z.ai Key
```

Antigravity Tools çš„ä»£ç†ä¸­ä»‹å±¤ï¼ˆ`src-tauri/src/proxy/middleware/auth.rs`ï¼‰æœƒæª¢æŸ¥ `proxy.auth_mode`ï¼Œå¦‚æœé–‹å•Ÿé‘‘æ¬Šï¼Œéœ€è¦å®¢æˆ¶ç«¯å¸¶ API Keyã€‚

**é‡è¦**ï¼šç„¡è«– `proxy.auth_mode` å¦‚ä½•ï¼Œz.ai Key éƒ½æ˜¯ä»£ç†è‡ªå‹•æ³¨å…¥çš„ï¼Œå®¢æˆ¶ç«¯ä¸éœ€è¦é…ç½®ã€‚

## è·Ÿæˆ‘åš

### ç¬¬ 1 æ­¥ï¼šé…ç½® z.ai ä¸¦å•Ÿç”¨ MCP åŠŸèƒ½

**ç‚ºä»€éº¼**
å…ˆç¢ºä¿ z.ai åŸºç¤é…ç½®æ­£ç¢ºï¼Œå†é€å€‹å•Ÿç”¨ MCP ç«¯é»ã€‚

1. æ‰“é–‹ Antigravity Toolsï¼Œé€²å…¥ **API Proxy** é é¢
2. æ‰¾åˆ° **z.ai é…ç½®** å¡ç‰‡ï¼Œé»æ“Šå±•é–‹
3. é…ç½®ä»¥ä¸‹æ¬„ä½ï¼š

```yaml
 # z.ai é…ç½®
base_url: "https://api.z.ai/api/anthropic"  # z.ai Anthropic ç›¸å®¹ç«¯é»
api_key: "ä½ çš„-z.ai-api-key"               # å¾ z.ai æ§åˆ¶å°ç²å–
enabled: true                              # å•Ÿç”¨ z.ai
```

4. æ‰¾åˆ° **MCP é…ç½®** å­å¡ç‰‡ï¼Œé…ç½®ï¼š

```yaml
 # MCP é…ç½®
enabled: true                              # å•Ÿç”¨ MCP ç¸½é–‹é—œ
web_search_enabled: true                    # å•Ÿç”¨ Web Search
web_reader_enabled: true                    # å•Ÿç”¨ Web Reader
vision_enabled: true                        # å•Ÿç”¨ Vision MCP
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šé…ç½®å„²å­˜å¾Œï¼Œé é¢ä¸‹æ–¹æœƒå‡ºç¾ã€Œæœ¬åœ° MCP ç«¯é»ã€åˆ—è¡¨ï¼Œé¡¯ç¤ºä¸‰å€‹ç«¯é»çš„å®Œæ•´ URLã€‚

### ç¬¬ 2 æ­¥ï¼šé©—è­‰ Web Search ç«¯é»

**ç‚ºä»€éº¼**
Web Search æ˜¯é ç«¯åå‘ä»£ç†ï¼Œæœ€ç°¡å–®ï¼Œé©åˆå…ˆé©—è­‰åŸºç¤é…ç½®ã€‚

```bash
 # 1) å…ˆåˆ—å‡º Web Search ç«¯é»æä¾›çš„å·¥å…·ï¼ˆå·¥å…·åä»¥å¯¦éš›è¿”å›ç‚ºæº–ï¼‰
curl -X POST http://127.0.0.1:8045/mcp/web_search_prime/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/list",
    "id": 1
  }'
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šè¿”å›ä¸€å€‹åŒ…å« `tools` åˆ—è¡¨çš„ JSON éŸ¿æ‡‰ã€‚

::: tip ç¹¼çºŒé©—è­‰ tools/callï¼ˆå¯é¸ï¼‰
æ‹¿åˆ° `tools[].name` å’Œ `tools[].inputSchema` å¾Œï¼Œä½ å°±èƒ½æŒ‰ schema æ‹¼ `tools/call` è«‹æ±‚ï¼ˆåƒæ•¸ä»¥ schema ç‚ºæº–ï¼Œåˆ¥çŒœæ¬„ä½ï¼‰ã€‚
:::

::: tip ç«¯é»æœªæ‰¾åˆ°ï¼Ÿ
å¦‚æœæ”¶åˆ° `404 Not Found`ï¼Œæª¢æŸ¥ï¼š
1. `proxy.zai.mcp.enabled` æ˜¯å¦ç‚º `true`
2. `proxy.zai.mcp.web_search_enabled` æ˜¯å¦ç‚º `true`
3. åä»£æœå‹™æ˜¯å¦æ­£åœ¨åŸ·è¡Œ
:::

### ç¬¬ 3 æ­¥ï¼šé©—è­‰ Web Reader ç«¯é»

**ç‚ºä»€éº¼**
Web Reader ä¹Ÿæ˜¯é ç«¯åå‘ä»£ç†ï¼Œä½†åƒæ•¸å’Œè¿”å›æ ¼å¼ä¸åŒï¼Œé©—è­‰ä»£ç†èƒ½æ­£ç¢ºè™•ç†ä¸åŒç«¯é»ã€‚

```bash
 # 2) åˆ—å‡º Web Reader ç«¯é»æä¾›çš„å·¥å…·
curl -X POST http://127.0.0.1:8045/mcp/web_reader/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/list",
    "id": 2
  }'
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šè¿”å›ä¸€å€‹åŒ…å« `tools` åˆ—è¡¨çš„ JSON éŸ¿æ‡‰ã€‚

### ç¬¬ 4 æ­¥ï¼šé©—è­‰ Vision MCP ç«¯é»ï¼ˆæœƒè©±ç®¡ç†ï¼‰

**ç‚ºä»€éº¼**
Vision MCP æ˜¯å…§å»ºä¼ºæœå™¨ï¼Œæœ‰æœƒè©±ç‹€æ…‹ï¼Œéœ€è¦å…ˆ `initialize`ï¼Œå†èª¿ç”¨å·¥å…·ã€‚

#### 4.1 åˆå§‹åŒ–æœƒè©±

```bash
 # 1) ç™¼é€ initialize è«‹æ±‚
curl -X POST http://127.0.0.1:8045/mcp/zai-mcp-server/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "initialize",
    "params": {
      "protocolVersion": "2024-11-05"
    },
    "id": 1
  }'
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šéŸ¿æ‡‰ä¸­åŒ…å« `mcp-session-id` æ¨™é ­ï¼Œå„²å­˜é€™å€‹ IDã€‚

```json
{
  "jsonrpc": "2.0",
  "result": {
    "protocolVersion": "2024-11-05",
    "capabilities": { "tools": {} },
    "serverInfo": {
      "name": "zai-mcp-server",
      "version": "<app-version>"
    }
  },
  "id": 1
}
```

::: info æé†’
`serverInfo.version` ä¾†è‡ª Rust çš„ `env!("CARGO_PKG_VERSION")`ï¼Œä»¥ä½ æœ¬æ©Ÿå¯¦éš›å®‰è£ç‰ˆæœ¬ç‚ºæº–ã€‚
:::

éŸ¿æ‡‰æ¨™é ­ï¼š
```
mcp-session-id: uuid-v4-string
```

#### 4.2 ç²å–å·¥å…·åˆ—è¡¨

```bash
 # 2) ç™¼é€ tools/list è«‹æ±‚ï¼ˆå¸¶ä¸Šæœƒè©± IDï¼‰
curl -X POST http://127.0.0.1:8045/mcp/zai-mcp-server/mcp \
  -H "Content-Type: application/json" \
  -H "mcp-session-id: ä½ çš„æœƒè©±ID" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/list",
    "id": 2
  }'
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šè¿”å› 8 å€‹å·¥å…·çš„å®šç¾©ï¼ˆ`ui_to_artifact`ã€`extract_text_from_screenshot`ã€`diagnose_error_screenshot` ç­‰ï¼‰ã€‚

#### 4.3 èª¿ç”¨å·¥å…·

```bash
 # 3) èª¿ç”¨ analyze_image å·¥å…·
curl -X POST http://127.0.0.1:8045/mcp/zai-mcp-server/mcp \
  -H "Content-Type: application/json" \
  -H "mcp-session-id: ä½ çš„æœƒè©±ID" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/call",
    "params": {
      "name": "analyze_image",
      "arguments": {
        "image_source": "https://example.com/image.jpg",
        "prompt": "æè¿°é€™å¼µåœ–ç‰‡çš„å…§å®¹"
      }
    },
    "id": 3
  }'
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šè¿”å›åœ–ç‰‡åˆ†æçµæœçš„æ–‡å­—æè¿°ã€‚

::: danger æœƒè©± ID é‡è¦
Vision MCP çš„æ‰€æœ‰è«‹æ±‚ï¼ˆé™¤äº† `initialize`ï¼‰éƒ½å¿…é ˆå¸¶ `mcp-session-id` æ¨™é ­ã€‚

æœƒè©± ID åœ¨ `initialize` éŸ¿æ‡‰ä¸­è¿”å›ï¼Œå¾ŒçºŒè«‹æ±‚å¿…é ˆä½¿ç”¨åŒä¸€å€‹ IDã€‚æœƒè©±éºå¤±å¾Œéœ€è¦é‡æ–° `initialize`ã€‚
:::
### ç¬¬ 5 æ­¥ï¼šæ¸¬è©¦ SSE keepaliveï¼ˆå¯é¸ï¼‰

**ç‚ºä»€éº¼**
Vision MCP çš„ GET ç«¯é»è¿”å› SSEï¼ˆServer-Sent Eventsï¼‰æµï¼Œç”¨æ–¼ä¿æŒé€£ç·šæ´»èºã€‚

```bash
 # 4) èª¿ç”¨ GET ç«¯é»ï¼ˆç²å– SSE æµï¼‰
curl -N http://127.0.0.1:8045/mcp/zai-mcp-server/mcp \
  -H "mcp-session-id: ä½ çš„æœƒè©±ID"
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šæ¯ 15 ç§’æ”¶åˆ°ä¸€å€‹ `event: ping` è¨Šæ¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```
event: ping
data: keepalive

event: ping
data: keepalive
...
```

## æª¢æŸ¥é» âœ…

### é…ç½®æª¢æŸ¥

- [ ] `proxy.zai.enabled` ç‚º `true`
- [ ] `proxy.zai.api_key` å·²é…ç½®ï¼ˆéç©ºï¼‰
- [ ] `proxy.zai.mcp.enabled` ç‚º `true`
- [ ] è‡³å°‘å•Ÿç”¨äº†ä¸€å€‹ MCP ç«¯é»ï¼ˆ`web_search_enabled` / `web_reader_enabled` / `vision_enabled`ï¼‰
- [ ] åä»£æœå‹™æ­£åœ¨åŸ·è¡Œ

### åŠŸèƒ½é©—è­‰

- [ ] Web Search ç«¯é»è¿”å›æœå°‹çµæœ
- [ ] Web Reader ç«¯é»è¿”å›ç¶²é å…§å®¹
- [ ] Vision MCP ç«¯é»æˆåŠŸ `initialize` ä¸¦ç²å– `mcp-session-id`
- [ ] Vision MCP ç«¯é»è¿”å›å·¥å…·åˆ—è¡¨ï¼ˆ8 å€‹å·¥å…·ï¼‰
- [ ] Vision MCP ç«¯é»æˆåŠŸèª¿ç”¨å·¥å…·ä¸¦è¿”å›çµæœ

## Vision MCP å·¥å…·é€ŸæŸ¥

| å·¥å…·å | åŠŸèƒ½ | å¿…éœ€åƒæ•¸ | ç¯„ä¾‹å ´æ™¯ |
|--- | --- | --- | ---|
| `ui_to_artifact` | æŠŠ UI æˆªåœ–è½‰ç‚ºä»£ç¢¼/æç¤ºè©/è¦æ ¼/æè¿° | `image_source`ã€`output_type`ã€`prompt` | å¾è¨­è¨ˆç¨¿ç”Ÿæˆå‰ç«¯ä»£ç¢¼ |
| `extract_text_from_screenshot` | å¾æˆªåœ–æå–æ–‡å­—/ä»£ç¢¼ï¼ˆé¡ä¼¼ OCRï¼‰ | `image_source`ã€`prompt` | è®€å–éŒ¯èª¤æ—¥èªŒæˆªåœ– |
| `diagnose_error_screenshot` | è¨ºæ–·éŒ¯èª¤æˆªåœ–ï¼ˆå †ç–Šè¿½è¹¤ã€æ—¥èªŒï¼‰ | `image_source`ã€`prompt` | åˆ†æåŸ·è¡Œæ™‚éŒ¯èª¤ |
| `understand_technical_diagram` | åˆ†ææ¶æ§‹/æµç¨‹/UML/ER åœ– | `image_source`ã€`prompt` | ç†è§£ç³»çµ±æ¶æ§‹åœ– |
| `analyze_data_visualization` | åˆ†æåœ–è¡¨/å„€è¡¨æ¿ | `image_source`ã€`prompt` | å¾å„€è¡¨æ¿æå–è¶¨å‹¢ |
| `ui_diff_check` | æ¯”è¼ƒå…©å€‹ UI æˆªåœ–ä¸¦å ±å‘Šå·®ç•° | `expected_image_source`ã€`actual_image_source`ã€`prompt` | è¦–è¦ºè¿´æ­¸æ¸¬è©¦ |
| `analyze_image` | é€šç”¨åœ–åƒåˆ†æ | `image_source`ã€`prompt` | æè¿°åœ–ç‰‡å…§å®¹ |
| `analyze_video` | å½±ç‰‡å…§å®¹åˆ†æ | `video_source`ã€`prompt` | åˆ†æå½±ç‰‡å ´æ™¯ |

::: info åƒæ•¸èªªæ˜
- `image_source`ï¼šæœ¬åœ°æª”æ¡ˆè·¯å¾‘ï¼ˆå¦‚ `/tmp/screenshot.png`ï¼‰æˆ–é ç«¯ URLï¼ˆå¦‚ `https://example.com/image.jpg`ï¼‰
- `video_source`ï¼šæœ¬åœ°æª”æ¡ˆè·¯å¾‘æˆ–é ç«¯ URLï¼ˆæ”¯æ´ MP4ã€MOVã€M4Vï¼‰
- `output_type`ï¼ˆ`ui_to_artifact`ï¼‰ï¼š`code` / `prompt` / `spec` / `description`
:::

## è¸©å‘æé†’

### 404 Not Found

**ç¾è±¡**ï¼šèª¿ç”¨ MCP ç«¯é»è¿”å› `404 Not Found`ã€‚

**åŸå› **ï¼š
1. ç«¯é»æœªå•Ÿç”¨ï¼ˆå°æ‡‰çš„ `*_enabled` ç‚º `false`ï¼‰
2. åä»£æœå‹™æœªå•Ÿå‹•
3. URL è·¯å¾‘éŒ¯èª¤ï¼ˆæ³¨æ„ `/mcp/` å‰ç¶´ï¼‰

**è§£æ±º**ï¼š
1. æª¢æŸ¥ `proxy.zai.mcp.enabled` å’Œå°æ‡‰çš„ `*_enabled` é…ç½®
2. æª¢æŸ¥åä»£æœå‹™ç‹€æ…‹
3. ç¢ºèª URL è·¯å¾‘æ ¼å¼ï¼ˆå¦‚ `/mcp/web_search_prime/mcp`ï¼‰

### 400 Bad Request: Missing Mcp-Session-Id

**ç¾è±¡**ï¼šèª¿ç”¨ Vision MCPï¼ˆé™¤ `initialize` å¤–ï¼‰è¿”å› `400 Bad Request`ã€‚

- GET ç«¯é»ï¼šè¿”å›ç´”æ–‡å­— `Missing Mcp-Session-Id`
- POST ç«¯é»ï¼šè¿”å› JSON-RPC éŒ¯èª¤ `{"error":{"code":-32000,"message":"Bad Request: missing Mcp-Session-Id"}}`

**åŸå› **ï¼šè«‹æ±‚æ¨™é ­ç¼ºå°‘ `mcp-session-id` æˆ– ID ç„¡æ•ˆã€‚

**è§£æ±º**ï¼š
1. ç¢ºä¿ `initialize` è«‹æ±‚æˆåŠŸï¼Œä¸¦å¾éŸ¿æ‡‰æ¨™é ­ç²å– `mcp-session-id`
2. å¾ŒçºŒè«‹æ±‚ï¼ˆ`tools/list`ã€`tools/call`ï¼Œä»¥åŠ SSE keepaliveï¼‰éƒ½å¿…é ˆå¸¶è©²æ¨™é ­
3. å¦‚æœæœƒè©±éºå¤±ï¼ˆå¦‚æœå‹™é‡å•Ÿï¼‰ï¼Œéœ€è¦é‡æ–° `initialize`

### z.ai is not configured

**ç¾è±¡**ï¼šè¿”å› `400 Bad Request`ï¼Œæç¤º `z.ai is not configured`ã€‚

**åŸå› **ï¼š`proxy.zai.enabled` ç‚º `false` æˆ– `api_key` ç‚ºç©ºã€‚

**è§£æ±º**ï¼š
1. ç¢ºä¿ `proxy.zai.enabled` ç‚º `true`
2. ç¢ºä¿ `proxy.zai.api_key` å·²é…ç½®ï¼ˆéç©ºï¼‰

### ä¸Šæ¸¸è«‹æ±‚å¤±æ•—

**ç¾è±¡**ï¼šè¿”å› `502 Bad Gateway` æˆ–å…§éƒ¨éŒ¯èª¤ã€‚

**åŸå› **ï¼š
1. z.ai API Key ç„¡æ•ˆæˆ–éæœŸ
2. ç¶²è·¯é€£ç·šå•é¡Œï¼ˆéœ€è¦ä¸Šæ¸¸ä»£ç†ï¼‰
3. z.ai ä¼ºæœå™¨éŒ¯èª¤

**è§£æ±º**ï¼š
1. é©—è­‰ z.ai API Key æ˜¯å¦æ­£ç¢º
2. æª¢æŸ¥ `proxy.upstream_proxy` é…ç½®ï¼ˆå¦‚æœéœ€è¦ä»£ç†è¨ªå• z.aiï¼‰
3. æŸ¥çœ‹æ—¥èªŒç²å–è©³ç´°éŒ¯èª¤è³‡è¨Š

## èˆ‡å¤–éƒ¨ MCP å®¢æˆ¶ç«¯é›†æˆ

### Claude Desktop é…ç½®ç¯„ä¾‹

Claude Desktop çš„ MCP å®¢æˆ¶ç«¯é…ç½®æª”æ¡ˆï¼ˆ`~/.config/claude/claude_desktop_config.json`ï¼‰ï¼š

```json
{
  "mcpServers": {
    "antigravity-vision": {
      "command": "node",
      "args": [
        "/path/to/mcp-client-wrapper.js",
        "--endpoint",
        "http://127.0.0.1:8045/mcp/zai-mcp-server/mcp"
      ]
    },
    "antigravity-web-search": {
      "command": "node",
      "args": [
        "/path/to/mcp-client-wrapper.js",
        "--endpoint",
        "http://127.0.0.1:8045/mcp/web_search_prime/mcp"
      ]
    }
  }
}
```

::: tip Claude Desktop çš„é™åˆ¶
Claude Desktop çš„ MCP å®¢æˆ¶ç«¯éœ€è¦é€é `stdio` é€šè¨Šï¼Œå¦‚æœä½ ç›´æ¥ç”¨ HTTP ç«¯é»ï¼Œéœ€è¦ç·¨å¯«ä¸€å€‹ wrapper è…³æœ¬æŠŠ `stdio` è½‰ç‚º HTTP è«‹æ±‚ã€‚

æˆ–è€…ä½¿ç”¨æ”¯æ´ HTTP MCP çš„å®¢æˆ¶ç«¯ï¼ˆå¦‚ Cursorï¼‰ã€‚
:::

### HTTP MCP å®¢æˆ¶ç«¯ï¼ˆå¦‚ Cursorï¼‰

å¦‚æœå®¢æˆ¶ç«¯æ”¯æ´ HTTP MCPï¼Œç›´æ¥é…ç½®ç«¯é» URL å³å¯ï¼š

```yaml
 # Cursor MCP é…ç½®
mcpServers:
  - name: antigravity-vision
    url: http://127.0.0.1:8045/mcp/zai-mcp-server/mcp
  - name: antigravity-web-search
    url: http://127.0.0.1:8045/mcp/web_search_prime/mcp
```

## æœ¬èª²å°çµ

Antigravity Tools çš„ MCP ç«¯é»æŠŠ z.ai çš„èƒ½åŠ›æš´éœ²ç‚ºå¯èª¿ç”¨å·¥å…·ï¼Œåˆ†ç‚ºå…©é¡ï¼š
- **é ç«¯åå‘ä»£ç†**ï¼ˆWeb Search/Web Readerï¼‰ï¼šç°¡å–®è½‰ç™¼ï¼Œç„¡ç‹€æ…‹
- **å…§å»ºä¼ºæœå™¨**ï¼ˆVision MCPï¼‰ï¼šå®Œæ•´å¯¦ä½œ JSON-RPC 2.0ï¼Œæœ‰æœƒè©±ç®¡ç†

é—œéµé»ï¼š
1. çµ±ä¸€é‘‘æ¬Šï¼šz.ai Key ç”± Antigravity ç®¡ç†ï¼Œå®¢æˆ¶ç«¯ç„¡éœ€é…ç½®
2. å¯é–‹é—œï¼šä¸‰å€‹ç«¯é»å¯ç¨ç«‹å•Ÿç”¨/åœç”¨
3. æœƒè©±éš”é›¢ï¼šVision MCP ä½¿ç”¨ `mcp-session-id` éš”é›¢å®¢æˆ¶ç«¯
4. éˆæ´»é›†æˆï¼šæ”¯æ´ä»»ä½•ç›¸å®¹ MCP å”è­°çš„å®¢æˆ¶ç«¯

## ä¸‹ä¸€èª²é å‘Š

> ä¸‹ä¸€èª²æˆ‘å€‘å­¸ç¿’ **[Cloudflared ä¸€éµéš§é“](/zh-tw/lbjlaq/Antigravity-Manager/platforms/cloudflared/)**ã€‚
>
> ä½ æœƒå­¸åˆ°ï¼š
> - å¦‚ä½•ä¸€éµå®‰è£å’Œå•Ÿå‹• Cloudflared éš§é“
> - quick æ¨¡å¼ vs auth æ¨¡å¼çš„å€åˆ¥
> - å¦‚ä½•å®‰å…¨åœ°æŠŠæœ¬åœ° API æš´éœ²åˆ°å…¬ç¶²

---

## é™„éŒ„ï¼šæºç¢¼åƒè€ƒ

<details>
<summary><strong>é»æ“Šå±•é–‹æŸ¥çœ‹æºç¢¼ä½ç½®</strong></summary>

> æ›´æ–°æ™‚é–“ï¼š2026-01-23

| åŠŸèƒ½ | æª”æ¡ˆè·¯å¾‘ | è¡Œè™Ÿ |
|--- | --- | ---|
| Web Search ç«¯é» | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L115-L135) | 115-135 |
| Web Reader ç«¯é» | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L137-L157) | 137-157 |
| Vision MCP ç«¯é»ï¼ˆä¸»å…¥å£ï¼‰ | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L376-L397) | 376-397 |
| Vision MCP initialize è™•ç† | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L271-L293) | 271-293 |
| Vision MCP tools/list è™•ç† | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L311-L314) | 311-314 |
| Vision MCP tools/call è™•ç† | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L315-L363) | 315-363 |
| Vision MCP æœƒè©±ç‹€æ…‹ç®¡ç† | [`src-tauri/src/proxy/zai_vision_mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/zai_vision_mcp.rs#L1-L42) | 1-42 |
| Vision MCP å·¥å…·å®šç¾© | [`src-tauri/src/proxy/zai_vision_tools.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/zai_vision_tools.rs#L166-L271) | 166-271 |
| Vision MCP å·¥å…·èª¿ç”¨å¯¦ä½œ | [`src-tauri/src/proxy/zai_vision_tools.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/zai_vision_tools.rs#L273-L400) | 273-400 |
| è·¯ç”±è¨»å†Š | [`src-tauri/src/proxy/server.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/server.rs#L157-L169) | 157-169 |
| é‘‘æ¬Šä¸­ä»‹å±¤ | [`src-tauri/src/proxy/middleware/auth.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/middleware/auth.rs#L1-L78) | 1-78 |
| MCP é…ç½® UI | [`src/pages/ApiProxy.tsx`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src/pages/ApiProxy.tsx#L1304-L1357) | 1304-1357 |
| å€‰åº«å…§èªªæ˜æ–‡ä»¶ | [`docs/zai/mcp.md`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/docs/zai/mcp.md#L1-L57) | 1-57 |

**é—œéµå¸¸é‡**ï¼š
- `ZAI_PAAZ_CHAT_COMPLETIONS_URL = "https://api.z.ai/api/paas/v4/chat/completions"`ï¼šz.ai PaaS API ç«¯é»ï¼ˆç”¨æ–¼ Vision å·¥å…·èª¿ç”¨ï¼‰

**é—œéµå‡½æ•¸**ï¼š
- `handle_web_search_prime()`ï¼šè™•ç† Web Search ç«¯é»çš„é ç«¯åå‘ä»£ç†
- `handle_web_reader()`ï¼šè™•ç† Web Reader ç«¯é»çš„é ç«¯åå‘ä»£ç†
- `handle_zai_mcp_server()`ï¼šè™•ç† Vision MCP ç«¯é»çš„æ‰€æœ‰æ–¹æ³•ï¼ˆGET/POST/DELETEï¼‰
- `mcp_session_id()`ï¼šå¾è«‹æ±‚æ¨™é ­æå– `mcp-session-id`
- `forward_mcp()`ï¼šé€šç”¨ MCP è½‰ç™¼å‡½æ•¸ï¼ˆæ³¨å…¥é‘‘æ¬Šä¸¦è½‰ç™¼åˆ°ä¸Šæ¸¸ï¼‰
- `tool_specs()`ï¼šè¿”å› Vision MCP çš„å·¥å…·å®šç¾©åˆ—è¡¨
- `call_tool()`ï¼šåŸ·è¡ŒæŒ‡å®šçš„ Vision MCP å·¥å…·

</details>
