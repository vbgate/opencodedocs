---
title: "å¸³è™Ÿèª¿åº¦: é«˜å¯ç”¨ç­–ç•¥ | Antigravity-Manager"
sidebarTitle: "è®“è«‹æ±‚æ›´ç©©å®š"
subtitle: "é«˜å¯ç”¨èª¿åº¦"
description: "å­¸ç¿’ Antigravity Manager å¸³è™Ÿèª¿åº¦èˆ‡é«˜å¯ç”¨ç­–ç•¥ã€‚æŒæ¡ç²˜æ€§æœƒè©±ã€å›ºå®šå¸³è™Ÿã€å¤±æ•—é‡è©¦æ©Ÿåˆ¶ï¼Œæå‡ç³»çµ±å¯ç”¨æ€§ã€‚"
tags:
  - "é€²éš"
  - "èª¿åº¦"
  - "ç²˜æ€§æœƒè©±"
  - "å¸³è™Ÿè¼ªæ›"
  - "å¤±æ•—é‡è©¦"
prerequisite:
  - "start-add-account"
  - "start-proxy-and-first-client"
  - "advanced-config"
order: 3
---
# é«˜å¯ç”¨èª¿åº¦ï¼šè¼ªæ›ã€å›ºå®šå¸³è™Ÿã€ç²˜æ€§æœƒè©±èˆ‡å¤±æ•—é‡è©¦

ä½ æŠŠ Antigravity Tools ç•¶æˆæœ¬åœ° AI é–˜é“ç”¨äº†ä¸€æ®µæ™‚é–“å¾Œï¼ŒåŸºæœ¬éƒ½æœƒæ’åˆ°åŒä¸€å€‹å•é¡Œï¼šå¸³è™Ÿè¶Šå°‘è¶Šå®¹æ˜“ 429/401/invalid_grantï¼Œå¸³è™Ÿè¶Šå¤šè¶Šå®¹æ˜“"å“ªå€‹å¸³è™Ÿåœ¨å¹¹æ´»"èªªä¸æ¸…ï¼Œå¿«å–å‘½ä¸­ç‡ä¹Ÿæœƒæ‰ã€‚

é€™ç¯€èª²å°±æŠŠèª¿åº¦é€™å¡Šè¬›æ¸…æ¥šï¼šå®ƒåˆ°åº•æ€éº¼é¸å¸³è™Ÿã€ä»€éº¼å«"ç²˜æ€§æœƒè©±"ã€ä»€éº¼æ™‚å€™æœƒå¼·åˆ¶è¼ªæ›ã€ä»¥åŠå¦‚ä½•ç”¨"å›ºå®šå¸³è™Ÿæ¨¡å¼"æŠŠèª¿åº¦è®Šæˆå¯æ§çš„ã€‚

## å­¸å®Œä½ èƒ½åšä»€éº¼

- çœ‹æ‡‚ Antigravity Tools çš„ 3 ç¨®èª¿åº¦æ¨¡å¼åœ¨çœŸå¯¦è«‹æ±‚è£¡å„åšäº†ä»€éº¼
- çŸ¥é“"æœƒè©±æŒ‡ç´‹ï¼ˆsession_idï¼‰"æ€éº¼ç”Ÿæˆï¼Œä»¥åŠå®ƒæ€éº¼å½±éŸ¿ç²˜æ€§èª¿åº¦
- åœ¨ GUI è£¡å•Ÿç”¨/é—œé–‰"å›ºå®šå¸³è™Ÿæ¨¡å¼"ï¼Œä¸¦ç†è§£å®ƒæœƒè¦†è“‹å“ªäº›èª¿åº¦é‚è¼¯
- é‡åˆ° 429/5xx/invalid_grant æ™‚ï¼ŒçŸ¥é“ç³»çµ±æœƒæ€éº¼æ¨™è¨˜é™æµã€æ€éº¼é‡è©¦ã€ä»€éº¼æ™‚å€™è¼ªæ›

## ä½ ç¾åœ¨çš„å›°å¢ƒ

- Claude Code æˆ– OpenAI SDK è·‘è‘—è·‘è‘—çªç„¶ 429ï¼Œä¸€é‡è©¦å°±æ›å¸³è™Ÿï¼Œå¿«å–å‘½ä¸­ç‡ä¸‹æ»‘
- å¤šå€‹å®¢æˆ¶ç«¯ä¸¦ç™¼è·‘ä»»å‹™ï¼Œç¶“å¸¸"äº’ç›¸è¸©æ‰"å°æ–¹çš„å¸³è™Ÿç‹€æ…‹
- ä½ æƒ³æ’éšœï¼Œä½†ä¸çŸ¥é“ç•¶å‰è«‹æ±‚æ˜¯å“ªå€‹å¸³è™Ÿåœ¨æœå‹™
- ä½ åªæƒ³ç”¨æŸå€‹"æœ€ç©©çš„å¸³è™Ÿ"ï¼Œä½†ç³»çµ±ç¸½åœ¨è¼ªæ›

## ä»€éº¼æ™‚å€™ç”¨é€™ä¸€æ‹›

- ä½ éœ€è¦æŠŠ"ç©©å®šæ€§ï¼ˆå°‘å ±éŒ¯ï¼‰"å’Œ"å¿«å–å‘½ä¸­ï¼ˆåŒå¸³è™Ÿï¼‰"åšæ¬Šè¡¡
- ä½ æƒ³è®“åŒä¸€æ¢å°è©±ç›¡é‡å¾©ç”¨åŒä¸€å€‹å¸³è™Ÿï¼ˆæ¸›å°‘ Prompt Caching æŠ–å‹•ï¼‰
- ä½ è¦åšç°åº¦/æ’éšœï¼Œæƒ³æŠŠæ‰€æœ‰è«‹æ±‚éƒ½å›ºå®šåˆ°ä¸€å€‹å¸³è™Ÿ

## ğŸ’ é–‹å§‹å‰çš„æº–å‚™

1) è‡³å°‘æº–å‚™ 2 å€‹å¯ç”¨å¸³è™Ÿï¼ˆå¸³è™Ÿæ± è¶Šå°ï¼Œè¼ªæ›ç©ºé–“è¶Šå°ï¼‰
2) åä»£æœå‹™å·²å•Ÿå‹•ï¼ˆåœ¨ã€ŒAPI Proxyã€é é¢èƒ½çœ‹åˆ° Running ç‹€æ…‹ï¼‰
3) ä½ çŸ¥é“è¨­å®šæª”åœ¨å“ªè£¡ï¼ˆå¦‚æœä½ éœ€è¦æ‰‹å‹•æ”¹è¨­å®šï¼‰

::: tip å…ˆæŠŠè¨­å®šç³»çµ±é€™èª²è£œä¸Š
å¦‚æœä½ é‚„ä¸ç†Ÿ `gui_config.json` å’Œå“ªäº›è¨­å®šèƒ½ç†±æ›´æ–°ï¼Œå…ˆçœ‹ **[è¨­å®šå…¨è§£ï¼šAppConfig/ProxyConfigã€è½ç›¤ä½ç½®èˆ‡ç†±æ›´æ–°èªæ„](/zh-tw/lbjlaq/Antigravity-Manager/advanced/config/)**ã€‚
:::

## æ ¸å¿ƒæ€è·¯ï¼šä¸€æ¬¡è«‹æ±‚æœƒç¶“éå“ªå¹¾å±¤"èª¿åº¦"

èª¿åº¦ä¸æ˜¯ä¸€å€‹"å–®ç¨çš„é–‹é—œ"ï¼Œè€Œæ˜¯å¹¾å±¤æ©Ÿåˆ¶ç–Šåœ¨ä¸€èµ·ï¼š

1) **SessionManager å…ˆçµ¦è«‹æ±‚æ‰“ä¸€å€‹æœƒè©±æŒ‡ç´‹ï¼ˆsession_idï¼‰**
2) **Handlers æ¯æ¬¡é‡è©¦éƒ½æœƒè¦æ±‚ TokenManager å¼·åˆ¶è¼ªæ›**ï¼ˆ`attempt > 0`ï¼‰
3) **TokenManager å†æ ¹æ“šï¼šå›ºå®šå¸³è™Ÿ â†’ ç²˜æ€§æœƒè©± â†’ 60s è¦–çª— â†’ è¼ªè©¢** é¸å‡ºå¸³è™Ÿ
4) **é‡åˆ° 429/5xx æ™‚æœƒè¨˜éŒ„é™æµè³‡è¨Š**ï¼Œå¾ŒçºŒé¸å¸³è™Ÿæœƒä¸»å‹•è·³éé™æµå¸³è™Ÿ

### ä»€éº¼æ˜¯"æœƒè©±æŒ‡ç´‹ï¼ˆsession_idï¼‰"ï¼Ÿ

**æœƒè©±æŒ‡ç´‹**å°±æ˜¯ä¸€å€‹"ç›¡é‡ç©©å®šçš„ Session Key"ï¼Œç”¨ä¾†æŠŠåŒä¸€æ®µå°è©±çš„å¤šæ¬¡è«‹æ±‚ç¶åœ¨åŒä¸€å¸³è™Ÿä¸Šã€‚

 åœ¨ Claude è«‹æ±‚è£¡ï¼Œå„ªå…ˆç´šæ˜¯ï¼š

 1) `metadata.user_id`ï¼ˆå®¢æˆ¶ç«¯é¡¯å¼å‚³å…¥ï¼Œä¸”éç©ºä¸”ä¸å« `"session-"` å‰ç¶´ï¼‰
 2) ç¬¬ä¸€æ¢"è¶³å¤ é•·"çš„ user è¨Šæ¯åš SHA256 é›œæ¹Šï¼Œç„¶å¾Œæˆªæ–·æˆ `sid-xxxxxxxxxxxxxxxx`

 å°æ‡‰å¯¦ä½œï¼š`src-tauri/src/proxy/session_manager.rs`ï¼ˆClaude/OpenAI/Gemini éƒ½æœ‰å„è‡ªçš„æå–é‚è¼¯ï¼‰ã€‚

::: info å°ç´°ç¯€ï¼šç‚ºä»€éº¼åªçœ‹ç¬¬ä¸€æ¢ user è¨Šæ¯ï¼Ÿ
æºç¢¼è£¡æ˜ç¢ºå¯«äº†"åªé›œæ¹Šç¬¬ä¸€æ¢ä½¿ç”¨è€…è¨Šæ¯å…§å®¹ï¼Œä¸æ··å…¥æ¨¡å‹åç¨±æˆ–æ™‚é–“æˆ³"ï¼Œç›®æ¨™æ˜¯è®“åŒä¸€å°è©±çš„å¤šè¼ªè«‹æ±‚ç›¡é‡ç”Ÿæˆç›¸åŒçš„ session_idï¼Œå¾è€Œæé«˜å¿«å–å‘½ä¸­ç‡ã€‚
:::

### TokenManager é¸å¸³è™Ÿçš„å„ªå…ˆç´š

TokenManager çš„æ ¸å¿ƒå…¥å£æ˜¯ï¼š

- `TokenManager::get_token(quota_group, force_rotate, session_id, target_model)`

 å®ƒåšçš„äº‹å¯ä»¥æŒ‰å„ªå…ˆç´šç†è§£ï¼š

 1) **å›ºå®šå¸³è™Ÿæ¨¡å¼ï¼ˆFixed Accountï¼‰**ï¼šå¦‚æœåœ¨ GUI ä¸­å•Ÿç”¨äº†"å›ºå®šå¸³è™Ÿæ¨¡å¼"ï¼ˆåŸ·è¡Œæ™‚è¨­å®šï¼‰ï¼Œä¸”è©²å¸³è™Ÿæ²’è¢«é™æµã€ä¹Ÿæ²’è¢«é…é¡ä¿è­·ï¼Œå°±ç›´æ¥ç”¨å®ƒã€‚
 2) **ç²˜æ€§æœƒè©±ï¼ˆSession Bindingï¼‰**ï¼šå¦‚æœæœ‰ `session_id` ä¸”èª¿åº¦æ¨¡å¼ä¸æ˜¯ `PerformanceFirst`ï¼Œæœƒå„ªå…ˆå¾©ç”¨è©² session ç¶å®šçš„å¸³è™Ÿã€‚
 3) **60s å…¨åŸŸè¦–çª—å¾©ç”¨**ï¼šå¦‚æœæ²’å‚³ `session_id`ï¼ˆæˆ–é‚„æ²’ç¶å®šæˆåŠŸï¼‰ï¼Œåœ¨é `PerformanceFirst` ä¸‹æœƒç›¡é‡åœ¨ 60 ç§’å…§å¾©ç”¨"ä¸Šä¸€æ¬¡ç”¨éçš„å¸³è™Ÿ"ã€‚
 4) **è¼ªè©¢ï¼ˆRound-robinï¼‰**ï¼šä»¥ä¸Šéƒ½ä¸é©ç”¨æ™‚ï¼ŒæŒ‰ä¸€å€‹å…¨åŸŸè‡ªå¢ç´¢å¼•è¼ªè©¢é¸æ“‡å¸³è™Ÿã€‚

 æ­¤å¤–é‚„æœ‰å…©æ¢"éš±å½¢è¦å‰‡"ï¼Œå¾ˆå½±éŸ¿é«”æ„Ÿï¼š

 - **å¸³è™Ÿæœƒå…ˆæ’åº**ï¼šULTRA > PRO > FREEï¼ŒåŒ tier å…§å„ªå…ˆå‰©é¤˜é…é¡é«˜çš„å¸³è™Ÿã€‚
 - **å¤±æ•—æˆ–é™æµæœƒè¢«è·³é**ï¼šå·²å˜—è©¦å¤±æ•—çš„å¸³è™Ÿæœƒé€²å…¥ `attempted` é›†åˆï¼›è¢«é™æµæ¨™è¨˜çš„å¸³è™Ÿæœƒè¢«è·³éã€‚

### 3 ç¨®èª¿åº¦æ¨¡å¼åˆ°åº•å·®åœ¨å“ª

 åœ¨è¨­å®šè£¡ä½ æœƒçœ‹åˆ°ï¼š`CacheFirst` / `Balance` / `PerformanceFirst`ã€‚

 ä»¥"å¾Œç«¯ TokenManager çœŸå¯¦åˆ†æ”¯"ç‚ºæº–ï¼Œå®ƒå€‘çš„é—œéµå·®ç•°åªæœ‰ä¸€å€‹ï¼š**æ˜¯å¦å•Ÿç”¨ç²˜æ€§æœƒè©± + 60s è¦–çª—å¾©ç”¨**ã€‚

 - `PerformanceFirst`ï¼šè·³éç²˜æ€§æœƒè©±èˆ‡ 60s è¦–çª—å¾©ç”¨ï¼Œç›´æ¥èµ°è¼ªè©¢ï¼ˆä¸¦ç¹¼çºŒè·³éé™æµ/é…é¡ä¿è­·å¸³è™Ÿï¼‰ã€‚
 - `CacheFirst` / `Balance`ï¼šéƒ½æœƒå•Ÿç”¨ç²˜æ€§æœƒè©±èˆ‡ 60s è¦–çª—å¾©ç”¨ã€‚

 ::: warning é—œæ–¼ max_wait_seconds
 å‰ç«¯/è¨­å®šçµæ§‹è£¡æœ‰ `max_wait_seconds`ï¼Œä¸¦ä¸” UI åªåœ¨ `CacheFirst` ä¸‹å…è¨±èª¿æ•´ã€‚ä½†ç›®å‰å¾Œç«¯èª¿åº¦é‚è¼¯åªåŸºæ–¼ `mode` åˆ†æ”¯ï¼Œä¸¦æ²’æœ‰è®€å– `max_wait_seconds`ã€‚
 :::

### å¤±æ•—é‡è©¦èˆ‡"å¼·åˆ¶è¼ªæ›"æ€éº¼è¯å‹•

 åœ¨ OpenAI/Gemini/Claude çš„ handler è£¡ï¼Œéƒ½æœƒç”¨é¡ä¼¼ä¸‹é¢çš„æ¨¡å¼è™•ç†é‡è©¦ï¼š

 - ç¬¬ 1 æ¬¡å˜—è©¦ï¼š`force_rotate = false`
 - ç¬¬ 2 æ¬¡åŠä»¥å¾Œï¼š`force_rotate = true`ï¼ˆ`attempt > 0`ï¼‰ï¼ŒTokenManager æœƒè·³éç²˜æ€§å¾©ç”¨ï¼Œç›´æ¥æ‰¾ä¸‹ä¸€å€‹å¯ç”¨å¸³è™Ÿ

 é‡åˆ° 429/529/503/500 ç­‰éŒ¯èª¤æ™‚ï¼š

 - handler æœƒå‘¼å« `token_manager.mark_rate_limited(...)` æŠŠé€™å€‹å¸³è™Ÿè¨˜éŒ„ç‚º"é™æµ/éè¼‰"ï¼Œå¾ŒçºŒèª¿åº¦æœƒä¸»å‹•è·³éå®ƒã€‚
 - OpenAI ç›¸å®¹è·¯å¾‘é‚„æœƒå˜—è©¦å¾éŒ¯èª¤ JSON è£¡è§£æ `RetryInfo.retryDelay` æˆ– `quotaResetDelay`ï¼Œç­‰å¾…ä¸€å°æ®µæ™‚é–“å†ç¹¼çºŒé‡è©¦ã€‚

## è·Ÿæˆ‘åšï¼šæŠŠèª¿åº¦èª¿åˆ°"å¯æ§"

### ç¬¬ 1 æ­¥ï¼šå…ˆç¢ºèªä½ çœŸçš„æœ‰"å¸³è™Ÿæ± "

**ç‚ºä»€éº¼**
èª¿åº¦å†é«˜ç´šï¼Œæ± å­è£¡åªæœ‰ 1 å€‹å¸³è™Ÿä¹Ÿæ²’å¾—é¸ã€‚å¾ˆå¤š"è¼ªæ›ä¸ç”Ÿæ•ˆ/ç²˜æ€§æ²’æ„Ÿè¦º"çš„æ ¹å› éƒ½æ˜¯å¸³è™Ÿå¤ªå°‘ã€‚

**æ“ä½œ**
æ‰“é–‹ã€ŒAccountsã€é é¢ï¼Œç¢ºèªè‡³å°‘æœ‰ 2 å€‹å¸³è™Ÿè™•æ–¼å¯ç”¨ç‹€æ…‹ï¼ˆä¸æ˜¯ disabled / proxy disabledï¼‰ã€‚

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šè‡³å°‘ 2 å€‹å¸³è™Ÿèƒ½æ­£å¸¸åˆ·æ–°é…é¡ï¼Œä¸¦ä¸”åä»£å•Ÿå‹•å¾Œ `active_accounts` ä¸ç‚º 0ã€‚

### ç¬¬ 2 æ­¥ï¼šåœ¨ GUI è£¡é¸æ“‡èª¿åº¦æ¨¡å¼

**ç‚ºä»€éº¼**
èª¿åº¦æ¨¡å¼æ±ºå®šäº†"åŒä¸€æ®µå°è©±"åˆ°åº•æ˜¯ç›¡é‡å¾©ç”¨åŒä¸€å¸³è™Ÿï¼Œé‚„æ˜¯æ¯æ¬¡éƒ½è¼ªè©¢ã€‚

**æ“ä½œ**
é€²å…¥ã€ŒAPI Proxyã€é é¢ï¼Œæ‰¾åˆ° "Account Scheduling & Rotation" å¡ç‰‡ï¼Œé¸æ“‡å…¶ä¸­ä¸€å€‹æ¨¡å¼ï¼š

- `Balance`ï¼šæ¨è–¦é è¨­å€¼ã€‚å¤§å¤šæ•¸æƒ…æ³ä¸‹æ›´ç©©ï¼ˆæœƒè©±ç²˜æ€§ + å¤±æ•—æ™‚è¼ªæ›ï¼‰ã€‚
- `PerformanceFirst`ï¼šä¸¦ç™¼é«˜ã€ä»»å‹™çŸ­ã€ä½ æ›´åœ¨æ„ååè€Œä¸æ˜¯å¿«å–æ™‚é¸å®ƒã€‚
- `CacheFirst`ï¼šå¦‚æœä½ å¸Œæœ›"å°è©±ç›¡é‡å›ºå®šå¸³è™Ÿ"ï¼Œå¯ä»¥é¸å®ƒï¼ˆç•¶å‰å¾Œç«¯èˆ‡ `Balance` çš„è¡Œç‚ºå·®ç•°å¾ˆå°ï¼‰ã€‚

 å¦‚æœä½ è¦æ‰‹å‹•æ”¹è¨­å®šï¼Œå°æ‡‰ç‰‡æ®µæ˜¯ï¼š

```json
{
  "proxy": {
    "scheduling": {
      "mode": "Balance",
      "max_wait_seconds": 60
    }
  }
}
```

 **ä½ æ‡‰è©²çœ‹åˆ°**ï¼šåˆ‡æ›æ¨¡å¼å¾Œæœƒç«‹å³å¯«å…¥ `gui_config.json`ï¼Œåä»£æœå‹™åŸ·è¡Œæ™‚ç›´æ¥ç”Ÿæ•ˆï¼ˆç„¡éœ€é‡å•Ÿï¼‰ã€‚

### ç¬¬ 3 æ­¥ï¼šå•Ÿç”¨"å›ºå®šå¸³è™Ÿæ¨¡å¼"ï¼ˆæŠŠè¼ªæ›é—œæ‰ï¼‰

**ç‚ºä»€éº¼**
æ’éšœã€ç°åº¦ã€æˆ–è€…ä½ æƒ³æŠŠæŸå€‹å¸³è™Ÿ"é‡˜æ­»"çµ¦æŸå€‹å®¢æˆ¶ç«¯ç”¨æ™‚ï¼Œå›ºå®šå¸³è™Ÿæ¨¡å¼æ˜¯æœ€ç›´æ¥çš„æ‰‹æ®µã€‚

**æ“ä½œ**
åœ¨åŒä¸€å¼µå¡ç‰‡è£¡æ‰“é–‹ "Fixed Account Mode"ï¼Œç„¶å¾Œåœ¨ä¸‹æ‹‰æ¡†è£¡é¸æ“‡å¸³è™Ÿã€‚

 åˆ¥å¿˜äº†ï¼šé€™å€‹é–‹é—œåªåœ¨åä»£æœå‹™ Running æ™‚å¯ç”¨ã€‚

 **ä½ æ‡‰è©²çœ‹åˆ°**ï¼šå¾ŒçºŒè«‹æ±‚éƒ½æœƒå„ªå…ˆä½¿ç”¨é€™å€‹å¸³è™Ÿï¼›å¦‚æœå®ƒè¢«é™æµæˆ–è¢«é…é¡ä¿è­·ï¼Œæœƒå›é€€åˆ°è¼ªè©¢ã€‚

 ::: info å›ºå®šå¸³è™Ÿæ˜¯åŸ·è¡Œæ™‚è¨­å®š
 å›ºå®šå¸³è™Ÿæ¨¡å¼æ˜¯**åŸ·è¡Œæ™‚ç‹€æ…‹**ï¼ˆé€é GUI æˆ– API å‹•æ…‹è¨­å®šï¼‰ï¼Œä¸æœƒæŒä¹…åŒ–åˆ° `gui_config.json`ã€‚é‡å•Ÿåä»£æœå‹™å¾Œï¼Œå›ºå®šå¸³è™Ÿæœƒæ¢å¾©ç‚ºç©ºï¼ˆå›åˆ°è¼ªè©¢æ¨¡å¼ï¼‰ã€‚
 :::

### ç¬¬ 4 æ­¥ï¼šéœ€è¦çš„æ™‚å€™æ¸…æ‰"æœƒè©±ç¶å®š"

**ç‚ºä»€éº¼**
ç²˜æ€§æœƒè©±æœƒæŠŠ `session_id -> account_id` è¨˜åœ¨è¨˜æ†¶é«”è£¡ã€‚å¦‚æœä½ åœ¨åŒä¸€å°æ©Ÿå™¨ä¸Šåšä¸åŒå¯¦é©—ï¼ˆæ¯”å¦‚åˆ‡æ›å¸³è™Ÿæ± ã€åˆ‡æ›æ¨¡å¼ï¼‰ï¼ŒèˆŠç¶å®šå¯èƒ½æœƒå¹²æ“¾ä½ è§€å¯Ÿã€‚

**æ“ä½œ**
 åœ¨ "Account Scheduling & Rotation" å¡ç‰‡å³ä¸Šè§’é» "Clear bindings"ã€‚

 **ä½ æ‡‰è©²çœ‹åˆ°**ï¼šèˆŠæœƒè©±æœƒé‡æ–°åˆ†é…å¸³è™Ÿï¼ˆä¸‹ä¸€å€‹è«‹æ±‚æœƒé‡æ–°ç¶å®šï¼‰ã€‚

### ç¬¬ 5 æ­¥ï¼šç”¨å›æ‡‰æ¨™é ­ç¢ºèª"åˆ°åº•æ˜¯å“ªå€‹å¸³è™Ÿåœ¨æœå‹™"

**ç‚ºä»€éº¼**
ä½ æƒ³é©—è­‰èª¿åº¦æ˜¯å¦ç¬¦åˆé æœŸï¼Œæœ€å¯é çš„è¾¦æ³•æ˜¯æ‹¿åˆ°æœå‹™ç«¯è¿”å›çš„"ç•¶å‰å¸³è™Ÿè­˜åˆ¥ç¢¼"ã€‚

**æ“ä½œ**
å° OpenAI ç›¸å®¹ç«¯é»ç™¼ä¸€å€‹éä¸²æµè«‹æ±‚ï¼Œç„¶å¾Œè§€å¯Ÿå›æ‡‰æ¨™é ­è£¡çš„ `X-Account-Email`ã€‚

```bash
  # ä¾‹å­ï¼šæœ€å°åŒ–çš„ OpenAI Chat Completions è«‹æ±‚
  # æ³¨æ„ï¼šmodel å¿…é ˆæ˜¯ä½ ç•¶å‰è¨­å®šè£¡å¯ç”¨/å¯è·¯ç”±çš„æ¨¡å‹å
curl -i "http://127.0.0.1:8045/v1/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-REPLACE_ME" \
  -d '{
    "model": "gemini-3-pro-high",
    "stream": false,
    "messages": [{"role": "user", "content": "hello"}]
  }'
```

 **ä½ æ‡‰è©²çœ‹åˆ°**ï¼šå›æ‡‰æ¨™é ­è£¡å‡ºç¾é¡ä¼¼ä¸‹é¢çš„å…§å®¹ï¼ˆç¤ºä¾‹ï¼‰ï¼š

 ```text
 X-Account-Email: example@gmail.com
 X-Mapped-Model: gemini-3-pro-high
 ```

## æª¢æŸ¥é» âœ…

 - ä½ èƒ½èªªæ¸…æ¥š `fixed account`ã€`sticky session`ã€`round-robin` ä¸‰å€‹æ©Ÿåˆ¶èª°è¦†è“‹èª°
 - ä½ çŸ¥é“ `session_id` æ˜¯æ€éº¼ä¾†çš„ï¼ˆå„ªå…ˆ `metadata.user_id`ï¼Œå¦å‰‡é›œæ¹Šç¬¬ä¸€æ¢ user è¨Šæ¯ï¼‰
 - ä½ é‡åˆ° 429/5xx æ™‚èƒ½é æœŸï¼šç³»çµ±æœƒå…ˆè¨˜éŒ„é™æµï¼Œå†æ›å¸³è™Ÿé‡è©¦
 - ä½ èƒ½ç”¨ `X-Account-Email` é©—è­‰ç•¶å‰è«‹æ±‚åˆ°åº•æ˜¯å“ªå€‹å¸³è™Ÿåœ¨æœå‹™

## è¸©å‘æé†’

 1) **å¸³è™Ÿæ± åªæœ‰ 1 å€‹æ™‚ï¼Œä¸è¦æœŸå¾…"è¼ªæ›èƒ½æ•‘ä½ "**
 è¼ªæ›åªæ˜¯"æ›å¦ä¸€å€‹å¸³è™Ÿ"ï¼Œæ± å­è£¡æ²’ç¬¬äºŒå€‹å¸³è™Ÿæ™‚ï¼Œ429/invalid_grant åªæœƒæ›´é »ç¹æš´éœ²ã€‚

 2) **`CacheFirst` ä¸æ˜¯"æ°¸é ç­‰åˆ°å¯ç”¨"**
 ç•¶å‰å¾Œç«¯èª¿åº¦é‚è¼¯é‡åˆ°é™æµæœƒå‚¾å‘æ–¼è§£ç¶ä¸¦åˆ‡æ›å¸³è™Ÿï¼Œè€Œä¸æ˜¯é•·æœŸé˜»å¡ç­‰å¾…ã€‚

 3) **å›ºå®šå¸³è™Ÿä¸æ˜¯çµ•å°å¼·åˆ¶**
 å¦‚æœå›ºå®šå¸³è™Ÿè¢«æ¨™è¨˜ç‚ºé™æµã€æˆ–è¢«é…é¡ä¿è­·å‘½ä¸­ï¼Œç³»çµ±æœƒå›é€€åˆ°è¼ªè©¢ã€‚

## æœ¬èª²å°çµ

 - èª¿åº¦éˆè·¯ï¼šhandler æå– `session_id` â†’ `TokenManager::get_token` é¸å¸³è™Ÿ â†’ å‡ºéŒ¯æ™‚ `attempt > 0` å¼·åˆ¶è¼ªæ›
 - ä½ æœ€å¸¸ç”¨çš„å…©å€‹é–‹é—œï¼šèª¿åº¦æ¨¡å¼ï¼ˆæ˜¯å¦å•Ÿç”¨ç²˜æ€§/60s å¾©ç”¨ï¼‰+ å›ºå®šå¸³è™Ÿæ¨¡å¼ï¼ˆç›´æ¥æŒ‡å®šå¸³è™Ÿï¼‰
 - 429/5xx æœƒè¢«è¨˜éŒ„æˆ"é™æµç‹€æ…‹"ï¼Œå¾ŒçºŒèª¿åº¦æœƒè·³éè©²å¸³è™Ÿï¼Œç›´åˆ°é–å®šæ™‚é–“éæœŸ

## ä¸‹ä¸€èª²é å‘Š

> ä¸‹ä¸€èª²æˆ‘å€‘çœ‹ **æ¨¡å‹è·¯ç”±**ï¼šç•¶ä½ å¸Œæœ›å°å¤–æš´éœ²"ç©©å®šçš„æ¨¡å‹é›†åˆ"ï¼Œä»¥åŠæƒ³åšè¬ç”¨å­—å…ƒ/é è¨­ç­–ç•¥æ™‚ï¼Œè©²æ€éº¼è¨­å®šèˆ‡æ’æŸ¥ã€‚

---

## é™„éŒ„ï¼šæºç¢¼åƒè€ƒ

<details>
<summary><strong>é»æ“Šå±•é–‹æŸ¥çœ‹æºç¢¼ä½ç½®</strong></summary>

> æ›´æ–°æ™‚é–“ï¼š2026-01-23

| åŠŸèƒ½ | æª”æ¡ˆè·¯å¾‘ | è¡Œè™Ÿ |
| --- | --- | --- |
| èª¿åº¦æ¨¡å¼èˆ‡è¨­å®šçµæ§‹ï¼ˆStickySessionConfigï¼‰ | [`src-tauri/src/proxy/sticky_config.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/sticky_config.rs#L1-L36) | 1-36 |
| æœƒè©±æŒ‡ç´‹ç”Ÿæˆï¼ˆClaude/OpenAI/Geminiï¼‰ | [`src-tauri/src/proxy/session_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/session_manager.rs#L1-L159) | 1-159 |
| TokenManagerï¼šå›ºå®šå¸³è™Ÿæ¨¡å¼æ¬„ä½èˆ‡åˆå§‹åŒ– | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L27-L50) | 27-50 |
| TokenManagerï¼šé¸å¸³è™Ÿæ ¸å¿ƒé‚è¼¯ï¼ˆå›ºå®šå¸³è™Ÿ/ç²˜æ€§æœƒè©±/60s è¦–çª—/è¼ªè©¢/é…é¡ä¿è­·ï¼‰ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L470-L940) | 470-940 |
| TokenManagerï¼šinvalid_grant è‡ªå‹•åœç”¨ä¸¦ç§»å‡ºæ±  | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L868-L878) | 868-878 |
| TokenManagerï¼šé™æµè¨˜éŒ„èˆ‡æˆåŠŸæ¸…ç† API | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L1087-L1147) | 1087-1147 |
| TokenManagerï¼šæ›´æ–°èª¿åº¦è¨­å®š / æ¸…ç†æœƒè©±ç¶å®š / å›ºå®šå¸³è™Ÿæ¨¡å¼ setter | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L1419-L1461) | 1419-1461 |
| ProxyConfigï¼šscheduling æ¬„ä½å®šç¾©èˆ‡é è¨­å€¼ | [`src-tauri/src/proxy/config.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/config.rs#L174-L257) | 174-257 |
| åä»£å•Ÿå‹•æ™‚åŒæ­¥ scheduling è¨­å®š | [`src-tauri/src/commands/proxy.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/commands/proxy.rs#L70-L100) | 70-100 |
| èª¿åº¦ç›¸é—œçš„ Tauri å‘½ä»¤ï¼ˆget/update/clear bindings/fixed accountï¼‰ | [`src-tauri/src/commands/proxy.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/commands/proxy.rs#L478-L551) | 478-551 |
| OpenAI handlerï¼šsession_id + é‡è©¦æ™‚å¼·åˆ¶è¼ªæ› | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L160-L182) | 160-182 |
| OpenAI handlerï¼š429/5xx è¨˜éŒ„é™æµ + è§£æ retry delay | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L349-L367) | 349-367 |
| Gemini handlerï¼šsession_id + é‡è©¦æ™‚å¼·åˆ¶è¼ªæ› | [`src-tauri/src/proxy/handlers/gemini.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/gemini.rs#L62-L88) | 62-88 |
| Gemini handlerï¼š429/5xx è¨˜éŒ„é™æµä¸¦è¼ªæ› | [`src-tauri/src/proxy/handlers/gemini.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/gemini.rs#L279-L299) | 279-299 |
| Claude handlerï¼šæå– session_id ä¸¦å‚³çµ¦ TokenManager | [`src-tauri/src/proxy/handlers/claude.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/claude.rs#L517-L524) | 517-524 |
| 429 retry delay è§£æï¼ˆRetryInfo.retryDelay / quotaResetDelayï¼‰ | [`src-tauri/src/proxy/upstream/retry.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/upstream/retry.rs#L37-L66) | 37-66 |
| é™æµåŸå› è­˜åˆ¥èˆ‡æŒ‡æ•¸é€€é¿ï¼ˆRateLimitTrackerï¼‰ | [`src-tauri/src/proxy/rate_limit.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/rate_limit.rs#L154-L279) | 154-279 |

**é—œéµçµæ§‹é«”**ï¼š
- `StickySessionConfig`ï¼šèª¿åº¦æ¨¡å¼èˆ‡è¨­å®šçµæ§‹ï¼ˆ`mode`, `max_wait_seconds`ï¼‰
- `TokenManager`ï¼šå¸³è™Ÿæ± ã€æœƒè©±ç¶å®šã€å›ºå®šå¸³è™Ÿæ¨¡å¼ã€é™æµè¿½è¹¤å™¨
- `SessionManager`ï¼šå¾è«‹æ±‚ä¸­æå– `session_id`

</details>
