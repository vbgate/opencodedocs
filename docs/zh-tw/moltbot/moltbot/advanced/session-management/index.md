---
title: "æœƒè©±ç®¡ç†ï¼šæœƒè©±éš”é›¢ã€å­ Agent å”ä½œèˆ‡ä¸Šä¸‹æ–‡å£“ç¸® | Clawdbot æ•™ç¨‹"
sidebarTitle: "å¤šç”¨æˆ¶ä¸ä¸²æ“¾"
subtitle: "æœƒè©±ç®¡ç†èˆ‡å¤š Agentï¼šæœƒè©±éš”é›¢ã€å­ Agent å”ä½œå’Œä¸Šä¸‹æ–‡å£“ç¸®"
description: "å­¸ç¿’ Clawdbot çš„æœƒè©±æ¨¡å‹ã€å¤š Agent æœƒè©±éš”é›¢ã€å­ Agent å”ä½œæ©Ÿåˆ¶å’Œä¸Šä¸‹æ–‡å£“ç¸®ç­–ç•¥ã€‚æŒæ¡å¤š Agent ç’°å¢ƒä¸‹çš„æœƒè©±é…ç½®ã€ä¸Šä¸‹æ–‡æ§åˆ¶å’Œæœ€ä½³å¯¦è¸ï¼Œç¢ºä¿é«˜æ•ˆéš”é›¢ä¸åŒç”¨æˆ¶çš„å°è©±æ­·å²å’Œä»»å‹™åŸ·è¡Œã€‚"
tags:
  - "æœƒè©±ç®¡ç†"
  - "å¤š Agent"
  - "ä¸Šä¸‹æ–‡å£“ç¸®"
prerequisite:
  - "start-gateway-startup"
order: 200
---

# æœƒè©±ç®¡ç†èˆ‡å¤š Agentï¼šæœƒè©±éš”é›¢ã€å­ Agent å”ä½œå’Œä¸Šä¸‹æ–‡å£“ç¸®

## å­¸å®Œä½ èƒ½åšä»€éº¼

- ç†è§£ Clawdbot çš„æœƒè©±æ¨¡å‹å’Œæœƒè©±éµçµæ§‹
- é…ç½®ä¸åŒ Agent ä¹‹é–“çš„æœƒè©±éš”é›¢
- ä½¿ç”¨å­ Agent å®Œæˆéš”é›¢ä»»å‹™
- ç®¡ç†ä¸Šä¸‹æ–‡è¦–çª—ï¼Œé¿å…è¶…å‡ºæ¨¡å‹é™åˆ¶
- æŒæ¡æœƒè©±é‡ç½®å’Œå£“ç¸®çš„æœ€ä½³å¯¦è¸

## ä½ ç¾åœ¨çš„å›°å¢ƒ

ç•¶ä½ çš„ AI åŠ©æ‰‹åŒæ™‚æœå‹™æ–¼å¤šå€‹ç”¨æˆ¶ã€å¤šå€‹æ¸ é“æ™‚ï¼Œä½ å¯èƒ½æœƒé‡åˆ°é€™äº›å•é¡Œï¼š

- **æœƒè©±ä¸²æ“¾**ï¼šä¸åŒç”¨æˆ¶çš„è¨Šæ¯æ··åœ¨ä¸€èµ·ï¼ŒAI è¨˜ä¸ä½å„è‡ªçš„æ­·å²
- **ä¸Šä¸‹æ–‡çˆ†ç‚¸**ï¼šé•·æ™‚é–“å°è©±å¾Œï¼Œæ¨¡å‹é–‹å§‹"å¤±æ†¶"æˆ–å›æ‡‰è®Šæ…¢
- **å­ä»»å‹™æ··äº‚**ï¼šä¸» Agent èª¿ç”¨å­ä»»å‹™æ™‚ï¼Œæ²’æœ‰æ¸…æ™°çš„éš”é›¢é‚Šç•Œ
- **è³‡æºæµªè²»**ï¼šæ‰€æœ‰ Agent å…±äº«åŒä¸€å¥—æœƒè©±ï¼Œå°è‡´å„²å­˜å’Œé‹ç®—è³‡æºç„¡æ³•æœ‰æ•ˆåˆ©ç”¨

Clawdbot çš„**æœƒè©±ç®¡ç†ç³»çµ±**å°±æ˜¯ç‚ºäº†è§£æ±ºé€™äº›å•é¡Œè€Œè¨­è¨ˆçš„ã€‚

## æ ¸å¿ƒæ€è·¯

**æœƒè©±**æ˜¯ Clawdbot çš„æ ¸å¿ƒæŠ½è±¡å–®å…ƒâ€”â€”æ¯å€‹æœƒè©±ä»£è¡¨ä¸€æ®µç¨ç«‹çš„å°è©±æ­·å²ï¼Œæ“æœ‰è‡ªå·±çš„è¨Šæ¯è¨˜éŒ„ã€å…ƒè³‡æ–™å’Œç”Ÿå‘½é€±æœŸã€‚

Clawdbot é€é**æœƒè©±éµï¼ˆsession keyï¼‰**ä¾†è­˜åˆ¥å’Œéš”é›¢ä¸åŒçš„æœƒè©±ã€‚æœƒè©±éµä¸åƒ…å€åˆ†ä¸åŒçš„å°è©±ç‰©ä»¶ï¼ˆç”¨æˆ¶ã€ç¾¤çµ„ã€é »é“ï¼‰ï¼Œé‚„å€åˆ†ä¸åŒçš„ Agent å¯¦ä¾‹ã€‚

::: info ä»€éº¼æ˜¯æœƒè©±éµï¼Ÿ

æœƒè©±éµæ˜¯ä¸€å€‹å­—ä¸²è­˜åˆ¥ç¬¦ï¼Œç”¨æ–¼å”¯ä¸€è­˜åˆ¥ä¸€å€‹æœƒè©±ã€‚æ ¼å¼ç¯„ä¾‹ï¼š
- `agent:main:main`ï¼ˆä¸» Agent çš„ä¸»æœƒè©±ï¼‰
- `agent:work:main`ï¼ˆå·¥ä½œ Agent çš„ä¸»æœƒè©±ï¼‰
- `agent:main:whatsapp:group:123`ï¼ˆWhatsApp ç¾¤çµ„æœƒè©±ï¼‰
- `cron:job-id`ï¼ˆå®šæ™‚ä»»å‹™æœƒè©±ï¼‰

Clawdbot æ ¹æ“šæœƒè©±éµå°‡è¨Šæ¯è·¯ç”±åˆ°æ­£ç¢ºçš„ Agentï¼Œä¸¦ç¶­è­·ç¨ç«‹çš„å°è©±æ­·å²ã€‚
:::

## æœƒè©±æ¨¡å‹

### æœƒè©±éµçš„çµ„æˆ

Clawdbot ä½¿ç”¨çµæ§‹åŒ–çš„æœƒè©±éµä¾†è­˜åˆ¥ä¸åŒé¡å‹çš„æœƒè©±ï¼š

| æœƒè©±é¡å‹ | éµæ ¼å¼ | ç¯„ä¾‹ | èªªæ˜ |
|--- | --- | --- | ---|
| **ä¸»æœƒè©±** | `agent:<agentId>:<mainKey>` | `agent:main:main` | æ¯å€‹ Agent çš„é è¨­ä¸»æœƒè©± |
| **ç›´æ¥è¨Šæ¯** | `agent:<agentId>:dm:<peerId>` | `agent:main:dm:+15551234567` | æŒ‰ `dmScope` è¨­å®šéš”é›¢ |
| **ç¾¤çµ„/é »é“** | `agent:<agentId>:<channel>:group:<id>` | `agent:main:whatsapp:group:123` | ç¾¤çµ„å’Œé »é“è‡ªå‹•éš”é›¢ |
| **å­ Agent** | `agent:<agentId>:subagent:<uuid>` | `agent:main:subagent:a1b2c3d4` | å­ Agent çš„éš”é›¢æœƒè©± |
| **å®šæ™‚ä»»å‹™** | `cron:<jobId>` | `cron:daily-report` | Cron ä»»å‹™çš„å°ˆç”¨æœƒè©± |
| **Webhook** | `hook:<uuid>` | `hook:xyz789` | Webhook è§¸ç™¼çš„æœƒè©± |

### æœƒè©±å„²å­˜

æœƒè©±è³‡æ–™å„²å­˜åœ¨å…©å€‹ä½ç½®ï¼š

```bash
# æœƒè©±ç´¢å¼•ï¼ˆå…ƒè³‡æ–™ï¼‰
~/.clawdbot/agents/<agentId>/sessions/sessions.json

# è¨Šæ¯æ­·å²ï¼ˆæ¯æœƒè©±ä¸€å€‹æª”æ¡ˆï¼‰
~/.clawdbot/agents/<agentId>/sessions/<sessionId>.jsonl
```

**sessions.json** æ˜¯ä¸€å€‹å°æ‡‰è¡¨ï¼Œè¨˜éŒ„ï¼š
- æœƒè©±éµ â†’ æœƒè©±å…ƒè³‡æ–™ï¼ˆsessionId, updatedAt, model, tokens ç­‰ï¼‰
- åˆªé™¤é€™äº›æ¢ç›®æ˜¯å®‰å…¨çš„ï¼Œå®ƒå€‘æœƒåœ¨éœ€è¦æ™‚è‡ªå‹•é‡å»º

**JSONL æª”æ¡ˆ**å„²å­˜å®Œæ•´çš„å°è©±æ­·å²ï¼Œæ¯è¡Œä¸€æ¢è¨Šæ¯è¨˜éŒ„ã€‚

::: tip Gateway æ˜¯å–®ä¸€çœŸç›¸æº

æ‰€æœ‰æœƒè©±ç‹€æ…‹ç”± Gateway æ“æœ‰ã€‚UI ç”¨æˆ¶ç«¯ï¼ˆmacOS æ‡‰ç”¨ç¨‹å¼ã€WebChatï¼‰å¿…é ˆå¾ Gateway æŸ¥è©¢æœƒè©±åˆ—è¡¨å’Œ token è¨ˆæ•¸ï¼Œè€Œä¸æ˜¯ç›´æ¥è®€å–æœ¬åœ°æª”æ¡ˆã€‚

åœ¨é ç«¯æ¨¡å¼ä¸‹ï¼Œä½ é—œå¿ƒçš„æœƒè©±å„²å­˜åœ¨é ç«¯ Gateway ä¸»æ©Ÿä¸Šï¼Œè€Œä¸æ˜¯ä½ çš„ Mac ä¸Šã€‚
:::

## æœƒè©±éš”é›¢æ©Ÿåˆ¶

### å–® Agent æ¨¡å¼ï¼ˆé è¨­ï¼‰

å¦‚æœä¸åšä»»ä½•è¨­å®šï¼ŒClawdbot åŸ·è¡Œå–®å€‹ Agentï¼š
- `agentId` é è¨­ç‚º `main`
- æ‰€æœ‰ DM æœƒè©±å…±äº«ä¸»æœƒè©±éµï¼ˆ`agent:main:main`ï¼‰
- é€™æ„å‘³è‘—**åŒä¸€å€‹ç”¨æˆ¶å¾ä¸åŒæ¸ é“ç™¼ä¾†çš„è¨Šæ¯æœƒé€²å…¥åŒä¸€å€‹æœƒè©±**

### å¤š Agent æ¨¡å¼

**å¤šå€‹ Agent = å¤šå€‹éš”é›¢çš„å¤§è…¦**

æ¯å€‹ Agent æ“æœ‰è‡ªå·±ç¨ç«‹çš„ï¼š
- **Workspace**ï¼ˆå·¥ä½œå€æª”æ¡ˆã€AGENTS.mdã€SOUL.mdï¼‰
- **State directory**ï¼ˆèªè­‰è¨­å®šã€æ¨¡å‹ç™»éŒ„æª”ï¼‰
- **Session store**ï¼ˆèŠå¤©æ­·å²å’Œè·¯ç”±ç‹€æ…‹ï¼‰

#### ç‚ºä»€éº¼è¦å¤š Agentï¼Ÿ

| å ´æ™¯ | è§£æ±ºæ–¹æ¡ˆ |
|--- | ---|
| **å¤šç”¨æˆ¶å…±äº«ä¼ºæœå™¨** | æ¯å€‹ç”¨æˆ¶æœ‰ç¨ç«‹ Agentï¼Œæœƒè©±å®Œå…¨éš”é›¢ |
| **ä¸åŒæ¸ é“ä¸åŒäººæ ¼** | WhatsApp ç”¨æ—¥å¸¸ Agentï¼ŒTelegram ç”¨æ·±åº¦å·¥ä½œ Agent |
| **æ¬Šé™åˆ†é›¢** | å®¶åº­ Agent é™åˆ¶å·¥å…·ï¼Œå€‹äºº Agent å®Œå…¨å­˜å– |
| **ä¸åŒç’°å¢ƒ** | é–‹ç™¼ Agentã€ç”Ÿç”¢ Agent å®Œå…¨éš”é›¢ |

#### è¨­å®šå¤š Agent

**ç¬¬ 1 æ­¥ï¼šæ–°å¢æ–° Agent**

```bash
clawdbot agents add work
```

é€™æœƒåœ¨ `~/.clawdbot/agents/work/` å»ºç«‹æ–°çš„ Agent ç›®éŒ„ã€‚

**ç¬¬ 2 æ­¥ï¼šè¨­å®šè·¯ç”±è¦å‰‡**

åœ¨ `~/.clawdbot/clawdbot.json` ä¸­æ–°å¢ `bindings`ï¼š

```json5
{
  agents: {
    list: [
      { id: "home", workspace: "~/clawd-home", name: "Home" },
      { id: "work", workspace: "~/clawd-work", name: "Work" }
    ]
  },
  bindings: [
    { agentId: "home", match: { channel: "whatsapp", accountId: "personal" } },
    { agentId: "work", match: { channel: "whatsapp", accountId: "biz" } }
  ]
}
```

**ç¬¬ 3 æ­¥ï¼šé©—è­‰è¨­å®š**

```bash
clawdbot agents list --bindings
```

#### è·¯ç”±è¦å‰‡ï¼ˆç¢ºå®šæ€§åŒ¹é…ï¼‰

ç•¶è¨Šæ¯åˆ°é”æ™‚ï¼ŒClawdbot æŒ‰**æœ€å…·é«”å„ªå…ˆ**çš„é †åºåŒ¹é…è¦å‰‡ï¼š

1. **peer** åŒ¹é…ï¼ˆç²¾ç¢ºçš„ DM/group/channel idï¼‰
2. **guildId**ï¼ˆDiscordï¼‰
3. **teamId**ï¼ˆSlackï¼‰
4. **accountId** åŒ¹é…
5. æ¸ é“å±¤ç´šåŒ¹é…ï¼ˆ`accountId: "*"`ï¼‰
6. å›é€€åˆ°é è¨­ Agent

::: warning æ³¨æ„ç¶å®šé †åº

ç¶å®šåˆ—è¡¨ä¸­çš„é †åºå¾ˆé‡è¦ï¼æ›´å…·é«”çš„è¦å‰‡æ‡‰è©²æ”¾åœ¨å‰é¢ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³å°‡ä¸€å€‹ç‰¹å®š DM è·¯ç”±åˆ° `work` Agentï¼Œå…¶ä»– WhatsApp DM è·¯ç”±åˆ° `home` Agentï¼Œå¿…é ˆå…ˆå¯« peer è¦å‰‡ï¼š
```json5
{
  bindings: [
    { agentId: "work", match: { channel: "whatsapp", peer: { kind: "dm", id: "+15551234567" } } },
    { agentId: "home", match: { channel: "whatsapp" } }
  ]
}
```
:::

### DM ç¯„åœæ§åˆ¶

ä½¿ç”¨ `session.dmScope` æ§åˆ¶ç›´æ¥è¨Šæ¯å¦‚ä½•åˆ†çµ„ï¼š

| é¸é … | è¡Œç‚º | é©ç”¨å ´æ™¯ |
|--- | --- | ---|
| `main`ï¼ˆé è¨­ï¼‰ | æ‰€æœ‰ DM å…±äº«ä¸»æœƒè©± | å–®ç”¨æˆ¶å¤šæ¸ é“ |
| `per-peer` | æŒ‰ç™¼é€è€… ID éš”é›¢ | å¤šç”¨æˆ¶ç’°å¢ƒ |
| `per-channel-peer` | æŒ‰æ¸ é“ + ç™¼é€è€…éš”é›¢ | å…±ç”¨æ”¶ä»¶åŒ£ |

è¨­å®šç¯„ä¾‹ï¼š

```json5
{
  session: {
    dmScope: "per-channel-peer"  // æ¯å€‹æ¸ é“çš„æ¯å€‹ç”¨æˆ¶ç¨ç«‹æœƒè©±
  }
}
```

### èº«ä»½é€£çµï¼ˆIdentity Linksï¼‰

å¦‚æœåŒä¸€å€‹ç”¨æˆ¶ä½¿ç”¨å¤šå€‹å¹³å°ï¼ˆå¦‚ WhatsApp å’Œ Telegramï¼‰ï¼Œä½ å¯ä»¥é€é `session.identityLinks` è®“ä»–å€‘å…±äº«æœƒè©±ï¼š

```json5
{
  session: {
    identityLinks: {
      alice: ["telegram:123456789", "discord:987654321012345678"]
    }
  }
}
```

é€™æ¨£ï¼ŒAlice å¾ Telegram æˆ– Discord ç™¼ä¾†çš„è¨Šæ¯éƒ½æœƒé€²å…¥ `agent:<agentId>:dm:alice` æœƒè©±ã€‚

## å­ Agent å”ä½œ

### ä»€éº¼æ˜¯å­ Agent

**å­ Agent**æ˜¯ä¸€å€‹åœ¨éš”é›¢æœƒè©±ä¸­åŸ·è¡Œçš„ Agent å¯¦ä¾‹ï¼Œç”¨æ–¼åŸ·è¡Œç‰¹å®šä»»å‹™è€Œä¸å½±éŸ¿ä¸»æœƒè©±çš„ä¸Šä¸‹æ–‡ã€‚

å…¸å‹ä½¿ç”¨å ´æ™¯ï¼š
- **ç¨‹å¼ç¢¼å¯©æŸ¥**ï¼šå­ Agent åˆ†æç¨‹å¼ç¢¼ï¼Œè¿”å›æ‘˜è¦
- **è³‡æ–™æå–**ï¼šå­ Agent å¾é•·æ–‡ä»¶ä¸­æå–è³‡è¨Š
- **å¹³è¡Œä»»å‹™**ï¼šä¸» Agent ç­‰å¾…æ™‚ï¼Œå­ Agent åœ¨èƒŒæ™¯åŸ·è¡Œ
- **æ²™ç®±éš”é›¢**ï¼šåœ¨å—é™ç’°å¢ƒä¸­åŸ·è¡Œä¸ä¿¡ä»»çš„ä»»å‹™

### sessions_spawn å·¥å…·

ä½¿ç”¨ `sessions_spawn` å·¥å…·å»ºç«‹å­ Agentï¼š

```json
{
  "task": "åˆ†æé€™å€‹æ–‡ä»¶ä¸¦æå–é—œéµè¦é»",
  "label": "æ–‡ä»¶åˆ†æ",
  "model": "anthropic/claude-opus-4-5",
  "thinking": "detailed",
  "runTimeoutSeconds": 300,
  "cleanup": "keep"
}
```

åƒæ•¸èªªæ˜ï¼š

| åƒæ•¸ | é¡å‹ | å¿…å¡« | èªªæ˜ |
|--- | --- | --- | ---|
| `task` | string | âœ… | å­ Agent çš„ä»»å‹™æè¿° |
| `label` | string | âŒ | å¯è®€çš„ä»»å‹™æ¨™ç±¤ï¼ˆç”¨æ–¼è¿½è¹¤ï¼‰ |
| `agentId` | string | âŒ | ç›®æ¨™ Agent IDï¼ˆé è¨­ç•¶å‰ Agentï¼‰ |
| `model` | string | âŒ | æ¨¡å‹è¦†è“‹ |
| `thinking` | string | âŒ | æ€è€ƒç­‰ç´šï¼ˆ`minimal`/`standard`/`detailed`ï¼‰ |
| `runTimeoutSeconds` | number | âŒ | é€¾æ™‚æ™‚é–“ï¼ˆç§’ï¼‰ |
| `cleanup` | string | âŒ | ä»»å‹™å®Œæˆå¾Œæ¸…ç†ç­–ç•¥ï¼ˆ`keep`/`delete`ï¼‰ |

### å­ Agent ç”Ÿå‘½é€±æœŸ

```mermaid
sequenceDiagram
    participant Main as ä¸» Agent
    participant Tool as sessions_spawn
    participant Gateway
    participant Sub as å­ Agent

    Main->>Tool: å‘¼å« sessions_spawn
    Tool->>Gateway: 1. é©—è­‰æ¬Šé™ï¼ˆagentToAgentï¼‰
    Tool->>Gateway: 2. å»ºç«‹å­æœƒè©±ï¼ˆsubagent:uuidï¼‰
    Tool->>Sub: 3. å‚³é€ä»»å‹™
    Sub->>Sub: 4. åŸ·è¡Œä»»å‹™
    Sub->>Main: 5. å‚³å›çµæœ
    Main->>Tool: 6. æ±ºå®šä¿ç•™æˆ–åˆªé™¤å­æœƒè©±
```

**ç”Ÿå‘½é€±æœŸæ­¥é©Ÿ**ï¼š

1. **æ¬Šé™æª¢æŸ¥**ï¼šå¦‚æœè·¨ Agent å‘¼å«ï¼Œé©—è­‰ `tools.agentToAgent.allow` è¨­å®š
2. **å»ºç«‹å­æœƒè©±**ï¼šç”¢ç”Ÿå”¯ä¸€çš„ `agent:<agentId>:subagent:<uuid>` éµ
3. **åŸ·è¡Œä»»å‹™**ï¼šå­ Agent åœ¨éš”é›¢æœƒè©±ä¸­å®Œæˆä»»å‹™
4. **å‚³å›çµæœ**ï¼šçµæœæµå¼å‚³å›åˆ°ä¸» Agent
5. **æ¸…ç†ç­–ç•¥**ï¼š
   - `cleanup: "keep"`ï¼šä¿ç•™å­æœƒè©±ç”¨æ–¼å¾ŒçºŒæª¢æŸ¥
   - `cleanup: "delete"`ï¼šè‡ªå‹•åˆªé™¤å­æœƒè©±

### è¨­å®š Agent é–“é€šè¨Š

é è¨­æƒ…æ³ä¸‹ï¼ŒAgent é–“é€šè¨Šæ˜¯åœç”¨çš„ã€‚éœ€è¦æ˜ç¢ºå•Ÿç”¨ï¼š

```json5
{
  tools: {
    agentToAgent: {
      enabled: true,
      allow: ["home", "work", "family"]
    }
  }
}
```

æ¬Šé™èªªæ˜ï¼š
- `enabled: false`ï¼šå®Œå…¨åœç”¨ Agent é–“é€šè¨Š
- `allow: ["*"]`ï¼šå…è¨±ä»»ä½• Agent
- `allow: ["home", "work"]`ï¼šåªå…è¨±ç‰¹å®š Agent

::: danger å®‰å…¨æé†’

å­ Agent ç¹¼æ‰¿çˆ¶ Agent çš„éƒ¨åˆ†ä¸Šä¸‹æ–‡ï¼Œä½†**ä¸æœƒ**ç²å¾—å®Œæ•´çš„çˆ¶æœƒè©±æ­·å²ã€‚é€™æ—¢æ˜¯ç‰¹æ€§ï¼ˆç¯€çœ tokenï¼‰ï¼Œä¹Ÿæ˜¯é™åˆ¶ï¼ˆå­ Agent ä¸çŸ¥é“å®Œæ•´ä¸Šä¸‹æ–‡ï¼‰ã€‚

å°æ–¼æ•æ„Ÿæ“ä½œï¼Œè€ƒæ…®åœ¨ä¸»æœƒè©±ä¸­å®Œæˆè€Œä¸æ˜¯é€éå­ Agentã€‚
:::

## ä¸Šä¸‹æ–‡å£“ç¸®

### ä»€éº¼æ˜¯ä¸Šä¸‹æ–‡è¦–çª—

æ¯å€‹ AI æ¨¡å‹éƒ½æœ‰ä¸€å€‹**ä¸Šä¸‹æ–‡è¦–çª—ï¼ˆcontext windowï¼‰**â€”â€”å®ƒèƒ½åœ¨ä¸€æ¬¡æ¨ç†ä¸­çœ‹åˆ°çš„æœ€å¤§ token æ•¸é‡ã€‚

é•·æ™‚é–“å°è©±æœƒç´¯ç©è¨Šæ¯å’Œå·¥å…·çµæœã€‚ä¸€æ—¦æ¥è¿‘æ¨¡å‹é™åˆ¶ï¼ŒClawdbot æœƒ**å£“ç¸®ï¼ˆcompactï¼‰**æ­·å²ä»¥é¨°å‡ºç©ºé–“ã€‚

### è‡ªå‹•å£“ç¸®

ç•¶æœƒè©±æ¥è¿‘æˆ–è¶…å‡ºä¸Šä¸‹æ–‡è¦–çª—æ™‚ï¼ŒClawdbot è‡ªå‹•è§¸ç™¼å£“ç¸®ï¼š

- **å£“ç¸®å‰**ï¼šå…ˆåŸ·è¡Œä¸€å€‹**éœé»˜è¨˜æ†¶åˆ·æ–°**ï¼Œæç¤ºæ¨¡å‹å°‡æŒä¹…åŒ–ç­†è¨˜å¯«å…¥ç£ç¢Ÿï¼ˆå¦‚æœå·¥ä½œå€å¯å¯«ï¼‰
- **å£“ç¸®éç¨‹**ï¼šå°‡èˆŠå°è©±ç¸½çµç‚ºå£“ç¸®æ‘˜è¦ï¼Œä¿ç•™æœ€è¿‘çš„è¨Šæ¯
- **æŒä¹…åŒ–**ï¼šå£“ç¸®çµæœå¯«å…¥ JSONL æ­·å²æª”æ¡ˆ
- **é‡è©¦**ï¼šä½¿ç”¨å£“ç¸®å¾Œçš„ä¸Šä¸‹æ–‡é‡è©¦åŸå§‹è«‹æ±‚

ä½ æœƒçœ‹åˆ°ï¼š
- `ğŸ§¹ Auto-compaction complete`ï¼ˆåœ¨è©³ç´°æ¨¡å¼ä¸‹ï¼‰
- `/status` é¡¯ç¤º `ğŸ§¹ Compactions: <count>`

### æ‰‹å‹•å£“ç¸®

ä½¿ç”¨ `/compact` æŒ‡ä»¤æ‰‹å‹•è§¸ç™¼å£“ç¸®ï¼š

```
/compact
```

ä½ å¯ä»¥æ–°å¢å£“ç¸®æŒ‡ä»¤ï¼š

```
/compact Focus on decisions and open questions
```

é€™æœƒæŒ‡å° AI åœ¨ç¸½çµæ™‚é—œæ³¨ç‰¹å®šå…§å®¹ã€‚

### å£“ç¸® vs å‰ªæ

| æ“ä½œ | ä½œç”¨ | æŒä¹…åŒ– | ä½ç½® |
|--- | --- | --- | ---|
| **å£“ç¸®ï¼ˆCompactionï¼‰** | ç¸½çµèˆŠå°è©± | âœ… | å¯«å…¥ JSONL |
| **å‰ªæï¼ˆPruningï¼‰** | ç§»é™¤èˆŠå·¥å…·çµæœ | âŒ | åƒ…è¨˜æ†¶é«”ä¸­ |

::: tip å£“ç¸®ç­–ç•¥å»ºè­°

- **å£“ç¸®**ï¼šå„²å­˜è³‡è¨Šæ‘˜è¦ï¼Œé©åˆéœ€è¦å›é¡§æ­·å²
- **å‰ªæ**ï¼šæš«æ™‚æ¸…ç†ï¼Œé©åˆæ¸›å°‘å–®æ¬¡è«‹æ±‚çš„ token ä½¿ç”¨
- **/new**ï¼šå®Œå…¨æ¸…ç©ºæœƒè©±ï¼Œç”¨æ–¼é–‹å§‹æ–°ä¸»é¡Œ

æ ¹æ“šä½ çš„ä½¿ç”¨ç¿’æ…£é¸æ“‡åˆé©çš„ç­–ç•¥ã€‚
:::

### å£“ç¸®è¨­å®š

åœ¨ `~/.clawdbot/clawdbot.json` ä¸­è¨­å®šå£“ç¸®è¡Œç‚ºï¼š

```json5
{
  agents: {
    defaults: {
      compaction: {
        enabled: true,
        threshold: 0.9,  // ä¸Šä¸‹æ–‡ä½¿ç”¨ 90% æ™‚è§¸ç™¼
        trigger: "auto"  // auto/manual
      }
    }
  }
}
```

## è·Ÿæˆ‘åšï¼šè¨­å®šæœƒè©±ç®¡ç†

è®“æˆ‘å€‘é€éä¸€å€‹å¯¦éš›å ´æ™¯ä¾†è¨­å®šæœƒè©±ç®¡ç†ã€‚

### å ´æ™¯

ä½ æœ‰ä¸€å€‹ WhatsApp è™Ÿç¢¼ï¼Œå¸Œæœ›ï¼š
1. å€‹äººè¯çµ¡äººä½¿ç”¨ `home` Agentï¼ˆæ—¥å¸¸å°è©±ï¼‰
2. å·¥ä½œç¾¤çµ„ä½¿ç”¨ `work` Agentï¼ˆå°ˆæ¥­å›æ‡‰ï¼‰
3. å•Ÿç”¨å­ Agent ç”¨æ–¼éš”é›¢ä»»å‹™

### ç¬¬ 1 æ­¥ï¼šæ–°å¢å…©å€‹ Agent

```bash
# æ–°å¢å®¶åº­ Agent
clawdbot agents add home

# æ–°å¢å·¥ä½œ Agent
clawdbot agents add work
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šæç¤ºä½ è¼¸å…¥å·¥ä½œå€è·¯å¾‘ç­‰è³‡è¨Šã€‚

### ç¬¬ 2 æ­¥ï¼šç·¨è¼¯è¨­å®šæª”

é–‹å•Ÿ `~/.clawdbot/clawdbot.json`ï¼Œæ–°å¢ Agent åˆ—è¡¨å’Œç¶å®šè¦å‰‡ï¼š

```json5
{
  agents: {
    list: [
      {
        id: "home",
        name: "Home",
        workspace: "~/clawd-home",
        model: "anthropic/claude-sonnet-4-5"
      },
      {
        id: "work",
        name: "Work",
        workspace: "~/clawd-work",
        model: "anthropic/claude-opus-4-5"
      }
    ]
  },
  bindings: [
    // å€‹äººè¨Šæ¯è·¯ç”±åˆ° home Agent
    { agentId: "home", match: { channel: "whatsapp", peer: { kind: "dm", id: "+15551230001" } } },
    // å·¥ä½œç¾¤çµ„è·¯ç”±åˆ° work Agent
    { agentId: "work", match: { channel: "whatsapp", peer: { kind: "group", id: "120363999999999999@g.us" } } },
    // å…¶ä»– WhatsApp è¨Šæ¯è·¯ç”±åˆ° home Agentï¼ˆé è¨­ï¼‰
    { agentId: "home", match: { channel: "whatsapp" } }
  ],
  tools: {
    agentToAgent: {
      enabled: true,
      allow: ["home", "work"]
    }
  }
}
```

### ç¬¬ 3 æ­¥ï¼šé‡æ–°å•Ÿå‹• Gateway

```bash
clawdbot gateway restart
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šGateway å•Ÿå‹•æ—¥èªŒï¼Œé¡¯ç¤ºå·²è¼‰å…¥çš„ Agent å’Œç¶å®šè¦å‰‡ã€‚

### ç¬¬ 4 æ­¥ï¼šæ¸¬è©¦å­ Agent å‘¼å«

åœ¨ `home` Agent çš„æœƒè©±ä¸­å‚³é€ï¼š

```
è«‹ç”¨å­ Agent åˆ†æé€™å€‹ PDF æ–‡ä»¶ä¸¦æå–é—œéµè³‡è¨Šï¼š/path/to/file.pdf
```

Agent æ‡‰è©²è‡ªå‹•å‘¼å« `sessions_spawn` å·¥å…·ï¼Œä½ æœƒçœ‹åˆ°ï¼š
- å­ Agent å»ºç«‹é€šçŸ¥
- ä»»å‹™åŸ·è¡Œéç¨‹
- çµæœå‚³å›

### ç¬¬ 5 æ­¥ï¼šæª¢æŸ¥æœƒè©±ç‹€æ…‹

åœ¨èŠå¤©ä¸­å‚³é€ï¼š

```
/status
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼š
- ç•¶å‰æœƒè©±çš„ token ä½¿ç”¨æƒ…æ³
- å£“ç¸®æ¬¡æ•¸
- æ¨¡å‹è³‡è¨Š

## æª¢æŸ¥é» âœ…

å®Œæˆè¨­å®šå¾Œï¼Œé©—è­‰ä»¥ä¸‹å¹¾é»ï¼š

- [ ] `clawdbot agents list --bindings` é¡¯ç¤ºæ­£ç¢ºçš„ç¶å®šè¦å‰‡
- [ ] å€‹äºº DM è·¯ç”±åˆ° `home` Agent
- [ ] å·¥ä½œç¾¤çµ„è·¯ç”±åˆ° `work` Agent
- [ ] å­ Agent å‘¼å«æ­£å¸¸é‹ä½œ
- [ ] `/status` é¡¯ç¤ºæ­£ç¢ºçš„æœƒè©±è³‡è¨Š

## è¸©å‘æé†’

### å¸¸è¦‹éŒ¯èª¤

| éŒ¯èª¤ | åŸå›  | è§£æ±ºæ–¹æ³• |
|--- | --- | ---|
| **Agent é–“å‘¼å«è¢«ç¦æ­¢** | `tools.agentToAgent.enabled` æœªå•Ÿç”¨æˆ– `allow` åˆ—è¡¨ä¸åŒ…å«ç›®æ¨™ Agent | æª¢æŸ¥è¨­å®šï¼Œç¢ºä¿å·²å•Ÿç”¨ä¸¦æ–°å¢å…è¨±åˆ—è¡¨ |
| **å­ Agent å»ºç«‹å¤±æ•—** | è·¨ Agent å‘¼å«æ™‚ï¼Œç›®æ¨™ Agent ä¸åœ¨å…è¨±åˆ—è¡¨ä¸­ | æª¢æŸ¥ `tools.agentToAgent.allow` è¨­å®š |
| **æœƒè©±éµè¡çª** | ç¶å®šè¦å‰‡é †åºéŒ¯èª¤ï¼Œæ›´å…·é«”çš„è¦å‰‡è¢«è¦†è“‹ | å°‡ peer è¦å‰‡æ”¾åœ¨æ¸ é“è¦å‰‡ä¹‹å‰ |
| **å£“ç¸®å¤±æ•—** | ä¸Šä¸‹æ–‡éå°æˆ–æ¨¡å‹ä¸æ”¯æ´å£“ç¸® | æª¢æŸ¥æ¨¡å‹ä¸Šä¸‹æ–‡è¦–çª—å’Œå£“ç¸®è¨­å®š |

### è¨­å®šå»ºè­°

- **å¾ç°¡å–®é–‹å§‹**ï¼šå…ˆç”¨å–® Agent æ¸¬è©¦ï¼Œç¢ºèªåŠŸèƒ½æ­£å¸¸å¾Œå†æ–°å¢å¤š Agent
- **ä½¿ç”¨æ¨™ç±¤**ï¼šçµ¦å­ Agent ä»»å‹™æ–°å¢æ¸…æ™°çš„ `label`ï¼Œæ–¹ä¾¿è¿½è¹¤
- **ç›£æ§ token ä½¿ç”¨**ï¼šå®šæœŸæª¢æŸ¥ `/status`ï¼Œäº†è§£ä¸Šä¸‹æ–‡ä½¿ç”¨æƒ…æ³
- **å‚™ä»½è¨­å®š**ï¼šä¿®æ”¹ `clawdbot.json` å‰å…ˆå‚™ä»½

## æœ¬èª²å°çµ

æœ¬èª²ä»‹ç´¹äº† Clawdbot çš„æœƒè©±ç®¡ç†ç³»çµ±ï¼š

- **æœƒè©±æ¨¡å‹**ï¼šæœƒè©±éµã€å„²å­˜ä½ç½®ã€ç”Ÿå‘½é€±æœŸ
- **æœƒè©±éš”é›¢**ï¼šå¤š Agent æ¨¡å¼ã€DM ç¯„åœæ§åˆ¶ã€èº«ä»½é€£çµ
- **å­ Agent å”ä½œ**ï¼š`sessions_spawn` å·¥å…·ã€æ¬Šé™æ§åˆ¶ã€æ¸…ç†ç­–ç•¥
- **ä¸Šä¸‹æ–‡å£“ç¸®**ï¼šè‡ªå‹•/æ‰‹å‹•å£“ç¸®ã€å£“ç¸® vs å‰ªæ

é€éåˆç†è¨­å®šæœƒè©±ç®¡ç†ï¼Œä½ å¯ä»¥è®“ Clawdbot åŒæ™‚æœå‹™å¤šå€‹ç”¨æˆ¶å’Œå ´æ™¯ï¼Œæ¯å€‹éƒ½æœ‰è‡ªå·±çš„éš”é›¢ä¸Šä¸‹æ–‡å’Œæ­·å²ã€‚

## ä¸‹ä¸€èª²é å‘Š

> ä¸‹ä¸€èª²æˆ‘å€‘å­¸ç¿’ **[ç€è¦½å™¨è‡ªå‹•åŒ–å·¥å…·](../tools-browser/)**ã€‚
>
> ä½ æœƒå­¸åˆ°ï¼š
> - å¦‚ä½•è¨­å®šå’Œä½¿ç”¨ç€è¦½å™¨å·¥å…·
> - ç€è¦½å™¨è‡ªå‹•åŒ–çš„å®‰å…¨é™åˆ¶
> - æˆªåœ–å’Œè¡¨å–®æ“ä½œ

---

## é™„éŒ„ï¼šåŸå§‹ç¢¼åƒè€ƒ

<details>
<summary><strong>é»æ“Šå±•é–‹æŸ¥çœ‹åŸå§‹ç¢¼ä½ç½®</strong></summary>

> æ›´æ–°æ™‚é–“ï¼š2026-01-27

| åŠŸèƒ½ | æª”æ¡ˆè·¯å¾‘ | è¡Œè™Ÿ |
|--- | --- | ---|
| æœƒè©±éµè§£æ | [`src/routing/session-key.ts`](https://github.com/moltbot/moltbot/blob/main/src/routing/session-key.ts) | 1-100 |
| æœƒè©±è¨­å®š Schema | [`src/config/zod-schema.session.ts`](https://github.com/moltbot/moltbot/blob/main/src/config/zod-schema.session.ts) | 11-83 |
| å­ Agent ç”¢ç”Ÿå·¥å…· | [`src/agents/tools/sessions-spawn-tool.ts`](https://github.com/moltbot/moltbot/blob/main/src/agents/tools/sessions-spawn-tool.ts) | 28-269 |
| æœƒè©±å·¥å…·è¼”åŠ©å‡½æ•¸ | [`src/agents/tools/sessions-helpers.ts`](https://github.com/moltbot/moltbot/blob/main/src/agents/tools/sessions-helpers.ts) | 1-328 |
| æœƒè©±ç®¡ç†æ–‡ä»¶ | [`docs/concepts/session.md`](https://github.com/moltbot/moltbot/blob/main/docs/concepts/session.md) | 1-151 |
| å¤š Agent è·¯ç”±æ–‡ä»¶ | [`docs/concepts/multi-agent.md`](https://github.com/moltbot/moltbot/blob/main/docs/concepts/multi-agent.md) | 1-355 |
| ä¸Šä¸‹æ–‡å£“ç¸®æ–‡ä»¶ | [`docs/concepts/compaction.md`](https://github.com/moltbot/moltbot/blob/main/docs/concepts/compaction.md) | 1-50 |

**é—œéµå¸¸æ•¸**ï¼š
- `SESSION_ID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i`ï¼šæœƒè©± ID æ­£è¦è¡¨ç¤ºå¼ï¼ˆ`sessions-helpers.ts:96`ï¼‰

**é—œéµé¡å‹**ï¼š
- `SessionKind = "main" | "group" | "cron" | "hook" | "node" | "other"`ï¼šæœƒè©±é¡å‹æšèˆ‰ï¼ˆ`sessions-helpers.ts:11`ï¼‰
- `SessionListRow`ï¼šæœƒè©±åˆ—è¡¨è¡Œçµæ§‹ï¼ˆ`sessions-helpers.ts:19-41`ï¼‰

**é—œéµå‡½æ•¸**ï¼š
- `createSessionsSpawnTool()`ï¼šå»ºç«‹å­ Agent ç”¢ç”Ÿå·¥å…·ï¼ˆ`sessions-spawn-tool.ts:60-269`ï¼‰
- `resolveSessionReference()`ï¼šè§£ææœƒè©±åƒè€ƒï¼ˆ`sessions-helpers.ts:215-253`ï¼‰
- `classifySessionKind()`ï¼šåˆ†é¡æœƒè©±é¡å‹ï¼ˆ`sessions-helpers.ts:255-271`ï¼‰
- `createAgentToAgentPolicy()`ï¼šå»ºç«‹ Agent é–“é€šè¨Šç­–ç•¥ï¼ˆ`sessions-helpers.ts:72-94`ï¼‰

</details>
