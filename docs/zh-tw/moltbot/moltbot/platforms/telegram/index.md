---
title: "Telegram é »é“è¨­å®šèˆ‡ä½¿ç”¨ | Clawdbot æ•™å­¸"
sidebarTitle: "5 åˆ†é˜é€£ä¸Š Telegram"
subtitle: "Telegram é »é“è¨­å®šèˆ‡ä½¿ç”¨"
description: "å­¸ç¿’å¦‚ä½•åœ¨ Clawdbot ä¸­è¨­å®šå’Œä½¿ç”¨ Telegram é »é“,åŒ…æ‹¬ Bot Token å–å¾—ã€åŸºç¤è¨­å®šã€DM å’Œç¾¤çµ„å­˜å–æ§åˆ¶ã€Webhook è¨­å®šç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚æœ¬æ•™å­¸æ¶µè“‹å¾å»ºç«‹ Telegram Bot åˆ°é€²éšåŠŸèƒ½è¨­å®šçš„å®Œæ•´æµç¨‹ã€‚"
tags:
  - "platforms"
  - "telegram"
  - "channels"
prerequisite:
  - "start-getting-started"
order: 80
---

# Telegram é »é“è¨­å®šèˆ‡ä½¿ç”¨

## å­¸å®Œä½ èƒ½åšä»€éº¼

- ğŸ¤– åœ¨ Telegram ä¸­å»ºç«‹ Bot ä¸¦å–å¾— Bot Token
- âš™ï¸ è¨­å®š Telegram é »é“é€£æ¥åˆ° Clawdbot
- ğŸ”’ æ§åˆ¶ DM å’Œç¾¤çµ„çš„å­˜å–æ¬Šé™(é…å°æ©Ÿåˆ¶å’Œç™½åå–®)
- ğŸ“¡ è¨­å®šç¾¤çµ„æåŠè¦å‰‡å’Œå›æ‡‰ç­–ç•¥
- ğŸ”Œ è¨­å®š Webhook æ¨¡å¼(å¯é¸)
- ğŸ¯ ä½¿ç”¨ Telegram Bot API ç‰¹æ€§(å…§è¯æŒ‰éˆ•ã€ä¸»é¡Œã€å›è¦†)

## ä½ ç¾åœ¨çš„å›°å¢ƒ

ä½ å·²ç¶“åœ¨ Telegram ä¸Šä½¿ç”¨ Clawdbot,ä½†é‡åˆ°äº†é€™äº›å•é¡Œ:

- âŒ ä¸æ¸…æ¥šå¦‚ä½•æ­£ç¢ºè¨­å®š Bot Token
- âŒ é™Œç”Ÿäººçµ¦ Bot ç™¼è¨Šæ¯å¾Œ,Bot æ²’æœ‰å›æ‡‰
- âŒ åœ¨ç¾¤çµ„ä¸­,Bot ä¸å›æ‡‰éæåŠè¨Šæ¯
- âŒ æƒ³è¦ç²¾ç´°æ§åˆ¶èª°èƒ½å­˜å– Bot,ä½†ä¸çŸ¥é“å¦‚ä½•è¨­å®š
- âŒ è½èªªé Webhook å’Œ Long-polling çš„å€åˆ¥,ä¸çŸ¥é“é¸å“ªå€‹

é€™æ•™å­¸æœƒå¹«ä½ ä¸€æ­¥æ­¥è§£æ±ºé€™äº›å•é¡Œã€‚

## ä»€éº¼æ™‚å€™ç”¨é€™ä¸€æ‹›

é©åˆä½¿ç”¨ Telegram é »é“çš„å ´æ™¯:

- âœ… ä½ å·²ç¶“åœ¨ä½¿ç”¨ Telegram,å¸Œæœ›åœ¨é€™å€‹å¹³å°èˆ‡ AI åŠ©æ‰‹å°è©±
- âœ… ä½ éœ€è¦ Bot åœ¨ç¾¤çµ„ä¸­å›æ‡‰ç‰¹å®šä½¿ç”¨è€…æˆ–æŒ‡ä»¤
- âœ… ä½ å¸Œæœ›ä½¿ç”¨ Telegram Bot API çš„ç‰¹æ®ŠåŠŸèƒ½(å…§è¯æŒ‰éˆ•ã€Forum ä¸»é¡Œ)
- âœ… ä½ çš„ä¼ºæœå™¨ç¶²è·¯ç’°å¢ƒé©åˆä½¿ç”¨ Long-polling æˆ– Webhook

**å¦‚æœä¸»è¦ä½¿ç”¨ WhatsApp æˆ–å…¶ä»–é »é“**:é€™èª²å¯ä»¥è·³é,å°ˆæ³¨æ–¼ä½ ä½¿ç”¨çš„é »é“ã€‚

## ğŸ’ é–‹å§‹å‰çš„æº–å‚™

åœ¨é–‹å§‹ä¹‹å‰,ç¢ºä¿ä½ å·²ç¶“:

- [ ] å®Œæˆäº† [å¿«é€Ÿé–‹å§‹](../../start/getting-started/) æ•™å­¸,Clawdbot å·²å®‰è£ä¸¦å¯ä»¥å•Ÿå‹•
- [ ] æœ‰ä¸€å€‹ Telegram å¸³æˆ¶(ä¸éœ€è¦æ˜¯ Premium ä½¿ç”¨è€…)
- [ ] äº†è§£åŸºæœ¬çš„ Telegram Bot æ¦‚å¿µ(Botã€Tokenã€éš±ç§æ¨¡å¼)

::: info è¨­å®šæª”ä½ç½®
é è¨­æƒ…æ³ä¸‹,Clawdbot çš„è¨­å®šæª”ä½æ–¼:
- **Linux/macOS**: `~/.clawdbot/clawdbot.json`
- **Windows**: `%USERPROFILE%\.clawdbot\clawdbot.json`
:::

## æ ¸å¿ƒæ€è·¯

### Telegram Bot API vs å…¶ä»–é »é“

èˆ‡å…¶ä»–å³æ™‚é€šè¨Šå¹³å°ä¸åŒ,Telegram ä½¿ç”¨**Bot API** æ¶æ§‹:

| ç‰¹æ€§ | Telegram | WhatsApp | Slack |
|--- | --- | --- | ---|
| é€£ç·šæ–¹å¼ | Bot API(HTTP) | Web Client | Bot API + WebSocket |
| è¨Šæ¯æ¨¡å¼ | æ¨é€(Bot ä¸»å‹•ç™¼é€) | æ‹‰å–(ç›£è½ Web Client) | æ‹‰å–(ç›£è½ WebSocket) |
| éš±ç§æ¨¡å¼ | **æ”¯æ´**(Bot å¯é¸æ“‡) | N/A | N/A |
| ç¾¤çµ„æ”¯æ´ | SuperGroup + Forum | Groups | Channels + Workspace |
| ç‰¹æ®ŠåŠŸèƒ½ | Forum ä¸»é¡Œã€å…§è¯æŒ‰éˆ• | - | - |

### Clawdbot çš„æ•´åˆæ–¹å¼

Clawdbot ä½¿ç”¨ [grammY](https://grammy.dev/) Bot API æ¡†æ¶æ•´åˆ Telegram:

```mermaid
graph LR
    A[ä½¿ç”¨è€…è¨Šæ¯] --> B[Telegram Bot API]
    B --> C[grammY æ¡†æ¶]
    C --> D[Clawdbot Gateway]
    D --> E[Agent è™•ç†]
    E --> D
    D --> F[å›æ‡‰ç™¼é€]
    F --> B
    B --> G[ä½¿ç”¨è€…æ”¶åˆ°å›è¦†]
```

**é—œéµé»**:
- **Long-polling**:é è¨­æ¨¡å¼,Clawdbot ä¸»å‹•æ‹‰å– Telegram æ›´æ–°
- **Webhook**:å¯é¸æ¨¡å¼,Telegram æ¨é€æ›´æ–°åˆ°ä½ çš„ä¼ºæœå™¨
- **DM é…å°**:é è¨­å•Ÿç”¨,é™Œç”Ÿäººéœ€è¦å…ˆé…å°æ‰èƒ½ç™¼é€è¨Šæ¯
- **ç¾¤çµ„æåŠ**:é è¨­å•Ÿç”¨,Bot åªå›æ‡‰ `@botname` æˆ–è¨­å®šçš„æåŠæ¨¡å¼

### å­˜å–æ§åˆ¶æ©Ÿåˆ¶

Clawdbot æä¾›ä¸‰å±¤å­˜å–æ§åˆ¶:

1. **DM å±¤é¢**(`dmPolicy`)
   - `pairing`:é™Œç”Ÿä½¿ç”¨è€…æ”¶åˆ°é…å°ç¢¼,å¿…é ˆå…ˆæ‰¹å‡†
   - `allowlist`:åªå…è¨±ç™½åå–®ä¸­çš„ä½¿ç”¨è€…
   - `open`:å…è¨±æ‰€æœ‰ DM(éœ€è¨­å®š `allowFrom: ["*"]`)

2. **ç¾¤çµ„å±¤é¢**(`groups` + `groupPolicy`)
   - åˆ—å‡ºå“ªäº›ç¾¤çµ„å¯ä»¥å­˜å– Bot
   - è¨­å®šæ¯å€‹ç¾¤çµ„çš„ `requireMention` è¦å‰‡

3. **ç™¼é€è€…å±¤é¢**(`allowFrom` + `groupAllowFrom`)
   - åœ¨å·²å…è¨±çš„ DM/ç¾¤çµ„ä¸­,é€²ä¸€æ­¥é™åˆ¶èª°å¯ä»¥ç™¼é€è¨Šæ¯

::: warning å®‰å…¨é è¨­
é è¨­ DM ç­–ç•¥æ˜¯ `pairing`,é€™æ˜¯æœ€å®‰å…¨çš„é è¨­å€¼ã€‚é™Œç”Ÿäººç™¼é€çš„è¨Šæ¯æœƒè¢«å¿½ç•¥,ç›´åˆ°ä½ æ‰¹å‡†é…å°ç¢¼ã€‚
:::

## è·Ÿæˆ‘åš

### ç¬¬ 1 æ­¥:å»ºç«‹ Telegram Bot ä¸¦å–å¾— Token

**ç‚ºä»€éº¼**
Telegram Bot éœ€è¦ Bot Token æ‰èƒ½é€é Bot API å­˜å–å’Œç™¼é€è¨Šæ¯ã€‚é€™å€‹ Token ç›¸ç•¶æ–¼ Bot çš„ã€Œèº«åˆ†æ†‘è­‰ã€ã€‚

**æ“ä½œ**

1. åœ¨ Telegram ä¸­æœå°‹ä¸¦é–‹å•Ÿ **@BotFather**
2. ç™¼é€æŒ‡ä»¤ `/newbot`
3. æŒ‰ç…§æç¤ºæ“ä½œ:
   - è¼¸å…¥ Bot åç¨±(ä¾‹å¦‚:`My Clawdbot Assistant`)
   - è¼¸å…¥ Bot ä½¿ç”¨è€…åç¨±(å¿…é ˆä»¥ `bot` çµå°¾,ä¾‹å¦‚:`my_clawdbot_bot`)
4. BotFather æœƒè¿”å› Bot Token,æ ¼å¼å¦‚:`123456:ABC-DEF123456`

**ä½ æ‡‰è©²çœ‹åˆ°**:
```
Done! Congratulations on your new bot.

You can find it at t.me/my_clawdbot_bot. You can now add a description,
about section and profile picture for it, see /help for a list of commands.

Use this token to access the HTTP API:
123456:ABC-DEF1234567890

Keep your token secure and store it safely, it can be used by anyone
to control your bot.
```

::: tip å®‰å…¨å»ºè­°
- ğŸ” ç«‹å³å°‡ Token è¤‡è£½ä¸¦å„²å­˜åˆ°å®‰å…¨çš„åœ°æ–¹(å¦‚å¯†ç¢¼ç®¡ç†å™¨)
- âš ï¸ **çµ•ä¸è¦**åœ¨å…¬é–‹å„²å­˜åº«ã€ç¤¾ç¾¤åª’é«”æˆ–èˆ‡ä»–äººåˆ†äº« Token
- ğŸ”„ å¦‚æœ Token å¤–æ´©,ç«‹å³åœ¨ @BotFather ä¸­ä½¿ç”¨ `/revoke` æŒ‡ä»¤æ’¤éŠ·
:::

**å¯é¸ BotFather è¨­å®š**(æ¨è–¦)

1. è¨­å®šç¾¤çµ„æ¬Šé™:
   - `/setjoingroups` â†’ é¸æ“‡æ˜¯å¦å…è¨± Bot è¢«æ–°å¢åˆ°ç¾¤çµ„
   - `/setprivacy` â†’ æ§åˆ¶æ˜¯å¦çœ‹åˆ°æ‰€æœ‰ç¾¤çµ„è¨Šæ¯

2. è¨­å®š Bot è³‡è¨Š:
   - `/setdescription` â†’ æ–°å¢æè¿°
   - `/setabouttext` â†’ æ–°å¢é—œæ–¼æ–‡å­—
   - `/setuserpic` â†’ ä¸Šå‚³é ­åƒ

### ç¬¬ 2 æ­¥:è¨­å®š Telegram é »é“

**ç‚ºä»€éº¼**
è¨­å®šæª”å‘Šè¨´ Clawdbot å¦‚ä½•é€£æ¥åˆ° Telegram Bot API,ä»¥åŠå¦‚ä½•è™•ç†è¨Šæ¯å’Œæ¬Šé™ã€‚

**æ“ä½œ**

å»ºç«‹æˆ–ç·¨è¼¯ `~/.clawdbot/clawdbot.json`:

```json5
{
  "channels": {
    "telegram": {
      "enabled": true,
      "botToken": "123456:ABC-DEF1234567890",
      "dmPolicy": "pairing"
    }
  }
}
```

**è¨­å®šæ¬„ä½èªªæ˜**:

| æ¬„ä½ | é¡å‹ | é è¨­å€¼ | èªªæ˜ |
|--- | --- | --- | ---|
| `enabled` | boolean | `true` | æ˜¯å¦å•Ÿå‹• Telegram é »é“ |
| `botToken` | string | - | Bot Token(å¿…éœ€) |
| `dmPolicy` | string | `"pairing"` | DM å­˜å–ç­–ç•¥ |
| `allowFrom` | array | `[]` | DM ç™½åå–®(ä½¿ç”¨è€… ID æˆ– @ä½¿ç”¨è€…åç¨±) |
| `groupPolicy` | string | `"allowlist"` | ç¾¤çµ„å­˜å–ç­–ç•¥ |
| `groupAllowFrom` | array | `[]` | ç¾¤çµ„ç™¼é€è€…ç™½åå–® |
| `groups` | object | `{}` | ç¾¤çµ„è©³ç´°è¨­å®š |

**ç’°å¢ƒè®Šæ•¸æ–¹å¼**(å¯é¸)

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç’°å¢ƒè®Šæ•¸(é©ç”¨æ–¼é è¨­å¸³æˆ¶):

```bash
export TELEGRAM_BOT_TOKEN="123456:ABC-DEF1234567890"
```

::: tip ç’°å¢ƒè®Šæ•¸å„ªå…ˆé †åº
å¦‚æœåŒæ™‚è¨­å®šäº†ç’°å¢ƒè®Šæ•¸å’Œè¨­å®šæª”:
- **è¨­å®šæª”å„ªå…ˆ**(`channels.telegram.botToken`)
- ç’°å¢ƒè®Šæ•¸ä½œç‚º**é è¨­å¸³æˆ¶çš„å¾Œå‚™**
:::

### ç¬¬ 3 æ­¥:å•Ÿå‹• Gateway ä¸¦é©—è­‰é€£ç·š

**ç‚ºä»€éº¼**
å•Ÿå‹• Gateway è®“å®ƒæ ¹æ“šè¨­å®šé€£æ¥åˆ° Telegram Bot API,ä¸¦é–‹å§‹ç›£è½è¨Šæ¯ã€‚

**æ“ä½œ**

1. åœ¨çµ‚ç«¯æ©Ÿä¸­å•Ÿå‹• Gateway:

```bash
# æ–¹å¼ 1:ç›´æ¥å•Ÿå‹•
clawdbot gateway --verbose

# æ–¹å¼ 2:ä½¿ç”¨å®ˆè­·ç¨‹åº
clawdbot gateway --port 18789 --verbose
```

2. è§€å¯Ÿ Gateway çš„å•Ÿå‹•æ—¥èªŒ,å°‹æ‰¾ Telegram ç›¸é—œè³‡è¨Š

**ä½ æ‡‰è©²çœ‹åˆ°**:
```
[INFO] Starting Gateway...
[INFO] Loading config from ~/.clawdbot/clawdbot.json
[INFO] Starting channels...
[INFO] Starting Telegram channel...
[INFO] Telegram bot connected: @my_clawdbot_bot
[INFO] Listening for updates (long-polling)...
```

::: tip æŸ¥çœ‹è©³ç´°æ—¥èªŒ
ä½¿ç”¨ `--verbose` æ¨™èªŒå¯ä»¥çœ‹åˆ°æ›´è©³ç´°çš„æ—¥èªŒ,åŒ…æ‹¬:
- æ¥æ”¶åˆ°çš„æ¯æ¢è¨Šæ¯
- æœƒè©±è·¯ç”±æ±ºç­–
- æ¬Šé™æª¢æŸ¥çµæœ
:::

**æª¢æŸ¥é» âœ…**

- [ ] Gateway æˆåŠŸå•Ÿå‹•ä¸”æ²’æœ‰å ±éŒ¯
- [ ] æ—¥èªŒé¡¯ç¤º "Telegram bot connected"
- [ ] æ²’æœ‰å‡ºç¾ "Authentication failed" æˆ– "Invalid token" éŒ¯èª¤

### ç¬¬ 4 æ­¥:åœ¨ Telegram ä¸­æ¸¬è©¦ Bot

**ç‚ºä»€éº¼**
ç™¼é€ç¬¬ä¸€æ¢è¨Šæ¯é©—è­‰ Bot æ­£ç¢ºé€£ç·šã€è¨­å®šç”Ÿæ•ˆã€å¯ä»¥æ¥æ”¶å’Œå›è¦†è¨Šæ¯ã€‚

**æ“ä½œ**

1. åœ¨ Telegram ä¸­æœå°‹ä½ çš„ Bot ä½¿ç”¨è€…åç¨±(å¦‚ `@my_clawdbot_bot`)
2. é»æ“Š "Start" æŒ‰éˆ•æˆ–ç™¼é€ `/start` æŒ‡ä»¤
3. å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ DM è¯çµ¡,ä½ æ‡‰è©²æ”¶åˆ°é…å°ç¢¼

**ä½ æ‡‰è©²çœ‹åˆ°**:
```
ğŸ‘‹ Hi! I'm your Clawdbot assistant.

To get started, please approve this pairing code:
CLAW-ABC123

Run this command in your terminal:
clawdbot pairing approve telegram CLAW-ABC123
```

**å¦‚æœ Bot æ²’æœ‰å›æ‡‰**:

| å•é¡Œ | å¯èƒ½åŸå›  | è§£æ±ºæ–¹æ³• |
|--- | --- | ---|
| Bot ç„¡å›æ‡‰ | Bot Token éŒ¯èª¤ | æª¢æŸ¥ `clawdbot.json` ä¸­çš„ `botToken` å€¼ |
| Bot ç„¡å›æ‡‰ | Gateway æœªå•Ÿå‹• | åŸ·è¡Œ `clawdbot gateway --verbose` æŸ¥çœ‹éŒ¯èª¤ |
| Bot ç„¡å›æ‡‰ | ç¶²è·¯å•é¡Œ | æª¢æŸ¥ä¼ºæœå™¨æ˜¯å¦èƒ½å­˜å– `api.telegram.org` |
| Bot ç„¡å›æ‡‰ | Bot è¢«å°é– | åœ¨ @BotFather ä¸­æª¢æŸ¥ Bot ç‹€æ…‹ |

### ç¬¬ 5 æ­¥:æ‰¹å‡† DM é…å°(å¦‚æœé©ç”¨)

**ç‚ºä»€éº¼**
é è¨­ DM ç­–ç•¥æ˜¯ `pairing`,é™Œç”Ÿäººéœ€è¦ä½ æ‰¹å‡†å¾Œæ‰èƒ½ç™¼é€è¨Šæ¯çµ¦ Botã€‚é€™ä¿è­‰äº†å®‰å…¨æ€§ã€‚

**æ“ä½œ**

1. åœ¨çµ‚ç«¯æ©Ÿä¸­åŸ·è¡Œé…å°æŒ‡ä»¤:

```bash
# æŸ¥çœ‹å¾…æ‰¹å‡†çš„é…å°
clawdbot pairing list telegram

# æ‰¹å‡†é…å°ç¢¼
clawdbot pairing approve telegram CLAW-ABC123
```

2. é…å°æˆåŠŸå¾Œ,ä½¿ç”¨è€…å¯ä»¥æ­£å¸¸ç™¼é€è¨Šæ¯çµ¦ Bot

**ä½ æ‡‰è©²çœ‹åˆ°**:
```
âœ… Pairing approved: telegram:user:123456789

User @username can now send messages to the bot.
```

::: tip é…å°ç¢¼éæœŸ
é…å°ç¢¼åœ¨ 1 å°æ™‚å¾ŒéæœŸã€‚ä½¿ç”¨è€…éœ€è¦é‡æ–°ç™¼é€ `/start` æŒ‡ä»¤å–å¾—æ–°ç¢¼ã€‚
:::

## ç¾¤çµ„è¨­å®š

### å–å¾—ç¾¤çµ„ Chat ID

è¦è¨­å®šç¾¤çµ„å­˜å–æ§åˆ¶,é¦–å…ˆéœ€è¦çŸ¥é“ç¾¤çµ„çš„ Chat IDã€‚

**æ–¹æ³• 1:ä½¿ç”¨ç¬¬ä¸‰æ–¹ Bot(å¿«é€Ÿä½†ä¸æ¨è–¦)**

1. å°‡ä½ çš„ Bot æ–°å¢åˆ°ç¾¤çµ„
2. åœ¨ç¾¤çµ„ä¸­è½‰ç™¼ä»»æ„è¨Šæ¯åˆ° `@userinfobot`
3. Bot æœƒè¿”å›ç¾¤çµ„è³‡è¨Š,åŒ…æ‹¬ Chat ID

**æ–¹æ³• 2:ä½¿ç”¨ Gateway æ—¥èªŒ(æ¨è–¦)**

1. åœ¨ç¾¤çµ„ä¸­ç™¼é€ä»»æ„è¨Šæ¯çµ¦ Bot
2. åŸ·è¡Œ:

```bash
clawdbot logs --follow
```

3. åœ¨æ—¥èªŒä¸­å°‹æ‰¾ `chat.id` æ¬„ä½,ç¾¤çµ„ ID é€šå¸¸æ˜¯è² æ•¸(å¦‚ `-1001234567890`)

**ä½ æ‡‰è©²çœ‹åˆ°**:
```
[INFO] Received message from chat: -1001234567890
```

### è¨­å®šç¾¤çµ„å­˜å–

**æ–¹å¼ 1:å…è¨±æ‰€æœ‰ç¾¤çµ„**

```json5
{
  "channels": {
    "telegram": {
      "groups": {
        "*": {
          "requireMention": true
        }
      }
    }
  }
}
```

**æ–¹å¼ 2:åƒ…å…è¨±ç‰¹å®šç¾¤çµ„**

```json5
{
  "channels": {
    "telegram": {
      "groups": {
        "-1001234567890": {
          "requireMention": false
        },
        "-1009876543210": {
          "requireMention": true
        }
      }
    }
  }
}
```

**æ–¹å¼ 3:ç¾¤çµ„ä¸­å§‹çµ‚å›æ‡‰(ä¸è¦æ±‚æåŠ)**

```json5
{
  "channels": {
    "telegram": {
      "groups": {
        "-1001234567890": {
          "requireMention": false
        }
      }
    }
  }
}
```

### Telegram éš±ç§æ¨¡å¼è¨­å®š

å¦‚æœç¾¤çµ„ä¸­ Bot **ä¸å›æ‡‰éæåŠè¨Šæ¯**,å¯èƒ½æ˜¯éš±ç§æ¨¡å¼é™åˆ¶ã€‚

**æª¢æŸ¥æ­¥é©Ÿ**:

1. åœ¨ @BotFather ä¸­åŸ·è¡Œ `/setprivacy`
2. é¸æ“‡ **Disable**(é—œé–‰éš±ç§æ¨¡å¼)
3. **é‡è¦**:Telegram è¦æ±‚ä½ å¾ç¾¤çµ„ä¸­ç§»é™¤ä¸¦é‡æ–°æ–°å¢ Bot,è¨­å®šæ‰æœƒç”Ÿæ•ˆ
4. é‡æ–°æ–°å¢ Bot åˆ°ç¾¤çµ„

::: warning éš±ç§æ¨¡å¼å½±éŸ¿
- âœ… **éš±ç§æ¨¡å¼ OFF**:Bot å¯ä»¥çœ‹åˆ°æ‰€æœ‰ç¾¤çµ„è¨Šæ¯(éœ€è¦ `requireMention: false` æ‰æœƒå›æ‡‰æ‰€æœ‰è¨Šæ¯)
- âš ï¸ **éš±ç§æ¨¡å¼ ON**:Bot åªçœ‹åˆ° @æåŠ æˆ– Bot è¢«å›è¦†çš„è¨Šæ¯(é è¨­)
- ğŸ›¡ï¸ **Bot æ˜¯ç®¡ç†å“¡**:ç®¡ç†å“¡ Bot å¯ä»¥çœ‹åˆ°æ‰€æœ‰è¨Šæ¯,ç„¡è«–éš±ç§æ¨¡å¼å¦‚ä½•
:::

### æœƒè©±å…§ç¾¤çµ„å•Ÿç”¨

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æŒ‡ä»¤å‹•æ…‹åˆ‡æ›ç¾¤çµ„å›æ‡‰è¡Œç‚º(æœƒè©±å±¤ç´š,é‡å•Ÿå¾Œå¤±æ•ˆ):

- `/activation always` â€” ç¾¤çµ„ä¸­å›æ‡‰æ‰€æœ‰è¨Šæ¯
- `/activation mention` â€” åªå›æ‡‰æåŠ(é è¨­)

::: tip æ¨è–¦ä½¿ç”¨è¨­å®š
ç‚ºäº†æŒä¹…åŒ–è¡Œç‚º,æ¨è–¦åœ¨ `clawdbot.json` ä¸­è¨­å®š `groups.requireMention`,è€Œä¸æ˜¯ä¾è³´æŒ‡ä»¤ã€‚
:::

## é€²éšè¨­å®š

### Webhook æ¨¡å¼(å¯é¸)

é è¨­ä½¿ç”¨ **Long-polling**(ä¸»å‹•æ‹‰å–æ›´æ–°)ã€‚å¦‚æœä½ æœ‰å…¬é–‹ä¼ºæœå™¨,å¯ä»¥ä½¿ç”¨ Webhook æ¨¡å¼ã€‚

**è¨­å®š Webhook**:

```json5
{
  "channels": {
    "telegram": {
      "webhookUrl": "https://your-domain.com/telegram-webhook",
      "webhookSecret": "your-secret-token"
    }
  }
}
```

**Webhook vs Long-polling**:

| ç‰¹æ€§ | Long-polling | Webhook |
|--- | --- | ---|
| ç¶²è·¯è¦æ±‚ | éœ€è¦ä¸»å‹•å­˜å– `api.telegram.org` | éœ€è¦å…¬é–‹ HTTPS ç«¯é» |
| å»¶é² | ~1-3 ç§’è¼ªè©¢é–“éš” | è¿‘ä¹å³æ™‚æ¨é€ |
| ä¼ºæœå™¨è³‡æº | è¼ƒé«˜(æŒçºŒè¼ªè©¢) | è¼ƒä½(è¢«å‹•æ¥æ”¶) |
| é©ç”¨å ´æ™¯ | å®¶ç”¨ä¼ºæœå™¨ã€ç„¡å…¬é–‹ IP | VPSã€æœ‰ç¶²åŸŸåç¨± |

::: tip æœ¬åœ° Webhook æ¸¬è©¦
å¦‚æœä½ æƒ³åœ¨æœ¬åœ°æ¸¬è©¦ Webhook:
- ä½¿ç”¨ `ngrok` æˆ– `localtunnel` å»ºç«‹è‡¨æ™‚é€šé“
- å°‡é€šé“ URL è¨­å®šç‚º `webhookUrl`
- Gateway æœƒåœ¨ `0.0.0.0:8787` ç›£è½ `/telegram-webhook`
:::

### åª’é«”å¤§å°é™åˆ¶

æ§åˆ¶ Telegram ä¸­ç™¼é€å’Œæ¥æ”¶çš„åª’é«”æª”æ¡ˆå¤§å°:

```json5
{
  "channels": {
    "telegram": {
      "mediaMaxMb": 10
    }
  }
}
```

- é è¨­:5MB
- è¶…å‡ºé™åˆ¶çš„åª’é«”æœƒè¢«æ‹’çµ•

### è¨Šæ¯åˆ†å¡Šè¨­å®š

Telegram å°å–®æ¢è¨Šæ¯çš„æ–‡å­—é•·åº¦æœ‰é™åˆ¶(ç´„ 4096 å­—å…ƒ)ã€‚Clawdbot æœƒè‡ªå‹•åˆ†å¡Šé•·è¨Šæ¯ã€‚

```json5
{
  "channels": {
    "telegram": {
      "textChunkLimit": 4000,
      "chunkMode": "length"
    }
  }
}
```

**åˆ†å¡Šæ¨¡å¼**:

- `"length"`:æŒ‰å­—å…ƒæ•¸åˆ†å¡Š(é è¨­)
- `"newline"`:å…ˆæŒ‰ç©ºè¡Œåˆ†å‰²(ä¿ç•™æ®µè½),å†æŒ‰é•·åº¦åˆ†å¡Š

### Forum ä¸»é¡Œæ”¯æ´

Telegram Forum è¶…ç´šç¾¤æ”¯æ´ä¸»é¡Œã€‚Clawdbot æœƒç‚ºæ¯å€‹ä¸»é¡Œå»ºç«‹ç¨ç«‹æœƒè©±ã€‚

```json5
{
  "channels": {
    "telegram": {
      "groups": {
        "-1001234567890": {
          "topics": {
            "12345": {
              "requireMention": false,
              "systemPrompt": "You are a specialist in this topic."
            }
          }
        }
      }
    }
  }
}
```

**ä¸»é¡Œæœƒè©±é‡‘é‘°æ ¼å¼**:
```
agent:main:telegram:group:-1001234567890:topic:12345
```

### å…§è¯æŒ‰éˆ•

Telegram æ”¯æ´äº’å‹•å¼æŒ‰éˆ•(Inline Buttons)ã€‚

**å•Ÿç”¨æŒ‰éˆ•**:

```json5
{
  "channels": {
    "telegram": {
      "capabilities": {
        "inlineButtons": "allowlist"
      }
    }
  }
}
```

**æŒ‰éˆ•ä½œç”¨åŸŸ**:

- `"off"`:åœç”¨æŒ‰éˆ•
- `"dm"`:åƒ…åœ¨ DM ä¸­å…è¨±
- `"group"`:åƒ…åœ¨ç¾¤çµ„ä¸­å…è¨±
- `"all"`:DM + ç¾¤çµ„
- `"allowlist"`:DM + ç¾¤çµ„,ä½†åªå…è¨± `allowFrom` ä¸­çš„ç™¼é€è€…

**é€é Agent ç™¼é€æŒ‰éˆ•**:

ä½¿ç”¨ `telegram` å·¥å…·çš„ `sendMessage` æ“ä½œ:

```json5
{
  "action": "send",
  "channel": "telegram",
  "to": "123456789",
  "message": "Choose an option:",
  "buttons": [
    [
      {"text": "Yes", "callback_data": "yes"},
      {"text": "No", "callback_data": "no"}
    ],
    [
      {"text": "Cancel", "callback_data": "cancel"}
    ]
  ]
}
```

**æŒ‰éˆ•å›å‘¼è™•ç†**:

ç•¶ä½¿ç”¨è€…é»æ“ŠæŒ‰éˆ•æ™‚,Agent æœƒæ”¶åˆ°æ ¼å¼å¦‚ `callback_data: value` çš„è¨Šæ¯ã€‚

### åæ‡‰é€šçŸ¥

æ§åˆ¶ Agent æ˜¯å¦æ¥æ”¶ä½¿ç”¨è€…å°è¨Šæ¯çš„åæ‡‰(emoji)ã€‚

```json5
{
  "channels": {
    "telegram": {
      "reactionNotifications": "all",
      "reactionLevel": "minimal"
    }
  }
}
```

**åæ‡‰é€šçŸ¥æ¨¡å¼**:

- `"off"`:å¿½ç•¥æ‰€æœ‰åæ‡‰
- `"own"`:åªé€šçŸ¥ä½¿ç”¨è€…å° Bot è¨Šæ¯çš„åæ‡‰(é è¨­)
- `"all"`:é€šçŸ¥æ‰€æœ‰åæ‡‰

**Agent åæ‡‰å±¤ç´š**:

- `"off"`:Agent ä¸èƒ½ç™¼é€åæ‡‰
- `"ack"`:è™•ç†æ™‚ç™¼é€ç¢ºèªåæ‡‰ ğŸ‘€
- `"minimal"`:è¬¹æ…ä½¿ç”¨åæ‡‰(æ¯ 5-10 æ¬¡äº¤æ› 1 æ¬¡,é è¨­)
- `"extensive"`:è‡ªç”±ä½¿ç”¨åæ‡‰

## è¸©å‘æé†’

### å¸¸è¦‹è¨­å®šéŒ¯èª¤

| éŒ¯èª¤ | ç—‡ç‹€ | åŸå›  | è§£æ±ºæ–¹æ³• |
|--- | --- | --- | ---|
| Token æ ¼å¼éŒ¯èª¤ | "Invalid token" éŒ¯èª¤ | è¤‡è£½äº†ä¸å®Œæ•´çš„ Token | æª¢æŸ¥ Token æ˜¯å¦å®Œæ•´(åŒ…å«å†’è™Ÿ) |
| ç’°å¢ƒè®Šæ•¸è¡çª | Bot ä½¿ç”¨ä¸åŒçš„ Token | ç’°å¢ƒè®Šæ•¸è¦†è“‹äº†è¨­å®šæª” | å„ªå…ˆä½¿ç”¨ `channels.telegram.botToken` |
| ç¾¤çµ„ç„¡å›æ‡‰ | Bot ä¸è™•ç†ç¾¤çµ„è¨Šæ¯ | éš±ç§æ¨¡å¼æœªé—œé–‰ | åœ¨ @BotFather ä¸­åŸ·è¡Œ `/setprivacy` |
| Webhook å¤±æ•— | "Webhook setup failed" | URL ç„¡æ³•å­˜å–æˆ– HTTPS ä¸æ­£ç¢º | æª¢æŸ¥ä¼ºæœå™¨å’Œæ†‘è­‰ |

### ç¶²è·¯å•é¡Œ

**IPv6 è·¯ç”±å•é¡Œ**:

ä¸€äº›ä¼ºæœå™¨å„ªå…ˆä½¿ç”¨ IPv6 è§£æ `api.telegram.org`,å¦‚æœ IPv6 ç¶²è·¯æœ‰å•é¡Œæœƒå°è‡´è«‹æ±‚å¤±æ•—ã€‚

**ç—‡ç‹€**:
- Bot å•Ÿå‹•ä½†å¾ˆå¿«åœæ­¢å›æ‡‰
- æ—¥èªŒé¡¯ç¤º "HttpError: Network request failed"

**è§£æ±ºæ–¹æ³•**:

1. æª¢æŸ¥ DNS è§£æ:

```bash
dig +short api.telegram.org A    # IPv4
dig +short api.telegram.org AAAA # IPv6
```

2. å¼·åˆ¶ä½¿ç”¨ IPv4(æ–°å¢åˆ° `/etc/hosts` æˆ–ä¿®æ”¹ DNS è¨­å®š)

```bash
# /etc/hosts ç¯„ä¾‹
123.45.67.89 api.telegram.org
```

3. é‡æ–°å•Ÿå‹• Gateway

### éš±ç§æ¨¡å¼é™·é˜±

**å•é¡Œ**:
- é—œé–‰éš±ç§æ¨¡å¼å¾Œ,Bot ä»ç„¶çœ‹ä¸åˆ°ç¾¤çµ„è¨Šæ¯

**åŸå› **:
- Telegram è¦æ±‚ä½ å¾ç¾¤çµ„ä¸­**ç§»é™¤ä¸¦é‡æ–°æ–°å¢** Bot

**è§£æ±ºæ–¹æ³•**:
1. åœ¨ç¾¤çµ„ä¸­ç§»é™¤ Bot
2. é‡æ–°æ–°å¢ Bot åˆ°ç¾¤çµ„
3. ç­‰å¾… 30 ç§’å¾Œæ¸¬è©¦

## æœ¬èª²å°çµ

æœ¬èª²ä½ å­¸æœƒäº†:

- âœ… åœ¨ Telegram ä¸­å»ºç«‹ Bot ä¸¦å–å¾— Token
- âœ… è¨­å®š Clawdbot é€£æ¥åˆ° Telegram Bot API
- âœ… ç†è§£å’Œä½¿ç”¨ DM é…å°æ©Ÿåˆ¶
- âœ… è¨­å®šç¾¤çµ„å­˜å–æ§åˆ¶(ç™½åå–® + æåŠè¦å‰‡)
- âœ… äº†è§£ Webhook vs Long-polling çš„å€åˆ¥
- âœ… è¨­å®šé€²éšåŠŸèƒ½(åª’é«”é™åˆ¶ã€åˆ†å¡Šã€Forum ä¸»é¡Œã€å…§è¯æŒ‰éˆ•)
- âœ… è™•ç†å¸¸è¦‹ç¶²è·¯å’Œè¨­å®šå•é¡Œ

**é—œéµè¨­å®šæ¬„ä½å›é¡§**:

| æ¬„ä½ | æ¨è–¦å€¼ | èªªæ˜ |
|--- | --- | ---|
| `dmPolicy` | `"pairing"` | æœ€å®‰å…¨çš„é è¨­ DM ç­–ç•¥ |
| `groups.*.requireMention` | `true` | ç¾¤çµ„é è¨­è¦æ±‚æåŠ |
| `reactionNotifications` | `"own"` | åªå›æ‡‰ Bot è¨Šæ¯çš„åæ‡‰ |
| `streamMode` | `"partial"` | å•Ÿç”¨è‰ç¨¿ä¸²æµæ›´æ–° |

## ä¸‹ä¸€èª²é å‘Š

> ä¸‹ä¸€èª²æˆ‘å€‘å­¸ç¿’ **[Slack é »é“](../../platforms/slack/)**ã€‚
>
> ä½ æœƒå­¸åˆ°:
> - å¦‚ä½•å»ºç«‹ Slack App ä¸¦å–å¾— Bot Token
> - è¨­å®š Slack Bot Token å’Œ App Token
> - ç†è§£ Slack çš„ Workspace å’Œ Channel æ¦‚å¿µ
> - è¨­å®š Slack ç‰¹æœ‰çš„åŠŸèƒ½(åŸ·è¡Œç·’ã€æ·å¾‘ã€App Home)

---

## é™„éŒ„:åŸå§‹ç¢¼åƒè€ƒ

<details>
<summary><strong>é»æ“Šå±•é–‹æŸ¥çœ‹åŸå§‹ç¢¼ä½ç½®</strong></summary>

> æ›´æ–°æ™‚é–“:2026-01-27

| åŠŸèƒ½ | æª”æ¡ˆè·¯å¾‘ | è¡Œè™Ÿ |
|--- | --- | ---|
| Telegram Bot å»ºç«‹ | [`src/telegram/bot.ts`](https://github.com/moltbot/moltbot/blob/main/src/telegram/bot.ts) | 106-452 |
| è¨­å®šé¡å‹å®šç¾© | [`src/config/types.telegram.ts`](https://github.com/moltbot/moltbot/blob/main/src/config/types.telegram.ts) | 14-157 |
| Telegram æ–‡ä»¶ | [`docs/channels/telegram.md`](https://github.com/moltbot/moltbot/blob/main/docs/channels/telegram.md) | 1-547 |
| Bot è¨Šæ¯è™•ç†å™¨ | [`src/telegram/bot-message.ts`](https://github.com/moltbot/moltbot/blob/main/src/telegram/bot-message.ts) | å…¨æª”æ¡ˆ |
| Bot æŒ‡ä»¤è™•ç†å™¨ | [`src/telegram/bot-handlers.ts`](https://github.com/moltbot/moltbot/blob/main/src/telegram/bot-handlers.ts) | å…¨æª”æ¡ˆ |
| åŸç”ŸæŒ‡ä»¤è¨»å†Š | [`src/telegram/bot-native-commands.ts`](https://github.com/moltbot/moltbot/blob/main/src/telegram/bot-native-commands.ts) | å…¨æª”æ¡ˆ |

**é—œéµè¨­å®šæ¬„ä½**:

- `dmPolicy`: DM å­˜å–ç­–ç•¥(`"pairing"` | `"allowlist"` | `"open"` | `"disabled"`)
- `groupPolicy`: ç¾¤çµ„ç­–ç•¥(`"open"` | `"allowlist"` | `"disabled"`)
- `requireMention`: ç¾¤çµ„æ˜¯å¦è¦æ±‚æåŠ(`boolean`)
- `reactionNotifications`: åæ‡‰é€šçŸ¥æ¨¡å¼(`"off"` | `"own"` | `"all"`)
- `reactionLevel`: Agent åæ‡‰å±¤ç´š(`"off"` | `"ack"` | `"minimal"` | `"extensive"`)

**é—œéµå‡½æ•¸**:

- `createTelegramBot()`: å»ºç«‹ Telegram Bot å¯¦ä¾‹ä¸¦è¨­å®š grammY æ¡†æ¶
- `createTelegramWebhookCallback()`: å»ºç«‹ Webhook å›å‘¼è™•ç†å™¨
- `getTelegramSequentialKey()`: ç”¢ç”Ÿæœƒè©±é‡‘é‘°,æ”¯æ´ Forum ä¸»é¡Œå’Œæ™®é€šç¾¤çµ„

**ç›¸ä¾å‡½å¼åº«**:

- [grammY](https://grammy.dev/): Telegram Bot API æ¡†æ¶
- @grammyjs/runner: é †åºåŒ–æ›´æ–°è™•ç†
- @grammyjs/transformer-throttler: API ç¯€æµé™åˆ¶

</details>
