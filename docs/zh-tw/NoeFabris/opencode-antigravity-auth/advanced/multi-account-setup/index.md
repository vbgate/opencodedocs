---
title: "å¤šå¸³æˆ¶è¨­å®šï¼šé…é¡æ± åŒ–èˆ‡è² è¼‰å‡è¡¡ | opencode-antigravity-auth"
sidebarTitle: "è©¦è©¦å¤šå¸³è™Ÿ"
subtitle: "å¤šå¸³æˆ¶è¨­å®šï¼šé…é¡æ± åŒ–èˆ‡è² è¼‰å‡è¡¡"
description: "å­¸ç¿’å¦‚ä½•è¨­å®šå¤šå€‹ Google å¸³æˆ¶å¯¦ç¾é…é¡æ± åŒ–èˆ‡è² è¼‰å‡è¡¡ã€‚æŒæ¡é›™é…é¡ç³»çµ±ã€å¸³æˆ¶é¸æ“‡ç­–ç•¥å’Œ PID åç§»è¨­å®šï¼Œæœ€å¤§åŒ– API é…é¡åˆ©ç”¨ç‡ã€‚"
tags:
  - "advanced"
  - "multi-account"
  - "load-balancing"
  - "quota-management"
prerequisite:
  - "start-quick-install"
  - "start-first-auth-login"
order: 4
---

# å¤šå¸³æˆ¶è¨­å®šï¼šé…é¡æ± åŒ–èˆ‡è² è¼‰å‡è¡¡

## å­¸å®Œä½ èƒ½åšä»€éº¼

- æ–°å¢å¤šå€‹ Google å¸³æˆ¶ï¼Œæå‡æ•´é«”é…é¡ä¸Šé™
- ç†è§£é›™é…é¡ç³»çµ±ï¼Œæœ‰æ•ˆåˆ©ç”¨ Antigravity å’Œ Gemini CLI é…é¡æ± 
- æ ¹æ“šå¸³æˆ¶æ•¸é‡å’Œä½¿ç”¨æƒ…å¢ƒé¸æ“‡åˆé©çš„è² è¼‰å‡è¡¡ç­–ç•¥
- æ’æŸ¥å¤šå¸³æˆ¶è¨­å®šä¸­çš„å¸¸è¦‹å•é¡Œ

## ä½ ç¾åœ¨çš„å›°å¢ƒ

å–®å¸³æˆ¶ä½¿ç”¨æ™‚ï¼Œä½ å¯èƒ½æœƒé‡åˆ°é€™äº›ç—›é»ï¼š

- é »ç¹é‡åˆ° 429 é€Ÿç‡é™åˆ¶éŒ¯èª¤ï¼Œä¸å¾—ä¸ç­‰å¾…é…é¡æ¢å¾©
- é–‹ç™¼/æ¸¬è©¦æƒ…å¢ƒä¸­ä¸¦è¡Œè«‹æ±‚å¤ªå¤šï¼Œä¸€å€‹å¸³æˆ¶æ‰›ä¸ä½
- Gemini 3 Pro æˆ– Claude Opus æ¨¡å‹çš„é…é¡ç”¨å®Œå¾Œï¼Œåªèƒ½ç­‰å¾…éš”å¤©
- ä¸¦è¡ŒåŸ·è¡Œå¤šå€‹ OpenCode å¯¦ä¾‹æˆ– oh-my-opencode å­ä»£ç†æ™‚ï¼Œå¸³æˆ¶é–“ç«¶çˆ­æ¿€çƒˆ

## ä»€éº¼æ™‚å€™ç”¨é€™ä¸€æ‹›

å¤šå¸³æˆ¶è¨­å®šé©åˆä»¥ä¸‹æƒ…å¢ƒï¼š

| æƒ…å¢ƒ | å»ºè­°å¸³æˆ¶æ•¸ | åŸå›  |
| --- | --- | --- |
| å€‹äººé–‹ç™¼ | 2-3 å€‹ | å‚™ç”¨å¸³æˆ¶ï¼Œé¿å…ä¸­æ–· |
| åœ˜éšŠå”ä½œ | 3-5 å€‹ | åˆ†æ”¤è«‹æ±‚ï¼Œæ¸›å°‘ç«¶çˆ­ |
| é«˜é » API å‘¼å« | 5+ å€‹ | è² è¼‰å‡è¡¡ï¼Œæœ€å¤§åŒ–ååé‡ |
| ä¸¦è¡Œä»£ç† | 3+ å€‹ + PID åç§» | æ¯å€‹ Agent ç¨ç«‹å¸³æˆ¶ |

::: warning å‰ç½®æª¢æŸ¥
é–‹å§‹æœ¬æ•™å­¸å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“å®Œæˆï¼š
- âœ… å®‰è£äº† opencode-antigravity-auth å¤–æ›
- âœ… æˆåŠŸé€šé OAuth èªè­‰ä¸¦æ–°å¢äº†ç¬¬ä¸€å€‹å¸³æˆ¶
- âœ… å¯ä»¥ä½¿ç”¨ Antigravity æ¨¡å‹ç™¼èµ·è«‹æ±‚

[å¿«é€Ÿå®‰è£æ•™å­¸](../../start/quick-install/) | [é¦–æ¬¡ç™»å…¥æ•™å­¸](../../start/first-auth-login/)
:::

## æ ¸å¿ƒæ€è·¯

å¤šå¸³æˆ¶è¨­å®šçš„æ ¸å¿ƒæ©Ÿåˆ¶ï¼š

1. **é…é¡æ± åŒ–**ï¼šæ¯å€‹ Google å¸³æˆ¶éƒ½æœ‰ç¨ç«‹çš„é…é¡ï¼Œå¤šå€‹å¸³æˆ¶çš„é…é¡ç–ŠåŠ å¾Œå½¢æˆæ›´å¤§çš„ç¸½æ± 
2. **è² è¼‰å‡è¡¡**ï¼šå¤–æ›è‡ªå‹•é¸æ“‡å¯ç”¨å¸³æˆ¶ï¼Œé‡åˆ°é€Ÿç‡é™åˆ¶æ™‚åˆ‡æ›åˆ°ä¸‹ä¸€å€‹å¸³æˆ¶
3. **é›™é…é¡ç³»çµ±**ï¼ˆåƒ… Geminiï¼‰ï¼šæ¯å€‹å¸³æˆ¶å¯å­˜å– Antigravity å’Œ Gemini CLI å…©å€‹ç¨ç«‹çš„é…é¡æ± 
4. **æ™ºæ…§æ¢å¾©**ï¼šé€Ÿç‡é™åˆ¶å»é‡ï¼ˆ2 ç§’è¦–çª—ï¼‰+ æŒ‡æ•¸é€€é¿ï¼Œé¿å…ç„¡æ•ˆé‡è©¦

**é…é¡è¨ˆç®—ç¯„ä¾‹**ï¼š

å‡è¨­æ¯å€‹å¸³æˆ¶çš„ Claude é…é¡ç‚º 1000 è«‹æ±‚/åˆ†é˜ï¼š

| å¸³æˆ¶æ•¸ | ç†è«–ç¸½é…é¡ | å¯¦éš›å¯ç”¨ï¼ˆè€ƒæ…®å¿«å–ï¼‰ |
| --- | --- | --- |
| 1      | 1000/min   | 1000/min          |
| 3      | 3000/min   | ~2500/minï¼ˆsticky ç­–ç•¥ï¼‰ |
| 5      | 5000/min   | ~4000/minï¼ˆround-robinï¼‰ |

> ğŸ’¡ **ç‚ºä»€éº¼ sticky ç­–ç•¥å¯ç”¨é…é¡æ›´ä½ï¼Ÿ**
>
> sticky ç­–ç•¥æœƒä¿æŒä½¿ç”¨åŒä¸€å¸³æˆ¶ç›´åˆ°é™é€Ÿï¼Œå°è‡´å…¶ä»–å¸³æˆ¶é…é¡é–’ç½®ã€‚ä½†é€™æ¨£åšçš„å¥½è™•æ˜¯ä¿ç•™äº† Anthropic çš„æç¤ºè©å¿«å–ï¼Œæå‡å›æ‡‰é€Ÿåº¦ã€‚

## è·Ÿæˆ‘åš

### ç¬¬ 1 æ­¥ï¼šæ–°å¢ç¬¬äºŒå€‹å¸³æˆ¶

**ç‚ºä»€éº¼**
æ–°å¢ç¬¬äºŒå€‹å¸³æˆ¶å¾Œï¼Œç•¶ä¸»å¸³æˆ¶é‡åˆ°é€Ÿç‡é™åˆ¶æ™‚ï¼Œå¤–æ›æœƒè‡ªå‹•åˆ‡æ›åˆ°å‚™ç”¨å¸³æˆ¶ï¼Œé¿å…è«‹æ±‚å¤±æ•—ã€‚

**æ“ä½œ**

åŸ·è¡Œ OAuth ç™»å…¥æŒ‡ä»¤ï¼š

```bash
opencode auth login
```

å¦‚æœä½ å·²ç¶“æœ‰ä¸€å€‹å¸³æˆ¶ï¼Œæœƒçœ‹åˆ°å¦‚ä¸‹æç¤ºï¼š

```
1 account(s) saved:
  1. user1@gmail.com

(a)dd new account(s) or (f)resh start? [a/f]:
```

è¼¸å…¥ `a` ä¸¦æŒ‰ Enterï¼Œç€è¦½å™¨æœƒè‡ªå‹•é–‹å•Ÿ Google æˆæ¬Šé é¢ã€‚

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼š

1. ç€è¦½å™¨é–‹å•Ÿ Google OAuth æˆæ¬Šé é¢
2. é¸æ“‡æˆ–ç™»å…¥ä½ çš„ç¬¬äºŒå€‹ Google å¸³æˆ¶
3. åŒæ„æˆæ¬Šå¾Œï¼Œçµ‚ç«¯æ©Ÿé¡¯ç¤ºï¼š

```
Account added successfully!

2 account(s) saved:
  1. user1@gmail.com
  2. user2@gmail.com
```

::: tip
å¦‚æœç€è¦½å™¨æ²’æœ‰è‡ªå‹•é–‹å•Ÿï¼Œè¤‡è£½çµ‚ç«¯æ©Ÿé¡¯ç¤ºçš„ OAuth URL ä¸¦æ‰‹å‹•è²¼åˆ°ç€è¦½å™¨ä¸­ã€‚
:::

### ç¬¬ 2 æ­¥ï¼šé©—è­‰å¤šå¸³æˆ¶ç‹€æ…‹

**ç‚ºä»€éº¼**
ç¢ºèªå¸³æˆ¶å·²æ­£ç¢ºæ–°å¢ä¸¦å¯ç”¨ã€‚

**æ“ä½œ**

æŸ¥çœ‹å¸³æˆ¶å„²å­˜æª”æ¡ˆï¼š

```bash
cat ~/.config/opencode/antigravity-accounts.json
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼š

```json
{
  "version": 3,
  "accounts": [
    {
      "email": "user1@gmail.com",
      "refreshToken": "1//0abc...",
      "projectId": "project-id-123",
      "addedAt": 1737609600000,
      "lastUsed": 1737609600000
    },
    {
      "email": "user2@gmail.com",
      "refreshToken": "1//0xyz...",
      "addedAt": 1737609700000,
      "lastUsed": 1737609700000
    }
  ],
  "activeIndex": 0,
  "activeIndexByFamily": {
    "claude": 0,
    "gemini": 0
  }
}
```

::: warning å®‰å…¨æé†’
`antigravity-accounts.json` åŒ…å« OAuth refresh tokensï¼Œç­‰åŒæ–¼å¯†ç¢¼æª”æ¡ˆã€‚è«‹å‹¿æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»çµ±ã€‚
:::

### ç¬¬ 3 æ­¥ï¼šæ¸¬è©¦å¸³æˆ¶åˆ‡æ›

**ç‚ºä»€éº¼**
é©—è­‰å¤šå¸³æˆ¶è² è¼‰å‡è¡¡æ˜¯å¦æ­£å¸¸é‹ä½œã€‚

**æ“ä½œ**

ç™¼é€å¤šå€‹ä¸¦è¡Œè«‹æ±‚è§¸ç™¼é€Ÿç‡é™åˆ¶ï¼š

```bash
# macOS/Linux
for i in {1..10}; do
  opencode run "Test $i" --model=google/antigravity-claude-sonnet-4-5 &
done
wait

# Windows PowerShell
1..10 | ForEach-Object {
  Start-Process -FilePath "opencode" -ArgumentList "run","Test $_","--model=google/antigravity-claude-sonnet-4-5"
}
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼š

1. å‰ N å€‹è«‹æ±‚ä½¿ç”¨å¸³æˆ¶ 1ï¼ˆuser1@gmail.comï¼‰
2. é‡åˆ° 429 å¾Œï¼Œè‡ªå‹•åˆ‡æ›åˆ°å¸³æˆ¶ 2ï¼ˆuser2@gmail.comï¼‰
3. å¦‚æœå•Ÿç”¨äº†é€šçŸ¥ï¼Œæœƒçœ‹åˆ° "Switched to account 2" çš„ toast æç¤º

::: info å¸³æˆ¶åˆ‡æ›é€šçŸ¥
å¦‚æœå•Ÿç”¨äº† `quiet_mode: false`ï¼ˆé è¨­ï¼‰ï¼Œå¤–æ›æœƒé¡¯ç¤ºå¸³æˆ¶åˆ‡æ›é€šçŸ¥ã€‚é¦–æ¬¡åˆ‡æ›æœƒé¡¯ç¤ºé›»å­éƒµä»¶åœ°å€ï¼Œå¾ŒçºŒåªé¡¯ç¤ºå¸³æˆ¶ç´¢å¼•ã€‚
:::

### ç¬¬ 4 æ­¥ï¼šè¨­å®šé›™é…é¡ç³»çµ±ï¼ˆGemini å°ˆç”¨ï¼‰

**ç‚ºä»€éº¼**
å•Ÿç”¨é›™é…é¡ fallback å¾Œï¼Œç•¶ Antigravity é…é¡ç”¨ç›¡æ™‚ï¼Œå¤–æ›æœƒè‡ªå‹•å˜—è©¦ Gemini CLI é…é¡ï¼Œç„¡éœ€åˆ‡æ›å¸³æˆ¶ã€‚

**æ“ä½œ**

ç·¨è¼¯å¤–æ›è¨­å®šæª”ï¼š

```bash
# macOS/Linux
nano ~/.config/opencode/antigravity.json

# Windows
notepad %APPDATA%\opencode\antigravity.json
```

æ–°å¢ä»¥ä¸‹è¨­å®šï¼š

```json
{
  "$schema": "https://raw.githubusercontent.com/NoeFabris/opencode-antigravity-auth/main/assets/antigravity.schema.json",
  "quota_fallback": true
}
```

å„²å­˜æª”æ¡ˆä¸¦é‡æ–°å•Ÿå‹• OpenCodeã€‚

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼š

1. ä½¿ç”¨ Gemini æ¨¡å‹æ™‚ï¼Œå¤–æ›å„ªå…ˆä½¿ç”¨ Antigravity é…é¡
2. ç•¶ Antigravity å›å‚³ 429 æ™‚ï¼Œè‡ªå‹•åˆ‡æ›åˆ°åŒä¸€å¸³æˆ¶çš„ Gemini CLI é…é¡
3. å¦‚æœé›™é…é¡éƒ½é™é€Ÿï¼Œå†åˆ‡æ›åˆ°ä¸‹ä¸€å€‹å¸³æˆ¶

::: tip é›™é…é¡ vs å¤šå¸³æˆ¶
- **é›™é…é¡**ï¼šåŒä¸€å€‹å¸³æˆ¶çš„å…©å€‹ç¨ç«‹é…é¡æ± ï¼ˆAntigravity + Gemini CLIï¼‰
- **å¤šå¸³æˆ¶**ï¼šå¤šå€‹å¸³æˆ¶çš„é…é¡æ± ç–ŠåŠ 
- æœ€ä½³å¯¦è¸ï¼šå…ˆå•Ÿç”¨é›™é…é¡ï¼Œå†æ–°å¢å¤šå¸³æˆ¶
:::

### ç¬¬ 5 æ­¥ï¼šé¸æ“‡å¸³æˆ¶é¸æ“‡ç­–ç•¥

**ç‚ºä»€éº¼**
ä¸åŒçš„å¸³æˆ¶æ•¸é‡å’Œä½¿ç”¨æƒ…å¢ƒéœ€è¦ä¸åŒçš„ç­–ç•¥ï¼Œä»¥é”åˆ°æœ€ä½³æ•ˆèƒ½ã€‚

**æ“ä½œ**

åœ¨ `antigravity.json` ä¸­è¨­å®šç­–ç•¥ï¼š

```json
{
  "account_selection_strategy": "hybrid"
}
```

æ ¹æ“šä½ çš„å¸³æˆ¶æ•¸é¸æ“‡ï¼š

| å¸³æˆ¶æ•¸ | å»ºè­°ç­–ç•¥ | è¨­å®šå€¼ | åŸå›  |
| --- | --- | --- | --- |
| 1      | sticky   | `"sticky"` | ä¿æŒ prompt cache |
| 2-5    | hybrid   | `"hybrid"` | å¹³è¡¡ååé‡å’Œå¿«å– |
| 5+     | round-robin | `"round-robin"` | æœ€å¤§åŒ–ååé‡ |

**ç­–ç•¥è©³è§£**ï¼š

- **sticky**ï¼ˆé è¨­å–®å¸³æˆ¶ï¼‰ï¼šä¿æŒä½¿ç”¨åŒä¸€å¸³æˆ¶ç›´åˆ°é€Ÿç‡é™åˆ¶ï¼Œé©åˆå–®ä¸€é–‹ç™¼å·¥ä½œéšæ®µ
- **round-robin**ï¼šæ¯å€‹è«‹æ±‚è¼ªæ›åˆ°ä¸‹ä¸€å€‹å¸³æˆ¶ï¼Œæœ€å¤§åŒ–ååé‡ä½†çŠ§ç‰²å¿«å–
- **hybrid**ï¼ˆé è¨­å¤šå¸³æˆ¶ï¼‰ï¼šåŸºæ–¼å¥åº·è©•åˆ† + Token bucket + LRU çš„ç¶œåˆæ±ºç­–

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼š

1. ä½¿ç”¨ `hybrid` ç­–ç•¥æ™‚ï¼Œå¤–æ›æœƒè‡ªå‹•é¸æ“‡ç•¶å‰æœ€ä½³å¸³æˆ¶
2. ä½¿ç”¨ `round-robin` ç­–ç•¥æ™‚ï¼Œè«‹æ±‚å‡å‹»åˆ†å¸ƒåˆ°æ‰€æœ‰å¸³æˆ¶
3. ä½¿ç”¨ `sticky` ç­–ç•¥æ™‚ï¼ŒåŒä¸€å·¥ä½œéšæ®µå§‹çµ‚ä½¿ç”¨åŒä¸€å¸³æˆ¶

### ç¬¬ 6 æ­¥ï¼šå•Ÿç”¨ PID åç§»ï¼ˆä¸¦è¡Œä»£ç†æƒ…å¢ƒï¼‰

**ç‚ºä»€éº¼**
åŸ·è¡Œå¤šå€‹ OpenCode å¯¦ä¾‹æˆ– oh-my-opencode ä¸¦è¡Œä»£ç†æ™‚ï¼Œä¸åŒç¨‹åºå¯èƒ½æœƒé¸æ“‡åŒä¸€å¸³æˆ¶ï¼Œå°è‡´ç«¶çˆ­ã€‚

**æ“ä½œ**

åœ¨ `antigravity.json` ä¸­æ–°å¢ï¼š

```json
{
  "pid_offset_enabled": true
}
```

å„²å­˜ä¸¦é‡æ–°å•Ÿå‹• OpenCodeã€‚

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼š

1. ä¸åŒç¨‹åºï¼ˆä¸åŒ PIDï¼‰å¾ä¸åŒçš„å¸³æˆ¶ç´¢å¼•é–‹å§‹
2. ä¸¦è¡Œä»£ç†ä¹‹é–“çš„å¸³æˆ¶ç«¶çˆ­æ¸›å°‘
3. æ•´é«”ååé‡æå‡

::: tip PID åç§»çš„é‹ä½œåŸç†
PID åç§»æœƒå°‡ç¨‹åº ID å°æ‡‰åˆ°å¸³æˆ¶åç§»é‡ï¼Œä¾‹å¦‚ï¼š
- PID 100 â†’ åç§» 0 â†’ å¾å¸³æˆ¶ 0 é–‹å§‹
- PID 101 â†’ åç§» 1 â†’ å¾å¸³æˆ¶ 1 é–‹å§‹
- PID 102 â†’ åç§» 2 â†’ å¾å¸³æˆ¶ 2 é–‹å§‹
:::

## æª¢æŸ¥é» âœ…

å®Œæˆä¸Šè¿°æ­¥é©Ÿå¾Œï¼Œä½ æ‡‰è©²èƒ½å¤ ï¼š

- [ ] é€é `opencode auth login` æ–°å¢å¤šå€‹ Google å¸³æˆ¶
- [ ] åœ¨ `antigravity-accounts.json` ä¸­çœ‹åˆ°å¤šå€‹å¸³æˆ¶è¨˜éŒ„
- [ ] é‡åˆ°é€Ÿç‡é™åˆ¶æ™‚ï¼Œå¤–æ›è‡ªå‹•åˆ‡æ›åˆ°ä¸‹ä¸€å€‹å¸³æˆ¶
- [ ] Gemini æ¨¡å‹å•Ÿç”¨äº†é›™é…é¡ fallback
- [ ] æ ¹æ“šå¸³æˆ¶æ•¸é‡é¸æ“‡äº†åˆé©çš„å¸³æˆ¶é¸æ“‡ç­–ç•¥
- [ ] ä¸¦è¡Œä»£ç†æƒ…å¢ƒå•Ÿç”¨äº† PID åç§»

## è¸©å‘æé†’

### æ‰€æœ‰å¸³æˆ¶éƒ½è¢«é™é€Ÿ

**ç—‡ç‹€**ï¼šæ‰€æœ‰å¸³æˆ¶éƒ½é¡¯ç¤º 429 éŒ¯èª¤ï¼Œç„¡æ³•ç¹¼çºŒè«‹æ±‚

**åŸå› **ï¼šé…é¡ç”¨ç›¡æˆ–ä¸¦è¡Œè«‹æ±‚éå¤š

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. ç­‰å¾…é€Ÿç‡é™åˆ¶è‡ªå‹•é‡è¨­ï¼ˆé€šå¸¸ 1-5 åˆ†é˜ï¼‰
2. å¦‚æœé•·æœŸå‡ºç¾å•é¡Œï¼Œæ–°å¢æ›´å¤šå¸³æˆ¶
3. æª¢æŸ¥è¨­å®šä¸­çš„ `max_rate_limit_wait_seconds`ï¼Œè¨­å®šåˆç†çš„ç­‰å¾…ä¸Šé™

### å¸³æˆ¶åˆ‡æ›éæ–¼é »ç¹

**ç—‡ç‹€**ï¼šæ¯æ¬¡è«‹æ±‚éƒ½åˆ‡æ›å¸³æˆ¶ï¼Œæ²’æœ‰ä½¿ç”¨åŒä¸€å¸³æˆ¶

**åŸå› **ï¼šç­–ç•¥é¸æ“‡ä¸ç•¶æˆ–å¥åº·è©•åˆ†ç•°å¸¸

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. å°‡ç­–ç•¥æ”¹ç‚º `sticky`
2. æª¢æŸ¥ `health_score` è¨­å®šï¼Œèª¿æ•´ `min_usable` å’Œ `rate_limit_penalty`
3. ç¢ºèªæ²’æœ‰é »ç¹ 429 éŒ¯èª¤å°è‡´å¸³æˆ¶è¢«æ¨™è¨˜ç‚ºä¸å¥åº·

### Gemini CLI æ¬Šé™éŒ¯èª¤ï¼ˆ403ï¼‰

**ç—‡ç‹€**ï¼šä½¿ç”¨ Gemini CLI æ¨¡å‹æ™‚å›å‚³ `Permission denied` éŒ¯èª¤

**åŸå› **ï¼šå¸³æˆ¶ç¼ºå°‘æœ‰æ•ˆçš„ Project ID

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. ç‚ºæ¯å€‹å¸³æˆ¶æ‰‹å‹•æ–°å¢ `projectId`ï¼š

```json
{
  "accounts": [
    {
      "email": "your@email.com",
      "refreshToken": "...",
      "projectId": "your-project-id"
    }
  ]
}
```

2. ç¢ºä¿åœ¨ [Google Cloud Console](https://console.cloud.google.com/) ä¸­å•Ÿç”¨äº† Gemini for Google Cloud API

### æ¬Šæ–ç„¡æ•ˆï¼ˆinvalid_grantï¼‰

**ç—‡ç‹€**ï¼šå¸³æˆ¶è¢«è‡ªå‹•ç§»é™¤ï¼Œæç¤º `invalid_grant` éŒ¯èª¤

**åŸå› **ï¼šGoogle å¸³æˆ¶å¯†ç¢¼è®Šæ›´ã€å®‰å…¨äº‹ä»¶æˆ–æ¬Šæ–éæœŸ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. åˆªé™¤ç„¡æ•ˆå¸³æˆ¶ä¸¦é‡æ–°èªè­‰ï¼š

```bash
rm ~/.config/opencode/antigravity-accounts.json
opencode auth login
```

2. å¦‚æœé »ç¹å‡ºç¾ï¼Œè€ƒæ…®ä½¿ç”¨æ›´ç©©å®šçš„ Google å¸³æˆ¶

## æœ¬èª²å°çµ

- å¤šå¸³æˆ¶è¨­å®šå¯ä»¥æå‡æ•´é«”é…é¡ä¸Šé™å’Œç³»çµ±ç©©å®šæ€§
- å¸³æˆ¶æ–°å¢éå¸¸ç°¡å–®ï¼Œé‡è¤‡åŸ·è¡Œ `opencode auth login` å³å¯
- é›™é…é¡ç³»çµ±è®“æ¯å€‹ Gemini å¸³æˆ¶çš„å¯ç”¨é…é¡ç¿»å€
- å¸³æˆ¶é¸æ“‡ç­–ç•¥æ‡‰æ ¹æ“šå¸³æˆ¶æ•¸é‡å’Œä½¿ç”¨æƒ…å¢ƒèª¿æ•´
- PID åç§»å°æ–¼ä¸¦è¡Œä»£ç†æƒ…å¢ƒè‡³é—œé‡è¦

## ä¸‹ä¸€èª²é å‘Š

> ä¸‹ä¸€èª²æˆ‘å€‘å­¸ç¿’ **[å¸³æˆ¶é¸æ“‡ç­–ç•¥](../account-selection-strategies/)**ã€‚
>
> ä½ æœƒå­¸åˆ°ï¼š
> - stickyã€round-robinã€hybrid ä¸‰ç¨®ç­–ç•¥çš„è©³ç´°é‹ä½œåŸç†
> - å¦‚ä½•æ ¹æ“šæƒ…å¢ƒé¸æ“‡æœ€ä½³ç­–ç•¥
> - å¥åº·è©•åˆ†å’Œ Token bucket çš„èª¿æ ¡æ–¹æ³•

---

## é™„éŒ„ï¼šåŸå§‹ç¢¼åƒè€ƒ

<details>
<summary><strong>é»æ“Šå±•é–‹æŸ¥çœ‹åŸå§‹ç¢¼ä½ç½®</strong></summary>

> æ›´æ–°æ™‚é–“ï¼š2026-01-23

| åŠŸèƒ½        | æª”æ¡ˆè·¯å¾‘                                                                                    | è¡Œè™Ÿ    |
| --- | --- | --- |
| AccountManager é¡åˆ¥ | [`src/plugin/accounts.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/accounts.ts#L174-L250) | 174-250 |
| è² è¼‰å‡è¡¡ç­–ç•¥ | [`src/plugin/rotation.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/rotation.ts)         | å…¨æ–‡   |
| è¨­å®š Schema | [`src/plugin/config/schema.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/config/schema.ts) | å…¨æ–‡   |
| å¸³æˆ¶å„²å­˜ | [`src/plugin/storage.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/storage.ts)     | å…¨æ–‡   |

**é—œéµå¸¸æ•¸**ï¼š

| å¸¸æ•¸å | å€¼ | èªªæ˜ |
| --- | --- | --- |
| `QUOTA_EXHAUSTED_BACKOFFS` | `[60000, 300000, 1800000, 7200000]` | é…é¡è€—ç›¡é€€é¿æ™‚é–“ï¼ˆ1åˆ†é˜â†’5åˆ†é˜â†’30åˆ†é˜â†’2å°æ™‚ï¼‰ |
| `RATE_LIMIT_EXCEEDED_BACKOFF` | `30000` | é€Ÿç‡é™åˆ¶é€€é¿æ™‚é–“ï¼ˆ30ç§’ï¼‰ |
| `MIN_BACKOFF_MS` | `2000` | æœ€å°é€€é¿æ™‚é–“ï¼ˆ2ç§’ï¼‰ |

**é—œéµå‡½å¼**ï¼š

- `calculateBackoffMs(reason, consecutiveFailures, retryAfterMs)`ï¼šè¨ˆç®—é€€é¿å»¶é²
- `getQuotaKey(family, headerStyle, model)`ï¼šç”¢ç”Ÿé…é¡éµï¼ˆæ”¯æ´æ¨¡å‹ç´šåˆ¥é™æµï¼‰
- `isRateLimitedForQuotaKey(account, key)`ï¼šæª¢æŸ¥ç‰¹å®šé…é¡éµæ˜¯å¦é™é€Ÿ
- `selectHybridAccount(accounts, family)`ï¼šhybrid ç­–ç•¥çš„å¸³æˆ¶é¸æ“‡é‚è¼¯

**è¨­å®šé …**ï¼ˆä¾†è‡ª schema.tsï¼‰ï¼š

| è¨­å®šé … | é¡å‹ | é è¨­å€¼ | èªªæ˜ |
| --- | --- | --- | --- |
| `account_selection_strategy` | enum | `"hybrid"` | å¸³æˆ¶é¸æ“‡ç­–ç•¥ |
| `quota_fallback` | boolean | `false` | å•Ÿç”¨ Gemini é›™é…é¡ fallback |
| `pid_offset_enabled` | boolean | `false` | å•Ÿç”¨ PID åç§» |
| `switch_on_first_rate_limit` | boolean | `true` | é¦–æ¬¡é™é€Ÿç«‹å³åˆ‡æ› |

</details>
