---
title: "Thinking æ¨¡å‹è¨­å®š | opencode-antigravity-auth"
sidebarTitle: "è®“ AI æ·±åº¦æ€è€ƒ"
subtitle: "Thinking æ¨¡å‹ï¼šClaude èˆ‡ Gemini 3 çš„æ€è€ƒèƒ½åŠ›"
description: "å­¸ç¿’è¨­å®š Claude èˆ‡ Gemini 3 Thinking æ¨¡å‹ã€‚æŒæ¡ thinking budgetã€thinking level å’Œ variant è¨­å®šæ–¹æ³•ã€‚"
tags:
  - "Thinking æ¨¡å‹"
  - "Claude Opus 4.5"
  - "Claude Sonnet 4.5"
  - "Gemini 3 Pro"
  - "Gemini 3 Flash"
  - "variant è¨­å®š"
prerequisite:
  - "start-quick-install"
  - "start-first-request"
order: 4
---

# Thinking æ¨¡å‹ï¼šClaude èˆ‡ Gemini 3 çš„æ€è€ƒèƒ½åŠ›

## å­¸å®Œä½ èƒ½åšä»€éº¼

- è¨­å®š Claude Opus 4.5ã€Sonnet 4.5 Thinking æ¨¡å‹çš„ thinking budget
- ä½¿ç”¨ Gemini 3 Pro/Flash çš„ thinking levelï¼ˆminimal/low/medium/highï¼‰
- é€é OpenCode variant ç³»çµ±éˆæ´»èª¿æ•´æ€è€ƒå¼·åº¦
- ç†è§£ interleaved thinkingï¼ˆå·¥å…·å‘¼å«æ™‚çš„æ€è€ƒæ©Ÿåˆ¶ï¼‰
- æŒæ¡æ€è€ƒå€å¡Šä¿ç•™ç­–ç•¥ï¼ˆkeep_thinking è¨­å®šï¼‰

## ä½ ç¾åœ¨çš„å›°å¢ƒ

ä½ æƒ³è®“ AI æ¨¡å‹åœ¨è¤‡é›œä»»å‹™ä¸Šè¡¨ç¾æ›´å¥½â€”â€”æ¯”å¦‚å¤šæ­¥æ¨ç†ã€ç¨‹å¼ç¢¼é™¤éŒ¯æˆ–æ¶æ§‹è¨­è¨ˆã€‚ä½†ä½ çŸ¥é“ï¼š

- æ™®é€šæ¨¡å‹å›ç­”å¤ªå¿«ï¼Œæ€è€ƒä¸å¤ æ·±å…¥
- Claude å®˜æ–¹é™åˆ¶ thinking åŠŸèƒ½ï¼Œé›£ä»¥å­˜å–
- Gemini 3 çš„ thinking level è¨­å®šä¸æ¸…æ™°
- ä¸æ¸…æ¥š how much thinking is enoughï¼ˆbudget æ‡‰è©²è¨­å¤šå°‘ï¼‰
- é–±è®€æ€è€ƒå€å¡Šå…§å®¹æ™‚é‡åˆ°ç°½åéŒ¯èª¤

## ä»€éº¼æ™‚å€™ç”¨é€™ä¸€æ‹›

**é©ç”¨å ´æ™¯**ï¼š
- éœ€è¦å¤šæ­¥æ¨ç†çš„è¤‡é›œå•é¡Œï¼ˆæ¼”ç®—æ³•è¨­è¨ˆã€ç³»çµ±æ¶æ§‹ï¼‰
- éœ€è¦ä»”ç´°æ€è€ƒçš„ç¨‹å¼ç¢¼å¯©æŸ¥æˆ–é™¤éŒ¯
- éœ€è¦æ·±åº¦åˆ†æçš„é•·æ–‡ä»¶æˆ–ç¨‹å¼ç¢¼åº«
- å·¥å…·å‘¼å«å¯†é›†çš„ä»»å‹™ï¼ˆéœ€è¦ interleaved thinkingï¼‰

**ä¸é©ç”¨å ´æ™¯**ï¼š
- ç°¡å–®å•ç­”ï¼ˆæµªè²» thinking quotaï¼‰
- å¿«é€ŸåŸå‹é©—è­‰ï¼ˆé€Ÿåº¦å„ªå…ˆï¼‰
- äº‹å¯¦æŸ¥è©¢ï¼ˆä¸éœ€è¦æ¨ç†ï¼‰

## ğŸ’ é–‹å§‹å‰çš„æº–å‚™

::: warning å‰ç½®æª¢æŸ¥

 1. **å·²å®Œæˆå¤–æ›å®‰è£å’Œèªè­‰**ï¼šåƒè€ƒ [å¿«é€Ÿå®‰è£](../../start/quick-install/) å’Œ [é¦–æ¬¡èªè­‰](../../start/first-auth-login/)
 2. **äº†è§£åŸºæœ¬æ¨¡å‹ä½¿ç”¨**ï¼šåƒè€ƒ [é¦–æ¬¡è«‹æ±‚](../../start/first-request/)
3. **æœ‰å¯ç”¨çš„ Thinking æ¨¡å‹**ï¼šç¢ºä¿ä½ çš„å¸³æˆ¶æœ‰æ¬Šé™å­˜å– Claude Opus 4.5/Sonnet 4.5 Thinking æˆ– Gemini 3 Pro/Flash

:::

---

## æ ¸å¿ƒæ€è·¯

### ä»€éº¼æ˜¯ Thinking æ¨¡å‹

**Thinking æ¨¡å‹**æœƒåœ¨ç”¢ç”Ÿæœ€çµ‚ç­”æ¡ˆå‰ï¼Œå…ˆé€²è¡Œå…§éƒ¨æ¨ç†ï¼ˆthinking blocksï¼‰ã€‚é€™äº›æ€è€ƒå…§å®¹ï¼š

- **ä¸è¢«è¨ˆè²»**ï¼šThinking tokens ä¸è¨ˆå…¥å¸¸è¦è¼¸å‡ºé…é¡ï¼ˆå…·é«”è¨ˆè²»è¦å‰‡ä»¥ Antigravity å®˜æ–¹ç‚ºæº–ï¼‰
- **æå‡æ¨ç†å“è³ª**ï¼šæ›´å¤šæ€è€ƒ â†’ æ›´æº–ç¢ºã€æ›´æœ‰é‚è¼¯çš„å›ç­”
- **æ¶ˆè€—æ™‚é–“**ï¼šThinking å¢åŠ å›æ‡‰å»¶é²ï¼Œä½†æ›ä¾†æ›´å¥½çš„çµæœ

**é—œéµå€åˆ¥**ï¼š

| æ™®é€šæ¨¡å‹ | Thinking æ¨¡å‹ |
| --- | --- |
| ç›´æ¥ç”¢ç”Ÿç­”æ¡ˆ | å…ˆæ€è€ƒ â†’ å†ç”¢ç”Ÿç­”æ¡ˆ |
| å¿«é€Ÿä½†å¯èƒ½æ·ºè–„ | æ…¢é€Ÿä½†æ›´æ·±å…¥ |
| é©åˆç°¡å–®ä»»å‹™ | é©åˆè¤‡é›œä»»å‹™ |

### å…©ç¨® Thinking å¯¦ç¾

Antigravity Auth å¤–æ›æ”¯æ´å…©ç¨® Thinking å¯¦ç¾ï¼š

#### Claude Thinkingï¼ˆOpus 4.5ã€Sonnet 4.5ï¼‰

- **Token-based budget**ï¼šç”¨æ•¸å­—æ§åˆ¶æ€è€ƒé‡ï¼ˆå¦‚ 8192ã€32768ï¼‰
- **Interleaved thinking**ï¼šå¯ä»¥åœ¨å·¥å…·å‘¼å«å‰å¾Œæ€è€ƒ
- **Snake_case keys**ï¼šä½¿ç”¨ `include_thoughts`ã€`thinking_budget`

#### Gemini 3 Thinkingï¼ˆProã€Flashï¼‰

- **Level-based**ï¼šç”¨å­—ä¸²æ§åˆ¶æ€è€ƒå¼·åº¦ï¼ˆminimal/low/medium/highï¼‰
- **CamelCase keys**ï¼šä½¿ç”¨ `includeThoughts`ã€`thinkingLevel`
- **æ¨¡å‹å·®ç•°**ï¼šFlash æ”¯æ´ all 4 levelsï¼ŒPro åªæ”¯æ´ low/high

---

## è·Ÿæˆ‘åš

### ç¬¬ 1 æ­¥ï¼šé€é Variant è¨­å®š Thinking æ¨¡å‹

OpenCode çš„ variant ç³»çµ±è®“ä½ åœ¨æ¨¡å‹é¸æ“‡å™¨ä¸­ç›´æ¥é¸æ“‡ thinking å¼·åº¦ï¼Œè€Œç„¡éœ€è¨˜æ†¶è¤‡é›œçš„æ¨¡å‹åã€‚

#### æª¢æŸ¥ç¾æœ‰è¨­å®š

æª¢è¦–ä½ çš„æ¨¡å‹è¨­å®šæª”æ¡ˆï¼ˆé€šå¸¸åœ¨ `.opencode/models.json` æˆ–ç³»çµ±è¨­å®šç›®éŒ„ï¼‰ï¼š

```bash
## æª¢è¦–æ¨¡å‹è¨­å®š
cat ~/.opencode/models.json
```

#### è¨­å®š Claude Thinking æ¨¡å‹

æ‰¾åˆ° `antigravity-claude-sonnet-4-5-thinking` æˆ– `antigravity-claude-opus-4-5-thinking`ï¼Œæ–°å¢ variantsï¼š

```json
{
  "antigravity-claude-sonnet-4-5-thinking": {
    "name": "Claude Sonnet 4.5 Thinking",
    "limit": { "context": 200000, "output": 64000 },
    "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
    "variants": {
      "low": { "thinkingConfig": { "thinkingBudget": 8192 } },
      "medium": { "thinkingConfig": { "thinkingBudget": 16384 } },
      "max": { "thinkingConfig": { "thinkingBudget": 32768 } }
    }
  }
}
```

**è¨­å®šèªªæ˜**ï¼š
- `low`ï¼š8192 tokens - è¼•é‡æ€è€ƒï¼Œé©åˆä¸­ç­‰è¤‡é›œåº¦ä»»å‹™
- `medium`ï¼š16384 tokens - å¹³è¡¡æ€è€ƒèˆ‡é€Ÿåº¦
- `max`ï¼š32768 tokens - æœ€å¤§æ€è€ƒï¼Œé©åˆæœ€è¤‡é›œä»»å‹™

#### è¨­å®š Gemini 3 Thinking æ¨¡å‹

**Gemini 3 Pro**ï¼ˆåªæ”¯æ´ low/highï¼‰ï¼š

```json
{
  "antigravity-gemini-3-pro": {
    "name": "Gemini 3 Pro (Antigravity)",
    "limit": { "context": 1048576, "output": 65535 },
    "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
    "variants": {
      "low": { "thinkingLevel": "low" },
      "high": { "thinkingLevel": "high" }
    }
  }
}
```

**Gemini 3 Flash**ï¼ˆæ”¯æ´ all 4 levelsï¼‰ï¼š

```json
{
  "antigravity-gemini-3-flash": {
    "name": "Gemini 3 Flash (Antigravity)",
    "limit": { "context": 1048576, "output": 65536 },
    "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
    "variants": {
      "minimal": { "thinkingLevel": "minimal" },
      "low": { "thinkingLevel": "low" },
      "medium": { "thinkingLevel": "medium" },
      "high": { "thinkingLevel": "high" }
    }
  }
}
```

**è¨­å®šèªªæ˜**ï¼š
- `minimal`ï¼šæœ€ä½æ€è€ƒï¼Œæœ€å¿«å›æ‡‰ï¼ˆåƒ… Flashï¼‰
- `low`ï¼šè¼•é‡æ€è€ƒ
- `medium`ï¼šå¹³è¡¡æ€è€ƒï¼ˆåƒ… Flashï¼‰
- `high`ï¼šæœ€å¤§æ€è€ƒï¼ˆæœ€æ…¢ä½†æœ€æ·±å…¥ï¼‰

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šåœ¨ OpenCode çš„æ¨¡å‹é¸æ“‡å™¨ä¸­ï¼Œé¸æ“‡ Thinking æ¨¡å‹å¾Œå¯ä»¥çœ‹åˆ° variant ä¸‹æ‹‰é¸å–®ã€‚

### ç¬¬ 2 æ­¥ï¼šä½¿ç”¨ Thinking æ¨¡å‹ç™¼èµ·è«‹æ±‚

è¨­å®šå®Œæˆå¾Œï¼Œä½ å¯ä»¥é€é OpenCode é¸æ“‡æ¨¡å‹å’Œ variantï¼š

```bash
## ä½¿ç”¨ Claude Sonnet 4.5 Thinking (max)
opencode run "å¹«æˆ‘è¨­è¨ˆä¸€å€‹åˆ†æ•£å¼å¿«å–ç³»çµ±çš„æ¶æ§‹" \
  --model=google/antigravity-claude-sonnet-4-5-thinking \
  --variant=max

## ä½¿ç”¨ Gemini 3 Pro (high)
opencode run "åˆ†æé€™æ®µç¨‹å¼ç¢¼çš„æ•ˆèƒ½ç“¶é ¸" \
  --model=google/antigravity-gemini-3-pro \
  --variant=high

## ä½¿ç”¨ Gemini 3 Flash (minimal - æœ€å¿«)
opencode run "å¿«é€Ÿç¸½çµé€™å€‹æª”æ¡ˆçš„å…§å®¹" \
  --model=google/antigravity-gemini-3-flash \
  --variant=minimal
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼šæ¨¡å‹æœƒå…ˆè¼¸å‡º thinking blocksï¼ˆæ€è€ƒå…§å®¹ï¼‰ï¼Œç„¶å¾Œç”¢ç”Ÿæœ€çµ‚ç­”æ¡ˆã€‚

### ç¬¬ 3 æ­¥ï¼šç†è§£ Interleaved Thinking

Interleaved thinking æ˜¯ Claude æ¨¡å‹çš„ç‰¹æ®Šèƒ½åŠ›â€”â€”å®ƒå¯ä»¥åœ¨å·¥å…·å‘¼å«çš„å‰å¾Œé€²è¡Œæ€è€ƒã€‚

**å ´æ™¯ç¯„ä¾‹**ï¼šè®“ AI ä½¿ç”¨å·¥å…·ï¼ˆå¦‚æª”æ¡ˆæ“ä½œã€è³‡æ–™åº«æŸ¥è©¢ï¼‰å®Œæˆä»»å‹™æ™‚ï¼š

```
Thinking: æˆ‘éœ€è¦å…ˆè®€å–è¨­å®šæª”ï¼Œç„¶å¾Œæ ¹æ“šå…§å®¹æ±ºå®šä¸‹ä¸€æ­¥...

[å‘¼å«å·¥å…·: read_file("config.json")]

Tool Result: { "port": 8080, "mode": "production" }

Thinking: é€£æ¥åŸ æ˜¯ 8080ï¼Œç”Ÿç”¢æ¨¡å¼ã€‚æˆ‘éœ€è¦é©—è­‰è¨­å®šæ˜¯å¦æ­£ç¢º...

[å‘¼å«å·¥å…·: validate_config({ "port": 8080, "mode": "production" })]

Tool Result: { "valid": true }

Thinking: è¨­å®šæœ‰æ•ˆã€‚ç¾åœ¨æˆ‘å¯ä»¥å•Ÿå‹•æœå‹™äº†ã€‚

[ç”¢ç”Ÿæœ€çµ‚ç­”æ¡ˆ]
```

**ç‚ºä»€éº¼é‡è¦**ï¼š
- å·¥å…·å‘¼å«å‰å¾Œéƒ½æœ‰æ€è€ƒ â†’ æ›´æ™ºæ…§çš„æ±ºç­–
- é©æ‡‰å·¥å…·å›å‚³çµæœ â†’ å‹•æ…‹èª¿æ•´ç­–ç•¥
- é¿å…ç›²ç›®åŸ·è¡Œ â†’ æ¸›å°‘éŒ¯èª¤æ“ä½œ

::: tip å¤–æ›è‡ªå‹•è™•ç†

ä½ ä¸éœ€è¦æ‰‹å‹•è¨­å®š interleaved thinkingã€‚Antigravity Auth å¤–æ›æœƒè‡ªå‹•åµæ¸¬ Claude Thinking æ¨¡å‹ä¸¦æ³¨å…¥ç³»çµ±æŒ‡ä»¤ï¼š
- "Interleaved thinking is enabled. You may think between tool calls and after receiving tool results before deciding on next action or final answer."

:::

### ç¬¬ 4 æ­¥ï¼šæ§åˆ¶æ€è€ƒå€å¡Šä¿ç•™ç­–ç•¥

é è¨­æƒ…æ³ä¸‹ï¼Œå¤–æ›æœƒ**å‰é›¢æ€è€ƒå€å¡Š**ä»¥æé«˜å¯é æ€§ï¼ˆé¿å…ç°½åéŒ¯èª¤ï¼‰ã€‚å¦‚æœä½ æƒ³é–±è®€æ€è€ƒå…§å®¹ï¼Œéœ€è¦è¨­å®š `keep_thinking`ã€‚

#### ç‚ºä»€éº¼é è¨­å‰é›¢ï¼Ÿ

**ç°½åéŒ¯èª¤å•é¡Œ**ï¼š
- Thinking blocks åœ¨å¤šè¼ªå°è©±ä¸­éœ€è¦ç°½ååŒ¹é…
- å¦‚æœä¿ç•™æ‰€æœ‰æ€è€ƒå€å¡Šï¼Œå¯èƒ½å°è‡´ç°½åè¡çª
- å‰é›¢æ€è€ƒå€å¡Šæ˜¯æ›´ç©©å®šçš„æ–¹æ¡ˆï¼ˆä½†å¤±å»æ€è€ƒå…§å®¹ï¼‰

#### å•Ÿç”¨æ€è€ƒå€å¡Šä¿ç•™

å»ºç«‹æˆ–ç·¨è¼¯è¨­å®šæª”æ¡ˆï¼š

**Linux/macOS**ï¼š`~/.config/opencode/antigravity.json`

**Windows**ï¼š`%APPDATA%\opencode\antigravity.json`

```json
{
  "$schema": "https://raw.githubusercontent.com/NoeFabris/opencode-antigravity-auth/main/assets/antigravity.schema.json",
  "keep_thinking": true
}
```

æˆ–ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ï¼š

```bash
export OPENCODE_ANTIGRAVITY_KEEP_THINKING=1
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼š
- `keep_thinking: false`ï¼ˆé è¨­ï¼‰ï¼šåªçœ‹åˆ°æœ€çµ‚ç­”æ¡ˆï¼Œæ€è€ƒå€å¡Šè¢«éš±è—
- `keep_thinking: true`ï¼šçœ‹åˆ°å®Œæ•´æ€è€ƒéç¨‹ï¼ˆå¯èƒ½åœ¨æŸäº›å¤šè¼ªå°è©±ä¸­é‡åˆ°ç°½åéŒ¯èª¤ï¼‰

::: warning æ¨è–¦åšæ³•

- **ç”Ÿç”¢ç’°å¢ƒ**ï¼šä½¿ç”¨é è¨­ `keep_thinking: false`ï¼Œç¢ºä¿ç©©å®šæ€§
- **é™¤éŒ¯/å­¸ç¿’**ï¼šæš«æ™‚å•Ÿç”¨ `keep_thinking: true`ï¼Œè§€å¯Ÿæ€è€ƒéç¨‹
- **å¦‚æœé‡åˆ°ç°½åéŒ¯èª¤**ï¼šé—œé–‰ `keep_thinking`ï¼Œå¤–æ›æœƒè‡ªå‹•æ¢å¾©

:::

### ç¬¬ 5 æ­¥ï¼šæª¢æŸ¥ Max Output Tokens

Claude Thinking æ¨¡å‹éœ€è¦æ›´å¤§çš„è¼¸å‡ºä»¤ç‰Œé™åˆ¶ï¼ˆmaxOutputTokensï¼‰ï¼Œå¦å‰‡æ€è€ƒ budget å¯èƒ½ç„¡æ³•å®Œå…¨ä½¿ç”¨ã€‚

**å¤–æ›è‡ªå‹•è™•ç†**ï¼š
- å¦‚æœä½ è¨­å®šäº† thinking budgetï¼Œå¤–æ›æœƒè‡ªå‹•èª¿æ•´ `maxOutputTokens` åˆ° 64,000
- åŸå§‹ç¢¼ä½ç½®ï¼š`src/plugin/transform/claude.ts:78-90`

**æ‰‹å‹•è¨­å®šï¼ˆé¸ç”¨ï¼‰**ï¼š

å¦‚æœä½ æ‰‹å‹•è¨­å®š `maxOutputTokens`ï¼Œç¢ºä¿å®ƒå¤§æ–¼ thinking budgetï¼š

```json
{
  "antigravity-claude-sonnet-4-5-thinking": {
    "variants": {
      "max": {
        "thinkingConfig": { "thinkingBudget": 32768 },
        "maxOutputTokens": 64000  // å¿…é ˆ >= thinkingBudget
      }
    }
  }
}
```

**ä½ æ‡‰è©²çœ‹åˆ°**ï¼š
- å¦‚æœ `maxOutputTokens` éå°ï¼Œå¤–æ›æœƒè‡ªå‹•èª¿æ•´ç‚º 64,000
- é™¤éŒ¯æ—¥èªŒä¸­æœƒé¡¯ç¤º "Adjusted maxOutputTokens for thinking model"

---

## æª¢æŸ¥é» âœ…

é©—è­‰ä½ çš„è¨­å®šæ˜¯å¦æ­£ç¢ºï¼š

### 1. é©—è­‰ Variant å¯è¦‹æ€§

åœ¨ OpenCode ä¸­ï¼š

1. é–‹å•Ÿæ¨¡å‹é¸æ“‡å™¨
2. é¸æ“‡ `Claude Sonnet 4.5 Thinking`
3. æª¢æŸ¥æ˜¯å¦æœ‰ variant ä¸‹æ‹‰é¸å–®ï¼ˆlow/medium/maxï¼‰

**é æœŸçµæœ**ï¼šèƒ½çœ‹åˆ° 3 å€‹ variant é¸é …ã€‚

### 2. é©—è­‰ Thinking å…§å®¹è¼¸å‡º

```bash
opencode run "æ€è€ƒ 3 æ­¥ï¼š1+1=ï¼Ÿç‚ºä»€éº¼ï¼Ÿ" \
  --model=google/antigravity-claude-sonnet-4-5-thinking \
  --variant=max
```

**é æœŸçµæœ**ï¼š
- å¦‚æœ `keep_thinking: true`ï¼šçœ‹åˆ°è©³ç´°æ€è€ƒéç¨‹
- å¦‚æœ `keep_thinking: false`ï¼ˆé è¨­ï¼‰ï¼šç›´æ¥çœ‹åˆ°ç­”æ¡ˆ "2"

### 3. é©—è­‰ Interleaved Thinkingï¼ˆéœ€è¦å·¥å…·å‘¼å«ï¼‰

```bash
## ä½¿ç”¨éœ€è¦å·¥å…·å‘¼å«çš„ä»»å‹™
opencode run "è®€å–ç›®å‰ç›®éŒ„çš„æª”æ¡ˆåˆ—è¡¨ï¼Œç„¶å¾Œç¸½çµæª”æ¡ˆé¡å‹" \
  --model=google/antigravity-claude-sonnet-4-5-thinking \
  --variant=medium
```

**é æœŸçµæœ**ï¼š
- åœ¨å·¥å…·å‘¼å«å‰å¾Œçœ‹åˆ°æ€è€ƒå…§å®¹
- AI æœƒæ ¹æ“šå·¥å…·å›å‚³çµæœèª¿æ•´ç­–ç•¥

---

## è¸©å‘æé†’

### âŒ éŒ¯èª¤ 1ï¼šThinking Budget è¶…å‡º Max Output Tokens

**å•é¡Œ**ï¼šè¨­å®š `thinkingBudget: 32768`ï¼Œä½† `maxOutputTokens: 20000`

**éŒ¯èª¤è³‡è¨Š**ï¼š
```
Invalid argument: max_output_tokens must be greater than or equal to thinking_budget
```

**è§£æ±ºæ–¹æ³•**ï¼š
- è®“å¤–æ›è‡ªå‹•è™•ç†ï¼ˆæ¨è–¦ï¼‰
- æˆ–æ‰‹å‹•è¨­å®š `maxOutputTokens >= thinkingBudget`

### âŒ éŒ¯èª¤ 2ï¼šGemini 3 Pro ä½¿ç”¨ unsupported level

**å•é¡Œ**ï¼šGemini 3 Pro åªæ”¯æ´ low/highï¼Œä½†ä½ å˜—è©¦ä½¿ç”¨ `minimal`

**éŒ¯èª¤è³‡è¨Š**ï¼š
```
Invalid argument: thinking_level "minimal" not supported for gemini-3-pro
```

**è§£æ±ºæ–¹æ³•**ï¼šåªä½¿ç”¨ Pro æ”¯æ´çš„ levelsï¼ˆlow/highï¼‰

### âŒ éŒ¯èª¤ 3ï¼šå¤šè¼ªå°è©±ç°½åéŒ¯èª¤ï¼ˆkeep_thinking: trueï¼‰

**å•é¡Œ**ï¼šå•Ÿç”¨ `keep_thinking: true` å¾Œï¼Œå¤šè¼ªå°è©±é‡åˆ°éŒ¯èª¤

**éŒ¯èª¤è³‡è¨Š**ï¼š
```
Signature mismatch in thinking blocks
```

**è§£æ±ºæ–¹æ³•**ï¼š
- æš«æ™‚é—œé–‰ `keep_thinking`ï¼š`export OPENCODE_ANTIGRAVITY_KEEP_THINKING=0`
- æˆ–é‡æ–°é–‹å§‹æœƒè©±

### âŒ éŒ¯èª¤ 4ï¼šVariant ä¸é¡¯ç¤º

**å•é¡Œ**ï¼šè¨­å®šäº† variantsï¼Œä½†åœ¨ OpenCode æ¨¡å‹é¸æ“‡å™¨ä¸­çœ‹ä¸åˆ°

**å¯èƒ½åŸå› **ï¼š
- è¨­å®šæª”æ¡ˆè·¯å¾‘éŒ¯èª¤
- JSON èªæ³•éŒ¯èª¤ï¼ˆç¼ºå°‘é€—è™Ÿã€å¼•è™Ÿï¼‰
- æ¨¡å‹ ID ä¸åŒ¹é…

**è§£æ±ºæ–¹æ³•**ï¼š
1. æª¢æŸ¥è¨­å®šæª”æ¡ˆè·¯å¾‘ï¼š`~/.opencode/models.json` æˆ– `~/.config/opencode/models.json`
2. é©—è­‰ JSON èªæ³•ï¼š`cat ~/.opencode/models.json | python -m json.tool`
3. æª¢æŸ¥æ¨¡å‹ ID æ˜¯å¦èˆ‡å¤–æ›å›å‚³çš„ä¸€è‡´

---

## æœ¬èª²å°çµ

Thinking æ¨¡å‹é€éåœ¨ç”¢ç”Ÿç­”æ¡ˆå‰é€²è¡Œå…§éƒ¨æ¨ç†ï¼Œæå‡è¤‡é›œä»»å‹™çš„å›ç­”å“è³ªï¼š

| åŠŸèƒ½ | Claude Thinking | Gemini 3 Thinking |
| --- | --- | ---|
| **è¨­å®šæ–¹å¼** | `thinkingBudget`ï¼ˆæ•¸å­—ï¼‰ | `thinkingLevel`ï¼ˆå­—ä¸²ï¼‰ |
| **Levels** | è‡ªè¨‚ budget | minimal/low/medium/high |
| **Keys** | snake_caseï¼ˆ`include_thoughts`ï¼‰ | camelCaseï¼ˆ`includeThoughts`ï¼‰ |
| **Interleaved** | âœ… æ”¯æ´ | âŒ ä¸æ”¯æ´ |
| **Max Output** | è‡ªå‹•èª¿æ•´åˆ° 64,000 | ä½¿ç”¨é è¨­å€¼ |

**é—œéµè¨­å®š**ï¼š
- **Variant ç³»çµ±**ï¼šé€é `thinkingConfig.thinkingBudget`ï¼ˆClaudeï¼‰æˆ– `thinkingLevel`ï¼ˆGemini 3ï¼‰è¨­å®š
- **keep_thinking**ï¼šé è¨­ falseï¼ˆç©©å®šï¼‰ï¼Œtrueï¼ˆå¯è®€æ€è€ƒå…§å®¹ï¼‰
- **Interleaved thinking**ï¼šè‡ªå‹•å•Ÿç”¨ï¼Œç„¡éœ€æ‰‹å‹•è¨­å®š

---

## ä¸‹ä¸€èª²é å‘Š

> ä¸‹ä¸€èª²æˆ‘å€‘å­¸ç¿’ **[Google Search Grounding](../google-search-grounding/)**ã€‚
>
> ä½ æœƒå­¸åˆ°ï¼š
> - ç‚º Gemini æ¨¡å‹å•Ÿç”¨ Google Search æª¢ç´¢
> - è¨­å®šå‹•æ…‹æª¢ç´¢é–¾å€¼
> - æå‡äº‹å¯¦æº–ç¢ºæ€§ï¼Œæ¸›å°‘å¹»è¦º

---

## é™„éŒ„ï¼šåŸå§‹ç¢¼åƒè€ƒ

<details>
<summary><strong>é»æ“Šå±•é–‹æª¢è¦–åŸå§‹ç¢¼ä½ç½®</strong></summary>

> æ›´æ–°æ™‚é–“ï¼š2026-01-23

| åŠŸèƒ½ | æª”æ¡ˆè·¯å¾‘ | è¡Œè™Ÿ |
| --- | --- | ---|
| Claude Thinking è¨­å®šå»ºæ§‹ | [`src/plugin/transform/claude.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/claude.ts) | 62-72 |
| Gemini 3 Thinking è¨­å®šå»ºæ§‹ | [`src/plugin/transform/gemini.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/gemini.ts) | 163-171 |
| Gemini 2.5 Thinking è¨­å®šå»ºæ§‹ | [`src/plugin/transform/gemini.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/gemini.ts) | 176-184 |
| Claude Thinking æ¨¡å‹åµæ¸¬ | [`src/plugin/transform/claude.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/claude.ts) | 34-37 |
| Gemini 3 æ¨¡å‹åµæ¸¬ | [`src/plugin/transform/gemini.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/gemini.ts) | 137-139 |
| Interleaved Thinking Hint æ³¨å…¥ | [`src/plugin/transform/claude.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/claude.ts) | 96-138 |
| Max Output Tokens è‡ªå‹•èª¿æ•´ | [`src/plugin/transform/claude.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/claude.ts) | 78-90 |
| keep_thinking è¨­å®š Schema | [`src/plugin/config/schema.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/config/schema.ts) | 78-87 |
| Claude Thinking æ‡‰ç”¨è½‰æ› | [`src/plugin/transform/claude.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/claude.ts) | 324-366 |
| Gemini Thinking æ‡‰ç”¨è½‰æ› | [`src/plugin/transform/gemini.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/gemini.ts) | 372-434 |

**é—œéµå¸¸æ•¸**ï¼š
- `CLAUDE_THINKING_MAX_OUTPUT_TOKENS = 64_000`ï¼šClaude Thinking æ¨¡å‹çš„æœ€å¤§è¼¸å‡ºä»¤ç‰Œæ•¸
- `CLAUDE_INTERLEAVED_THINKING_HINT`ï¼šæ³¨å…¥åˆ°ç³»çµ±æŒ‡ä»¤çš„ interleaved thinking æç¤º

**é—œéµå‡½å¼**ï¼š
- `buildClaudeThinkingConfig(includeThoughts, thinkingBudget)`ï¼šå»ºæ§‹ Claude Thinking è¨­å®šï¼ˆsnake_case keysï¼‰
- `buildGemini3ThinkingConfig(includeThoughts, thinkingLevel)`ï¼šå»ºæ§‹ Gemini 3 Thinking è¨­å®šï¼ˆlevel stringï¼‰
- `buildGemini25ThinkingConfig(includeThoughts, thinkingBudget)`ï¼šå»ºæ§‹ Gemini 2.5 Thinking è¨­å®šï¼ˆnumeric budgetï¼‰
- `ensureClaudeMaxOutputTokens(generationConfig, thinkingBudget)`ï¼šç¢ºä¿ maxOutputTokens è¶³å¤ å¤§
- `appendClaudeThinkingHint(payload, hint)`ï¼šæ³¨å…¥ interleaved thinking hint
- `isClaudeThinkingModel(model)`ï¼šåµæ¸¬æ˜¯å¦ç‚º Claude Thinking æ¨¡å‹
- `isGemini3Model(model)`ï¼šåµæ¸¬æ˜¯å¦ç‚º Gemini 3 æ¨¡å‹

</details>
