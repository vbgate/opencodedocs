---
title: "Thinking æ¨¡å‹é…ç½® | opencode-antigravity-auth"
sidebarTitle: "è®© AI æ·±åº¦æ€è€ƒ"
subtitle: "Thinking æ¨¡å‹ï¼šClaude ä¸ Gemini 3 çš„æ€è€ƒèƒ½åŠ›"
description: "å­¦ä¹ é…ç½® Claude ä¸ Gemini 3 Thinking æ¨¡å‹ã€‚æŒæ¡ thinking budgetã€thinking level å’Œ variant é…ç½®æ–¹æ³•ã€‚"
tags:
  - "Thinking æ¨¡å‹"
  - "Claude Opus 4.5"
  - "Claude Sonnet 4.5"
  - "Gemini 3 Pro"
  - "Gemini 3 Flash"
  - "variant é…ç½®"
prerequisite:
  - "start-quick-install"
  - "start-first-request"
order: 4
---

# Thinking æ¨¡å‹ï¼šClaude ä¸ Gemini 3 çš„æ€è€ƒèƒ½åŠ›

## å­¦å®Œä½ èƒ½åšä»€ä¹ˆ

- é…ç½® Claude Opus 4.5ã€Sonnet 4.5 Thinking æ¨¡å‹çš„ thinking budget
- ä½¿ç”¨ Gemini 3 Pro/Flash çš„ thinking levelï¼ˆminimal/low/medium/highï¼‰
- é€šè¿‡ OpenCode variant ç³»ç»Ÿçµæ´»è°ƒæ•´æ€è€ƒå¼ºåº¦
- ç†è§£ interleaved thinkingï¼ˆå·¥å…·è°ƒç”¨æ—¶çš„æ€è€ƒæœºåˆ¶ï¼‰
- æŒæ¡æ€è€ƒå—ä¿ç•™ç­–ç•¥ï¼ˆkeep_thinking é…ç½®ï¼‰

## ä½ ç°åœ¨çš„å›°å¢ƒ

ä½ æƒ³è®© AI æ¨¡å‹åœ¨å¤æ‚ä»»åŠ¡ä¸Šè¡¨ç°æ›´å¥½â€”â€”æ¯”å¦‚å¤šæ­¥æ¨ç†ã€ä»£ç è°ƒè¯•æˆ–æ¶æ„è®¾è®¡ã€‚ä½†ä½ çŸ¥é“ï¼š

- æ™®é€šæ¨¡å‹å›ç­”å¤ªå¿«ï¼Œæ€è€ƒä¸å¤Ÿæ·±å…¥
- Claude å®˜æ–¹é™åˆ¶ thinking åŠŸèƒ½ï¼Œéš¾ä»¥è®¿é—®
- Gemini 3 çš„ thinking level é…ç½®ä¸æ¸…æ™°
- ä¸æ¸…æ¥š how much thinking is enoughï¼ˆbudget åº”è¯¥è®¾å¤šå°‘ï¼‰
- é˜…è¯»æ€è€ƒå—å†…å®¹æ—¶é‡åˆ°ç­¾åé”™è¯¯

## ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸€æ‹›

**é€‚ç”¨åœºæ™¯**ï¼š
- éœ€è¦å¤šæ­¥æ¨ç†çš„å¤æ‚é—®é¢˜ï¼ˆç®—æ³•è®¾è®¡ã€ç³»ç»Ÿæ¶æ„ï¼‰
- éœ€è¦ä»”ç»†æ€è€ƒçš„ä»£ç å®¡æŸ¥æˆ–è°ƒè¯•
- éœ€è¦æ·±åº¦åˆ†æçš„é•¿æ–‡æ¡£æˆ–ä»£ç åº“
- å·¥å…·è°ƒç”¨å¯†é›†çš„ä»»åŠ¡ï¼ˆéœ€è¦ interleaved thinkingï¼‰

**ä¸é€‚ç”¨åœºæ™¯**ï¼š
- ç®€å•é—®ç­”ï¼ˆæµªè´¹ thinking quotaï¼‰
- å¿«é€ŸåŸå‹éªŒè¯ï¼ˆé€Ÿåº¦ä¼˜å…ˆï¼‰
- äº‹å®æŸ¥è¯¢ï¼ˆä¸éœ€è¦æ¨ç†ï¼‰

## ğŸ’ å¼€å§‹å‰çš„å‡†å¤‡

::: warning å‰ç½®æ£€æŸ¥

 1. **å·²å®Œæˆæ’ä»¶å®‰è£…å’Œè®¤è¯**ï¼šå‚è€ƒ [å¿«é€Ÿå®‰è£…](../../start/quick-install/) å’Œ [é¦–æ¬¡è®¤è¯](../../start/first-auth-login/)
 2. **äº†è§£åŸºæœ¬æ¨¡å‹ä½¿ç”¨**ï¼šå‚è€ƒ [é¦–æ¬¡è¯·æ±‚](../../start/first-request/)
3. **æœ‰å¯ç”¨çš„ Thinking æ¨¡å‹**ï¼šç¡®ä¿ä½ çš„è´¦æˆ·æœ‰æƒé™è®¿é—® Claude Opus 4.5/Sonnet 4.5 Thinking æˆ– Gemini 3 Pro/Flash

:::

---

## æ ¸å¿ƒæ€è·¯

### ä»€ä¹ˆæ˜¯ Thinking æ¨¡å‹

**Thinking æ¨¡å‹**ä¼šåœ¨ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆå‰ï¼Œå…ˆè¿›è¡Œå†…éƒ¨æ¨ç†ï¼ˆthinking blocksï¼‰ã€‚è¿™äº›æ€è€ƒå†…å®¹ï¼š

- **ä¸è¢«è®¡è´¹**ï¼šThinking tokens ä¸è®¡å…¥å¸¸è§„è¾“å‡ºé…é¢ï¼ˆå…·ä½“è®¡è´¹è§„åˆ™ä»¥ Antigravity å®˜æ–¹ä¸ºå‡†ï¼‰
- **æå‡æ¨ç†è´¨é‡**ï¼šæ›´å¤šæ€è€ƒ â†’ æ›´å‡†ç¡®ã€æ›´æœ‰é€»è¾‘çš„å›ç­”
- **æ¶ˆè€—æ—¶é—´**ï¼šThinking å¢åŠ å“åº”å»¶è¿Ÿï¼Œä½†æ¢æ¥æ›´å¥½çš„ç»“æœ

**å…³é”®åŒºåˆ«**ï¼š

| æ™®é€šæ¨¡å‹ | Thinking æ¨¡å‹ |
| --------- | ------------- |
| ç›´æ¥ç”Ÿæˆç­”æ¡ˆ | å…ˆæ€è€ƒ â†’ å†ç”Ÿæˆç­”æ¡ˆ |
| å¿«é€Ÿä½†å¯èƒ½æµ…è–„ | æ…¢é€Ÿä½†æ›´æ·±å…¥ |
| é€‚åˆç®€å•ä»»åŠ¡ | é€‚åˆå¤æ‚ä»»åŠ¡ |

### ä¸¤ç§ Thinking å®ç°

Antigravity Auth æ’ä»¶æ”¯æŒä¸¤ç§ Thinking å®ç°ï¼š

#### Claude Thinkingï¼ˆOpus 4.5ã€Sonnet 4.5ï¼‰

- **Token-based budget**ï¼šç”¨æ•°å­—æ§åˆ¶æ€è€ƒé‡ï¼ˆå¦‚ 8192ã€32768ï¼‰
- **Interleaved thinking**ï¼šå¯ä»¥åœ¨å·¥å…·è°ƒç”¨å‰åæ€è€ƒ
- **Snake_case keys**ï¼šä½¿ç”¨ `include_thoughts`ã€`thinking_budget`

#### Gemini 3 Thinkingï¼ˆProã€Flashï¼‰

- **Level-based**ï¼šç”¨å­—ç¬¦ä¸²æ§åˆ¶æ€è€ƒå¼ºåº¦ï¼ˆminimal/low/medium/highï¼‰
- **CamelCase keys**ï¼šä½¿ç”¨ `includeThoughts`ã€`thinkingLevel`
- **æ¨¡å‹å·®å¼‚**ï¼šFlash æ”¯æŒ all 4 levelsï¼ŒPro åªæ”¯æŒ low/high

---

## è·Ÿæˆ‘åš

### ç¬¬ 1 æ­¥ï¼šé€šè¿‡ Variant é…ç½® Thinking æ¨¡å‹

OpenCode çš„ variant ç³»ç»Ÿè®©ä½ åœ¨æ¨¡å‹é€‰æ‹©å™¨ä¸­ç›´æ¥é€‰æ‹© thinking å¼ºåº¦ï¼Œè€Œæ— éœ€è®°å¿†å¤æ‚çš„æ¨¡å‹åã€‚

#### æ£€æŸ¥ç°æœ‰é…ç½®

æŸ¥çœ‹ä½ çš„æ¨¡å‹é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸åœ¨ `.opencode/models.json` æˆ–ç³»ç»Ÿé…ç½®ç›®å½•ï¼‰ï¼š

```bash
## æŸ¥çœ‹æ¨¡å‹é…ç½®
cat ~/.opencode/models.json
```

#### é…ç½® Claude Thinking æ¨¡å‹

æ‰¾åˆ° `antigravity-claude-sonnet-4-5-thinking` æˆ– `antigravity-claude-opus-4-5-thinking`ï¼Œæ·»åŠ  variantsï¼š

```json
{
  "antigravity-claude-sonnet-4-5-thinking": {
    "name": "Claude Sonnet 4.5 Thinking",
    "limit": { "context": 200000, "output": 64000 },
    "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
    "variants": {
      "low": { "thinkingConfig": { "thinkingBudget": 8192 } },
      "medium": { "thinkingConfig": { "thinkingBudget": 16384 } },
      "max": { "thinkingConfig": { "thinkingBudget": 32768 } }
    }
  }
}
```

**é…ç½®è¯´æ˜**ï¼š
- `low`ï¼š8192 tokens - è½»é‡æ€è€ƒï¼Œé€‚åˆä¸­ç­‰å¤æ‚åº¦ä»»åŠ¡
- `medium`ï¼š16384 tokens - å¹³è¡¡æ€è€ƒä¸é€Ÿåº¦
- `max`ï¼š32768 tokens - æœ€å¤§æ€è€ƒï¼Œé€‚åˆæœ€å¤æ‚ä»»åŠ¡

#### é…ç½® Gemini 3 Thinking æ¨¡å‹

**Gemini 3 Pro**ï¼ˆåªæ”¯æŒ low/highï¼‰ï¼š

```json
{
  "antigravity-gemini-3-pro": {
    "name": "Gemini 3 Pro (Antigravity)",
    "limit": { "context": 1048576, "output": 65535 },
    "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
    "variants": {
      "low": { "thinkingLevel": "low" },
      "high": { "thinkingLevel": "high" }
    }
  }
}
```

**Gemini 3 Flash**ï¼ˆæ”¯æŒ all 4 levelsï¼‰ï¼š

```json
{
  "antigravity-gemini-3-flash": {
    "name": "Gemini 3 Flash (Antigravity)",
    "limit": { "context": 1048576, "output": 65536 },
    "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
    "variants": {
      "minimal": { "thinkingLevel": "minimal" },
      "low": { "thinkingLevel": "low" },
      "medium": { "thinkingLevel": "medium" },
      "high": { "thinkingLevel": "high" }
    }
  }
}
```

**é…ç½®è¯´æ˜**ï¼š
- `minimal`ï¼šæœ€ä½æ€è€ƒï¼Œæœ€å¿«å“åº”ï¼ˆä»… Flashï¼‰
- `low`ï¼šè½»é‡æ€è€ƒ
- `medium`ï¼šå¹³è¡¡æ€è€ƒï¼ˆä»… Flashï¼‰
- `high`ï¼šæœ€å¤§æ€è€ƒï¼ˆæœ€æ…¢ä½†æœ€æ·±å…¥ï¼‰

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šåœ¨ OpenCode çš„æ¨¡å‹é€‰æ‹©å™¨ä¸­ï¼Œé€‰æ‹© Thinking æ¨¡å‹åå¯ä»¥çœ‹åˆ° variant ä¸‹æ‹‰èœå•ã€‚

### ç¬¬ 2 æ­¥ï¼šä½¿ç”¨ Thinking æ¨¡å‹å‘èµ·è¯·æ±‚

é…ç½®å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡ OpenCode é€‰æ‹©æ¨¡å‹å’Œ variantï¼š

```bash
## ä½¿ç”¨ Claude Sonnet 4.5 Thinking (max)
opencode run "å¸®æˆ‘è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿçš„æ¶æ„" \
  --model=google/antigravity-claude-sonnet-4-5-thinking \
  --variant=max

## ä½¿ç”¨ Gemini 3 Pro (high)
opencode run "åˆ†æè¿™æ®µä»£ç çš„æ€§èƒ½ç“¶é¢ˆ" \
  --model=google/antigravity-gemini-3-pro \
  --variant=high

## ä½¿ç”¨ Gemini 3 Flash (minimal - æœ€å¿«)
opencode run "å¿«é€Ÿæ€»ç»“è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹" \
  --model=google/antigravity-gemini-3-flash \
  --variant=minimal
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šæ¨¡å‹ä¼šå…ˆè¾“å‡º thinking blocksï¼ˆæ€è€ƒå†…å®¹ï¼‰ï¼Œç„¶åç”Ÿæˆæœ€ç»ˆç­”æ¡ˆã€‚

### ç¬¬ 3 æ­¥ï¼šç†è§£ Interleaved Thinking

Interleaved thinking æ˜¯ Claude æ¨¡å‹çš„ç‰¹æ®Šèƒ½åŠ›â€”â€”å®ƒå¯ä»¥åœ¨å·¥å…·è°ƒç”¨çš„å‰åè¿›è¡Œæ€è€ƒã€‚

**åœºæ™¯ç¤ºä¾‹**ï¼šè®© AI ä½¿ç”¨å·¥å…·ï¼ˆå¦‚æ–‡ä»¶æ“ä½œã€æ•°æ®åº“æŸ¥è¯¢ï¼‰å®Œæˆä»»åŠ¡æ—¶ï¼š

```
Thinking: æˆ‘éœ€è¦å…ˆè¯»å–é…ç½®æ–‡ä»¶ï¼Œç„¶åæ ¹æ®å†…å®¹å†³å®šä¸‹ä¸€æ­¥...

[è°ƒç”¨å·¥å…·: read_file("config.json")]

Tool Result: { "port": 8080, "mode": "production" }

Thinking: ç«¯å£æ˜¯ 8080ï¼Œç”Ÿäº§æ¨¡å¼ã€‚æˆ‘éœ€è¦éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®...

[è°ƒç”¨å·¥å…·: validate_config({ "port": 8080, "mode": "production" })]

Tool Result: { "valid": true }

Thinking: é…ç½®æœ‰æ•ˆã€‚ç°åœ¨æˆ‘å¯ä»¥å¯åŠ¨æœåŠ¡äº†ã€‚

[ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ]
```

**ä¸ºä»€ä¹ˆé‡è¦**ï¼š
- å·¥å…·è°ƒç”¨å‰åéƒ½æœ‰æ€è€ƒ â†’ æ›´æ™ºèƒ½çš„å†³ç­–
- é€‚åº”å·¥å…·è¿”å›ç»“æœ â†’ åŠ¨æ€è°ƒæ•´ç­–ç•¥
- é¿å…ç›²ç›®æ‰§è¡Œ â†’ å‡å°‘é”™è¯¯æ“ä½œ

::: tip æ’ä»¶è‡ªåŠ¨å¤„ç†

ä½ ä¸éœ€è¦æ‰‹åŠ¨é…ç½® interleaved thinkingã€‚Antigravity Auth æ’ä»¶ä¼šè‡ªåŠ¨æ£€æµ‹ Claude Thinking æ¨¡å‹å¹¶æ³¨å…¥ç³»ç»ŸæŒ‡ä»¤ï¼š
- "Interleaved thinking is enabled. You may think between tool calls and after receiving tool results before deciding on next action or final answer."

:::

### ç¬¬ 4 æ­¥ï¼šæ§åˆ¶æ€è€ƒå—ä¿ç•™ç­–ç•¥

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ’ä»¶ä¼š**å‰¥ç¦»æ€è€ƒå—**ä»¥æé«˜å¯é æ€§ï¼ˆé¿å…ç­¾åé”™è¯¯ï¼‰ã€‚å¦‚æœä½ æƒ³é˜…è¯»æ€è€ƒå†…å®¹ï¼Œéœ€è¦é…ç½® `keep_thinking`ã€‚

#### ä¸ºä»€ä¹ˆé»˜è®¤å‰¥ç¦»ï¼Ÿ

**ç­¾åé”™è¯¯é—®é¢˜**ï¼š
- Thinking blocks åœ¨å¤šè½®å¯¹è¯ä¸­éœ€è¦ç­¾ååŒ¹é…
- å¦‚æœä¿ç•™æ‰€æœ‰æ€è€ƒå—ï¼Œå¯èƒ½å¯¼è‡´ç­¾åå†²çª
- å‰¥ç¦»æ€è€ƒå—æ˜¯æ›´ç¨³å®šçš„æ–¹æ¡ˆï¼ˆä½†å¤±å»æ€è€ƒå†…å®¹ï¼‰

#### å¯ç”¨æ€è€ƒå—ä¿ç•™

åˆ›å»ºæˆ–ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

**Linux/macOS**ï¼š`~/.config/opencode/antigravity.json`

**Windows**ï¼š`%APPDATA%\opencode\antigravity.json`

```json
{
  "$schema": "https://raw.githubusercontent.com/NoeFabris/opencode-antigravity-auth/main/assets/antigravity.schema.json",
  "keep_thinking": true
}
```

æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```bash
export OPENCODE_ANTIGRAVITY_KEEP_THINKING=1
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š
- `keep_thinking: false`ï¼ˆé»˜è®¤ï¼‰ï¼šåªçœ‹åˆ°æœ€ç»ˆç­”æ¡ˆï¼Œæ€è€ƒå—è¢«éšè—
- `keep_thinking: true`ï¼šçœ‹åˆ°å®Œæ•´æ€è€ƒè¿‡ç¨‹ï¼ˆå¯èƒ½åœ¨æŸäº›å¤šè½®å¯¹è¯ä¸­é‡åˆ°ç­¾åé”™è¯¯ï¼‰

::: warning æ¨èåšæ³•

- **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨é»˜è®¤ `keep_thinking: false`ï¼Œç¡®ä¿ç¨³å®šæ€§
- **è°ƒè¯•/å­¦ä¹ **ï¼šä¸´æ—¶å¯ç”¨ `keep_thinking: true`ï¼Œè§‚å¯Ÿæ€è€ƒè¿‡ç¨‹
- **å¦‚æœé‡åˆ°ç­¾åé”™è¯¯**ï¼šå…³é—­ `keep_thinking`ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨æ¢å¤

:::

### ç¬¬ 5 æ­¥ï¼šæ£€æŸ¥ Max Output Tokens

Claude Thinking æ¨¡å‹éœ€è¦æ›´å¤§çš„è¾“å‡ºä»¤ç‰Œé™åˆ¶ï¼ˆmaxOutputTokensï¼‰ï¼Œå¦åˆ™æ€è€ƒ budget å¯èƒ½æ— æ³•å®Œå…¨ä½¿ç”¨ã€‚

**æ’ä»¶è‡ªåŠ¨å¤„ç†**ï¼š
- å¦‚æœä½ è®¾ç½®äº† thinking budgetï¼Œæ’ä»¶ä¼šè‡ªåŠ¨è°ƒæ•´ `maxOutputTokens` åˆ° 64,000
- æºç ä½ç½®ï¼š`src/plugin/transform/claude.ts:78-90`

**æ‰‹åŠ¨é…ç½®ï¼ˆå¯é€‰ï¼‰**ï¼š

å¦‚æœä½ æ‰‹åŠ¨è®¾ç½® `maxOutputTokens`ï¼Œç¡®ä¿å®ƒå¤§äº thinking budgetï¼š

```json
{
  "antigravity-claude-sonnet-4-5-thinking": {
    "variants": {
      "max": {
        "thinkingConfig": { "thinkingBudget": 32768 },
        "maxOutputTokens": 64000  // å¿…é¡» >= thinkingBudget
      }
    }
  }
}
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š
- å¦‚æœ `maxOutputTokens` è¿‡å°ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨è°ƒæ•´ä¸º 64,000
- è°ƒè¯•æ—¥å¿—ä¸­ä¼šæ˜¾ç¤º "Adjusted maxOutputTokens for thinking model"

---

## æ£€æŸ¥ç‚¹ âœ…

éªŒè¯ä½ çš„é…ç½®æ˜¯å¦æ­£ç¡®ï¼š

### 1. éªŒè¯ Variant å¯è§æ€§

åœ¨ OpenCode ä¸­ï¼š

1. æ‰“å¼€æ¨¡å‹é€‰æ‹©å™¨
2. é€‰æ‹© `Claude Sonnet 4.5 Thinking`
3. æ£€æŸ¥æ˜¯å¦æœ‰ variant ä¸‹æ‹‰èœå•ï¼ˆlow/medium/maxï¼‰

**é¢„æœŸç»“æœ**ï¼šèƒ½çœ‹åˆ° 3 ä¸ª variant é€‰é¡¹ã€‚

### 2. éªŒè¯ Thinking å†…å®¹è¾“å‡º

```bash
opencode run "æ€è€ƒ 3 æ­¥ï¼š1+1=ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" \
  --model=google/antigravity-claude-sonnet-4-5-thinking \
  --variant=max
```

**é¢„æœŸç»“æœ**ï¼š
- å¦‚æœ `keep_thinking: true`ï¼šçœ‹åˆ°è¯¦ç»†æ€è€ƒè¿‡ç¨‹
- å¦‚æœ `keep_thinking: false`ï¼ˆé»˜è®¤ï¼‰ï¼šç›´æ¥çœ‹åˆ°ç­”æ¡ˆ "2"

### 3. éªŒè¯ Interleaved Thinkingï¼ˆéœ€è¦å·¥å…·è°ƒç”¨ï¼‰

```bash
## ä½¿ç”¨éœ€è¦å·¥å…·è°ƒç”¨çš„ä»»åŠ¡
opencode run "è¯»å–å½“å‰ç›®å½•çš„æ–‡ä»¶åˆ—è¡¨ï¼Œç„¶åæ€»ç»“æ–‡ä»¶ç±»å‹" \
  --model=google/antigravity-claude-sonnet-4-5-thinking \
  --variant=medium
```

**é¢„æœŸç»“æœ**ï¼š
- åœ¨å·¥å…·è°ƒç”¨å‰åçœ‹åˆ°æ€è€ƒå†…å®¹
- AI ä¼šæ ¹æ®å·¥å…·è¿”å›ç»“æœè°ƒæ•´ç­–ç•¥

---

## è¸©å‘æé†’

### âŒ é”™è¯¯ 1ï¼šThinking Budget è¶…å‡º Max Output Tokens

**é—®é¢˜**ï¼šè®¾ç½® `thinkingBudget: 32768`ï¼Œä½† `maxOutputTokens: 20000`

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Invalid argument: max_output_tokens must be greater than or equal to thinking_budget
```

**è§£å†³æ–¹æ³•**ï¼š
- è®©æ’ä»¶è‡ªåŠ¨å¤„ç†ï¼ˆæ¨èï¼‰
- æˆ–æ‰‹åŠ¨è®¾ç½® `maxOutputTokens >= thinkingBudget`

### âŒ é”™è¯¯ 2ï¼šGemini 3 Pro ä½¿ç”¨ unsupported level

**é—®é¢˜**ï¼šGemini 3 Pro åªæ”¯æŒ low/highï¼Œä½†ä½ å°è¯•ä½¿ç”¨ `minimal`

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Invalid argument: thinking_level "minimal" not supported for gemini-3-pro
```

**è§£å†³æ–¹æ³•**ï¼šåªä½¿ç”¨ Pro æ”¯æŒçš„ levelsï¼ˆlow/highï¼‰

### âŒ é”™è¯¯ 3ï¼šå¤šè½®å¯¹è¯ç­¾åé”™è¯¯ï¼ˆkeep_thinking: trueï¼‰

**é—®é¢˜**ï¼šå¯ç”¨ `keep_thinking: true` åï¼Œå¤šè½®å¯¹è¯é‡åˆ°é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Signature mismatch in thinking blocks
```

**è§£å†³æ–¹æ³•**ï¼š
- ä¸´æ—¶å…³é—­ `keep_thinking`ï¼š`export OPENCODE_ANTIGRAVITY_KEEP_THINKING=0`
- æˆ–é‡æ–°å¼€å§‹ä¼šè¯

### âŒ é”™è¯¯ 4ï¼šVariant ä¸æ˜¾ç¤º

**é—®é¢˜**ï¼šé…ç½®äº† variantsï¼Œä½†åœ¨ OpenCode æ¨¡å‹é€‰æ‹©å™¨ä¸­çœ‹ä¸åˆ°

**å¯èƒ½åŸå› **ï¼š
- é…ç½®æ–‡ä»¶è·¯å¾„é”™è¯¯
- JSON è¯­æ³•é”™è¯¯ï¼ˆç¼ºå°‘é€—å·ã€å¼•å·ï¼‰
- æ¨¡å‹ ID ä¸åŒ¹é…

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥é…ç½®æ–‡ä»¶è·¯å¾„ï¼š`~/.opencode/models.json` æˆ– `~/.config/opencode/models.json`
2. éªŒè¯ JSON è¯­æ³•ï¼š`cat ~/.opencode/models.json | python -m json.tool`
3. æ£€æŸ¥æ¨¡å‹ ID æ˜¯å¦ä¸æ’ä»¶è¿”å›çš„ä¸€è‡´

---

## æœ¬è¯¾å°ç»“

Thinking æ¨¡å‹é€šè¿‡åœ¨ç”Ÿæˆç­”æ¡ˆå‰è¿›è¡Œå†…éƒ¨æ¨ç†ï¼Œæå‡å¤æ‚ä»»åŠ¡çš„å›ç­”è´¨é‡ï¼š

| åŠŸèƒ½ | Claude Thinking | Gemini 3 Thinking |
|------|---------------|-----------------|
| **é…ç½®æ–¹å¼** | `thinkingBudget`ï¼ˆæ•°å­—ï¼‰ | `thinkingLevel`ï¼ˆå­—ç¬¦ä¸²ï¼‰ |
| **Levels** | è‡ªå®šä¹‰ budget | minimal/low/medium/high |
| **Keys** | snake_caseï¼ˆ`include_thoughts`ï¼‰ | camelCaseï¼ˆ`includeThoughts`ï¼‰ |
| **Interleaved** | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **Max Output** | è‡ªåŠ¨è°ƒæ•´åˆ° 64,000 | ä½¿ç”¨é»˜è®¤å€¼ |

**å…³é”®é…ç½®**ï¼š
- **Variant ç³»ç»Ÿ**ï¼šé€šè¿‡ `thinkingConfig.thinkingBudget`ï¼ˆClaudeï¼‰æˆ– `thinkingLevel`ï¼ˆGemini 3ï¼‰é…ç½®
- **keep_thinking**ï¼šé»˜è®¤ falseï¼ˆç¨³å®šï¼‰ï¼Œtrueï¼ˆå¯è¯»æ€è€ƒå†…å®¹ï¼‰
- **Interleaved thinking**ï¼šè‡ªåŠ¨å¯ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®

---

## ä¸‹ä¸€è¯¾é¢„å‘Š

> ä¸‹ä¸€è¯¾æˆ‘ä»¬å­¦ä¹  **[Google Search Grounding](../google-search-grounding/)**ã€‚
>
> ä½ ä¼šå­¦åˆ°ï¼š
> - ä¸º Gemini æ¨¡å‹å¯ç”¨ Google Search æ£€ç´¢
> - é…ç½®åŠ¨æ€æ£€ç´¢é˜ˆå€¼
> - æå‡äº‹å®å‡†ç¡®æ€§ï¼Œå‡å°‘å¹»è§‰

---

## é™„å½•ï¼šæºç å‚è€ƒ

<details>
<summary><strong>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æºç ä½ç½®</strong></summary>

> æ›´æ–°æ—¶é—´ï¼š2026-01-23

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œå· |
|------|---------|------|
| Claude Thinking é…ç½®æ„å»º | [`src/plugin/transform/claude.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/claude.ts) | 62-72 |
| Gemini 3 Thinking é…ç½®æ„å»º | [`src/plugin/transform/gemini.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/gemini.ts) | 163-171 |
| Gemini 2.5 Thinking é…ç½®æ„å»º | [`src/plugin/transform/gemini.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/gemini.ts) | 176-184 |
| Claude Thinking æ¨¡å‹æ£€æµ‹ | [`src/plugin/transform/claude.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/claude.ts) | 34-37 |
| Gemini 3 æ¨¡å‹æ£€æµ‹ | [`src/plugin/transform/gemini.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/gemini.ts) | 137-139 |
| Interleaved Thinking Hint æ³¨å…¥ | [`src/plugin/transform/claude.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/claude.ts) | 96-138 |
| Max Output Tokens è‡ªåŠ¨è°ƒæ•´ | [`src/plugin/transform/claude.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/claude.ts) | 78-90 |
| keep_thinking é…ç½® Schema | [`src/plugin/config/schema.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/config/schema.ts) | 78-87 |
| Claude Thinking åº”ç”¨è½¬æ¢ | [`src/plugin/transform/claude.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/claude.ts) | 324-366 |
| Gemini Thinking åº”ç”¨è½¬æ¢ | [`src/plugin/transform/gemini.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/transform/gemini.ts) | 372-434 |

**å…³é”®å¸¸é‡**ï¼š
- `CLAUDE_THINKING_MAX_OUTPUT_TOKENS = 64_000`ï¼šClaude Thinking æ¨¡å‹çš„æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•°
- `CLAUDE_INTERLEAVED_THINKING_HINT`ï¼šæ³¨å…¥åˆ°ç³»ç»ŸæŒ‡ä»¤çš„ interleaved thinking æç¤º

**å…³é”®å‡½æ•°**ï¼š
- `buildClaudeThinkingConfig(includeThoughts, thinkingBudget)`ï¼šæ„å»º Claude Thinking é…ç½®ï¼ˆsnake_case keysï¼‰
- `buildGemini3ThinkingConfig(includeThoughts, thinkingLevel)`ï¼šæ„å»º Gemini 3 Thinking é…ç½®ï¼ˆlevel stringï¼‰
- `buildGemini25ThinkingConfig(includeThoughts, thinkingBudget)`ï¼šæ„å»º Gemini 2.5 Thinking é…ç½®ï¼ˆnumeric budgetï¼‰
- `ensureClaudeMaxOutputTokens(generationConfig, thinkingBudget)`ï¼šç¡®ä¿ maxOutputTokens è¶³å¤Ÿå¤§
- `appendClaudeThinkingHint(payload, hint)`ï¼šæ³¨å…¥ interleaved thinking hint
- `isClaudeThinkingModel(model)`ï¼šæ£€æµ‹æ˜¯å¦ä¸º Claude Thinking æ¨¡å‹
- `isGemini3Model(model)`ï¼šæ£€æµ‹æ˜¯å¦ä¸º Gemini 3 æ¨¡å‹

</details>
