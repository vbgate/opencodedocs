---
title: "å¤šè´¦æˆ·è®¾ç½®: é…é¢æ± åŒ–ä¸è´Ÿè½½å‡è¡¡ | opencode-antigravity-auth"
sidebarTitle: "è¯•è¯•å¤šè´¦å·"
subtitle: "å¤šè´¦æˆ·è®¾ç½®ï¼šé…é¢æ± åŒ–ä¸è´Ÿè½½å‡è¡¡"
description: "å­¦ä¹ å¦‚ä½•é…ç½®å¤šä¸ª Google è´¦æˆ·å®ç°é…é¢æ± åŒ–ä¸è´Ÿè½½å‡è¡¡ã€‚æŒæ¡åŒé…é¢ç³»ç»Ÿã€è´¦æˆ·é€‰æ‹©ç­–ç•¥å’Œ PID åç§»é…ç½®ï¼Œæœ€å¤§åŒ– API é…é¢åˆ©ç”¨ç‡ã€‚"
tags:
  - "advanced"
  - "multi-account"
  - "load-balancing"
  - "quota-management"
prerequisite:
  - "start-quick-install"
  - "start-first-auth-login"
order: 4
---

# å¤šè´¦æˆ·è®¾ç½®ï¼šé…é¢æ± åŒ–ä¸è´Ÿè½½å‡è¡¡

## å­¦å®Œä½ èƒ½åšä»€ä¹ˆ

- æ·»åŠ å¤šä¸ª Google è´¦æˆ·ï¼Œæå‡æ€»ä½“é…é¢ä¸Šé™
- ç†è§£åŒé…é¢ç³»ç»Ÿï¼Œæœ‰æ•ˆåˆ©ç”¨ Antigravity å’Œ Gemini CLI é…é¢æ± 
- æ ¹æ®è´¦æˆ·æ•°é‡å’Œä½¿ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„è´Ÿè½½å‡è¡¡ç­–ç•¥
- æ’æŸ¥å¤šè´¦æˆ·é…ç½®ä¸­çš„å¸¸è§é—®é¢˜

## ä½ ç°åœ¨çš„å›°å¢ƒ

å•è´¦æˆ·ä½¿ç”¨æ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™äº›ç—›ç‚¹ï¼š

- é¢‘ç¹é‡åˆ° 429 é€Ÿç‡é™åˆ¶é”™è¯¯ï¼Œä¸å¾—ä¸ç­‰å¾…é…é¢æ¢å¤
- å¼€å‘/æµ‹è¯•åœºæ™¯ä¸­å¹¶å‘è¯·æ±‚å¤ªå¤šï¼Œä¸€ä¸ªè´¦æˆ·æ‰›ä¸ä½
- Gemini 3 Pro æˆ– Claude Opus æ¨¡å‹çš„é…é¢ç”¨å®Œåï¼Œåªèƒ½ç­‰å¾…ç¬¬äºŒå¤©
- å¹¶è¡Œè¿è¡Œå¤šä¸ª OpenCode å®ä¾‹æˆ– oh-my-opencode å­ä»£ç†æ—¶ï¼Œè´¦æˆ·é—´ç«äº‰æ¿€çƒˆ

## ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸€æ‹›

å¤šè´¦æˆ·é…ç½®é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š

| åœºæ™¯ | æ¨èè´¦æˆ·æ•° | åŸå›  |
|--- | --- | ---|
| ä¸ªäººå¼€å‘ | 2-3 ä¸ª | å¤‡ç”¨è´¦æˆ·ï¼Œé¿å…ä¸­æ–­ |
| å›¢é˜Ÿåä½œ | 3-5 ä¸ª | åˆ†æ‘Šè¯·æ±‚ï¼Œå‡å°‘ç«äº‰ |
| é«˜é¢‘ API è°ƒç”¨ | 5+ ä¸ª | è´Ÿè½½å‡è¡¡ï¼Œæœ€å¤§åŒ–åå |
| å¹¶è¡Œä»£ç† | 3+ ä¸ª + PID åç§» | æ¯ä¸ª Agent ç‹¬ç«‹è´¦æˆ· |

::: warning å‰ç½®æ£€æŸ¥
å¼€å§‹æœ¬æ•™ç¨‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»å®Œæˆï¼š
- âœ… å®‰è£…äº† opencode-antigravity-auth æ’ä»¶
- âœ… æˆåŠŸé€šè¿‡ OAuth è®¤è¯å¹¶æ·»åŠ äº†ç¬¬ä¸€ä¸ªè´¦æˆ·
- âœ… å¯ä»¥ä½¿ç”¨ Antigravity æ¨¡å‹å‘èµ·è¯·æ±‚

[å¿«é€Ÿå®‰è£…æ•™ç¨‹](../../start/quick-install/) | [é¦–æ¬¡ç™»å½•æ•™ç¨‹](../../start/first-auth-login/)
:::

## æ ¸å¿ƒæ€è·¯

å¤šè´¦æˆ·é…ç½®çš„æ ¸å¿ƒæœºåˆ¶ï¼š

1. **é…é¢æ± åŒ–**ï¼šæ¯ä¸ª Google è´¦æˆ·éƒ½æœ‰ç‹¬ç«‹çš„é…é¢ï¼Œå¤šä¸ªè´¦æˆ·çš„é…é¢å åŠ åå½¢æˆæ›´å¤§çš„æ€»æ± 
2. **è´Ÿè½½å‡è¡¡**ï¼šæ’ä»¶è‡ªåŠ¨é€‰æ‹©å¯ç”¨è´¦æˆ·ï¼Œé‡åˆ°é€Ÿç‡é™åˆ¶æ—¶åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªè´¦æˆ·
3. **åŒé…é¢ç³»ç»Ÿ**ï¼ˆä»… Geminiï¼‰ï¼šæ¯ä¸ªè´¦æˆ·å¯è®¿é—® Antigravity å’Œ Gemini CLI ä¸¤ä¸ªç‹¬ç«‹çš„é…é¢æ± 
4. **æ™ºèƒ½æ¢å¤**ï¼šé€Ÿç‡é™åˆ¶å»é‡ï¼ˆ2 ç§’çª—å£ï¼‰+ æŒ‡æ•°é€€é¿ï¼Œé¿å…æ— æ•ˆé‡è¯•

**é…é¢è®¡ç®—ç¤ºä¾‹**ï¼š

å‡è®¾æ¯ä¸ªè´¦æˆ·çš„ Claude é…é¢ä¸º 1000 è¯·æ±‚/åˆ†é’Ÿï¼š

| è´¦æˆ·æ•° | ç†è®ºæ€»é…é¢ | å®é™…å¯ç”¨ï¼ˆè€ƒè™‘ç¼“å­˜ï¼‰ |
|--- | --- | ---|
| 1      | 1000/min   | 1000/min          |
| 3      | 3000/min   | ~2500/minï¼ˆsticky ç­–ç•¥ï¼‰ |
| 5      | 5000/min   | ~4000/minï¼ˆround-robinï¼‰ |

> ğŸ’¡ **ä¸ºä»€ä¹ˆ sticky ç­–ç•¥å¯ç”¨é…é¢æ›´ä½ï¼Ÿ**
>
> sticky ç­–ç•¥ä¼šä¿æŒä½¿ç”¨åŒä¸€è´¦æˆ·ç›´åˆ°é™é€Ÿï¼Œå¯¼è‡´å…¶ä»–è´¦æˆ·é…é¢é—²ç½®ã€‚ä½†è¿™æ ·åšçš„å¥½å¤„æ˜¯ä¿ç•™äº† Anthropic çš„æç¤ºè¯ç¼“å­˜ï¼Œæå‡å“åº”é€Ÿåº¦ã€‚

## è·Ÿæˆ‘åš

### ç¬¬ 1 æ­¥ï¼šæ·»åŠ ç¬¬äºŒä¸ªè´¦æˆ·

**ä¸ºä»€ä¹ˆ**
æ·»åŠ ç¬¬äºŒä¸ªè´¦æˆ·åï¼Œå½“ä¸»è´¦æˆ·é‡åˆ°é€Ÿç‡é™åˆ¶æ—¶ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨è´¦æˆ·ï¼Œé¿å…è¯·æ±‚å¤±è´¥ã€‚

**æ“ä½œ**

è¿è¡Œ OAuth ç™»å½•å‘½ä»¤ï¼š

```bash
opencode auth login
```

å¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªè´¦æˆ·ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹æç¤ºï¼š

```
1 account(s) saved:
  1. user1@gmail.com

(a)dd new account(s) or (f)resh start? [a/f]:
```

è¾“å…¥ `a` å¹¶å›è½¦ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ Google æˆæƒé¡µé¢ã€‚

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š

1. æµè§ˆå™¨æ‰“å¼€ Google OAuth æˆæƒé¡µé¢
2. é€‰æ‹©æˆ–ç™»å½•ä½ çš„ç¬¬äºŒä¸ª Google è´¦æˆ·
3. åŒæ„æˆæƒåï¼Œç»ˆç«¯æ˜¾ç¤ºï¼š

```
Account added successfully!

2 account(s) saved:
  1. user1@gmail.com
  2. user2@gmail.com
```

::: tip
å¦‚æœæµè§ˆå™¨æ²¡æœ‰è‡ªåŠ¨æ‰“å¼€ï¼Œå¤åˆ¶ç»ˆç«¯æ˜¾ç¤ºçš„ OAuth URL å¹¶æ‰‹åŠ¨ç²˜è´´åˆ°æµè§ˆå™¨ä¸­ã€‚
:::

### ç¬¬ 2 æ­¥ï¼šéªŒè¯å¤šè´¦æˆ·çŠ¶æ€

**ä¸ºä»€ä¹ˆ**
ç¡®è®¤è´¦æˆ·å·²æ­£ç¡®æ·»åŠ å¹¶å¯ç”¨ã€‚

**æ“ä½œ**

æŸ¥çœ‹è´¦æˆ·å­˜å‚¨æ–‡ä»¶ï¼š

```bash
cat ~/.config/opencode/antigravity-accounts.json
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š

```json
{
  "version": 3,
  "accounts": [
    {
      "email": "user1@gmail.com",
      "refreshToken": "1//0abc...",
      "projectId": "project-id-123",
      "addedAt": 1737609600000,
      "lastUsed": 1737609600000
    },
    {
      "email": "user2@gmail.com",
      "refreshToken": "1//0xyz...",
      "addedAt": 1737609700000,
      "lastUsed": 1737609700000
    }
  ],
  "activeIndex": 0,
  "activeIndexByFamily": {
    "claude": 0,
    "gemini": 0
  }
}
```

::: warning å®‰å…¨æé†’
`antigravity-accounts.json` åŒ…å« OAuth refresh tokensï¼Œç­‰åŒäºå¯†ç æ–‡ä»¶ã€‚è¯·å‹¿æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚
:::

### ç¬¬ 3 æ­¥ï¼šæµ‹è¯•è´¦æˆ·åˆ‡æ¢

**ä¸ºä»€ä¹ˆ**
éªŒè¯å¤šè´¦æˆ·è´Ÿè½½å‡è¡¡æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

**æ“ä½œ**

å‘é€å¤šä¸ªå¹¶å‘è¯·æ±‚è§¦å‘é€Ÿç‡é™åˆ¶ï¼š

```bash
# macOS/Linux
for i in {1..10}; do
  opencode run "Test $i" --model=google/antigravity-claude-sonnet-4-5 &
done
wait

# Windows PowerShell
1..10 | ForEach-Object {
  Start-Process -FilePath "opencode" -ArgumentList "run","Test $_","--model=google/antigravity-claude-sonnet-4-5"
}
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š

1. å‰ N ä¸ªè¯·æ±‚ä½¿ç”¨è´¦æˆ· 1ï¼ˆuser1@gmail.comï¼‰
2. é‡åˆ° 429 åï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°è´¦æˆ· 2ï¼ˆuser2@gmail.comï¼‰
3. å¦‚æœå¯ç”¨äº†é€šçŸ¥ï¼Œä¼šçœ‹åˆ° "Switched to account 2" çš„ toast æç¤º

::: info è´¦æˆ·åˆ‡æ¢é€šçŸ¥
å¦‚æœå¯ç”¨äº† `quiet_mode: false`ï¼ˆé»˜è®¤ï¼‰ï¼Œæ’ä»¶ä¼šæ˜¾ç¤ºè´¦æˆ·åˆ‡æ¢é€šçŸ¥ã€‚é¦–æ¬¡åˆ‡æ¢ä¼šæ˜¾ç¤ºé‚®ç®±åœ°å€ï¼Œåç»­åªæ˜¾ç¤ºè´¦æˆ·ç´¢å¼•ã€‚
:::

### ç¬¬ 4 æ­¥ï¼šé…ç½®åŒé…é¢ç³»ç»Ÿï¼ˆGemini ä¸“ç”¨ï¼‰

**ä¸ºä»€ä¹ˆ**
å¯ç”¨åŒé…é¢ fallback åï¼Œå½“ Antigravity é…é¢ç”¨å°½æ—¶ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨å°è¯• Gemini CLI é…é¢ï¼Œæ— éœ€åˆ‡æ¢è´¦æˆ·ã€‚

**æ“ä½œ**

ç¼–è¾‘æ’ä»¶é…ç½®æ–‡ä»¶ï¼š

```bash
# macOS/Linux
nano ~/.config/opencode/antigravity.json

# Windows
notepad %APPDATA%\opencode\antigravity.json
```

æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```json
{
  "$schema": "https://raw.githubusercontent.com/NoeFabris/opencode-antigravity-auth/main/assets/antigravity.schema.json",
  "quota_fallback": true
}
```

ä¿å­˜æ–‡ä»¶å¹¶é‡å¯ OpenCodeã€‚

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š

1. ä½¿ç”¨ Gemini æ¨¡å‹æ—¶ï¼Œæ’ä»¶ä¼˜å…ˆä½¿ç”¨ Antigravity é…é¢
2. å½“ Antigravity è¿”å› 429 æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°åŒä¸€è´¦æˆ·çš„ Gemini CLI é…é¢
3. å¦‚æœåŒé…é¢éƒ½é™é€Ÿï¼Œå†åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªè´¦æˆ·

::: tip åŒé…é¢ vs å¤šè´¦æˆ·
- **åŒé…é¢**ï¼šåŒä¸€ä¸ªè´¦æˆ·çš„ä¸¤ä¸ªç‹¬ç«‹é…é¢æ± ï¼ˆAntigravity + Gemini CLIï¼‰
- **å¤šè´¦æˆ·**ï¼šå¤šä¸ªè´¦æˆ·çš„é…é¢æ± å åŠ 
- æœ€ä½³å®è·µï¼šå…ˆå¯ç”¨åŒé…é¢ï¼Œå†æ·»åŠ å¤šè´¦æˆ·
:::

### ç¬¬ 5 æ­¥ï¼šé€‰æ‹©è´¦æˆ·é€‰æ‹©ç­–ç•¥

**ä¸ºä»€ä¹ˆ**
ä¸åŒçš„è´¦æˆ·æ•°é‡å’Œä½¿ç”¨åœºæ™¯éœ€è¦ä¸åŒçš„ç­–ç•¥ï¼Œä»¥è¾¾åˆ°æœ€ä¼˜æ€§èƒ½ã€‚

**æ“ä½œ**

åœ¨ `antigravity.json` ä¸­é…ç½®ç­–ç•¥ï¼š

```json
{
  "account_selection_strategy": "hybrid"
}
```

æ ¹æ®ä½ çš„è´¦æˆ·æ•°é€‰æ‹©ï¼š

| è´¦æˆ·æ•° | æ¨èç­–ç•¥ | é…ç½®å€¼ | åŸå›  |
|--- | --- | --- | ---|
| 1      | sticky   | `"sticky"` | ä¿æŒ prompt cache |
| 2-5    | hybrid   | `"hybrid"` | å¹³è¡¡ååå’Œç¼“å­˜ |
| 5+     | round-robin | `"round-robin"` | æœ€å¤§åŒ–åå |

**ç­–ç•¥è¯¦è§£**ï¼š

- **sticky**ï¼ˆé»˜è®¤å•è´¦æˆ·ï¼‰ï¼šä¿æŒä½¿ç”¨åŒä¸€è´¦æˆ·ç›´åˆ°é€Ÿç‡é™åˆ¶ï¼Œé€‚åˆå•ä¸ªå¼€å‘ä¼šè¯
- **round-robin**ï¼šæ¯ä¸ªè¯·æ±‚è½®æ¢åˆ°ä¸‹ä¸€ä¸ªè´¦æˆ·ï¼Œæœ€å¤§åŒ–ååä½†ç‰ºç‰²ç¼“å­˜
- **hybrid**ï¼ˆé»˜è®¤å¤šè´¦æˆ·ï¼‰ï¼šåŸºäºå¥åº·è¯„åˆ† + Token bucket + LRU çš„ç»¼åˆå†³ç­–

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š

1. ä½¿ç”¨ `hybrid` ç­–ç•¥æ—¶ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨é€‰æ‹©å½“å‰æœ€ä¼˜è´¦æˆ·
2. ä½¿ç”¨ `round-robin` ç­–ç•¥æ—¶ï¼Œè¯·æ±‚å‡åŒ€åˆ†å¸ƒåˆ°æ‰€æœ‰è´¦æˆ·
3. ä½¿ç”¨ `sticky` ç­–ç•¥æ—¶ï¼ŒåŒä¸€ä¼šè¯å§‹ç»ˆä½¿ç”¨åŒä¸€è´¦æˆ·

### ç¬¬ 6 æ­¥ï¼šå¯ç”¨ PID åç§»ï¼ˆå¹¶è¡Œä»£ç†åœºæ™¯ï¼‰

**ä¸ºä»€ä¹ˆ**
è¿è¡Œå¤šä¸ª OpenCode å®ä¾‹æˆ– oh-my-opencode å¹¶è¡Œä»£ç†æ—¶ï¼Œä¸åŒè¿›ç¨‹å¯èƒ½ä¼šé€‰æ‹©åŒä¸€è´¦æˆ·ï¼Œå¯¼è‡´ç«äº‰ã€‚

**æ“ä½œ**

åœ¨ `antigravity.json` ä¸­æ·»åŠ ï¼š

```json
{
  "pid_offset_enabled": true
}
```

ä¿å­˜å¹¶é‡å¯ OpenCodeã€‚

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š

1. ä¸åŒè¿›ç¨‹ï¼ˆä¸åŒ PIDï¼‰ä»ä¸åŒçš„è´¦æˆ·ç´¢å¼•å¼€å§‹
2. å¹¶è¡Œä»£ç†ä¹‹é—´çš„è´¦æˆ·ç«äº‰å‡å°‘
3. æ€»ä½“ååé‡æå‡

::: tip PID åç§»çš„å·¥ä½œåŸç†
PID åç§»ä¼šå°†è¿›ç¨‹ ID æ˜ å°„åˆ°è´¦æˆ·åç§»é‡ï¼Œä¾‹å¦‚ï¼š
- PID 100 â†’ åç§» 0 â†’ ä»è´¦æˆ· 0 å¼€å§‹
- PID 101 â†’ åç§» 1 â†’ ä»è´¦æˆ· 1 å¼€å§‹
- PID 102 â†’ åç§» 2 â†’ ä»è´¦æˆ· 2 å¼€å§‹
:::

## æ£€æŸ¥ç‚¹ âœ…

å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] é€šè¿‡ `opencode auth login` æ·»åŠ å¤šä¸ª Google è´¦æˆ·
- [ ] åœ¨ `antigravity-accounts.json` ä¸­çœ‹åˆ°å¤šä¸ªè´¦æˆ·è®°å½•
- [ ] é‡åˆ°é€Ÿç‡é™åˆ¶æ—¶ï¼Œæ’ä»¶è‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªè´¦æˆ·
- [ ] Gemini æ¨¡å‹å¯ç”¨äº†åŒé…é¢ fallback
- [ ] æ ¹æ®è´¦æˆ·æ•°é‡é€‰æ‹©äº†åˆé€‚çš„è´¦æˆ·é€‰æ‹©ç­–ç•¥
- [ ] å¹¶è¡Œä»£ç†åœºæ™¯å¯ç”¨äº† PID åç§»

## è¸©å‘æé†’

### æ‰€æœ‰è´¦æˆ·éƒ½è¢«é™é€Ÿ

**ç—‡çŠ¶**ï¼šæ‰€æœ‰è´¦æˆ·éƒ½æ˜¾ç¤º 429 é”™è¯¯ï¼Œæ— æ³•ç»§ç»­è¯·æ±‚

**åŸå› **ï¼šé…é¢ç”¨å°½æˆ–å¹¶å‘è¯·æ±‚è¿‡å¤š

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. ç­‰å¾…é€Ÿç‡é™åˆ¶è‡ªåŠ¨é‡ç½®ï¼ˆé€šå¸¸ 1-5 åˆ†é’Ÿï¼‰
2. å¦‚æœé•¿æœŸå‡ºç°é—®é¢˜ï¼Œæ·»åŠ æ›´å¤šè´¦æˆ·
3. æ£€æŸ¥é…ç½®ä¸­çš„ `max_rate_limit_wait_seconds`ï¼Œè®¾ç½®åˆç†çš„ç­‰å¾…ä¸Šé™

### è´¦æˆ·åˆ‡æ¢è¿‡äºé¢‘ç¹

**ç—‡çŠ¶**ï¼šæ¯æ¬¡è¯·æ±‚éƒ½åˆ‡æ¢è´¦æˆ·ï¼Œæ²¡æœ‰ä½¿ç”¨åŒä¸€è´¦æˆ·

**åŸå› **ï¼šç­–ç•¥é€‰æ‹©ä¸å½“æˆ–å¥åº·è¯„åˆ†å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. å°†ç­–ç•¥æ”¹ä¸º `sticky`
2. æ£€æŸ¥ `health_score` é…ç½®ï¼Œè°ƒæ•´ `min_usable` å’Œ `rate_limit_penalty`
3. ç¡®è®¤æ²¡æœ‰é¢‘ç¹ 429 é”™è¯¯å¯¼è‡´è´¦æˆ·è¢«æ ‡è®°ä¸ºä¸å¥åº·

### Gemini CLI æƒé™é”™è¯¯ï¼ˆ403ï¼‰

**ç—‡çŠ¶**ï¼šä½¿ç”¨ Gemini CLI æ¨¡å‹æ—¶è¿”å› `Permission denied` é”™è¯¯

**åŸå› **ï¼šè´¦æˆ·ç¼ºå°‘æœ‰æ•ˆçš„ Project ID

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. ä¸ºæ¯ä¸ªè´¦æˆ·æ‰‹åŠ¨æ·»åŠ  `projectId`ï¼š

```json
{
  "accounts": [
    {
      "email": "your@email.com",
      "refreshToken": "...",
      "projectId": "your-project-id"
    }
  ]
}
```

2. ç¡®ä¿åœ¨ [Google Cloud Console](https://console.cloud.google.com/) ä¸­å¯ç”¨äº† Gemini for Google Cloud API

### ä»¤ç‰Œæ— æ•ˆï¼ˆinvalid_grantï¼‰

**ç—‡çŠ¶**ï¼šè´¦æˆ·è¢«è‡ªåŠ¨ç§»é™¤ï¼Œæç¤º `invalid_grant` é”™è¯¯

**åŸå› **ï¼šGoogle è´¦æˆ·å¯†ç æ›´æ”¹ã€å®‰å…¨äº‹ä»¶æˆ–ä»¤ç‰Œè¿‡æœŸ

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. åˆ é™¤æ— æ•ˆè´¦æˆ·å¹¶é‡æ–°è®¤è¯ï¼š

```bash
rm ~/.config/opencode/antigravity-accounts.json
opencode auth login
```

2. å¦‚æœé¢‘ç¹å‡ºç°ï¼Œè€ƒè™‘ä½¿ç”¨æ›´ç¨³å®šçš„ Google è´¦æˆ·

## æœ¬è¯¾å°ç»“

- å¤šè´¦æˆ·é…ç½®å¯ä»¥æå‡æ€»ä½“é…é¢ä¸Šé™å’Œç³»ç»Ÿç¨³å®šæ€§
- è´¦æˆ·æ·»åŠ éå¸¸ç®€å•ï¼Œé‡å¤è¿è¡Œ `opencode auth login` å³å¯
- åŒé…é¢ç³»ç»Ÿè®©æ¯ä¸ª Gemini è´¦æˆ·çš„å¯ç”¨é…é¢ç¿»å€
- è´¦æˆ·é€‰æ‹©ç­–ç•¥åº”æ ¹æ®è´¦æˆ·æ•°é‡å’Œä½¿ç”¨åœºæ™¯è°ƒæ•´
- PID åç§»å¯¹äºå¹¶è¡Œä»£ç†åœºæ™¯è‡³å…³é‡è¦

## ä¸‹ä¸€è¯¾é¢„å‘Š

> ä¸‹ä¸€è¯¾æˆ‘ä»¬å­¦ä¹  **[è´¦æˆ·é€‰æ‹©ç­–ç•¥](../account-selection-strategies/)**ã€‚
>
> ä½ ä¼šå­¦åˆ°ï¼š
> - stickyã€round-robinã€hybrid ä¸‰ç§ç­–ç•¥çš„è¯¦ç»†å·¥ä½œåŸç†
> - å¦‚ä½•æ ¹æ®åœºæ™¯é€‰æ‹©æœ€ä¼˜ç­–ç•¥
> - å¥åº·è¯„åˆ†å’Œ Token bucket çš„è°ƒä¼˜æ–¹æ³•

---

## é™„å½•ï¼šæºç å‚è€ƒ

<details>
<summary><strong>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æºç ä½ç½®</strong></summary>

> æ›´æ–°æ—¶é—´ï¼š2026-01-23

| åŠŸèƒ½        | æ–‡ä»¶è·¯å¾„                                                                                    | è¡Œå·    |
|--- | --- | ---|
| AccountManager ç±» | [`src/plugin/accounts.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/accounts.ts#L174-L250) | 174-250 |
| è´Ÿè½½å‡è¡¡ç­–ç•¥ | [`src/plugin/rotation.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/rotation.ts)         | å…¨æ–‡   |
| é…ç½® Schema | [`src/plugin/config/schema.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/config/schema.ts) | å…¨æ–‡   |
| è´¦æˆ·å­˜å‚¨ | [`src/plugin/storage.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/storage.ts)     | å…¨æ–‡   |

**å…³é”®å¸¸é‡**ï¼š

| å¸¸é‡å | å€¼ | è¯´æ˜ |
|--- | --- | ---|
| `QUOTA_EXHAUSTED_BACKOFFS` | `[60000, 300000, 1800000, 7200000]` | é…é¢è€—å°½é€€é¿æ—¶é—´ï¼ˆ1åˆ†é’Ÿâ†’5åˆ†é’Ÿâ†’30åˆ†é’Ÿâ†’2å°æ—¶ï¼‰ |
| `RATE_LIMIT_EXCEEDED_BACKOFF` | `30000` | é€Ÿç‡é™åˆ¶é€€é¿æ—¶é—´ï¼ˆ30ç§’ï¼‰ |
| `MIN_BACKOFF_MS` | `2000` | æœ€å°é€€é¿æ—¶é—´ï¼ˆ2ç§’ï¼‰ |

**å…³é”®å‡½æ•°**ï¼š

- `calculateBackoffMs(reason, consecutiveFailures, retryAfterMs)`ï¼šè®¡ç®—é€€é¿å»¶è¿Ÿ
- `getQuotaKey(family, headerStyle, model)`ï¼šç”Ÿæˆé…é¢é”®ï¼ˆæ”¯æŒæ¨¡å‹çº§åˆ«é™æµï¼‰
- `isRateLimitedForQuotaKey(account, key)`ï¼šæ£€æŸ¥ç‰¹å®šé…é¢é”®æ˜¯å¦é™é€Ÿ
- `selectHybridAccount(accounts, family)`ï¼šhybrid ç­–ç•¥çš„è´¦æˆ·é€‰æ‹©é€»è¾‘

**é…ç½®é¡¹**ï¼ˆæ¥è‡ª schema.tsï¼‰ï¼š

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--- | --- | --- | ---|
| `account_selection_strategy` | enum | `"hybrid"` | è´¦æˆ·é€‰æ‹©ç­–ç•¥ |
| `quota_fallback` | boolean | `false` | å¯ç”¨ Gemini åŒé…é¢ fallback |
| `pid_offset_enabled` | boolean | `false` | å¯ç”¨ PID åç§» |
| `switch_on_first_rate_limit` | boolean | `true` | é¦–æ¬¡é™é€Ÿç«‹å³åˆ‡æ¢ |

</details>
