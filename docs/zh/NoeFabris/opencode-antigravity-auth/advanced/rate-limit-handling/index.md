---
title: "é€Ÿç‡é™åˆ¶: è‡ªåŠ¨é‡è¯•æœºåˆ¶ | Antigravity Auth"
sidebarTitle: "429 é”™è¯¯è‡ªåŠ¨å¤„ç†"
subtitle: "é€Ÿç‡é™åˆ¶å¤„ç†ï¼šè‡ªåŠ¨é‡è¯•å’Œè´¦æˆ·åˆ‡æ¢æœºåˆ¶"
description: "å­¦ä¹  Antigravity Auth å¦‚ä½•æ™ºèƒ½å¤„ç† 429 é€Ÿç‡é™åˆ¶é”™è¯¯ã€‚ç†è§£ä¸åŒç±»å‹çš„é™é€Ÿã€è‡ªåŠ¨é‡è¯•ç®—æ³•ã€å¤šè´¦æˆ·åˆ‡æ¢é€»è¾‘ã€åŒé…é¢æ±  fallback æœºåˆ¶ã€‚"
tags:
  - "é€Ÿç‡é™åˆ¶"
  - "é‡è¯•æœºåˆ¶"
  - "å¤šè´¦æˆ·"
  - "è¿›é˜¶"
prerequisite:
  - "advanced-multi-account-setup"
  - "advanced-account-selection-strategies"
  - "platforms-dual-quota-system"
order: 6
---

# é€Ÿç‡é™åˆ¶å¤„ç†ï¼šè‡ªåŠ¨é‡è¯•å’Œè´¦æˆ·åˆ‡æ¢æœºåˆ¶

## å­¦å®Œä½ èƒ½åšä»€ä¹ˆ

ç†è§£å¹¶æŒæ¡ Antigravity Auth çš„æ™ºèƒ½é€Ÿç‡é™åˆ¶å¤„ç†æœºåˆ¶ï¼š
- åŒºåˆ† 5 ç§ä¸åŒç±»å‹çš„ 429 é”™è¯¯ï¼ˆé…é¢è€—å°½ã€é€Ÿç‡é™åˆ¶ã€å®¹é‡è€—å°½ç­‰ï¼‰
- ç†è§£è‡ªåŠ¨é‡è¯•çš„æŒ‡æ•°é€€é¿ç®—æ³•
- æŒæ¡å¤šè´¦æˆ·åœºæ™¯ä¸‹çš„è‡ªåŠ¨åˆ‡æ¢é€»è¾‘
- é…ç½®é¦–æ¬¡é™é€Ÿç«‹å³åˆ‡æ¢æˆ–é‡è¯•ä¸¤æ¬¡ååˆ‡æ¢
- ä½¿ç”¨ Gemini åŒé…é¢æ±  fallback æé«˜å¯ç”¨æ€§

ä¸å†è¢«"æ‰€æœ‰è´¦æˆ·éƒ½è¢«é™é€Ÿï¼Œä½†é…é¢è¿˜æ²¡ç”¨å®Œ"å›°æ‰°ã€‚

## ä½ ç°åœ¨çš„å›°å¢ƒ

ä½¿ç”¨å¤š Google è´¦æˆ·æ—¶é‡åˆ°ï¼š
- ç»å¸¸é‡åˆ° 429 é€Ÿç‡é™åˆ¶ï¼Œä¸çŸ¥é“è¯¥é‡è¯•è¿˜æ˜¯åˆ‡æ¢è´¦æˆ·
- ä¸åŒç±»å‹ 429 çš„ç­‰å¾…æ—¶é—´å·®å¼‚å¾ˆå¤§ï¼Œä¸çŸ¥é“è¯¥ç­‰å¤šä¹…
- æ‰€æœ‰è´¦æˆ·éƒ½è¢«é™é€Ÿï¼Œä½†å®é™…é…é¢æ²¡ç”¨å®Œï¼Œå› ä¸ºé™é€Ÿåˆ¤æ–­ä¸å‡†ç¡®
- Gemini çš„åŒé…é¢æ± åˆ‡æ¢æ—¶æœºä¸æ¸…æ¥šï¼Œå¯¼è‡´é…é¢æµªè´¹

## ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸€æ‹›

å½“ä½ ï¼š
- é…ç½®äº†å¤šä¸ªè´¦æˆ·ï¼Œä½†é¢‘ç¹é‡åˆ° 429 é”™è¯¯
- æƒ³ä¼˜åŒ–å¤šè´¦æˆ·åœºæ™¯ä¸‹çš„è¯·æ±‚æˆåŠŸç‡
- éœ€è¦è°ƒæ•´é‡è¯•ç­–ç•¥ï¼ˆå¦‚é¦–æ¬¡é™é€Ÿç«‹å³åˆ‡æ¢ï¼‰
- ä½¿ç”¨ Gemini æ¨¡å‹ï¼Œæƒ³åˆ©ç”¨åŒé…é¢æ± 

## æ ¸å¿ƒæ€è·¯

### ä»€ä¹ˆæ˜¯é€Ÿç‡é™åˆ¶å¤„ç†

Antigravity Auth æ’ä»¶åœ¨é‡åˆ° 429 é”™è¯¯æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. **æ£€æµ‹é™é€Ÿç±»å‹**ï¼šè§£æå“åº”ä¸­çš„ `reason` æˆ– `message`ï¼ŒåŒºåˆ† 5 ç§é™é€Ÿç±»å‹
2. **è®¡ç®—é€€é¿æ—¶é—´**ï¼šæ ¹æ®é™é€Ÿç±»å‹å’Œå¤±è´¥æ¬¡æ•°ï¼Œæ™ºèƒ½è®¡ç®—ç­‰å¾…æ—¶é—´
3. **æ‰§è¡Œç­–ç•¥**ï¼š
   - **å¤šè´¦æˆ·**ï¼šä¼˜å…ˆåˆ‡æ¢åˆ°å¯ç”¨è´¦æˆ·
   - **å•è´¦æˆ·**ï¼šæŒ‡æ•°é€€é¿é‡è¯•
4. **è®°å½•çŠ¶æ€**ï¼šæ›´æ–°è´¦æˆ·çš„é™é€ŸçŠ¶æ€ï¼Œä¾›åç»­è¯·æ±‚å‚è€ƒ

::: info ä¸ºä»€ä¹ˆéœ€è¦æ™ºèƒ½å¤„ç†ï¼Ÿ
Google å¯¹æ¯ä¸ªè´¦æˆ·éƒ½æœ‰é€Ÿç‡é™åˆ¶ã€‚å¦‚æœç®€å•åœ°"é‡åˆ° 429 å°±åˆ‡æ¢"ï¼Œå¯èƒ½å¯¼è‡´é¢‘ç¹åˆ‡æ¢ï¼Œé”™è¿‡å¿«é€Ÿæ¢å¤çš„è´¦æˆ·ï¼›å¦‚æœç®€å•åœ°"ç­‰å¾…é‡è¯•"ï¼Œåˆå¯èƒ½æµªè´¹å…¶ä»–å¯ç”¨è´¦æˆ·çš„é…é¢ã€‚æ™ºèƒ½å¤„ç†éœ€è¦åœ¨"åˆ‡æ¢"å’Œ"ç­‰å¾…"ä¹‹é—´æ‰¾åˆ°æœ€ä¼˜å¹³è¡¡ç‚¹ã€‚
:::

### 5 ç§é€Ÿç‡é™åˆ¶ç±»å‹

Antigravity Auth ä¼šæ ¹æ® API å“åº”ä¸­çš„ `reason` å­—æ®µæˆ– `message` å†…å®¹ï¼ŒåŒºåˆ†ä»¥ä¸‹ 5 ç§é™é€Ÿç±»å‹ï¼š

| ç±»å‹ | åŸå›  | é€€é¿ç­–ç•¥ | å…¸å‹åœºæ™¯ |
|--- | --- | --- | ---|
| `QUOTA_EXHAUSTED` | é…é¢ç”¨å®Œï¼ˆæ—¥é…é¢æˆ–æœˆé…é¢ï¼‰ | é€’å¢é€€é¿ï¼š1min â†’ 5min â†’ 30min â†’ 120min | æ—¥é…é¢è€—å°½ |
| `RATE_LIMIT_EXCEEDED` | è¯·æ±‚è¿‡å¿«ï¼ˆæ¯åˆ†é’Ÿé™åˆ¶ï¼‰ | å›ºå®š 30 ç§’ | çŸ­æ—¶é—´å¤§é‡è¯·æ±‚ |
| `MODEL_CAPACITY_EXHAUSTED` | æ¨¡å‹æœåŠ¡å™¨å®¹é‡ä¸è¶³ | å›ºå®š 15 ç§’ | é«˜å³°æ—¶æ®µ |
| `SERVER_ERROR` | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼ˆ5xxï¼‰ | å›ºå®š 20 ç§’ | æœåŠ¡ä¸ç¨³å®š |
| `UNKNOWN` | æœªçŸ¥åŸå›  | å›ºå®š 60 ç§’ | æ— æ³•è§£æçš„é”™è¯¯ |

**é€€é¿æ—¶é—´è®¡ç®—å…¬å¼**ï¼ˆaccounts.ts:51-75ï¼‰ï¼š

```typescript
// QUOTA_EXHAUSTEDï¼šé€’å¢é€€é¿ï¼ˆåŸºäºè¿ç»­å¤±è´¥æ¬¡æ•°ï¼‰
// å¤±è´¥ 1 æ¬¡ï¼š1min (60_000ms)
// å¤±è´¥ 2 æ¬¡ï¼š5min (300_000ms)
// å¤±è´¥ 3 æ¬¡ï¼š30min (1_800_000ms)
// å¤±è´¥ 4+ æ¬¡ï¼š120min (7_200_000ms)

// å…¶ä»–ç±»å‹ï¼šå›ºå®šé€€é¿
// RATE_LIMIT_EXCEEDEDï¼š30s
// MODEL_CAPACITY_EXHAUSTEDï¼š15s
// SERVER_ERRORï¼š20s
// UNKNOWNï¼š60s
```

### æŒ‡æ•°é€€é¿ç®—æ³•

Antigravity Auth ä½¿ç”¨**å¸¦å»é‡çš„æŒ‡æ•°é€€é¿**ç®—æ³•ï¼š

**æ ¸å¿ƒé€»è¾‘**ï¼ˆplugin.ts:509-567ï¼‰ï¼š

```typescript
// 1. å»é‡çª—å£ï¼š2 ç§’å†…çš„å¹¶å‘ 429 è§†ä¸ºåŒä¸€äº‹ä»¶
const RATE_LIMIT_DEDUP_WINDOW_MS = 2000;

// 2. çŠ¶æ€é‡ç½®ï¼š2 åˆ†é’Ÿæ—  429 åé‡ç½®è®¡æ•°
const RATE_LIMIT_STATE_RESET_MS = 120_000;

// 3. æŒ‡æ•°é€€é¿ï¼šbaseDelay * 2^(attempt-1)ï¼Œæœ€å¤§ 60s
const expBackoff = Math.min(baseDelay * Math.pow(2, attempt - 1), 60000);
```

**ä¸ºä»€ä¹ˆéœ€è¦å»é‡çª—å£ï¼Ÿ**

å‡è®¾ä½ æœ‰ 3 ä¸ªå¹¶å‘è¯·æ±‚åŒæ—¶è§¦å‘ 429ï¼š
- **æ— å»é‡**ï¼šæ¯ä¸ªè¯·æ±‚è®¡æ•°å™¨ +1ï¼Œå¯¼è‡´ attempt=3ï¼Œé€€é¿ 4sï¼ˆ2^2 Ã— 1sï¼‰
- **æœ‰å»é‡**ï¼šè§†ä¸ºåŒä¸€äº‹ä»¶ï¼Œattempt=1ï¼Œé€€é¿ 1s

å»é‡çª—å£å¯ä»¥é¿å…å¹¶å‘è¯·æ±‚è¿‡åº¦æ”¾å¤§é€€é¿æ—¶é—´ã€‚

### å¤šè´¦æˆ·åˆ‡æ¢é€»è¾‘

Antigravity Auth åœ¨å¤šè´¦æˆ·åœºæ™¯ä¸‹é‡‡ç”¨**ä¼˜å…ˆåˆ‡æ¢ï¼Œé‡è¯•å…œåº•**çš„ç­–ç•¥ï¼š

**å†³ç­–æµç¨‹**ï¼š

```mermaid
flowchart TD
    A[é‡åˆ° 429] --> B{é¦–æ¬¡é™é€Ÿ?}
    B -->|æ˜¯| C{switch_on_first_rate_limit?}
    B -->|å¦| D{å¤šè´¦æˆ·?}
    
    C -->|true| E[ç­‰å¾… 1s]
    E --> F[æ ‡è®°å½“å‰è´¦æˆ·é™é€Ÿ]
    F --> G[åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨è´¦æˆ·]
    
    C -->|false| H[ç­‰å¾… 1s å¹¶é‡è¯•]
    H --> I{æˆåŠŸ?}
    I -->|æ˜¯| J[ç»§ç»­ä½¿ç”¨å½“å‰è´¦æˆ·]
    I -->|å¦| K[æ ‡è®°å½“å‰è´¦æˆ·é™é€Ÿ]
    K --> D
    
    D -->|æ˜¯| L[åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨è´¦æˆ·]
    D -->|å¦| M[æŒ‡æ•°é€€é¿ç­‰å¾…]
    
    M --> N{æœ‰å…¶ä»–è´¦æˆ·?}
    N -->|æ˜¯| L
    N -->|å¦| O[ç»§ç»­ç­‰å¾…]
```

**å…³é”®é…ç½®**ï¼ˆconfig/schema.ts:256-259ï¼‰ï¼š

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--- | --- | ---|
| `switch_on_first_rate_limit` | `true` | é¦–æ¬¡é™é€Ÿæ˜¯å¦ç«‹å³åˆ‡æ¢è´¦æˆ·ï¼ˆç­‰å¾… 1s åï¼‰ |
| `max_rate_limit_wait_seconds` | `300` | æ‰€æœ‰è´¦æˆ·é™é€Ÿæ—¶çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆ5 åˆ†é’Ÿï¼‰ |

**æ¨èé…ç½®**ï¼š

- **å¤šè´¦æˆ·ï¼ˆ2+ï¼‰**ï¼š`switch_on_first_rate_limit: true`ï¼Œç«‹å³åˆ‡æ¢ï¼Œé¿å…æµªè´¹é…é¢
- **å•è´¦æˆ·**ï¼šè¯¥é…ç½®æ— æ•ˆï¼Œè‡ªåŠ¨ä½¿ç”¨æŒ‡æ•°é€€é¿é‡è¯•

### Gemini åŒé…é¢æ±  Fallback

Gemini æ¨¡å‹æ”¯æŒä¸¤ä¸ªç‹¬ç«‹çš„é…é¢æ± ï¼š
- **Antigravity é…é¢æ± **ï¼šä¼˜å…ˆä½¿ç”¨ï¼Œä½†å®¹é‡è¾ƒå°
- **Gemini CLI é…é¢æ± **ï¼šå¤‡é€‰ä½¿ç”¨ï¼Œå®¹é‡è¾ƒå¤§

**Fallback é€»è¾‘**ï¼ˆplugin.ts:1318-1345ï¼‰ï¼š

```
1. ä½¿ç”¨ Antigravity é…é¢æ± å‘èµ·è¯·æ±‚
2. é‡åˆ° 429 é™é€Ÿ
3. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–è´¦æˆ·çš„ Antigravity é…é¢å¯ç”¨
   - æœ‰ï¼šåˆ‡æ¢è´¦æˆ·ï¼Œç»§ç»­ä½¿ç”¨ Antigravity
   - æ— ï¼šå¦‚æœ quota_fallback=trueï¼Œåˆ‡æ¢åˆ° Gemini CLI é…é¢æ± 
```

**é…ç½®é€‰é¡¹**ï¼ˆconfig/schema.ts:179ï¼‰ï¼š

```json
{
  "quota_fallback": true  // é»˜è®¤ false
}
```

**ç¤ºä¾‹**ï¼š

ä½ æœ‰ 2 ä¸ªè´¦æˆ·ï¼Œéƒ½é‡åˆ° 429ï¼š

| çŠ¶æ€ | quota_fallback=false | quota_fallback=true |
|--- | --- | ---|
| è´¦æˆ· 1ï¼ˆAntigravityï¼‰ | é™é€Ÿ | é™é€Ÿ â†’ å°è¯• Gemini CLI |
| è´¦æˆ· 2ï¼ˆAntigravityï¼‰ | é™é€Ÿ | é™é€Ÿ â†’ å°è¯• Gemini CLI |
| ç»“æœ | ç­‰å¾… 5 åˆ†é’Ÿåé‡è¯• | åˆ‡æ¢åˆ° Gemini CLIï¼Œæ— éœ€ç­‰å¾… |

::: tip åŒé…é¢æ± çš„ä¼˜åŠ¿
Gemini CLI é…é¢æ± é€šå¸¸æ›´å¤§ï¼Œ fallback å¯ä»¥æ˜¾è‘—æé«˜è¯·æ±‚æˆåŠŸç‡ã€‚ä½†æ³¨æ„ï¼š
- æ˜¾å¼ä½¿ç”¨ `:antigravity` åç¼€çš„æ¨¡å‹ä¸ä¼š fallback
- ä»…å½“æ‰€æœ‰è´¦æˆ·çš„ Antigravity é…é¢éƒ½ç”¨å®Œåæ‰ fallback
:::

### å•è´¦æˆ·é‡è¯•é€»è¾‘

å¦‚æœåªæœ‰ä¸€ä¸ªè´¦æˆ·ï¼ŒAntigravity Auth ä½¿ç”¨**æŒ‡æ•°é€€é¿é‡è¯•**ï¼š

**é‡è¯•å…¬å¼**ï¼ˆplugin.ts:1373-1375ï¼‰ï¼š

```typescript
// é¦–æ¬¡ï¼š1s
// ç¬¬ 2 æ¬¡ï¼š2s (1s Ã— 2^1)
// ç¬¬ 3 æ¬¡ï¼š4s (1s Ã— 2^2)
// ç¬¬ 4 æ¬¡ï¼š8s (1s Ã— 2^3)
// ...
// æœ€å¤§ï¼š60s
const expBackoffMs = Math.min(1000 * Math.pow(2, attempt - 1), 60000);
```

**é‡è¯•æµç¨‹**ï¼š

```
ç¬¬ 1 æ¬¡ï¼šé‡åˆ° 429
  â†“ ç­‰å¾… 1s å¹¶é‡è¯•ï¼ˆå¿«é€Ÿé‡è¯•ï¼‰
ç¬¬ 2 æ¬¡ï¼šä»ç„¶ 429
  â†“ ç­‰å¾… 2s å¹¶é‡è¯•
ç¬¬ 3 æ¬¡ï¼šä»ç„¶ 429
  â†“ ç­‰å¾… 4s å¹¶é‡è¯•
...
```

**ä¸å¤šè´¦æˆ·çš„åŒºåˆ«**ï¼š

| åœºæ™¯ | ç­–ç•¥ | ç­‰å¾…æ—¶é—´ |
|--- | --- | ---|
| å•è´¦æˆ· | æŒ‡æ•°é€€é¿é‡è¯• | 1s â†’ 2s â†’ 4s â†’ 8s â†’ ... â†’ 60s |
| å¤šè´¦æˆ· | åˆ‡æ¢è´¦æˆ· | 1sï¼ˆé¦–æ¬¡ï¼‰æˆ– 5sï¼ˆç¬¬ 2 æ¬¡ï¼‰ |

## ğŸ’ å¼€å§‹å‰çš„å‡†å¤‡

::: warning å‰ç½®æ£€æŸ¥
ç¡®ä¿ä½ å·²å®Œæˆï¼š
- [x] å¤šè´¦æˆ·è®¾ç½®ï¼ˆè‡³å°‘ 2 ä¸ª Google è´¦æˆ·ï¼‰
- [x] ç†è§£ [è´¦æˆ·é€‰æ‹©ç­–ç•¥](/zh/NoeFabris/opencode-antigravity-auth/advanced/account-selection-strategies/)
- [x] ç†è§£ [åŒé…é¢ç³»ç»Ÿ](/zh/NoeFabris/opencode-antigravity-auth/platforms/dual-quota-system/)
:::

## è·Ÿæˆ‘åš

### ç¬¬ 1 æ­¥ï¼šå¯ç”¨è°ƒè¯•æ—¥å¿—è§‚å¯Ÿé€Ÿç‡é™åˆ¶

**ä¸ºä»€ä¹ˆ**
è°ƒè¯•æ—¥å¿—å¯ä»¥æ˜¾ç¤ºé€Ÿç‡é™åˆ¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¸®åŠ©ä½ ç†è§£æ’ä»¶çš„å·¥ä½œåŸç†ã€‚

**æ“ä½œ**

å¯ç”¨è°ƒè¯•æ—¥å¿—ï¼š

```bash
export OPENCODE_ANTIGRAVITY_DEBUG=1
```

å‘èµ·è¯·æ±‚è§¦å‘é€Ÿç‡é™åˆ¶ï¼š

```bash
# å‘èµ·å¤šä¸ªå¹¶å‘è¯·æ±‚ï¼ˆç¡®ä¿è§¦å‘ 429ï¼‰
for i in {1..10}; do
  opencode run "Test $i" --model=google/antigravity-gemini-3-pro &
done
wait
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š

```
[RateLimit] 429 on Account 0 family=claude retryAfterMs=60000
  message: You have exceeded the quota for this request.
  quotaResetTime: 2026-01-23T12:00:00Z
  retryDelayMs: 60000
  reason: QUOTA_EXHAUSTED

Rate limited. Quick retry in 1s... (toast é€šçŸ¥)
```

**æ—¥å¿—è§£è¯»**ï¼š

- `429 on Account 0 family=claude`ï¼šè´¦æˆ· 0 çš„ Claude æ¨¡å‹é™é€Ÿ
- `retryAfterMs=60000`ï¼šæœåŠ¡å™¨å»ºè®®ç­‰å¾… 60 ç§’
- `reason: QUOTA_EXHAUSTED`ï¼šé…é¢è€—å°½ï¼ˆé€€é¿æ—¶é—´é€’å¢ï¼‰

### ç¬¬ 2 æ­¥ï¼šé…ç½®é¦–æ¬¡é™é€Ÿç«‹å³åˆ‡æ¢

**ä¸ºä»€ä¹ˆ**
å¦‚æœä½ æœ‰å¤šä¸ªè´¦æˆ·ï¼Œé¦–æ¬¡é™é€Ÿç«‹å³åˆ‡æ¢å¯ä»¥æœ€å¤§åŒ–é…é¢åˆ©ç”¨ç‡ï¼Œé¿å…ç­‰å¾…ã€‚

**æ“ä½œ**

ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```bash
cat > ~/.config/opencode/antigravity.json << 'EOF'
{
  "$schema": "https://raw.githubusercontent.com/NoeFabris/opencode-antigravity-auth/main/assets/antigravity.schema.json",
  "switch_on_first_rate_limit": true
}
EOF
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šé…ç½®æ–‡ä»¶å·²æ›´æ–°ã€‚

**éªŒè¯é…ç½®ç”Ÿæ•ˆ**ï¼š

å‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œè§‚å¯Ÿé¦–æ¬¡é™é€Ÿåçš„è¡Œä¸ºï¼š

```bash
export OPENCODE_ANTIGRAVITY_DEBUG=1
for i in {1..5}; do
  opencode run "Test $i" --model=google/antigravity-gemini-3-pro &
done
wait
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š

```
[RateLimit] 429 on Account 0 family=gemini retryAfterMs=30000
Server at capacity. Switching account in 1s... (toast é€šçŸ¥)
[AccountContext] Selected account: user2@gmail.com (index: 1)
```

**å…³é”®ç‚¹**ï¼š
- é¦–æ¬¡ 429 åç­‰å¾… 1s
- è‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨è´¦æˆ·ï¼ˆindex: 1ï¼‰
- ä¸å†é‡è¯•å½“å‰è´¦æˆ·

### ç¬¬ 3 æ­¥ï¼šç¦ç”¨é¦–æ¬¡é™é€Ÿç«‹å³åˆ‡æ¢

**ä¸ºä»€ä¹ˆ**
å¦‚æœå¸Œæœ›å…ˆé‡è¯•å½“å‰è´¦æˆ·ï¼ˆé¿å…é¢‘ç¹åˆ‡æ¢ï¼‰ï¼Œå¯ä»¥ç¦ç”¨è¯¥é€‰é¡¹ã€‚

**æ“ä½œ**

ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```bash
cat > ~/.config/opencode/antigravity.json << 'EOF'
{
  "$schema": "https://raw.githubusercontent.com/NoeFabris/opencode-antigravity-auth/main/assets/antigravity.schema.json",
  "switch_on_first_rate_limit": false
}
EOF
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šé…ç½®æ–‡ä»¶å·²æ›´æ–°ã€‚

**éªŒè¯é…ç½®ç”Ÿæ•ˆ**ï¼š

å†æ¬¡å‘èµ·å¤šä¸ªè¯·æ±‚ï¼š

```bash
export OPENCODE_ANTIGRAVITY_DEBUG=1
for i in {1..5}; do
  opencode run "Test $i" --model=google/antigravity-gemini-3-pro &
done
wait
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š

```
[RateLimit] 429 on Account 0 family=gemini retryAfterMs=30000
Rate limited. Quick retry in 1s... (toast é€šçŸ¥)
[RateLimit] 429 on Account 0 family=gemini retryAfterMs=30000
Rate limited again. Switching account in 5s... (toast é€šçŸ¥)
[AccountContext] Selected account: user2@gmail.com (index: 1)
```

**å…³é”®ç‚¹**ï¼š
- é¦–æ¬¡ 429ï¼šç­‰å¾… 1s å¹¶**é‡è¯•å½“å‰è´¦æˆ·**
- ç¬¬ 2 æ¬¡ 429ï¼šç­‰å¾… 5s å**åˆ‡æ¢è´¦æˆ·**
- å¦‚æœé‡è¯•æˆåŠŸï¼Œç»§ç»­ä½¿ç”¨å½“å‰è´¦æˆ·

### ç¬¬ 4 æ­¥ï¼šå¯ç”¨ Gemini åŒé…é¢æ±  Fallback

**ä¸ºä»€ä¹ˆ**
Gemini æ¨¡å‹æ”¯æŒåŒé…é¢æ± ï¼Œå¯ç”¨ fallback å¯ä»¥æ˜¾è‘—æé«˜è¯·æ±‚æˆåŠŸç‡ã€‚

**æ“ä½œ**

ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```bash
cat > ~/.config/opencode/antigravity.json << 'EOF'
{
  "$schema": "https://raw.githubusercontent.com/NoeFabris/opencode-antigravity-auth/main/assets/antigravity.schema.json",
  "quota_fallback": true
}
EOF
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šé…ç½®æ–‡ä»¶å·²æ›´æ–°ã€‚

**éªŒè¯é…ç½®ç”Ÿæ•ˆ**ï¼š

å‘èµ· Gemini è¯·æ±‚ï¼ˆç¡®ä¿è§¦å‘ Antigravity é…é¢æ± é™é€Ÿï¼‰ï¼š

```bash
export OPENCODE_ANTIGRAVITY_DEBUG=1
for i in {1..5}; do
  opencode run "Test $i" --model=google/antigravity-gemini-3-pro &
done
wait
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š

```
[RateLimit] 429 on Account 0 family=gemini retryAfterMs=30000
Antigravity quota exhausted for gemini-3-pro. Switching to Gemini CLI quota... (toast é€šçŸ¥)
[DEBUG] quota fallback: gemini-cli
```

**å…³é”®ç‚¹**ï¼š
- æ‰€æœ‰è´¦æˆ·çš„ Antigravity é…é¢ç”¨å®Œå
- è‡ªåŠ¨åˆ‡æ¢åˆ° Gemini CLI é…é¢æ± 
- æ— éœ€ç­‰å¾…ï¼Œç›´æ¥é‡è¯•

**å¼ºåˆ¶ä½¿ç”¨ Antigravity é…é¢**ï¼ˆä¸ fallbackï¼‰ï¼š

```bash
# ä½¿ç”¨æ˜¾å¼åç¼€ :antigravity
opencode run "Test" --model=google/antigravity-gemini-3-pro:antigravity
```

### ç¬¬ 5 æ­¥ï¼šé…ç½®æœ€å¤§ç­‰å¾…æ—¶é—´

**ä¸ºä»€ä¹ˆ**
å¦‚æœæ‰€æœ‰è´¦æˆ·éƒ½è¢«é™é€Ÿï¼Œæ’ä»¶ä¼šç­‰å¾…æœ€çŸ­çš„é‡ç½®æ—¶é—´ã€‚ä½ å¯ä»¥é…ç½®æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œé¿å…æ— é™ç­‰å¾…ã€‚

**æ“ä½œ**

ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```bash
cat > ~/.config/opencode/antigravity.json << 'EOF'
{
  "$schema": "https://raw.githubusercontent.com/NoeFabris/opencode-antigravity-auth/main/assets/antigravity.schema.json",
  "max_rate_limit_wait_seconds": 60
}
EOF
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šé…ç½®æ–‡ä»¶å·²æ›´æ–°ã€‚

**éªŒè¯é…ç½®ç”Ÿæ•ˆ**ï¼š

è§¦å‘æ‰€æœ‰è´¦æˆ·é™é€Ÿï¼š

```bash
export OPENCODE_ANTIGRAVITY_DEBUG=1
for i in {1..20}; do
  opencode run "Test $i" --model=google/antigravity-claude-opus-4.5 &
done
wait
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š

```
[RateLimit] 429 on Account 0 family=claude retryAfterMs=60000
[RateLimit] 429 on Account 1 family=claude retryAfterMs=60000
[DEBUG] All accounts rate limited. Min wait time: 60s, max wait: 60s
Rate limited. Retrying in 60s... (toast é€šçŸ¥)
```

**å…³é”®ç‚¹**ï¼š
- æ‰€æœ‰è´¦æˆ·é™é€Ÿæ—¶ï¼Œç­‰å¾…æœ€çŸ­çš„é‡ç½®æ—¶é—´
- å¦‚æœæœ€çŸ­é‡ç½®æ—¶é—´ > `max_rate_limit_wait_seconds`ï¼Œä½¿ç”¨æœ€å¤§å€¼
- é»˜è®¤æœ€å¤§ç­‰å¾… 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰

## æ£€æŸ¥ç‚¹ âœ…

::: tip å¦‚ä½•éªŒè¯é…ç½®ç”Ÿæ•ˆï¼Ÿ
1. æŸ¥çœ‹é…ç½®æ–‡ä»¶ç¡®è®¤é…ç½®é¡¹æ­£ç¡®
2. å¯ç”¨è°ƒè¯•æ—¥å¿—ï¼š`OPENCODE_ANTIGRAVITY_DEBUG=1`
3. è§‚å¯Ÿæ—¥å¿—ä¸­çš„ `[RateLimit]` äº‹ä»¶
4. è§‚å¯Ÿåˆ‡æ¢è´¦æˆ·è¡Œä¸ºï¼ˆ`AccountContext` æ—¥å¿—ï¼‰
5. æ£€æŸ¥ toast é€šçŸ¥æ˜¯å¦æŒ‰é¢„æœŸæ˜¾ç¤º
:::

## è¸©å‘æé†’

### âŒ å¿½ç•¥å»é‡çª—å£ï¼Œè¯¯è§£é€€é¿æ—¶é—´

**é”™è¯¯è¡Œä¸º**ï¼š
- å‘èµ· 10 ä¸ªå¹¶å‘è¯·æ±‚ï¼Œéƒ½é‡åˆ° 429
- ä»¥ä¸ºé€€é¿æ—¶é—´æ˜¯ 2^10 Ã— 1s = 1024s
- å®é™…æ˜¯ 1sï¼ˆå› ä¸ºå»é‡çª—å£ï¼‰

**æ­£ç¡®åšæ³•**ï¼šç†è§£ 2 ç§’å»é‡çª—å£ï¼Œå¹¶å‘è¯·æ±‚ä¸ä¼šè¢«é‡å¤è®¡æ•°ã€‚

### âŒ æ··ç”¨ `switch_on_first_rate_limit` å’Œå•è´¦æˆ·

**é”™è¯¯è¡Œä¸º**ï¼š
- åªæœ‰ 1 ä¸ªè´¦æˆ·ï¼Œå´é…ç½®äº† `switch_on_first_rate_limit: true`
- ä»¥ä¸ºä¼šåˆ‡æ¢è´¦æˆ·ï¼Œå®é™…æ²¡æœ‰å…¶ä»–è´¦æˆ·å¯åˆ‡

**æ­£ç¡®åšæ³•**ï¼šå•è´¦æˆ·åœºæ™¯ä¸‹è¯¥é…ç½®æ— æ•ˆï¼Œè‡ªåŠ¨ä½¿ç”¨æŒ‡æ•°é€€é¿é‡è¯•ã€‚

### âŒ Gemini æ˜¾å¼åç¼€é˜»æ­¢ fallback

**é”™è¯¯è¡Œä¸º**ï¼š
- ä½¿ç”¨ `google/antigravity-gemini-3-pro:antigravity`
- é…ç½®äº† `quota_fallback: true`
- ä½†é‡åˆ° 429 æ—¶ä¸ä¼š fallback åˆ° Gemini CLI

**æ­£ç¡®åšæ³•**ï¼šæ˜¾å¼åç¼€ä¼šå¼ºåˆ¶ä½¿ç”¨æŒ‡å®šé…é¢æ± ï¼Œå¦‚æœéœ€è¦ fallbackï¼Œä¸è¦ä½¿ç”¨åç¼€ã€‚

### âŒ æ‰€æœ‰è´¦æˆ·é™é€Ÿåç­‰å¾…æ—¶é—´è¿‡é•¿

**é”™è¯¯è¡Œä¸º**ï¼š
- é…ç½®äº† `max_rate_limit_wait_seconds: 600`ï¼ˆ10 åˆ†é’Ÿï¼‰
- æ‰€æœ‰è´¦æˆ·é™é€Ÿ 60sï¼Œä½†ç­‰å¾…äº† 10 åˆ†é’Ÿ

**æ­£ç¡®åšæ³•**ï¼š`max_rate_limit_wait_seconds` æ˜¯**æœ€å¤§å€¼**ï¼Œå®é™…ç­‰å¾…æ—¶é—´æ˜¯æœ€çŸ­é‡ç½®æ—¶é—´ï¼Œä¸ä¼šè¶…è¿‡æœ€å¤§å€¼ã€‚

## æœ¬è¯¾å°ç»“

| æœºåˆ¶ | æ ¸å¿ƒç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|--- | --- | ---|
| **é€Ÿç‡é™åˆ¶æ£€æµ‹** | åŒºåˆ† 5 ç§ç±»å‹ï¼ˆQUOTA_EXHAUSTEDã€RATE_LIMIT_EXCEEDED ç­‰ï¼‰ | æ‰€æœ‰åœºæ™¯ |
| **æŒ‡æ•°é€€é¿** | å¤±è´¥æ¬¡æ•°è¶Šå¤šï¼Œç­‰å¾…æ—¶é—´è¶Šé•¿ï¼ˆ1s â†’ 2s â†’ 4s â†’ ... â†’ 60sï¼‰ | å•è´¦æˆ· |
| **è´¦æˆ·åˆ‡æ¢** | å¤šè´¦æˆ·ä¼˜å…ˆåˆ‡æ¢ï¼Œå•è´¦æˆ·é€€é¿é‡è¯• | å¤šè´¦æˆ· |
| **å»é‡çª—å£** | 2 ç§’å†…çš„å¹¶å‘ 429 è§†ä¸ºåŒä¸€äº‹ä»¶ | å¹¶å‘åœºæ™¯ |
| **åŒé…é¢æ±  fallback** | Antigravity é™é€Ÿåå°è¯• Gemini CLI | Gemini æ¨¡å‹ |

**å…³é”®é…ç½®**ï¼š

| é…ç½®é¡¹ | é»˜è®¤å€¼ | æ¨èå€¼ | è¯´æ˜ |
|--- | --- | --- | ---|
| `switch_on_first_rate_limit` | `true` | `true`ï¼ˆå¤šè´¦æˆ·ï¼‰ | é¦–æ¬¡é™é€Ÿç«‹å³åˆ‡æ¢ |
| `quota_fallback` | `false` | `true`ï¼ˆGeminiï¼‰ | å¯ç”¨åŒé…é¢æ±  fallback |
| `max_rate_limit_wait_seconds` | `300` | `300` | æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ |

**è°ƒè¯•æ–¹æ³•**ï¼š

- å¯ç”¨è°ƒè¯•æ—¥å¿—ï¼š`OPENCODE_ANTIGRAVITY_DEBUG=1`
- æŸ¥çœ‹ `[RateLimit]` äº‹ä»¶ï¼šäº†è§£é™é€Ÿç±»å‹å’Œé€€é¿æ—¶é—´
- æŸ¥çœ‹ `[AccountContext]` æ—¥å¿—ï¼šè§‚å¯Ÿè´¦æˆ·åˆ‡æ¢è¡Œä¸º

## ä¸‹ä¸€è¯¾é¢„å‘Š

> ä¸‹ä¸€è¯¾æˆ‘ä»¬å­¦ä¹  **[ä¼šè¯æ¢å¤](/zh/NoeFabris/opencode-antigravity-auth/advanced/session-recovery/)**ã€‚
>
> ä½ ä¼šå­¦åˆ°ï¼š
> - å¦‚ä½•è‡ªåŠ¨æ¢å¤ä¸­æ–­çš„å·¥å…·è°ƒç”¨
> - Thinking æ¨¡å‹çš„ä¼šè¯æ¢å¤æœºåˆ¶
> - Synthetic tool_result æ³¨å…¥åŸç†

---

## é™„å½•ï¼šæºç å‚è€ƒ

<details>
<summary><strong>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æºç ä½ç½®</strong></summary>

> æ›´æ–°æ—¶é—´ï¼š2026-01-23

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œå· |
|--- | --- | ---|
| é€Ÿç‡é™åˆ¶ç±»å‹å®šä¹‰ | [`src/plugin/accounts.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/accounts.ts#L10-L20) | 10-20 |
| è§£æé™é€ŸåŸå›  | [`src/plugin/accounts.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/accounts.ts#L29-L49) | 29-49 |
| è®¡ç®—é€€é¿æ—¶é—´ | [`src/plugin/accounts.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/accounts.ts#L51-L75) | 51-75 |
| æŒ‡æ•°é€€é¿ç®—æ³• | [`src/plugin.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin.ts#L532-L567) | 532-567 |
| æ ‡è®°è´¦æˆ·é™é€Ÿ | [`src/plugin/accounts.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/accounts.ts#L434-L461) | 434-461 |
| æ£€æŸ¥è´¦æˆ·æ˜¯å¦é™é€Ÿ | [`src/plugin/accounts.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/accounts.ts#L134-L152) | 134-152 |
| 429 é”™è¯¯å¤„ç† | [`src/plugin.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin.ts#L1260-L1396) | 1260-1396 |
| Gemini åŒé…é¢æ±  fallback | [`src/plugin.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin.ts#L1318-L1345) | 1318-1345 |
| é€Ÿç‡é™åˆ¶æ—¥å¿— | [`src/plugin/debug.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/debug.ts#L354-L396) | 354-396 |
| é…ç½® Schema | [`src/plugin/config/schema.ts`](https://github.com/NoeFabris/opencode-antigravity-auth/blob/main/src/plugin/config/schema.ts#L256-L221) | 256-221 |

**å…³é”®å¸¸é‡**ï¼š

- `QUOTA_EXHAUSTED_BACKOFFS = [60_000, 300_000, 1_800_000, 7_200_000]`ï¼šé…é¢è€—å°½é€’å¢é€€é¿æ—¶é—´ï¼ˆaccounts.ts:22ï¼‰
- `RATE_LIMIT_EXCEEDED_BACKOFF = 30_000`ï¼šé€Ÿç‡é™åˆ¶å›ºå®šé€€é¿ 30 ç§’ï¼ˆaccounts.ts:23ï¼‰
- `MODEL_CAPACITY_EXHAUSTED_BACKOFF = 15_000`ï¼šå®¹é‡è€—å°½å›ºå®šé€€é¿ 15 ç§’ï¼ˆaccounts.ts:24ï¼‰
- `SERVER_ERROR_BACKOFF = 20_000`ï¼šæœåŠ¡å™¨é”™è¯¯å›ºå®šé€€é¿ 20 ç§’ï¼ˆaccounts.ts:25ï¼‰
- `RATE_LIMIT_DEDUP_WINDOW_MS = 2000`ï¼šå»é‡çª—å£ 2 ç§’ï¼ˆplugin.ts:509ï¼‰
- `RATE_LIMIT_STATE_RESET_MS = 120_000`ï¼šçŠ¶æ€é‡ç½® 2 åˆ†é’Ÿï¼ˆplugin.ts:510ï¼‰
- `FIRST_RETRY_DELAY_MS = 1000`ï¼šé¦–æ¬¡å¿«é€Ÿé‡è¯• 1 ç§’ï¼ˆplugin.ts:1304ï¼‰

**å…³é”®å‡½æ•°**ï¼š

- `parseRateLimitReason(reason?, message?)`ï¼šè§£æé™é€ŸåŸå› ï¼ˆaccounts.ts:29ï¼‰
- `calculateBackoffMs(reason, consecutiveFailures, retryAfterMs?)`ï¼šè®¡ç®—é€€é¿æ—¶é—´ï¼ˆaccounts.ts:51ï¼‰
- `markRateLimitedWithReason(account, family, headerStyle, model, reason, retryAfterMs?)`ï¼šæ ‡è®°è´¦æˆ·é™é€Ÿï¼ˆaccounts.ts:445ï¼‰
- `isRateLimitedForHeaderStyle(account, family, headerStyle, model?)`ï¼šæ£€æŸ¥è´¦æˆ·æ˜¯å¦é™é€Ÿï¼ˆaccounts.ts:536ï¼‰
- `getRateLimitBackoff(accountIndex, quotaKey, serverRetryAfterMs)`ï¼šè·å–å»é‡åçš„é€€é¿æ—¶é—´ï¼ˆplugin.ts:532ï¼‰
- `resetRateLimitState(accountIndex, quotaKey)`ï¼šé‡ç½®é™é€ŸçŠ¶æ€ï¼ˆplugin.ts:573ï¼‰

</details>
