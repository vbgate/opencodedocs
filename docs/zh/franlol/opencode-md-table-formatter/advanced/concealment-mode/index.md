---
title: "éšè—æ¨¡å¼: å®½åº¦è®¡ç®—åŸç† | opencode-md-table-formatter"
sidebarTitle: "å®½åº¦è®¡ç®—ä¸‰æ­¥èµ°"
subtitle: "éšè—æ¨¡å¼åŸç†ï¼šä¸ºä»€ä¹ˆå®½åº¦è®¡ç®—å¦‚æ­¤é‡è¦"
description: "å­¦ä¹  OpenCode éšè—æ¨¡å¼çš„å·¥ä½œåŸç†ã€‚æŒæ¡æ’ä»¶æ˜¾ç¤ºå®½åº¦è®¡ç®—æ–¹æ³•ï¼Œäº†è§£ Markdown ç¬¦å·å‰¥ç¦»ã€ä»£ç å—ä¿æŠ¤ã€Bun.stringWidth çš„ä½¿ç”¨ã€‚"
tags:
  - "concealment-mode"
  - "æ˜¾ç¤ºå®½åº¦è®¡ç®—"
  - "Markdown ç¬¦å·å‰¥ç¦»"
  - "Bun.stringWidth"
prerequisite:
  - "start-features"
order: 30
---

# éšè—æ¨¡å¼åŸç†ï¼šä¸ºä»€ä¹ˆå®½åº¦è®¡ç®—å¦‚æ­¤é‡è¦

::: info å­¦å®Œä½ èƒ½åšä»€ä¹ˆ
- ç†è§£ OpenCode éšè—æ¨¡å¼çš„å·¥ä½œåŸç†
- çŸ¥é“ä¸ºä»€ä¹ˆæ™®é€šæ ¼å¼åŒ–å·¥å…·åœ¨éšè—æ¨¡å¼ä¸‹ä¼šå¯¹é½é”™ä½
- æŒæ¡æ’ä»¶çš„å®½åº¦è®¡ç®—ç®—æ³•ï¼ˆä¸‰æ­¥èµ°ï¼‰
- äº†è§£ `Bun.stringWidth` çš„ä½œç”¨
:::

## ä½ ç°åœ¨çš„å›°å¢ƒ

ä½ ç”¨ OpenCode å†™ä»£ç ï¼ŒAI ç”Ÿæˆäº†ä¸€ä¸ªæ¼‚äº®çš„è¡¨æ ¼ï¼š

```markdown
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|--- | --- | ---|
| **name** | string | ç”¨æˆ·å |
| age | number | å¹´é¾„ |
```

åœ¨æºç è§†å›¾é‡Œçœ‹ç€æŒºæ•´é½ã€‚ä½†åˆ‡åˆ°é¢„è§ˆæ¨¡å¼ï¼Œè¡¨æ ¼å´é”™ä½äº†ï¼š

```
| å­—æ®µ     | ç±»å‹   | è¯´æ˜   |
|--- | --- | ---|
| name | string | ç”¨æˆ·å |    â† æ€ä¹ˆçŸ­äº†ï¼Ÿ
| age      | number | å¹´é¾„   |
```

é—®é¢˜å‡ºåœ¨å“ªï¼Ÿ**éšè—æ¨¡å¼**ã€‚

## ä»€ä¹ˆæ˜¯éšè—æ¨¡å¼

OpenCode é»˜è®¤å¼€å¯**éšè—æ¨¡å¼ï¼ˆConcealment Modeï¼‰**ï¼Œå®ƒä¼šåœ¨æ¸²æŸ“æ—¶éšè— Markdown è¯­æ³•ç¬¦å·ï¼š

| æºç  | éšè—æ¨¡å¼ä¸‹æ˜¾ç¤º |
|--- | ---|
| `**ç²—ä½“**` | ç²—ä½“ï¼ˆ4 ä¸ªå­—ç¬¦ï¼‰ |
| `*æ–œä½“*` | æ–œä½“ï¼ˆ4 ä¸ªå­—ç¬¦ï¼‰ |
| `~~åˆ é™¤çº¿~~` | åˆ é™¤çº¿ï¼ˆ6 ä¸ªå­—ç¬¦ï¼‰ |
| `` `ä»£ç ` `` | `ä»£ç `ï¼ˆ4 ä¸ªå­—ç¬¦ + èƒŒæ™¯è‰²ï¼‰ |

::: tip éšè—æ¨¡å¼çš„å¥½å¤„
è®©ä½ ä¸“æ³¨äºå†…å®¹æœ¬èº«ï¼Œè€Œä¸æ˜¯è¢«ä¸€å † `**`ã€`*` ç¬¦å·å¹²æ‰°è§†çº¿ã€‚
:::

## ä¸ºä»€ä¹ˆæ™®é€šæ ¼å¼åŒ–å·¥å…·ä¼šå‡ºé—®é¢˜

æ™®é€šçš„è¡¨æ ¼æ ¼å¼åŒ–å·¥å…·è®¡ç®—å®½åº¦æ—¶ï¼Œä¼šæŠŠ `**name**` å½“ä½œ 8 ä¸ªå­—ç¬¦ï¼š

```
** n a m e ** = 8 å­—ç¬¦
```

ä½†åœ¨éšè—æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·çœ‹åˆ°çš„æ˜¯ `name`ï¼Œåªæœ‰ 4 ä¸ªå­—ç¬¦ã€‚

ç»“æœå°±æ˜¯ï¼šæ ¼å¼åŒ–å·¥å…·æŒ‰ 8 å­—ç¬¦å¯¹é½ï¼Œç”¨æˆ·çœ‹åˆ°çš„å´æ˜¯ 4 å­—ç¬¦ï¼Œè¡¨æ ¼è‡ªç„¶å°±é”™ä½äº†ã€‚

## æ ¸å¿ƒæ€è·¯ï¼šè®¡ç®—"æ˜¾ç¤ºå®½åº¦"è€Œé"å­—ç¬¦é•¿åº¦"

è¿™ä¸ªæ’ä»¶çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼š**è®¡ç®—ç”¨æˆ·å®é™…çœ‹åˆ°çš„å®½åº¦ï¼Œè€Œä¸æ˜¯æºç çš„å­—ç¬¦æ•°**ã€‚

ç®—æ³•åˆ†ä¸‰æ­¥ï¼š

```
ç¬¬ 1 æ­¥ï¼šä¿æŠ¤ä»£ç å—ï¼ˆä»£ç å—é‡Œçš„ç¬¦å·ä¸å‰¥ç¦»ï¼‰
ç¬¬ 2 æ­¥ï¼šå‰¥ç¦» Markdown ç¬¦å·ï¼ˆ**ã€*ã€~~ ç­‰ï¼‰
ç¬¬ 3 æ­¥ï¼šç”¨ Bun.stringWidth è®¡ç®—æœ€ç»ˆå®½åº¦
```

## è·Ÿæˆ‘åšï¼šç†è§£ä¸‰æ­¥ç®—æ³•

### ç¬¬ 1 æ­¥ï¼šä¿æŠ¤ä»£ç å—

**ä¸ºä»€ä¹ˆ**

è¡Œå†…ä»£ç ï¼ˆç”¨åå¼•å·åŒ…è£¹ï¼‰é‡Œçš„ Markdown ç¬¦å·æ˜¯"å­—é¢é‡"ï¼Œç”¨æˆ·ä¼šçœ‹åˆ° `**bold**` è¿™ 8 ä¸ªå­—ç¬¦ï¼Œè€Œä¸æ˜¯ `bold` è¿™ 4 ä¸ªå­—ç¬¦ã€‚

æ‰€ä»¥åœ¨å‰¥ç¦» Markdown ç¬¦å·ä¹‹å‰ï¼Œè¦å…ˆæŠŠä»£ç å—å†…å®¹"è—èµ·æ¥"ã€‚

**æºç å®ç°**

```typescript
// ç¬¬ 1 æ­¥ï¼šæå–å¹¶ä¿æŠ¤è¡Œå†…ä»£ç 
const codeBlocks: string[] = []
let textWithPlaceholders = text.replace(/`(.+?)`/g, (match, content) => {
  codeBlocks.push(content)
  return `\x00CODE${codeBlocks.length - 1}\x00`
})
```

**å·¥ä½œåŸç†**

| è¾“å…¥ | å¤„ç†å | codeBlocks æ•°ç»„ |
|--- | --- | ---|
| `` `**bold**` `` | `\x00CODE0\x00` | `["**bold**"]` |
| `` `a` and `b` `` | `\x00CODE0\x00 and \x00CODE1\x00` | `["a", "b"]` |

ç”¨ `\x00CODE0\x00` è¿™ç§ç‰¹æ®Šå ä½ç¬¦æ›¿æ¢ä»£ç å—ï¼Œåé¢å‰¥ç¦» Markdown ç¬¦å·æ—¶å°±ä¸ä¼šè¯¯ä¼¤å®ƒä»¬ã€‚

### ç¬¬ 2 æ­¥ï¼šå‰¥ç¦» Markdown ç¬¦å·

**ä¸ºä»€ä¹ˆ**

éšè—æ¨¡å¼ä¸‹ï¼Œ`**ç²—ä½“**` æ˜¾ç¤ºä¸º `ç²—ä½“`ï¼Œ`*æ–œä½“*` æ˜¾ç¤ºä¸º `æ–œä½“`ã€‚è®¡ç®—å®½åº¦æ—¶è¦æŠŠè¿™äº›ç¬¦å·å»æ‰ã€‚

**æºç å®ç°**

```typescript
// ç¬¬ 2 æ­¥ï¼šå‰¥ç¦»éä»£ç éƒ¨åˆ†çš„ Markdown ç¬¦å·
let visualText = textWithPlaceholders
let previousText = ""

while (visualText !== previousText) {
  previousText = visualText
  visualText = visualText
    .replace(/\*\*\*(.+?)\*\*\*/g, "$1") // ***ç²—æ–œä½“*** â†’ æ–‡æœ¬
    .replace(/\*\*(.+?)\*\*/g, "$1")     // **ç²—ä½“** â†’ ç²—ä½“
    .replace(/\*(.+?)\*/g, "$1")         // *æ–œä½“* â†’ æ–œä½“
    .replace(/~~(.+?)~~/g, "$1")         // ~~åˆ é™¤çº¿~~ â†’ åˆ é™¤çº¿
    .replace(/!\[([^\]]*)\]\(([^)]+)\)/g, "$1")     // ![alt](url) â†’ alt
    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, "$1 ($2)") // [text](url) â†’ text (url)
}
```

**ä¸ºä»€ä¹ˆç”¨ while å¾ªç¯ï¼Ÿ**

å¤„ç†åµŒå¥—è¯­æ³•ã€‚æ¯”å¦‚ `***ç²—æ–œä½“***`ï¼š

```
ç¬¬ 1 è½®ï¼š***ç²—æ–œä½“*** â†’ **ç²—æ–œä½“**ï¼ˆå‰¥ç¦»æœ€å¤–å±‚ ***ï¼‰
ç¬¬ 2 è½®ï¼š**ç²—æ–œä½“** â†’ *ç²—æ–œä½“*ï¼ˆå‰¥ç¦» **ï¼‰
ç¬¬ 3 è½®ï¼š*ç²—æ–œä½“* â†’ ç²—æ–œä½“ï¼ˆå‰¥ç¦» *ï¼‰
ç¬¬ 4 è½®ï¼šç²—æ–œä½“ = ç²—æ–œä½“ï¼ˆæ— å˜åŒ–ï¼Œé€€å‡ºå¾ªç¯ï¼‰
```

::: details å›¾ç‰‡å’Œé“¾æ¥çš„å¤„ç†
- **å›¾ç‰‡** `![alt](url)`ï¼šOpenCode åªæ˜¾ç¤º alt æ–‡æœ¬ï¼Œæ‰€ä»¥æ›¿æ¢ä¸º `alt`
- **é“¾æ¥** `[text](url)`ï¼šæ˜¾ç¤ºä¸º `text (url)`ï¼Œä¿ç•™ URL ä¿¡æ¯
:::

### ç¬¬ 3 æ­¥ï¼šæ¢å¤ä»£ç å— + è®¡ç®—å®½åº¦

**ä¸ºä»€ä¹ˆ**

ä»£ç å—å†…å®¹è¦æ”¾å›å»ï¼Œç„¶åç”¨ `Bun.stringWidth` è®¡ç®—æœ€ç»ˆçš„æ˜¾ç¤ºå®½åº¦ã€‚

**æºç å®ç°**

```typescript
// ç¬¬ 3 æ­¥ï¼šæ¢å¤ä»£ç å—å†…å®¹
visualText = visualText.replace(/\x00CODE(\d+)\x00/g, (match, index) => {
  return codeBlocks[parseInt(index)]
})

return Bun.stringWidth(visualText)
```

**ä¸ºä»€ä¹ˆç”¨ Bun.stringWidthï¼Ÿ**

`Bun.stringWidth` èƒ½æ­£ç¡®è®¡ç®—ï¼š

| å­—ç¬¦ç±»å‹ | ç¤ºä¾‹ | å­—ç¬¦æ•° | æ˜¾ç¤ºå®½åº¦ |
|--- | --- | --- | ---|
| ASCII | `abc` | 3 | 3 |
| ä¸­æ–‡ | `ä½ å¥½` | 2 | 4ï¼ˆæ¯ä¸ªå  2 æ ¼ï¼‰ |
| Emoji | `ğŸ˜€` | 1 | 2ï¼ˆå  2 æ ¼ï¼‰ |
| é›¶å®½å­—ç¬¦ | `a\u200Bb` | 3 | 2ï¼ˆé›¶å®½å­—ç¬¦ä¸å ä½ï¼‰ |

æ™®é€šçš„ `text.length` åªèƒ½æ•°å­—ç¬¦ä¸ªæ•°ï¼Œæ— æ³•å¤„ç†è¿™äº›ç‰¹æ®Šæƒ…å†µã€‚

## å®Œæ•´ç¤ºä¾‹

å‡è®¾å•å…ƒæ ¼å†…å®¹æ˜¯ï¼š`` **`code`** and *text* ``

**ç¬¬ 1 æ­¥ï¼šä¿æŠ¤ä»£ç å—**

```
è¾“å…¥ï¼š**`code`** and *text*
è¾“å‡ºï¼š**\x00CODE0\x00** and *text*
codeBlocks = ["code"]
```

**ç¬¬ 2 æ­¥ï¼šå‰¥ç¦» Markdown ç¬¦å·**

```
ç¬¬ 1 è½®ï¼š**\x00CODE0\x00** and *text* â†’ \x00CODE0\x00 and text
ç¬¬ 2 è½®ï¼šæ— å˜åŒ–ï¼Œé€€å‡º
```

**ç¬¬ 3 æ­¥ï¼šæ¢å¤ä»£ç å— + è®¡ç®—å®½åº¦**

```
æ¢å¤åï¼šcode and text
å®½åº¦ï¼šBun.stringWidth("code and text") = 13
```

æœ€ç»ˆï¼Œæ’ä»¶æŒ‰ 13 å­—ç¬¦çš„å®½åº¦æ¥å¯¹é½è¿™ä¸ªå•å…ƒæ ¼ï¼Œè€Œä¸æ˜¯æºç çš„ 22 å­—ç¬¦ã€‚

## æ£€æŸ¥ç‚¹

å®Œæˆæœ¬è¯¾åï¼Œä½ åº”è¯¥èƒ½å›ç­”ï¼š

- [ ] éšè—æ¨¡å¼ä¼šéšè—å“ªäº›ç¬¦å·ï¼Ÿï¼ˆç­”ï¼š`**`ã€`*`ã€`~~` ç­‰ Markdown è¯­æ³•ç¬¦å·ï¼‰
- [ ] ä¸ºä»€ä¹ˆè¦å…ˆä¿æŠ¤ä»£ç å—ï¼Ÿï¼ˆç­”ï¼šä»£ç å—é‡Œçš„ç¬¦å·æ˜¯å­—é¢é‡ï¼Œä¸åº”è¢«å‰¥ç¦»ï¼‰
- [ ] ä¸ºä»€ä¹ˆç”¨ while å¾ªç¯å‰¥ç¦»ç¬¦å·ï¼Ÿï¼ˆç­”ï¼šå¤„ç†åµŒå¥—è¯­æ³•ï¼Œå¦‚ `***ç²—æ–œä½“***`ï¼‰
- [ ] `Bun.stringWidth` æ¯” `text.length` å¥½åœ¨å“ªï¼Ÿï¼ˆç­”ï¼šèƒ½æ­£ç¡®è®¡ç®—ä¸­æ–‡ã€Emojiã€é›¶å®½å­—ç¬¦çš„æ˜¾ç¤ºå®½åº¦ï¼‰

## è¸©å‘æé†’

::: warning å¸¸è§è¯¯è§£
**è¯¯è§£**ï¼šä»£ç å—é‡Œçš„ `**` ä¹Ÿä¼šè¢«å‰¥ç¦»

**äº‹å®**ï¼šä¸ä¼šã€‚æ’ä»¶ä¼šå…ˆç”¨å ä½ç¬¦ä¿æŠ¤ä»£ç å—å†…å®¹ï¼Œå‰¥ç¦»å®Œå…¶ä»–éƒ¨åˆ†çš„ç¬¦å·åå†æ¢å¤ã€‚

æ‰€ä»¥ `` `**bold**` `` çš„å®½åº¦æ˜¯ 8ï¼ˆ`**bold**`ï¼‰ï¼Œä¸æ˜¯ 4ï¼ˆ`bold`ï¼‰ã€‚
:::

## æœ¬è¯¾å°ç»“

| æ­¥éª¤ | ä½œç”¨ | å…³é”®ä»£ç  |
|--- | --- | ---|
| ä¿æŠ¤ä»£ç å— | é˜²æ­¢ä»£ç å—å†…çš„ç¬¦å·è¢«è¯¯å‰¥ç¦» | `text.replace(/\`(.+?)\`/g, ...)` |
| å‰¥ç¦» Markdown | è®¡ç®—éšè—æ¨¡å¼ä¸‹çš„å®é™…æ˜¾ç¤ºå†…å®¹ | å¤šè½®æ­£åˆ™æ›¿æ¢ |
| è®¡ç®—å®½åº¦ | å¤„ç†ä¸­æ–‡ã€Emoji ç­‰ç‰¹æ®Šå­—ç¬¦ | `Bun.stringWidth()` |

## ä¸‹ä¸€è¯¾é¢„å‘Š

> ä¸‹ä¸€è¯¾æˆ‘ä»¬å­¦ä¹  **[è¡¨æ ¼è§„èŒƒ](../table-spec/)**ã€‚
>
> ä½ ä¼šå­¦åˆ°ï¼š
> - ä»€ä¹ˆæ ·çš„è¡¨æ ¼èƒ½è¢«æ ¼å¼åŒ–
> - è¡¨æ ¼éªŒè¯çš„ 4 æ¡è§„åˆ™
> - å¦‚ä½•é¿å…"æ— æ•ˆè¡¨æ ¼"é”™è¯¯

---

## é™„å½•ï¼šæºç å‚è€ƒ

<details>
<summary><strong>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æºç ä½ç½®</strong></summary>

> æ›´æ–°æ—¶é—´ï¼š2026-01-26

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œå· |
|--- | --- | ---|
| æ˜¾ç¤ºå®½åº¦è®¡ç®—å…¥å£ | [`index.ts`](https://github.com/franlol/opencode-md-table-formatter/blob/main/index.ts#L151-L159) | 151-159 |
| ä»£ç å—ä¿æŠ¤ | [`index.ts`](https://github.com/franlol/opencode-md-table-formatter/blob/main/index.ts#L168-L173) | 168-173 |
| Markdown ç¬¦å·å‰¥ç¦» | [`index.ts`](https://github.com/franlol/opencode-md-table-formatter/blob/main/index.ts#L175-L188) | 175-188 |
| ä»£ç å—æ¢å¤ | [`index.ts`](https://github.com/franlol/opencode-md-table-formatter/blob/main/index.ts#L190-L193) | 190-193 |
| Bun.stringWidth è°ƒç”¨ | [`index.ts`](https://github.com/franlol/opencode-md-table-formatter/blob/main/index.ts#L195) | 195 |

**å…³é”®å‡½æ•°**ï¼š
- `calculateDisplayWidth()`ï¼šå¸¦ç¼“å­˜çš„å®½åº¦è®¡ç®—å…¥å£
- `getStringWidth()`ï¼šæ ¸å¿ƒç®—æ³•ï¼Œå‰¥ç¦» Markdown ç¬¦å·å¹¶è®¡ç®—æ˜¾ç¤ºå®½åº¦

**å…³é”®å¸¸é‡**ï¼š
- `\x00CODE{n}\x00`ï¼šä»£ç å—å ä½ç¬¦æ ¼å¼

</details>
