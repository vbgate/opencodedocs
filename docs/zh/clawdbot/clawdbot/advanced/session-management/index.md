---
title: "ä¼šè¯ç®¡ç†ï¼šä¼šè¯éš”ç¦»ã€å­ Agent åä½œä¸ä¸Šä¸‹æ–‡å‹ç¼© | Clawdbot æ•™ç¨‹"
sidebarTitle: "å¤šç”¨æˆ·ä¸ä¸²æ‰°"
subtitle: "ä¼šè¯ç®¡ç†ä¸å¤š Agentï¼šä¼šè¯éš”ç¦»ã€å­ Agent åä½œå’Œä¸Šä¸‹æ–‡å‹ç¼©"
description: "å­¦ä¹  Clawdbot çš„ä¼šè¯æ¨¡å‹ã€å¤š Agent ä¼šè¯éš”ç¦»ã€å­ Agent åä½œæœºåˆ¶å’Œä¸Šä¸‹æ–‡å‹ç¼©ç­–ç•¥ã€‚æŒæ¡å¤š Agent ç¯å¢ƒä¸‹çš„ä¼šè¯é…ç½®ã€ä¸Šä¸‹æ–‡æ§åˆ¶å’Œæœ€ä½³å®è·µï¼Œç¡®ä¿é«˜æ•ˆéš”ç¦»ä¸åŒç”¨æˆ·çš„å¯¹è¯å†å²å’Œä»»åŠ¡æ‰§è¡Œã€‚"
tags:
  - "ä¼šè¯ç®¡ç†"
  - "å¤š Agent"
  - "ä¸Šä¸‹æ–‡å‹ç¼©"
prerequisite:
  - "start-gateway-startup"
order: 200
---

# ä¼šè¯ç®¡ç†ä¸å¤š Agentï¼šä¼šè¯éš”ç¦»ã€å­ Agent åä½œå’Œä¸Šä¸‹æ–‡å‹ç¼©

## å­¦å®Œä½ èƒ½åšä»€ä¹ˆ

- ç†è§£ Clawdbot çš„ä¼šè¯æ¨¡å‹å’Œä¼šè¯é”®ç»“æ„
- é…ç½®ä¸åŒ Agent ä¹‹é—´çš„ä¼šè¯éš”ç¦»
- ä½¿ç”¨å­ Agent å®Œæˆéš”ç¦»ä»»åŠ¡
- ç®¡ç†ä¸Šä¸‹æ–‡çª—å£ï¼Œé¿å…è¶…å‡ºæ¨¡å‹é™åˆ¶
- æŒæ¡ä¼šè¯é‡ç½®å’Œå‹ç¼©çš„æœ€ä½³å®è·µ

## ä½ ç°åœ¨çš„å›°å¢ƒ

å½“ä½ çš„ AI åŠ©æ‰‹åŒæ—¶æœåŠ¡äºå¤šä¸ªç”¨æˆ·ã€å¤šä¸ªæ¸ é“æ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™äº›é—®é¢˜ï¼š

- **ä¼šè¯ä¸²æ‰°**ï¼šä¸åŒç”¨æˆ·çš„æ¶ˆæ¯æ··åœ¨ä¸€èµ·ï¼ŒAI è®°ä¸ä½å„è‡ªçš„å†å²
- **ä¸Šä¸‹æ–‡çˆ†ç‚¸**ï¼šé•¿æ—¶é—´å¯¹è¯åï¼Œæ¨¡å‹å¼€å§‹"å¤±å¿†"æˆ–å“åº”å˜æ…¢
- **å­ä»»åŠ¡æ··ä¹±**ï¼šä¸» Agent è°ƒç”¨å­ä»»åŠ¡æ—¶ï¼Œæ²¡æœ‰æ¸…æ™°çš„éš”ç¦»è¾¹ç•Œ
- **èµ„æºæµªè´¹**ï¼šæ‰€æœ‰ Agent å…±äº«åŒä¸€å¥—ä¼šè¯ï¼Œå¯¼è‡´å­˜å‚¨å’Œè®¡ç®—èµ„æºæ— æ³•æœ‰æ•ˆåˆ©ç”¨

Clawdbot çš„**ä¼šè¯ç®¡ç†ç³»ç»Ÿ**å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è€Œè®¾è®¡çš„ã€‚

## æ ¸å¿ƒæ€è·¯

**ä¼šè¯**æ˜¯ Clawdbot çš„æ ¸å¿ƒæŠ½è±¡å•å…ƒâ€”â€”æ¯ä¸ªä¼šè¯ä»£è¡¨ä¸€æ®µç‹¬ç«‹çš„å¯¹è¯å†å²ï¼Œæ‹¥æœ‰è‡ªå·±çš„æ¶ˆæ¯è®°å½•ã€å…ƒæ•°æ®å’Œç”Ÿå‘½å‘¨æœŸã€‚

Clawdbot é€šè¿‡**ä¼šè¯é”®ï¼ˆsession keyï¼‰**æ¥æ ‡è¯†å’Œéš”ç¦»ä¸åŒçš„ä¼šè¯ã€‚ä¼šè¯é”®ä¸ä»…åŒºåˆ†ä¸åŒçš„å¯¹è¯å¯¹è±¡ï¼ˆç”¨æˆ·ã€ç¾¤ç»„ã€é¢‘é“ï¼‰ï¼Œè¿˜åŒºåˆ†ä¸åŒçš„ Agent å®ä¾‹ã€‚

::: info ä»€ä¹ˆæ˜¯ä¼šè¯é”®ï¼Ÿ

ä¼šè¯é”®æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ ‡è¯†ç¬¦ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªä¼šè¯ã€‚æ ¼å¼ç¤ºä¾‹ï¼š
- `agent:main:main`ï¼ˆä¸» Agent çš„ä¸»ä¼šè¯ï¼‰
- `agent:work:main`ï¼ˆå·¥ä½œ Agent çš„ä¸»ä¼šè¯ï¼‰
- `agent:main:whatsapp:group:123`ï¼ˆWhatsApp ç¾¤ç»„ä¼šè¯ï¼‰
- `cron:job-id`ï¼ˆå®šæ—¶ä»»åŠ¡ä¼šè¯ï¼‰

Clawdbot æ ¹æ®ä¼šè¯é”®å°†æ¶ˆæ¯è·¯ç”±åˆ°æ­£ç¡®çš„ Agentï¼Œå¹¶ç»´æŠ¤ç‹¬ç«‹çš„å¯¹è¯å†å²ã€‚
:::

## ä¼šè¯æ¨¡å‹

### ä¼šè¯é”®çš„ç»„æˆ

Clawdbot ä½¿ç”¨ç»“æ„åŒ–çš„ä¼šè¯é”®æ¥æ ‡è¯†ä¸åŒç±»å‹çš„ä¼šè¯ï¼š

| ä¼šè¯ç±»å‹ | é”®æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ |
|---------|---------|-------|------|
| **ä¸»ä¼šè¯** | `agent:<agentId>:<mainKey>` | `agent:main:main` | æ¯ä¸ª Agent çš„é»˜è®¤ä¸»ä¼šè¯ |
| **ç›´æ¥æ¶ˆæ¯** | `agent:<agentId>:dm:<peerId>` | `agent:main:dm:+15551234567` | æŒ‰ `dmScope` é…ç½®éš”ç¦» |
| **ç¾¤ç»„/é¢‘é“** | `agent:<agentId>:<channel>:group:<id>` | `agent:main:whatsapp:group:123` | ç¾¤ç»„å’Œé¢‘é“è‡ªåŠ¨éš”ç¦» |
| **å­ Agent** | `agent:<agentId>:subagent:<uuid>` | `agent:main:subagent:a1b2c3d4` | å­ Agent çš„éš”ç¦»ä¼šè¯ |
| **å®šæ—¶ä»»åŠ¡** | `cron:<jobId>` | `cron:daily-report` | Cron ä»»åŠ¡çš„ä¸“ç”¨ä¼šè¯ |
| **Webhook** | `hook:<uuid>` | `hook:xyz789` | Webhook è§¦å‘çš„ä¼šè¯ |

### ä¼šè¯å­˜å‚¨

ä¼šè¯æ•°æ®å­˜å‚¨åœ¨ä¸¤ä¸ªä½ç½®ï¼š

```bash
# ä¼šè¯ç´¢å¼•ï¼ˆå…ƒæ•°æ®ï¼‰
~/.clawdbot/agents/<agentId>/sessions/sessions.json

# æ¶ˆæ¯å†å²ï¼ˆæ¯ä¼šè¯ä¸€ä¸ªæ–‡ä»¶ï¼‰
~/.clawdbot/agents/<agentId>/sessions/<sessionId>.jsonl
```

**sessions.json** æ˜¯ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œè®°å½•ï¼š
- ä¼šè¯é”® â†’ ä¼šè¯å…ƒæ•°æ®ï¼ˆsessionId, updatedAt, model, tokens ç­‰ï¼‰
- åˆ é™¤è¿™äº›æ¡ç›®æ˜¯å®‰å…¨çš„ï¼Œå®ƒä»¬ä¼šåœ¨éœ€è¦æ—¶è‡ªåŠ¨é‡å»º

**JSONL æ–‡ä»¶**å­˜å‚¨å®Œæ•´çš„å¯¹è¯å†å²ï¼Œæ¯è¡Œä¸€æ¡æ¶ˆæ¯è®°å½•ã€‚

::: tip Gateway æ˜¯å•ä¸€çœŸç›¸æº

æ‰€æœ‰ä¼šè¯çŠ¶æ€ç”± Gateway æ‹¥æœ‰ã€‚UI å®¢æˆ·ç«¯ï¼ˆmacOS åº”ç”¨ã€WebChatï¼‰å¿…é¡»ä» Gateway æŸ¥è¯¢ä¼šè¯åˆ—è¡¨å’Œ token è®¡æ•°ï¼Œè€Œä¸æ˜¯ç›´æ¥è¯»å–æœ¬åœ°æ–‡ä»¶ã€‚

åœ¨è¿œç¨‹æ¨¡å¼ä¸‹ï¼Œä½ å…³å¿ƒçš„ä¼šè¯å­˜å‚¨åœ¨è¿œç¨‹ Gateway ä¸»æœºä¸Šï¼Œè€Œä¸æ˜¯ä½ çš„ Mac ä¸Šã€‚
:::

## ä¼šè¯éš”ç¦»æœºåˆ¶

### å• Agent æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰

å¦‚æœä¸åšä»»ä½•é…ç½®ï¼ŒClawdbot è¿è¡Œå•ä¸ª Agentï¼š
- `agentId` é»˜è®¤ä¸º `main`
- æ‰€æœ‰ DM ä¼šè¯å…±äº«ä¸»ä¼šè¯é”®ï¼ˆ`agent:main:main`ï¼‰
- è¿™æ„å‘³ç€**åŒä¸€ä¸ªç”¨æˆ·ä»ä¸åŒæ¸ é“å‘æ¥çš„æ¶ˆæ¯ä¼šè¿›å…¥åŒä¸€ä¸ªä¼šè¯**

### å¤š Agent æ¨¡å¼

**å¤šä¸ª Agent = å¤šä¸ªéš”ç¦»çš„å¤§è„‘**

æ¯ä¸ª Agent æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ï¼š
- **Workspace**ï¼ˆå·¥ä½œåŒºæ–‡ä»¶ã€AGENTS.mdã€SOUL.mdï¼‰
- **State directory**ï¼ˆè®¤è¯é…ç½®ã€æ¨¡å‹æ³¨å†Œè¡¨ï¼‰
- **Session store**ï¼ˆèŠå¤©å†å²å’Œè·¯ç”±çŠ¶æ€ï¼‰

#### ä¸ºä»€ä¹ˆè¦å¤š Agentï¼Ÿ

| åœºæ™¯ | è§£å†³æ–¹æ¡ˆ |
|--------|---------|
| **å¤šç”¨æˆ·å…±äº«æœåŠ¡å™¨** | æ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹ Agentï¼Œä¼šè¯å®Œå…¨éš”ç¦» |
| **ä¸åŒæ¸ é“ä¸åŒäººæ ¼** | WhatsApp ç”¨æ—¥å¸¸ Agentï¼ŒTelegram ç”¨æ·±åº¦å·¥ä½œ Agent |
| **æƒé™åˆ†ç¦»** | å®¶åº­ Agent é™åˆ¶å·¥å…·ï¼Œä¸ªäºº Agent å®Œå…¨è®¿é—® |
| **ä¸åŒç¯å¢ƒ** | å¼€å‘ Agentã€ç”Ÿäº§ Agent å®Œå…¨éš”ç¦» |

#### é…ç½®å¤š Agent

**ç¬¬ 1 æ­¥ï¼šæ·»åŠ æ–° Agent**

```bash
clawdbot agents add work
```

è¿™ä¼šåœ¨ `~/.clawdbot/agents/work/` åˆ›å»ºæ–°çš„ Agent ç›®å½•ã€‚

**ç¬¬ 2 æ­¥ï¼šé…ç½®è·¯ç”±è§„åˆ™**

åœ¨ `~/.clawdbot/clawdbot.json` ä¸­æ·»åŠ  `bindings`ï¼š

```json5
{
  agents: {
    list: [
      { id: "home", workspace: "~/clawd-home", name: "Home" },
      { id: "work", workspace: "~/clawd-work", name: "Work" }
    ]
  },
  bindings: [
    { agentId: "home", match: { channel: "whatsapp", accountId: "personal" } },
    { agentId: "work", match: { channel: "whatsapp", accountId: "biz" } }
  ]
}
```

**ç¬¬ 3 æ­¥ï¼šéªŒè¯é…ç½®**

```bash
clawdbot agents list --bindings
```

#### è·¯ç”±è§„åˆ™ï¼ˆç¡®å®šæ€§åŒ¹é…ï¼‰

å½“æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼ŒClawdbot æŒ‰**æœ€å…·ä½“ä¼˜å…ˆ**çš„é¡ºåºåŒ¹é…è§„åˆ™ï¼š

1. **peer** åŒ¹é…ï¼ˆç²¾ç¡®çš„ DM/group/channel idï¼‰
2. **guildId**ï¼ˆDiscordï¼‰
3. **teamId**ï¼ˆSlackï¼‰
4. **accountId** åŒ¹é…
5. æ¸ é“çº§åˆ«åŒ¹é…ï¼ˆ`accountId: "*"`ï¼‰
6. å›é€€åˆ°é»˜è®¤ Agent

::: warning æ³¨æ„ç»‘å®šé¡ºåº

ç»‘å®šåˆ—è¡¨ä¸­çš„é¡ºåºå¾ˆé‡è¦ï¼æ›´å…·ä½“çš„è§„åˆ™åº”è¯¥æ”¾åœ¨å‰é¢ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³å°†ä¸€ä¸ªç‰¹å®š DM è·¯ç”±åˆ° `work` Agentï¼Œå…¶ä»– WhatsApp DM è·¯ç”±åˆ° `home` Agentï¼Œå¿…é¡»å…ˆå†™ peer è§„åˆ™ï¼š
```json5
{
  bindings: [
    { agentId: "work", match: { channel: "whatsapp", peer: { kind: "dm", id: "+15551234567" } } },
    { agentId: "home", match: { channel: "whatsapp" } }
  ]
}
```
:::

### DM èŒƒå›´æ§åˆ¶

ä½¿ç”¨ `session.dmScope` æ§åˆ¶ç›´æ¥æ¶ˆæ¯å¦‚ä½•åˆ†ç»„ï¼š

| é€‰é¡¹ | è¡Œä¸º | é€‚ç”¨åœºæ™¯ |
|------|-------|---------|
| `main`ï¼ˆé»˜è®¤ï¼‰ | æ‰€æœ‰ DM å…±äº«ä¸»ä¼šè¯ | å•ç”¨æˆ·å¤šæ¸ é“ |
| `per-peer` | æŒ‰å‘é€è€… ID éš”ç¦» | å¤šç”¨æˆ·ç¯å¢ƒ |
| `per-channel-peer` | æŒ‰æ¸ é“ + å‘é€è€…éš”ç¦» | å…±äº«æ”¶ä»¶ç®± |

é…ç½®ç¤ºä¾‹ï¼š

```json5
{
  session: {
    dmScope: "per-channel-peer"  // æ¯ä¸ªæ¸ é“çš„æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹ä¼šè¯
  }
}
```

### èº«ä»½é“¾æ¥ï¼ˆIdentity Linksï¼‰

å¦‚æœåŒä¸€ä¸ªç”¨æˆ·ä½¿ç”¨å¤šä¸ªå¹³å°ï¼ˆå¦‚ WhatsApp å’Œ Telegramï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡ `session.identityLinks` è®©ä»–ä»¬å…±äº«ä¼šè¯ï¼š

```json5
{
  session: {
    identityLinks: {
      alice: ["telegram:123456789", "discord:987654321012345678"]
    }
  }
}
```

è¿™æ ·ï¼ŒAlice ä» Telegram æˆ– Discord å‘æ¥çš„æ¶ˆæ¯éƒ½ä¼šè¿›å…¥ `agent:<agentId>:dm:alice` ä¼šè¯ã€‚

## å­ Agent åä½œ

### ä»€ä¹ˆæ˜¯å­ Agent

**å­ Agent**æ˜¯ä¸€ä¸ªåœ¨éš”ç¦»ä¼šè¯ä¸­è¿è¡Œçš„ Agent å®ä¾‹ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šä»»åŠ¡è€Œä¸å½±å“ä¸»ä¼šè¯çš„ä¸Šä¸‹æ–‡ã€‚

å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š
- **ä»£ç å®¡æŸ¥**ï¼šå­ Agent åˆ†æä»£ç ï¼Œè¿”å›æ‘˜è¦
- **æ•°æ®æå–**ï¼šå­ Agent ä»é•¿æ–‡æ¡£ä¸­æå–ä¿¡æ¯
- **å¹¶è¡Œä»»åŠ¡**ï¼šä¸» Agent ç­‰å¾…æ—¶ï¼Œå­ Agent åœ¨åå°è¿è¡Œ
- **æ²™ç®±éš”ç¦»**ï¼šåœ¨å—é™ç¯å¢ƒä¸­æ‰§è¡Œä¸ä¿¡ä»»çš„ä»»åŠ¡

### sessions_spawn å·¥å…·

ä½¿ç”¨ `sessions_spawn` å·¥å…·åˆ›å»ºå­ Agentï¼š

```json
{
  "task": "åˆ†æè¿™ä¸ªæ–‡æ¡£å¹¶æå–å…³é”®è¦ç‚¹",
  "label": "æ–‡æ¡£åˆ†æ",
  "model": "anthropic/claude-opus-4-5",
  "thinking": "detailed",
  "runTimeoutSeconds": 300,
  "cleanup": "keep"
}
```

å‚æ•°è¯´æ˜ï¼š

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|-------|------|
| `task` | string | âœ… | å­ Agent çš„ä»»åŠ¡æè¿° |
| `label` | string | âŒ | å¯è¯»çš„ä»»åŠ¡æ ‡ç­¾ï¼ˆç”¨äºè¿½è¸ªï¼‰ |
| `agentId` | string | âŒ | ç›®æ ‡ Agent IDï¼ˆé»˜è®¤å½“å‰ Agentï¼‰ |
| `model` | string | âŒ | æ¨¡å‹è¦†ç›– |
| `thinking` | string | âŒ | æ€è€ƒçº§åˆ«ï¼ˆ`minimal`/`standard`/`detailed`ï¼‰ |
| `runTimeoutSeconds` | number | âŒ | è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ |
| `cleanup` | string | âŒ | ä»»åŠ¡å®Œæˆåæ¸…ç†ç­–ç•¥ï¼ˆ`keep`/`delete`ï¼‰ |

### å­ Agent ç”Ÿå‘½å‘¨æœŸ

```mermaid
sequenceDiagram
    participant Main as ä¸» Agent
    participant Tool as sessions_spawn
    participant Gateway
    participant Sub as å­ Agent

    Main->>Tool: è°ƒç”¨ sessions_spawn
    Tool->>Gateway: 1. éªŒè¯æƒé™ï¼ˆagentToAgentï¼‰
    Tool->>Gateway: 2. åˆ›å»ºå­ä¼šè¯ï¼ˆsubagent:uuidï¼‰
    Tool->>Sub: 3. å‘é€ä»»åŠ¡
    Sub->>Sub: 4. æ‰§è¡Œä»»åŠ¡
    Sub->>Main: 5. è¿”å›ç»“æœ
    Main->>Tool: 6. å†³å®šä¿ç•™æˆ–åˆ é™¤å­ä¼šè¯
```

**ç”Ÿå‘½å‘¨æœŸæ­¥éª¤**ï¼š

1. **æƒé™æ£€æŸ¥**ï¼šå¦‚æœè·¨ Agent è°ƒç”¨ï¼ŒéªŒè¯ `tools.agentToAgent.allow` é…ç½®
2. **åˆ›å»ºå­ä¼šè¯**ï¼šç”Ÿæˆå”¯ä¸€çš„ `agent:<agentId>:subagent:<uuid>` é”®
3. **æ‰§è¡Œä»»åŠ¡**ï¼šå­ Agent åœ¨éš”ç¦»ä¼šè¯ä¸­å®Œæˆä»»åŠ¡
4. **è¿”å›ç»“æœ**ï¼šç»“æœæµå¼è¿”å›åˆ°ä¸» Agent
5. **æ¸…ç†ç­–ç•¥**ï¼š
   - `cleanup: "keep"`ï¼šä¿ç•™å­ä¼šè¯ç”¨äºåç»­æ£€æŸ¥
   - `cleanup: "delete"`ï¼šè‡ªåŠ¨åˆ é™¤å­ä¼šè¯

### é…ç½® Agent é—´é€šä¿¡

é»˜è®¤æƒ…å†µä¸‹ï¼ŒAgent é—´é€šä¿¡æ˜¯ç¦ç”¨çš„ã€‚éœ€è¦æ˜¾å¼å¯ç”¨ï¼š

```json5
{
  tools: {
    agentToAgent: {
      enabled: true,
      allow: ["home", "work", "family"]
    }
  }
}
```

æƒé™è¯´æ˜ï¼š
- `enabled: false`ï¼šå®Œå…¨ç¦ç”¨ Agent é—´é€šä¿¡
- `allow: ["*"]`ï¼šå…è®¸ä»»ä½• Agent
- `allow: ["home", "work"]`ï¼šåªå…è®¸ç‰¹å®š Agent

::: danger å®‰å…¨æé†’

å­ Agent ç»§æ‰¿çˆ¶ Agent çš„éƒ¨åˆ†ä¸Šä¸‹æ–‡ï¼Œä½†**ä¸ä¼š**è·å¾—å®Œæ•´çš„çˆ¶ä¼šè¯å†å²ã€‚è¿™æ—¢æ˜¯ç‰¹æ€§ï¼ˆèŠ‚çœ tokenï¼‰ï¼Œä¹Ÿæ˜¯é™åˆ¶ï¼ˆå­ Agent ä¸çŸ¥é“å®Œæ•´ä¸Šä¸‹æ–‡ï¼‰ã€‚

å¯¹äºæ•æ„Ÿæ“ä½œï¼Œè€ƒè™‘åœ¨ä¸»ä¼šè¯ä¸­å®Œæˆè€Œä¸æ˜¯é€šè¿‡å­ Agentã€‚
:::

## ä¸Šä¸‹æ–‡å‹ç¼©

### ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡çª—å£

æ¯ä¸ª AI æ¨¡å‹éƒ½æœ‰ä¸€ä¸ª**ä¸Šä¸‹æ–‡çª—å£ï¼ˆcontext windowï¼‰**â€”â€”å®ƒèƒ½åœ¨ä¸€æ¬¡æ¨ç†ä¸­çœ‹åˆ°çš„æœ€å¤§ token æ•°é‡ã€‚

é•¿æ—¶é—´å¯¹è¯ä¼šç´¯ç§¯æ¶ˆæ¯å’Œå·¥å…·ç»“æœã€‚ä¸€æ—¦æ¥è¿‘æ¨¡å‹é™åˆ¶ï¼ŒClawdbot ä¼š**å‹ç¼©ï¼ˆcompactï¼‰**å†å²ä»¥è…¾å‡ºç©ºé—´ã€‚

### è‡ªåŠ¨å‹ç¼©

å½“ä¼šè¯æ¥è¿‘æˆ–è¶…å‡ºä¸Šä¸‹æ–‡çª—å£æ—¶ï¼ŒClawdbot è‡ªåŠ¨è§¦å‘å‹ç¼©ï¼š

- **å‹ç¼©å‰**ï¼šå…ˆè¿è¡Œä¸€ä¸ª**é™é»˜è®°å¿†åˆ·æ–°**ï¼Œæç¤ºæ¨¡å‹å°†æŒä¹…åŒ–ç¬”è®°å†™å…¥ç£ç›˜ï¼ˆå¦‚æœå·¥ä½œåŒºå¯å†™ï¼‰
- **å‹ç¼©è¿‡ç¨‹**ï¼šå°†æ—§å¯¹è¯æ€»ç»“ä¸ºå‹ç¼©æ‘˜è¦ï¼Œä¿ç•™æœ€è¿‘çš„æ¶ˆæ¯
- **æŒä¹…åŒ–**ï¼šå‹ç¼©ç»“æœå†™å…¥ JSONL å†å²æ–‡ä»¶
- **é‡è¯•**ï¼šä½¿ç”¨å‹ç¼©åçš„ä¸Šä¸‹æ–‡é‡è¯•åŸå§‹è¯·æ±‚

ä½ ä¼šçœ‹åˆ°ï¼š
- `ğŸ§¹ Auto-compaction complete`ï¼ˆåœ¨è¯¦ç»†æ¨¡å¼ä¸‹ï¼‰
- `/status` æ˜¾ç¤º `ğŸ§¹ Compactions: <count>`

### æ‰‹åŠ¨å‹ç¼©

ä½¿ç”¨ `/compact` å‘½ä»¤æ‰‹åŠ¨è§¦å‘å‹ç¼©ï¼š

```
/compact
```

ä½ å¯ä»¥æ·»åŠ å‹ç¼©æŒ‡ä»¤ï¼š

```
/compact Focus on decisions and open questions
```

è¿™ä¼šæŒ‡å¯¼ AI åœ¨æ€»ç»“æ—¶å…³æ³¨ç‰¹å®šå†…å®¹ã€‚

### å‹ç¼© vs å‰ªæ

| æ“ä½œ | ä½œç”¨ | æŒä¹…åŒ– | ä½ç½® |
|------|-------|---------|------|
| **å‹ç¼©ï¼ˆCompactionï¼‰** | æ€»ç»“æ—§å¯¹è¯ | âœ… | å†™å…¥ JSONL |
| **å‰ªæï¼ˆPruningï¼‰** | ç§»é™¤æ—§å·¥å…·ç»“æœ | âŒ | ä»…å†…å­˜ä¸­ |

::: tip å‹ç¼©ç­–ç•¥å»ºè®®

- **å‹ç¼©**ï¼šä¿å­˜ä¿¡æ¯æ‘˜è¦ï¼Œé€‚åˆéœ€è¦å›é¡¾å†å²
- **å‰ªæ**ï¼šä¸´æ—¶æ¸…ç†ï¼Œé€‚åˆå‡å°‘å•æ¬¡è¯·æ±‚çš„ token ä½¿ç”¨
- **/new**ï¼šå®Œå…¨æ¸…ç©ºä¼šè¯ï¼Œç”¨äºå¼€å§‹æ–°ä¸»é¢˜

æ ¹æ®ä½ çš„ä½¿ç”¨ä¹ æƒ¯é€‰æ‹©åˆé€‚çš„ç­–ç•¥ã€‚
:::

### å‹ç¼©é…ç½®

åœ¨ `~/.clawdbot/clawdbot.json` ä¸­é…ç½®å‹ç¼©è¡Œä¸ºï¼š

```json5
{
  agents: {
    defaults: {
      compaction: {
        enabled: true,
        threshold: 0.9,  // ä¸Šä¸‹æ–‡ä½¿ç”¨ 90% æ—¶è§¦å‘
        trigger: "auto"  // auto/manual
      }
    }
  }
}
```

## è·Ÿæˆ‘åšï¼šé…ç½®ä¼šè¯ç®¡ç†

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…åœºæ™¯æ¥é…ç½®ä¼šè¯ç®¡ç†ã€‚

### åœºæ™¯

ä½ æœ‰ä¸€ä¸ª WhatsApp å·ç ï¼Œå¸Œæœ›ï¼š
1. ä¸ªäººè”ç³»äººä½¿ç”¨ `home` Agentï¼ˆæ—¥å¸¸å¯¹è¯ï¼‰
2. å·¥ä½œç¾¤ç»„ä½¿ç”¨ `work` Agentï¼ˆä¸“ä¸šå“åº”ï¼‰
3. å¯ç”¨å­ Agent ç”¨äºéš”ç¦»ä»»åŠ¡

### ç¬¬ 1 æ­¥ï¼šæ·»åŠ ä¸¤ä¸ª Agent

```bash
# æ·»åŠ å®¶åº­ Agent
clawdbot agents add home

# æ·»åŠ å·¥ä½œ Agent
clawdbot agents add work
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šæç¤ºä½ è¾“å…¥å·¥ä½œåŒºè·¯å¾„ç­‰ä¿¡æ¯ã€‚

### ç¬¬ 2 æ­¥ï¼šç¼–è¾‘é…ç½®æ–‡ä»¶

æ‰“å¼€ `~/.clawdbot/clawdbot.json`ï¼Œæ·»åŠ  Agent åˆ—è¡¨å’Œç»‘å®šè§„åˆ™ï¼š

```json5
{
  agents: {
    list: [
      {
        id: "home",
        name: "Home",
        workspace: "~/clawd-home",
        model: "anthropic/claude-sonnet-4-5"
      },
      {
        id: "work",
        name: "Work",
        workspace: "~/clawd-work",
        model: "anthropic/claude-opus-4-5"
      }
    ]
  },
  bindings: [
    // ä¸ªäººæ¶ˆæ¯è·¯ç”±åˆ° home Agent
    { agentId: "home", match: { channel: "whatsapp", peer: { kind: "dm", id: "+15551230001" } } },
    // å·¥ä½œç¾¤ç»„è·¯ç”±åˆ° work Agent
    { agentId: "work", match: { channel: "whatsapp", peer: { kind: "group", id: "120363999999999999@g.us" } } },
    // å…¶ä»– WhatsApp æ¶ˆæ¯è·¯ç”±åˆ° home Agentï¼ˆé»˜è®¤ï¼‰
    { agentId: "home", match: { channel: "whatsapp" } }
  ],
  tools: {
    agentToAgent: {
      enabled: true,
      allow: ["home", "work"]
    }
  }
}
```

### ç¬¬ 3 æ­¥ï¼šé‡å¯ Gateway

```bash
clawdbot gateway restart
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šGateway å¯åŠ¨æ—¥å¿—ï¼Œæ˜¾ç¤ºå·²åŠ è½½çš„ Agent å’Œç»‘å®šè§„åˆ™ã€‚

### ç¬¬ 4 æ­¥ï¼šæµ‹è¯•å­ Agent è°ƒç”¨

åœ¨ `home` Agent çš„ä¼šè¯ä¸­å‘é€ï¼š

```
è¯·ç”¨å­ Agent åˆ†æè¿™ä¸ª PDF æ–‡æ¡£å¹¶æå–å…³é”®ä¿¡æ¯ï¼š/path/to/file.pdf
```

Agent åº”è¯¥è‡ªåŠ¨è°ƒç”¨ `sessions_spawn` å·¥å…·ï¼Œä½ ä¼šçœ‹åˆ°ï¼š
- å­ Agent åˆ›å»ºé€šçŸ¥
- ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹
- ç»“æœè¿”å›

### ç¬¬ 5 æ­¥ï¼šæ£€æŸ¥ä¼šè¯çŠ¶æ€

åœ¨èŠå¤©ä¸­å‘é€ï¼š

```
/status
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š
- å½“å‰ä¼šè¯çš„ token ä½¿ç”¨æƒ…å†µ
- å‹ç¼©æ¬¡æ•°
- æ¨¡å‹ä¿¡æ¯

## æ£€æŸ¥ç‚¹ âœ…

å®Œæˆé…ç½®åï¼ŒéªŒè¯ä»¥ä¸‹å‡ ç‚¹ï¼š

- [ ] `clawdbot agents list --bindings` æ˜¾ç¤ºæ­£ç¡®çš„ç»‘å®šè§„åˆ™
- [ ] ä¸ªäºº DM è·¯ç”±åˆ° `home` Agent
- [ ] å·¥ä½œç¾¤ç»„è·¯ç”±åˆ° `work` Agent
- [ ] å­ Agent è°ƒç”¨æ­£å¸¸å·¥ä½œ
- [ ] `/status` æ˜¾ç¤ºæ­£ç¡®çš„ä¼šè¯ä¿¡æ¯

## è¸©å‘æé†’

### å¸¸è§é”™è¯¯

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ³• |
|------|------|---------|
| **Agent é—´è°ƒç”¨è¢«ç¦æ­¢** | `tools.agentToAgent.enabled` æœªå¯ç”¨æˆ– `allow` åˆ—è¡¨ä¸åŒ…å«ç›®æ ‡ Agent | æ£€æŸ¥é…ç½®ï¼Œç¡®ä¿å·²å¯ç”¨å¹¶æ·»åŠ å…è®¸åˆ—è¡¨ |
| **å­ Agent åˆ›å»ºå¤±è´¥** | è·¨ Agent è°ƒç”¨æ—¶ï¼Œç›®æ ‡ Agent ä¸åœ¨å…è®¸åˆ—è¡¨ä¸­ | æ£€æŸ¥ `tools.agentToAgent.allow` é…ç½® |
| **ä¼šè¯é”®å†²çª** | ç»‘å®šè§„åˆ™é¡ºåºé”™è¯¯ï¼Œæ›´å…·ä½“çš„è§„åˆ™è¢«è¦†ç›– | å°† peer è§„åˆ™æ”¾åœ¨æ¸ é“è§„åˆ™ä¹‹å‰ |
| **å‹ç¼©å¤±è´¥** | ä¸Šä¸‹æ–‡è¿‡å°æˆ–æ¨¡å‹ä¸æ”¯æŒå‹ç¼© | æ£€æŸ¥æ¨¡å‹ä¸Šä¸‹æ–‡çª—å£å’Œå‹ç¼©é…ç½® |

### é…ç½®å»ºè®®

- **ä»ç®€å•å¼€å§‹**ï¼šå…ˆç”¨å• Agent æµ‹è¯•ï¼Œç¡®è®¤åŠŸèƒ½æ­£å¸¸åå†æ·»åŠ å¤š Agent
- **ä½¿ç”¨æ ‡ç­¾**ï¼šç»™å­ Agent ä»»åŠ¡æ·»åŠ æ¸…æ™°çš„ `label`ï¼Œæ–¹ä¾¿è¿½è¸ª
- **ç›‘æ§ token ä½¿ç”¨**ï¼šå®šæœŸæ£€æŸ¥ `/status`ï¼Œäº†è§£ä¸Šä¸‹æ–‡ä½¿ç”¨æƒ…å†µ
- **å¤‡ä»½é…ç½®**ï¼šä¿®æ”¹ `clawdbot.json` å‰å…ˆå¤‡ä»½

## æœ¬è¯¾å°ç»“

æœ¬è¯¾ä»‹ç»äº† Clawdbot çš„ä¼šè¯ç®¡ç†ç³»ç»Ÿï¼š

- **ä¼šè¯æ¨¡å‹**ï¼šä¼šè¯é”®ã€å­˜å‚¨ä½ç½®ã€ç”Ÿå‘½å‘¨æœŸ
- **ä¼šè¯éš”ç¦»**ï¼šå¤š Agent æ¨¡å¼ã€DM èŒƒå›´æ§åˆ¶ã€èº«ä»½é“¾æ¥
- **å­ Agent åä½œ**ï¼š`sessions_spawn` å·¥å…·ã€æƒé™æ§åˆ¶ã€æ¸…ç†ç­–ç•¥
- **ä¸Šä¸‹æ–‡å‹ç¼©**ï¼šè‡ªåŠ¨/æ‰‹åŠ¨å‹ç¼©ã€å‹ç¼© vs å‰ªæ

é€šè¿‡åˆç†é…ç½®ä¼šè¯ç®¡ç†ï¼Œä½ å¯ä»¥è®© Clawdbot åŒæ—¶æœåŠ¡å¤šä¸ªç”¨æˆ·å’Œåœºæ™¯ï¼Œæ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„éš”ç¦»ä¸Šä¸‹æ–‡å’Œå†å²ã€‚

## ä¸‹ä¸€è¯¾é¢„å‘Š

> ä¸‹ä¸€è¯¾æˆ‘ä»¬å­¦ä¹  **[æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·](../tools-browser/)**ã€‚
>
> ä½ ä¼šå­¦åˆ°ï¼š
> - å¦‚ä½•é…ç½®å’Œä½¿ç”¨æµè§ˆå™¨å·¥å…·
> - æµè§ˆå™¨è‡ªåŠ¨åŒ–çš„å®‰å…¨é™åˆ¶
> - æˆªå›¾å’Œè¡¨å•æ“ä½œ

---

## é™„å½•ï¼šæºç å‚è€ƒ

<details>
<summary><strong>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æºç ä½ç½®</strong></summary>

> æ›´æ–°æ—¶é—´ï¼š2026-01-27

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œå· |
|------|---------|------|
| ä¼šè¯é”®è§£æ | [`src/routing/session-key.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/routing/session-key.ts) | 1-100 |
| ä¼šè¯é…ç½® Schema | [`src/config/zod-schema.session.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/config/zod-schema.session.ts) | 11-83 |
| å­ Agent ç”Ÿæˆå·¥å…· | [`src/agents/tools/sessions-spawn-tool.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/agents/tools/sessions-spawn-tool.ts) | 28-269 |
| ä¼šè¯å·¥å…·è¾…åŠ©å‡½æ•° | [`src/agents/tools/sessions-helpers.ts`](https://github.com/clawdbot/clawdbot/blob/main/src/agents/tools/sessions-helpers.ts) | 1-328 |
| ä¼šè¯ç®¡ç†æ–‡æ¡£ | [`docs/concepts/session.md`](https://github.com/clawdbot/clawdbot/blob/main/docs/concepts/session.md) | 1-151 |
| å¤š Agent è·¯ç”±æ–‡æ¡£ | [`docs/concepts/multi-agent.md`](https://github.com/clawdbot/clawdbot/blob/main/docs/concepts/multi-agent.md) | 1-355 |
| ä¸Šä¸‹æ–‡å‹ç¼©æ–‡æ¡£ | [`docs/concepts/compaction.md`](https://github.com/clawdbot/clawdbot/blob/main/docs/concepts/compaction.md) | 1-50 |

**å…³é”®å¸¸é‡**ï¼š
- `SESSION_ID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i`ï¼šä¼šè¯ ID æ­£åˆ™è¡¨è¾¾å¼ï¼ˆ`sessions-helpers.ts:96`ï¼‰

**å…³é”®ç±»å‹**ï¼š
- `SessionKind = "main" | "group" | "cron" | "hook" | "node" | "other"`ï¼šä¼šè¯ç±»å‹æšä¸¾ï¼ˆ`sessions-helpers.ts:11`ï¼‰
- `SessionListRow`ï¼šä¼šè¯åˆ—è¡¨è¡Œç»“æ„ï¼ˆ`sessions-helpers.ts:19-41`ï¼‰

**å…³é”®å‡½æ•°**ï¼š
- `createSessionsSpawnTool()`ï¼šåˆ›å»ºå­ Agent ç”Ÿæˆå·¥å…·ï¼ˆ`sessions-spawn-tool.ts:60-269`ï¼‰
- `resolveSessionReference()`ï¼šè§£æä¼šè¯å¼•ç”¨ï¼ˆ`sessions-helpers.ts:215-253`ï¼‰
- `classifySessionKind()`ï¼šåˆ†ç±»ä¼šè¯ç±»å‹ï¼ˆ`sessions-helpers.ts:255-271`ï¼‰
- `createAgentToAgentPolicy()`ï¼šåˆ›å»º Agent é—´é€šä¿¡ç­–ç•¥ï¼ˆ`sessions-helpers.ts:72-94`ï¼‰

</details>
