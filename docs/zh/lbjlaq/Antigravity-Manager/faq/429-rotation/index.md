---
title: "429æ’æŸ¥: è´¦å·è½®æ¢ä¸é”™è¯¯å¤„ç† | Antigravity-Manager"
sidebarTitle: "429é”™è¯¯ï¼šè‡ªåŠ¨è½®æ¢è´¦å·"
subtitle: "429æ’æŸ¥: è´¦å·è½®æ¢ä¸é”™è¯¯å¤„ç†"
description: "å­¦ä¹  Antigravity Tools çš„ 429 é”™è¯¯æ’æŸ¥æ–¹æ³•ã€‚æŒæ¡ QUOTA_EXHAUSTEDã€RATE_LIMIT_EXCEEDED ç­‰é”™è¯¯çš„è¯†åˆ«ä¸å¤„ç†ï¼Œä½¿ç”¨ Monitor å’Œ X-Account-Email å¿«é€Ÿå®šä½é—®é¢˜ã€‚"
tags:
  - "FAQ"
  - "é”™è¯¯æ’æŸ¥"
  - "è´¦å·è°ƒåº¦"
  - "429é”™è¯¯"
prerequisite:
  - "start-getting-started"
  - "advanced-scheduling"
order: 3
---
# 429/å®¹é‡é”™è¯¯ï¼šè´¦å·è½®æ¢çš„æ­£ç¡®é¢„æœŸä¸æ¨¡å‹å®¹é‡è€—å°½çš„è¯¯åŒº

## å­¦å®Œä½ èƒ½åšä»€ä¹ˆ

- æ­£ç¡®åŒºåˆ†ã€Œé…é¢ä¸è¶³ã€å’Œã€Œä¸Šæ¸¸é™æµã€ï¼Œé¿å…è¯¯åˆ¤
- ç†è§£ Antigravity Tools çš„è‡ªåŠ¨è½®æ¢æœºåˆ¶å’Œé¢„æœŸè¡Œä¸º
- é‡åˆ° 429 é”™è¯¯æ—¶ï¼ŒçŸ¥é“å¦‚ä½•å¿«é€Ÿå®šä½é—®é¢˜å¹¶ä¼˜åŒ–é…ç½®

## ä½ ç°åœ¨çš„å›°å¢ƒ

- çœ‹åˆ°è¿”å› 429 é”™è¯¯ï¼Œè¯¯ä»¥ä¸ºæ˜¯"æ¨¡å‹æ²¡å®¹é‡äº†"
- é…äº†å¤šä¸ªè´¦å·ï¼Œå´è¿˜æ˜¯é¢‘ç¹é‡åˆ° 429ï¼Œä¸çŸ¥é“æ˜¯é…ç½®é—®é¢˜è¿˜æ˜¯è´¦å·é—®é¢˜
- ä¸æ¸…æ¥šç³»ç»Ÿä»€ä¹ˆæ—¶å€™ä¼šè‡ªåŠ¨åˆ‡æ¢è´¦å·ï¼Œä»€ä¹ˆæ—¶å€™ä¼š"å¡ä½"

## æ ¸å¿ƒæ€è·¯

### ä»€ä¹ˆæ˜¯ 429 é”™è¯¯ï¼Ÿ

**429 Too Many Requests** æ˜¯ HTTP çŠ¶æ€ç ã€‚åœ¨ Antigravity Tools é‡Œï¼Œ429 ä¸åªä»£è¡¨â€œè¯·æ±‚å¤ªé¢‘ç¹â€ï¼Œè¿˜å¯èƒ½æ˜¯é…é¢è€—å°½ã€æ¨¡å‹ä¸´æ—¶è¿‡è½½ç­‰ä¸€ç±»â€œä½ æš‚æ—¶ç”¨ä¸äº†â€çš„ä¿¡å·ã€‚

::: info ä»£ç†ä¼šå°è¯•è¯†åˆ« 429 çš„åŸå› 

ä»£ç†ä¼šä»å“åº”ä½“é‡Œå°è¯•è§£æ `error.details[0].reason` æˆ– `error.message`ï¼ŒæŠŠ 429 ç²—åˆ†ä¸ºå‡ ç±»ï¼ˆå®é™…ä»¥è¿”å›ä¸ºå‡†ï¼‰ï¼š

| ä»£ç†è¯†åˆ«çš„ç±»å‹ | å¸¸è§ reason / çº¿ç´¢ | å…¸å‹ç‰¹å¾ |
|--- | --- | ---|
| **é…é¢è€—å°½** | `QUOTA_EXHAUSTED` / æ–‡æœ¬åŒ…å« `exhausted`ã€`quota` | å¯èƒ½éœ€è¦ç­‰åˆ°é…é¢åˆ·æ–° |
| **é€Ÿç‡é™åˆ¶** | `RATE_LIMIT_EXCEEDED` / æ–‡æœ¬åŒ…å« `per minute`ã€`rate limit`ã€`too many requests` | é€šå¸¸æ˜¯å‡ åç§’çº§åˆ«çš„å†·å´ |
| **æ¨¡å‹å®¹é‡ä¸è¶³** | `MODEL_CAPACITY_EXHAUSTED` / æ–‡æœ¬åŒ…å« `model_capacity` | å¸¸è§æ˜¯çŸ­æš‚è¿‡è½½ï¼Œç¨åå¯æ¢å¤ |
| **æœªçŸ¥** | æ— æ³•è§£æ | èµ°é»˜è®¤å†·å´ç­–ç•¥ |

:::

### Antigravity Tools çš„è‡ªåŠ¨å¤„ç†

å½“ä¸€æ¬¡è¯·æ±‚é‡åˆ° 429ï¼ˆä»¥åŠéƒ¨åˆ† 5xx/è¿‡è½½çŠ¶æ€ï¼‰æ—¶ï¼Œä»£ç†é€šå¸¸ä¼šåœ¨æœåŠ¡ç«¯ä¾§åšä¸¤ä»¶äº‹ï¼š

1. **è®°å½•å†·å´æ—¶é—´**ï¼šæŠŠè¿™æ¬¡é”™è¯¯å†™å…¥ `RateLimitTracker`ï¼Œåç»­é€‰è´¦å·æ—¶ä¼šä¸»åŠ¨é¿å¼€â€œä»åœ¨å†·å´â€çš„è´¦å·ã€‚
2. **åœ¨é‡è¯•é‡Œè½®æ¢è´¦å·**ï¼šHandlers ä¼šåœ¨å•æ¬¡è¯·æ±‚å†…è¿›è¡Œå¤šæ¬¡å°è¯•ï¼Œé‡è¯•æ—¶ä¼š `force_rotate=true`ï¼Œä»è€Œè§¦å‘ TokenManager é€‰æ‹©ä¸‹ä¸€ä¸ªå¯ç”¨è´¦å·ã€‚

::: tip ä½ æ€ä¹ˆçŸ¥é“å®ƒæœ‰æ²¡æœ‰æ¢å·ï¼Ÿ
å³ä½¿ä½ çš„è¯·æ±‚ body ä¸å˜ï¼Œå“åº”é‡Œé€šå¸¸ä¼šå¸¦ `X-Account-Email`ï¼ˆä»¥åŠ `X-Mapped-Model`ï¼‰ï¼Œä½ å¯ä»¥ç”¨å®ƒéªŒè¯â€œè¿™æ¬¡è¯·æ±‚åˆ°åº•ç”¨çš„æ˜¯å“ªä¸ªè´¦å·â€ã€‚
:::

## ä»€ä¹ˆæ—¶å€™ä¼šé‡åˆ° 429 é”™è¯¯ï¼Ÿ

### åœºæ™¯ 1ï¼šå•ä¸ªè´¦å·è¯·æ±‚è¿‡å¿«

**ç°è±¡**ï¼šå³ä½¿åªæœ‰ä¸€ä¸ªè´¦å·ï¼ŒçŸ­æ—¶é—´å†…å‘é€å¤§é‡è¯·æ±‚ä¹Ÿä¼šè§¦å‘ 429ã€‚

**åŸå› **ï¼šæ¯ä¸ªè´¦å·éƒ½æœ‰è‡ªå·±çš„é€Ÿç‡é™åˆ¶ï¼ˆRPM/TPMï¼‰ï¼Œè¶…è¿‡å°±ä¼šé™æµã€‚

**è§£å†³**ï¼š
- å¢åŠ è´¦å·æ•°é‡
- é™ä½è¯·æ±‚é¢‘ç‡
- ä½¿ç”¨å›ºå®šè´¦å·æ¨¡å¼åˆ†æ•£å‹åŠ›ï¼ˆè¯¦è§ã€Œå›ºå®šè´¦å·æ¨¡å¼ã€ï¼‰

### åœºæ™¯ 2ï¼šæ‰€æœ‰è´¦å·åŒæ—¶é™æµ

**ç°è±¡**ï¼šæœ‰å¤šä¸ªè´¦å·ï¼Œä½†æ‰€æœ‰è´¦å·éƒ½è¿”å› 429ã€‚

**åŸå› **ï¼š
- è´¦å·æ€»æ•°ä¸è¶³ä»¥æ”¯æ’‘ä½ çš„è¯·æ±‚é¢‘ç‡
- æ‰€æœ‰è´¦å·å‡ ä¹åŒæ—¶è§¦å‘é™æµ/è¿‡è½½

**è§£å†³**ï¼š
- å¢åŠ æ›´å¤šè´¦å·
- è°ƒæ•´è°ƒåº¦æ¨¡å¼ä¸ºã€Œæ€§èƒ½ä¼˜å…ˆã€ï¼ˆè·³è¿‡ç²˜æ€§ä¼šè¯ä¸ 60s çª—å£å¤ç”¨ï¼‰
- æ£€æŸ¥é…é¢ä¿æŠ¤æ˜¯å¦è¯¯å°†å¯ç”¨è´¦å·æ’é™¤

### åœºæ™¯ 3ï¼šè´¦å·è¢«é…é¢ä¿æŠ¤è¯¯åˆ¤

**ç°è±¡**ï¼šæŸä¸ªè´¦å·çš„é…é¢å¾ˆå……è¶³ï¼Œä½†ç³»ç»Ÿä¸€ç›´è·³è¿‡å®ƒã€‚

**åŸå› **ï¼š
- å¼€å¯äº†**é…é¢ä¿æŠ¤**ï¼Œé˜ˆå€¼è®¾ç½®åé«˜
- è¯¥è´¦å·çš„ç‰¹å®šæ¨¡å‹é…é¢ä½äºé˜ˆå€¼
- è´¦å·è¢«æ‰‹åŠ¨æ ‡è®°ä¸º `proxy_disabled`

**è§£å†³**ï¼š
- æ£€æŸ¥é…é¢ä¿æŠ¤è®¾ç½®ï¼ˆSettings â†’ Quota Protectionï¼‰ï¼ŒæŒ‰ä½ çš„ä½¿ç”¨å¼ºåº¦è°ƒæ•´é˜ˆå€¼ä¸ç›‘æ§æ¨¡å‹
- åœ¨è´¦å·æ•°æ®ä¸­æ£€æŸ¥ `protected_models`ï¼Œç¡®è®¤æ˜¯ä¸æ˜¯è¢«ä¿æŠ¤ç­–ç•¥è·³è¿‡

## è·Ÿæˆ‘åš

### ç¬¬ 1 æ­¥ï¼šè¯†åˆ« 429 é”™è¯¯ç±»å‹

**ä¸ºä»€ä¹ˆ**ï¼šä¸åŒç±»å‹çš„ 429 é”™è¯¯éœ€è¦ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚

åœ¨ Proxy Monitor ä¸­æŸ¥çœ‹ 429 é”™è¯¯çš„å“åº”ä½“ï¼Œé‡ç‚¹çœ‹ä¸¤ç±»ä¿¡æ¯ï¼š

- **åŸå› **ï¼š`error.details[0].reason`ï¼ˆä¾‹å¦‚ `RATE_LIMIT_EXCEEDED`ã€`QUOTA_EXHAUSTED`ï¼‰æˆ– `error.message`
- **ç­‰å¾…æ—¶é—´**ï¼š`RetryInfo.retryDelay` æˆ– `details[0].metadata.quotaResetDelay`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

```json
{
  "error": {
    "details": [
      {
        "reason": "RATE_LIMIT_EXCEEDED",
        "metadata": {
          "quotaResetDelay": "42s"
        }
      }
    ]
  }
}
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š
- å¦‚æœå“åº”ä½“é‡Œèƒ½æ‰¾åˆ°ç­‰å¾…æ—¶é—´ï¼ˆä¾‹å¦‚ `RetryInfo.retryDelay` æˆ– `quotaResetDelay`ï¼‰ï¼Œä»£ç†é€šå¸¸ä¼šå…ˆç­‰å¾…ä¸€å°æ®µæ—¶é—´å†é‡è¯•ã€‚
- å¦‚æœæ²¡æœ‰ç­‰å¾…æ—¶é—´ï¼Œä»£ç†ä¼šæŒ‰å†…ç½®ç­–ç•¥ç»™è¿™ä¸ªè´¦å·åŠ ä¸€ä¸ªâ€œå†·å´æœŸâ€ï¼Œå¹¶åœ¨é‡è¯•é‡Œç›´æ¥æ¢ä¸‹ä¸€ä¸ªè´¦å·ã€‚

### ç¬¬ 2 æ­¥ï¼šæ£€æŸ¥è´¦å·è°ƒåº¦é…ç½®

**ä¸ºä»€ä¹ˆ**ï¼šè°ƒåº¦é…ç½®ç›´æ¥å½±å“è´¦å·è½®æ¢é¢‘ç‡å’Œä¼˜å…ˆçº§ã€‚

è¿›å…¥ **API Proxy** é¡µé¢ï¼ŒæŸ¥çœ‹è°ƒåº¦ç­–ç•¥ï¼š

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼/å»ºè®® |
|--- | --- | ---|
| **Scheduling Mode** | è°ƒåº¦æ¨¡å¼ | `Balance`ï¼ˆé»˜è®¤ï¼‰ |
| **Preferred Account** | å›ºå®šè´¦å·æ¨¡å¼ | æœªé€‰ä¸­ï¼ˆé»˜è®¤ï¼‰ |

**è°ƒåº¦æ¨¡å¼å¯¹æ¯”**ï¼š

| æ¨¡å¼ | è´¦å·å¤ç”¨ç­–ç•¥ | é™æµå¤„ç† | é€‚ç”¨åœºæ™¯ |
|--- | --- | --- | ---|
| **CacheFirst** | å¯ç”¨ç²˜æ€§ä¼šè¯ä¸ 60s çª—å£å¤ç”¨ | **ä¼˜å…ˆç­‰å¾…**ï¼Œæå¤§æå‡ Prompt Caching å‘½ä¸­ç‡ | å¯¹è¯ç±»/éœ€è¦é«˜ç¼“å­˜å‘½ä¸­ç‡ |
| **Balance** | å¯ç”¨ç²˜æ€§ä¼šè¯ä¸ 60s çª—å£å¤ç”¨ | **ç«‹å³åˆ‡æ¢**åˆ°å¤‡é€‰è´¦å·ï¼Œå…¼é¡¾æˆåŠŸç‡å’Œæ€§èƒ½ | é€šç”¨åœºæ™¯ï¼Œé»˜è®¤ |
| **PerformanceFirst** | è·³è¿‡ç²˜æ€§ä¼šè¯ä¸ 60s çª—å£å¤ç”¨ï¼Œçº¯è½®è¯¢æ¨¡å¼ | ç«‹å³åˆ‡æ¢ï¼Œè´¦å·è´Ÿè½½æœ€å‡è¡¡ | é«˜å¹¶å‘ã€æ— çŠ¶æ€è¯·æ±‚ |

::: tip ç¼“å­˜ä¼˜å…ˆ vs å¹³è¡¡æ¨¡å¼
å¦‚æœä½ ä½¿ç”¨ Prompt Caching ä¸”å¸Œæœ›æå‡ç¼“å­˜å‘½ä¸­ç‡ï¼Œé€‰æ‹© `CacheFirst` â€”â€” é™æµæ—¶å®ƒä¼šä¼˜å…ˆç­‰å¾…è€Œä¸æ˜¯ç«‹å³æ¢å·ã€‚å¦‚æœä½ æ›´çœ‹é‡è¯·æ±‚æˆåŠŸç‡è€Œä¸æ˜¯ç¼“å­˜ï¼Œé€‰æ‹© `Balance` â€”â€” é™æµæ—¶å®ƒä¼šç«‹å³æ¢å·ã€‚
:::

::: tip æ€§èƒ½ä¼˜å…ˆæ¨¡å¼
å¦‚æœä½ çš„è¯·æ±‚æ˜¯æ— çŠ¶æ€çš„ï¼ˆå¦‚å›¾ç‰‡ç”Ÿæˆã€ç‹¬ç«‹æŸ¥è¯¢ï¼‰ï¼Œå¯ä»¥è¯•è¯• `PerformanceFirst`ã€‚å®ƒä¼šè·³è¿‡ç²˜æ€§ä¼šè¯ä¸ 60s çª—å£å¤ç”¨ï¼Œè®©è¿ç»­è¯·æ±‚æ›´å®¹æ˜“è½åˆ°ä¸åŒè´¦å·ã€‚
:::

### ç¬¬ 3 æ­¥ï¼šéªŒè¯è´¦å·è½®æ¢æ˜¯å¦æ­£å¸¸å·¥ä½œ

**ä¸ºä»€ä¹ˆ**ï¼šç¡®è®¤ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨åˆ‡æ¢è´¦å·ã€‚

**æ–¹æ³• 1ï¼šçœ‹å“åº” Header**

ç”¨ curl æˆ–ä½ è‡ªå·±çš„å®¢æˆ·ç«¯æŠŠå“åº”å¤´æ‰“å°å‡ºæ¥ï¼Œè§‚å¯Ÿ `X-Account-Email` æ˜¯å¦ä¼šå˜åŒ–ã€‚

**æ–¹æ³• 2ï¼šæŸ¥çœ‹æ—¥å¿—**

æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼ˆæ ¹æ®ä½ çš„ç³»ç»Ÿä½ç½®ï¼‰ï¼Œæœç´¢ `ğŸ”„ [Token Rotation]`ï¼š

```
ğŸ”„ [Token Rotation] Accounts: [
  "account1@example.com(protected=[])",
  "account2@example.com(protected=[])",
  "account3@example.com(protected=[])"
]
```

**æ–¹æ³• 3ï¼šä½¿ç”¨ Proxy Monitor**

åœ¨ **Monitor** é¡µé¢æŸ¥çœ‹è¯·æ±‚æ—¥å¿—ï¼Œå…³æ³¨ï¼š
- **Account** å­—æ®µæ˜¯å¦åœ¨ä¸åŒè´¦å·é—´åˆ‡æ¢
- **Status** ä¸º 429 çš„è¯·æ±‚åï¼Œæ˜¯å¦æœ‰æˆåŠŸçš„è¯·æ±‚ä½¿ç”¨äº†ä¸åŒè´¦å·

**ä½ åº”è¯¥çœ‹åˆ°**ï¼š
- å½“æŸä¸ªè´¦å·è¿”å› 429 åï¼Œåç»­è¯·æ±‚è‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–è´¦å·
- å¦‚æœçœ‹åˆ°å¤šä¸ªè¯·æ±‚ä½¿ç”¨åŒä¸€è´¦å·ä¸”éƒ½å¤±è´¥ï¼Œå¯èƒ½æ˜¯è°ƒåº¦é…ç½®é—®é¢˜

### ç¬¬ 4 æ­¥ï¼šä¼˜åŒ–è´¦å·ä¼˜å…ˆçº§

**ä¸ºä»€ä¹ˆ**ï¼šè®©ç³»ç»Ÿä¼˜å…ˆä½¿ç”¨é«˜é…é¢/é«˜ç­‰çº§è´¦å·ï¼Œå‡å°‘ 429 æ¦‚ç‡ã€‚

åœ¨ TokenManager é‡Œï¼Œç³»ç»Ÿä¼šåœ¨é€‰æ‹©è´¦å·å‰å¯¹è´¦å·æ± åšä¸€æ¬¡æ’åºï¼ˆä¼šæ‰“å° `ğŸ”„ [Token Rotation] Accounts: ...`ï¼‰ï¼š

1. **è®¢é˜…ç­‰çº§ä¼˜å…ˆ**ï¼šULTRA > PRO > FREE
2. **é…é¢ç™¾åˆ†æ¯”ä¼˜å…ˆ**ï¼šåŒç­‰çº§å†…ï¼Œé…é¢é«˜çš„åœ¨å‰
3. **æ’åºå…¥å£**ï¼šè¿™ä¸ªæ’åºå‘ç”Ÿåœ¨ä»£ç†ä¾§ï¼Œæœ€ç»ˆç”¨å“ªä¸ªè´¦å·ä»¥ä»£ç†ä¾§æ’åº+å¯ç”¨æ€§åˆ¤æ–­ä¸ºå‡†ã€‚

::: info æ™ºèƒ½æ’åºåŸç†ï¼ˆä»£ç†ä¾§ï¼‰
ä¼˜å…ˆçº§æ˜¯ `ULTRA > PRO > FREE`ï¼›åŒä¸€è®¢é˜…ç­‰çº§å†…æŒ‰ `remaining_quota`ï¼ˆè´¦å·æœ€å¤§å‰©ä½™é…é¢ç™¾åˆ†æ¯”ï¼‰é™åºã€‚
:::

**æ“ä½œ**ï¼š
- æ‹–æ‹½è´¦å·è°ƒæ•´æ˜¾ç¤ºé¡ºåºï¼ˆå¯é€‰ï¼‰
- åˆ·æ–°é…é¢ï¼ˆAccounts â†’ åˆ·æ–°æ‰€æœ‰é…é¢ï¼‰
- æ£€æŸ¥è´¦å·çš„è®¢é˜…ç­‰çº§å’Œé…é¢

## è¸©å‘æé†’

### âŒ é”™è¯¯ 1ï¼šè¯¯å°† 429 å½“æˆ"æ¨¡å‹æ²¡å®¹é‡"

**ç°è±¡**ï¼šçœ‹åˆ° 429 é”™è¯¯å°±ä»¥ä¸ºæ¨¡å‹æ²¡å®¹é‡äº†ã€‚

**æ­£ç¡®ç†è§£**ï¼š
- 429 æ˜¯**é™æµ**ï¼Œä¸æ˜¯å®¹é‡é—®é¢˜
- å¢åŠ è´¦å·å¯ä»¥é™ä½ 429 æ¦‚ç‡
- è°ƒæ•´è°ƒåº¦æ¨¡å¼å¯ä»¥æå‡åˆ‡æ¢é€Ÿåº¦

### âŒ é”™è¯¯ 2ï¼šé…é¢ä¿æŠ¤é˜ˆå€¼è®¾ç½®è¿‡é«˜

**ç°è±¡**ï¼šé…é¢å……è¶³ä½†ç³»ç»Ÿä¸€ç›´è·³è¿‡è´¦å·ã€‚

**åŸå› **ï¼šQuota Protection ä¼šæŠŠä½äºé˜ˆå€¼çš„æ¨¡å‹åŠ å…¥è´¦å·çš„ `protected_models`ï¼Œä»£ç†åœ¨è°ƒåº¦æ—¶ä¼šè·³è¿‡â€œè¢«ä¿æŠ¤çš„æ¨¡å‹â€ã€‚é˜ˆå€¼è¿‡é«˜æ—¶ï¼Œå¯èƒ½å¯¼è‡´å¯ç”¨è´¦å·è¢«è¿‡åº¦æ’é™¤ã€‚

**ä¿®æ­£**ï¼š
- å›åˆ° **Settings â†’ Quota Protection**ï¼Œè°ƒæ•´ç›‘æ§æ¨¡å‹ä¸é˜ˆå€¼
- å¦‚æœä½ æƒ³ææ¸…æ¥šå®ƒåˆ°åº•ä¿æŠ¤äº†å“ªäº›æ¨¡å‹ï¼Œå»è´¦å·æ•°æ®é‡Œçœ‹ `protected_models`

### âŒ é”™è¯¯ 3ï¼šå›ºå®šè´¦å·æ¨¡å¼å¯¼è‡´æ— æ³•è½®æ¢

**ç°è±¡**ï¼šè®¾ç½®äº† `Preferred Account`ï¼Œä½†è¯¥è´¦å·é™æµåç³»ç»Ÿ"å¡ä½"ã€‚

**åŸå› **ï¼šå›ºå®šè´¦å·æ¨¡å¼ä¸‹ï¼Œç³»ç»Ÿä¼˜å…ˆä½¿ç”¨æŒ‡å®šè´¦å·ï¼Œåªæœ‰åœ¨è´¦å·ä¸å¯ç”¨æ—¶æ‰é™çº§åˆ°è½®è¯¢ã€‚

**ä¿®æ­£**ï¼š
- å¦‚æœä¸éœ€è¦å›ºå®šè´¦å·ï¼Œæ¸…ç©º `Preferred Account`
- æˆ–ç¡®ä¿å›ºå®šè´¦å·çš„é…é¢å……è¶³ï¼Œé¿å…é™æµ

## æ£€æŸ¥ç‚¹ âœ…

- [ ] èƒ½åŒºåˆ†é…é¢ä¸è¶³å’Œä¸Šæ¸¸é™æµ
- [ ] çŸ¥é“å¦‚ä½•åœ¨ Proxy Monitor ä¸­æŸ¥çœ‹ 429 é”™è¯¯è¯¦æƒ…
- [ ] ç†è§£ä¸‰ç§è°ƒåº¦æ¨¡å¼çš„åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯
- [ ] çŸ¥é“å¦‚ä½•æ£€æŸ¥è´¦å·è½®æ¢æ˜¯å¦æ­£å¸¸å·¥ä½œ
- [ ] èƒ½ä¼˜åŒ–è´¦å·ä¼˜å…ˆçº§å¹¶æ£€æŸ¥é…é¢ä¿æŠ¤ç­–ç•¥

## å¸¸è§é—®é¢˜

### Q1ï¼šä¸ºä»€ä¹ˆæˆ‘æœ‰å¤šä¸ªè´¦å·ï¼Œè¿˜æ˜¯ä¼šé‡åˆ° 429ï¼Ÿ

Aï¼šå¯èƒ½çš„åŸå› ï¼š
1. æ‰€æœ‰è´¦å·åŒæ—¶è§¦å‘é™æµï¼ˆè¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼‰
2. è¿ç»­è¯·æ±‚åœ¨â€œ60s çª—å£å¤ç”¨â€ä¸‹åå¤å¤ç”¨åŒä¸€è´¦å·ï¼Œæ›´å®¹æ˜“æŠŠå•è´¦å·æ‰“åˆ°é™æµ
3. é…é¢ä¿æŠ¤è¯¯å°†å¯ç”¨è´¦å·æ’é™¤
4. è´¦å·æ€»æ•°ä¸è¶³ä»¥æ”¯æ’‘ä½ çš„è¯·æ±‚é¢‘ç‡

**è§£å†³**ï¼š
- å¢åŠ æ›´å¤šè´¦å·
- ä½¿ç”¨ `PerformanceFirst` æ¨¡å¼
- æ£€æŸ¥ Quota Protection æ˜¯å¦æŠŠä½ è¦ç”¨çš„æ¨¡å‹åŠ å…¥äº† `protected_models`ï¼ˆå¿…è¦æ—¶è°ƒæ•´ç›‘æ§æ¨¡å‹ä¸é˜ˆå€¼ï¼‰
- é™ä½è¯·æ±‚é¢‘ç‡

### Q2ï¼š429 é”™è¯¯ä¼šè‡ªåŠ¨é‡è¯•å—ï¼Ÿ

Aï¼šä¼šåœ¨å•æ¬¡è¯·æ±‚å†…è‡ªåŠ¨é‡è¯•ã€‚**é‡è¯•æ¬¡æ•°ä¸Šé™é€šå¸¸æ˜¯ 3 æ¬¡**ï¼Œå…·ä½“è®¡ç®—æ–¹å¼ä¸º `min(3, è´¦å·æ± å¤§å°)`ï¼Œä¸”è‡³å°‘å°è¯• 1 æ¬¡ã€‚

**é‡è¯•æ¬¡æ•°ç¤ºä¾‹**ï¼š
- è´¦å·æ±  1 ä¸ªè´¦å· â†’ å°è¯• 1 æ¬¡ï¼ˆä¸é‡è¯•ï¼‰
- è´¦å·æ±  2 ä¸ªè´¦å· â†’ å°è¯• 2 æ¬¡ï¼ˆé‡è¯• 1 æ¬¡ï¼‰
- è´¦å·æ±  3 ä¸ªæˆ–æ›´å¤šè´¦å· â†’ å°è¯• 3 æ¬¡ï¼ˆé‡è¯• 2 æ¬¡ï¼‰

**å¤§è‡´æµç¨‹**ï¼š
1. è®°å½•é™æµ/è¿‡è½½ä¿¡æ¯ï¼ˆè¿›å…¥ `RateLimitTracker`ï¼‰
2. å¦‚æœèƒ½è§£æåˆ°ç­‰å¾…æ—¶é—´ï¼ˆä¾‹å¦‚ `RetryInfo.retryDelay` / `quotaResetDelay`ï¼‰ï¼Œä¼šå…ˆç­‰å¾…ä¸€å°æ®µæ—¶é—´å†ç»§ç»­
3. é‡è¯•æ—¶å¼ºåˆ¶è½®æ¢è´¦å·ï¼ˆ`attempt > 0` æ—¶ `force_rotate=true`ï¼‰ï¼Œå°è¯•ç”¨ä¸‹ä¸€ä¸ªå¯ç”¨è´¦å·å‘èµ·ä¸Šæ¸¸è¯·æ±‚

å¦‚æœæ‰€æœ‰å°è¯•éƒ½å¤±è´¥ï¼Œä»£ç†ä¼šæŠŠé”™è¯¯è¿”å›ç»™å®¢æˆ·ç«¯ï¼›åŒæ—¶ä½ ä»ç„¶å¯ä»¥ä»å“åº”å¤´ï¼ˆå¦‚ `X-Account-Email`ï¼‰æˆ– Proxy Monitor çœ‹åˆ°å®é™…ä½¿ç”¨è¿‡çš„è´¦å·ã€‚

### Q3ï¼šå¦‚ä½•æŸ¥çœ‹æŸä¸ªè´¦å·è¢«é™æµäº†å¤šä¹…ï¼Ÿ

Aï¼šæœ‰ä¸¤ç§æ–¹å¼ï¼š

**æ–¹å¼ 1**ï¼šæŸ¥çœ‹æ—¥å¿—ï¼Œæœç´¢ `rate-limited`

```
ğŸ”’ [FIX #820] Preferred account xxx@gmail.com is rate-limited, falling back to round-robin
```

**æ–¹å¼ 2**ï¼šæ—¥å¿—ä¸­ä¼šæ˜¾ç¤ºå‰©ä½™ç­‰å¾…æ—¶é—´

```
All accounts are currently limited. Please wait 30s.
```

### Q4ï¼šé…é¢ä¿æŠ¤å’Œé™æµæ˜¯ä¸€å›äº‹å—ï¼Ÿ

Aï¼šä¸æ˜¯ã€‚

| ç‰¹æ€§ | é…é¢ä¿æŠ¤ | é™æµè·Ÿè¸ª |
|--- | --- | ---|
| **è§¦å‘æ¡ä»¶** | æ¨¡å‹é…é¢ä½äºé˜ˆå€¼ | æ”¶åˆ° 429 é”™è¯¯ |
| **ä½œç”¨èŒƒå›´** | ç‰¹å®šæ¨¡å‹ | æ•´ä¸ªè´¦å· |
| **æŒç»­æ—¶é—´** | ç›´åˆ°é…é¢æ¢å¤ | ç”±ä¸Šæ¸¸å†³å®šï¼ˆé€šå¸¸å‡ ç§’åˆ°å‡ åˆ†é’Ÿï¼‰ |
| **è¡Œä¸º** | è·³è¿‡è¯¥æ¨¡å‹ | è·³è¿‡è¯¥è´¦å· |

### Q5ï¼šå¦‚ä½•å¼ºåˆ¶ç«‹å³åˆ‡æ¢è´¦å·ï¼Ÿ

Aï¼šå¯ä»¥ä»â€œè®©ä¸‹ä¸€æ¬¡è¯·æ±‚æ›´å®¹æ˜“æ¢å·â€çš„è§’åº¦å…¥æ‰‹ï¼š

1. **è°ƒåº¦å±‚é¢**ï¼šåˆ‡åˆ° `PerformanceFirst`ï¼Œè·³è¿‡ç²˜æ€§ä¼šè¯ä¸ 60s çª—å£å¤ç”¨
2. **å›ºå®šè´¦å·**ï¼šå¦‚æœå¯ç”¨äº† `Preferred Account`ï¼Œå…ˆæ¸…ç©ºå®ƒï¼Œå¦åˆ™ä¼šä¼˜å…ˆç”¨å›ºå®šè´¦å·ï¼ˆç›´åˆ°å®ƒé™æµ/è¢«ä¿æŠ¤ï¼‰
3. **è´¦å·æ± **ï¼šå¢åŠ è´¦å·æ•°é‡ï¼Œå•è´¦å·è¢«é™æµæ—¶æ›´å®¹æ˜“æ‰¾åˆ°æ›¿ä»£è´¦å·

å•æ¬¡è¯·æ±‚é‡Œï¼Œä»£ç†æœ¬èº«ä¹Ÿä¼šåœ¨é‡è¯•æ—¶å¼ºåˆ¶è½®æ¢ï¼ˆ`attempt > 0` ä¼šè§¦å‘ `force_rotate=true`ï¼‰ï¼Œä½†é‡è¯•æ¬¡æ•°å—ä¸Šé™æ§åˆ¶ã€‚

## æœ¬è¯¾å°ç»“

- 429 åœ¨ Antigravity Tools é‡Œæ˜¯ä¸€ç±»â€œä¸Šæ¸¸æš‚æ—¶ä¸å¯ç”¨â€çš„ä¿¡å·ï¼Œå¯èƒ½æ˜¯é€Ÿç‡é™åˆ¶ã€é…é¢è€—å°½ã€æ¨¡å‹å®¹é‡ä¸è¶³ç­‰åŸå› 
- ä»£ç†ä¼šè®°å½•å†·å´æ—¶é—´ï¼Œå¹¶åœ¨å•æ¬¡è¯·æ±‚çš„é‡è¯•é‡Œå°è¯•è½®æ¢è´¦å·ï¼ˆä½†é‡è¯•æ¬¡æ•°æœ‰é™ï¼‰
- è°ƒåº¦æ¨¡å¼ã€Quota Protectionã€è´¦å·æ•°é‡éƒ½ä¼šå½±å“ä½ é‡åˆ° 429 çš„æ¦‚ç‡ä¸æ¢å¤é€Ÿåº¦
- ç”¨ Proxy Monitorã€å“åº”å¤´ `X-Account-Email` å’Œæ—¥å¿—å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜

## ä¸‹ä¸€è¯¾é¢„å‘Š

> ä¸‹ä¸€è¯¾æˆ‘ä»¬å­¦ä¹  **[404/è·¯å¾„ä¸å…¼å®¹ï¼šBase URLã€/v1 å‰ç¼€ä¸"å è·¯å¾„"å®¢æˆ·ç«¯](../404-base-url/)**ã€‚
>
> ä½ ä¼šå­¦åˆ°ï¼š
> - æœ€å¸¸è§çš„æ¥å…¥é”™è¯¯ï¼ˆ404ï¼‰æ˜¯å¦‚ä½•äº§ç”Ÿçš„
> - ä¸åŒå®¢æˆ·ç«¯å¯¹ base_url çš„æ‹¼æ¥å·®å¼‚
> - å¦‚ä½•å¿«é€Ÿä¿®å¤ 404 é—®é¢˜

---

## é™„å½•ï¼šæºç å‚è€ƒ

<details>
<summary><strong>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æºç ä½ç½®</strong></summary>

> æ›´æ–°æ—¶é—´ï¼š2026-01-23

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œå· |
|--- | --- | ---|
| 429 é‡è¯•å»¶è¿Ÿè§£æï¼ˆRetryInfo / quotaResetDelayï¼‰ | [`src-tauri/src/proxy/upstream/retry.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/upstream/retry.rs#L38-L67) | 38-67 |
| Duration è§£æå·¥å…· | [`src-tauri/src/proxy/upstream/retry.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/upstream/retry.rs#L11-L35) | 11-35 |
| è°ƒåº¦æ¨¡å¼æšä¸¾ï¼ˆCacheFirst/Balance/PerformanceFirstï¼‰ | [`src-tauri/src/proxy/sticky_config.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/sticky_config.rs#L3-L12) | 3-12 |
| é™æµåŸå› è§£æä¸é»˜è®¤å†·å´ç­–ç•¥ | [`src-tauri/src/proxy/rate_limit.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/rate_limit.rs#L5-L258) | 5-258 |
| MAX_RETRY_ATTEMPTS å¸¸é‡å®šä¹‰ï¼ˆOpenAI handlerï¼‰ | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L14) | 14 |
| é‡è¯•æ¬¡æ•°è®¡ç®—ï¼ˆmax_attempts = min(MAX_RETRY_ATTEMPTS, pool_size)ï¼‰ | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L830) | 830 |
| OpenAI handlerï¼š429/5xx æ—¶æ ‡è®°é™æµå¹¶é‡è¯•/è½®æ¢ | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L349-L389) | 349-389 |
| è´¦å·æ’åºä¼˜å…ˆçº§ï¼ˆULTRA > PRO > FREE + remaining_quotaï¼‰ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L504-L538) | 504-538 |
| 60s çª—å£å¤ç”¨ + é¿å¼€é™æµ/é…é¢ä¿æŠ¤ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L624-L739) | 624-739 |
| é™æµè®°å½•å…¥å£ï¼ˆmark_rate_limitedï¼‰ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L1089-L1113) | 1089-1113 |
| 429 ç²¾ç¡®é”å®š/å®æ—¶é…é¢åˆ·æ–°/é™çº§ç­–ç•¥ï¼ˆmark_rate_limited_asyncï¼‰ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L1258-L1417) | 1258-1417 |

**å…³é”®å¸¸é‡**ï¼š
- `MAX_RETRY_ATTEMPTS = 3`ï¼šå•æ¬¡è¯·æ±‚å†…æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆOpenAI/Gemini handlerï¼‰
- `60`ï¼š60 ç§’çª—å£å¤ç”¨ï¼ˆä»…åœ¨ `PerformanceFirst` ä¹‹å¤–çš„æ¨¡å¼å¯ç”¨ï¼‰
- `5`ï¼šToken è·å–è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
- `300`ï¼šToken æå‰åˆ·æ–°é˜ˆå€¼ï¼ˆç§’ï¼Œ5 åˆ†é’Ÿï¼‰

**å…³é”®å‡½æ•°**ï¼š
- `parse_retry_delay()`ï¼šä» 429 é”™è¯¯å“åº”ä¸­æå–é‡è¯•å»¶è¿Ÿ
- `get_token_internal()`ï¼šè´¦å·é€‰æ‹©ä¸è½®æ¢çš„æ ¸å¿ƒé€»è¾‘
- `mark_rate_limited()`ï¼šæ ‡è®°è´¦å·ä¸ºé™æµçŠ¶æ€

</details>
