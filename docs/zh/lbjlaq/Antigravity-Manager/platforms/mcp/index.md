---
title: "MCP ç«¯ç‚¹: æš´éœ²å·¥å…· | Antigravity-Manager"
sidebarTitle: "è®© Claude ç”¨ä¸Š z.ai èƒ½åŠ›"
subtitle: "MCP ç«¯ç‚¹ï¼šæŠŠ Web Search/Reader/Vision ä½œä¸ºå¯è°ƒç”¨å·¥å…·æš´éœ²å‡ºå»"
description: "å­¦ä¹  Antigravity Manager çš„ MCP ç«¯ç‚¹é…ç½®ã€‚å¯ç”¨ Web Search/Reader/Visionï¼ŒéªŒè¯å·¥å…·è°ƒç”¨ï¼Œå¯¹æ¥å¤–éƒ¨å®¢æˆ·ç«¯ï¼ŒæŒæ¡å¸¸è§é”™è¯¯æ’æŸ¥æ–¹æ³•ã€‚"
tags:
  - "MCP"
  - "Web Search"
  - "Web Reader"
  - "Vision"
  - "z.ai"
  - "Antigravity Tools"
prerequisite:
  - "start-proxy-and-first-client"
  - "start-add-account"
order: 6
---
# MCP ç«¯ç‚¹ï¼šæŠŠ Web Search/Reader/Vision ä½œä¸ºå¯è°ƒç”¨å·¥å…·æš´éœ²å‡ºå»

ä½ ä¼šç”¨è¿™å¥— **MCP ç«¯ç‚¹**æŠŠ z.ai çš„æœç´¢ã€é˜…è¯»ã€è§†è§‰èƒ½åŠ›æš´éœ²ç»™å¤–éƒ¨ MCP å®¢æˆ·ç«¯ï¼Œé‡ç‚¹ææ¸…æ¥š"è¿œç¨‹åå‘ä»£ç†"å’Œ"å†…ç½®æœåŠ¡å™¨"çš„åŒºåˆ«ï¼Œä»¥åŠå¦‚ä½•å¯ç”¨å¹¶è°ƒç”¨è¿™äº›ç«¯ç‚¹ã€‚

## å­¦å®Œä½ èƒ½åšä»€ä¹ˆ

- ç†è§£ä¸‰ç§ MCP ç«¯ç‚¹çš„å·¥ä½œåŸç†ï¼ˆè¿œç¨‹åå‘ä»£ç† vs å†…ç½®æœåŠ¡å™¨ï¼‰
- åœ¨ Antigravity Tools ä¸­å¯ç”¨ Web Search/Web Reader/Vision MCP ç«¯ç‚¹
- è®©å¤–éƒ¨ MCP å®¢æˆ·ç«¯ï¼ˆå¦‚ Claude Desktopã€Cursorï¼‰é€šè¿‡æœ¬åœ°ç½‘å…³è°ƒç”¨è¿™äº›èƒ½åŠ›
- æŒæ¡ä¼šè¯ç®¡ç†ï¼ˆVision MCPï¼‰å’Œé‰´æƒæ¨¡å‹

## ä½ ç°åœ¨çš„å›°å¢ƒ

å¾ˆå¤š AI å·¥å…·å¼€å§‹æ”¯æŒ MCPï¼ˆModel Context Protocolï¼‰ï¼Œä½†éœ€è¦é…ç½®ä¸Šæ¸¸ API Key å’Œ URLã€‚z.ai çš„ MCP æœåŠ¡å™¨ä¹Ÿæä¾›äº†å¼ºå¤§çš„èƒ½åŠ›ï¼ˆæœç´¢ã€é˜…è¯»ã€è§†è§‰åˆ†æï¼‰ï¼Œä½†ç›´æ¥é…ç½®æ„å‘³ç€è¦åœ¨æ¯ä¸ªå®¢æˆ·ç«¯æš´éœ² z.ai Keyã€‚

Antigravity Tools çš„æ–¹æ¡ˆæ˜¯ï¼šåœ¨æœ¬åœ°ç½‘å…³å±‚é¢ç»Ÿä¸€ç®¡ç† z.ai Keyï¼ŒæŠŠ MCP ç«¯ç‚¹æš´éœ²å‡ºæ¥ï¼Œå®¢æˆ·ç«¯åªéœ€è¿æœ¬åœ°ç½‘å…³ï¼Œæ— éœ€çŸ¥é“ z.ai Keyã€‚

## ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸€æ‹›

- ä½ æœ‰å¤šä¸ª MCP å®¢æˆ·ç«¯ï¼ˆClaude Desktopã€Cursorã€è‡ªç ”å·¥å…·ï¼‰ï¼Œæƒ³ç»Ÿä¸€ç”¨ä¸€å¥— z.ai Key
- ä½ å¸Œæœ›æŠŠ z.ai çš„ Web Search/Web Reader/Vision èƒ½åŠ›ä½œä¸ºå·¥å…·æš´éœ²ç»™ AI ä½¿ç”¨
- ä½ ä¸æƒ³åœ¨å¤šä¸ªåœ°æ–¹é‡å¤é…ç½®å’Œè½®æ¢ z.ai Key

## ğŸ’ å¼€å§‹å‰çš„å‡†å¤‡

::: warning å‰ç½®æ¡ä»¶
- ä½ å·²ç»åœ¨ Antigravity Tools çš„ "API Proxy" é¡µé¢å¯åŠ¨äº†åä»£æœåŠ¡
- ä½ å·²ç»è·å–äº† z.ai API Keyï¼ˆä» z.ai æ§åˆ¶å°ï¼‰
- ä½ çŸ¥é“åä»£çš„ç«¯å£ï¼ˆé»˜è®¤ `8045`ï¼‰
:::

::: info ä»€ä¹ˆæ˜¯ MCPï¼Ÿ
MCPï¼ˆModel Context Protocolï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾åè®®ï¼Œè®© AI å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨å¤–éƒ¨å·¥å…·/æ•°æ®æºã€‚

å…¸å‹çš„ MCP äº¤äº’æµç¨‹ï¼š
1. å®¢æˆ·ç«¯ï¼ˆå¦‚ Claude Desktopï¼‰å‘ MCP Server å‘é€ `tools/list` è¯·æ±‚ï¼Œè·å–å¯ç”¨å·¥å…·åˆ—è¡¨
2. å®¢æˆ·ç«¯æ ¹æ®ä¸Šä¸‹æ–‡é€‰æ‹©å·¥å…·ï¼Œå‘é€ `tools/call` è¯·æ±‚
3. MCP Server æ‰§è¡Œå·¥å…·å¹¶è¿”å›ç»“æœï¼ˆæ–‡æœ¬ã€å›¾åƒã€æ•°æ®ç­‰ï¼‰

Antigravity Tools æä¾›äº†ä¸‰ç§ MCP ç«¯ç‚¹ï¼š
- **è¿œç¨‹åå‘ä»£ç†**ï¼šç›´æ¥è½¬å‘åˆ° z.ai MCP æœåŠ¡å™¨ï¼ˆWeb Search/Web Readerï¼‰
- **å†…ç½®æœåŠ¡å™¨**ï¼šæœ¬åœ°å®ç° JSON-RPC 2.0 åè®®ï¼Œå¤„ç†å·¥å…·è°ƒç”¨ï¼ˆVisionï¼‰
:::

## ä»€ä¹ˆæ˜¯ MCP ç«¯ç‚¹ï¼Ÿ

**MCP ç«¯ç‚¹**æ˜¯ Antigravity Tools æš´éœ²çš„ä¸€ç»„ HTTP è·¯ç”±ï¼Œè®©å¤–éƒ¨ MCP å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨ z.ai çš„èƒ½åŠ›ï¼ŒåŒæ—¶ç”± Antigravity Tools ç»Ÿä¸€ç®¡ç†é‰´æƒå’Œé…ç½®ã€‚

### ç«¯ç‚¹åˆ†ç±»

| ç«¯ç‚¹ç±»å‹ | å®ç°æ–¹å¼ | æœ¬åœ°è·¯å¾„ | ä¸Šæ¸¸ç›®æ ‡ |
|--- | --- | --- | ---|
| **Web Search** | è¿œç¨‹åå‘ä»£ç† | `/mcp/web_search_prime/mcp` | `https://api.z.ai/api/mcp/web_search_prime/mcp` |
| **Web Reader** | è¿œç¨‹åå‘ä»£ç† | `/mcp/web_reader/mcp` | `https://api.z.ai/api/mcp/web_reader/mcp` |
| **Vision MCP** | å†…ç½®æœåŠ¡å™¨ï¼ˆJSON-RPC 2.0ï¼‰ | `/mcp/zai-mcp-server/mcp` | å†…éƒ¨è°ƒç”¨ z.ai PaaS API |

### å…³é”®åŒºåˆ«

::: info è¿œç¨‹åå‘ä»£ç† vs å†…ç½®æœåŠ¡å™¨
**è¿œç¨‹åå‘ä»£ç†**ï¼ˆWeb Search/Web Readerï¼‰ï¼š
- ä»£ç†ä¼šä¿ç•™éƒ¨åˆ†è¯·æ±‚å¤´ï¼ˆ`content-type`ã€`accept`ã€`user-agent`ï¼‰å¹¶æ³¨å…¥ `Authorization` å¤´
- ä»£ç†ä¼šè½¬å‘ä¸Šæ¸¸çš„å“åº”ä½“å’ŒçŠ¶æ€ç ï¼Œä½†åªä¿ç•™ `CONTENT_TYPE` å“åº”å¤´
- æ— çŠ¶æ€ï¼Œæ— éœ€ä¼šè¯ç®¡ç†

**å†…ç½®æœåŠ¡å™¨**ï¼ˆVision MCPï¼‰ï¼š
- å®Œæ•´å®ç° JSON-RPC 2.0 åè®®ï¼ˆ`initialize`ã€`tools/list`ã€`tools/call`ï¼‰
- æœ‰çŠ¶æ€ï¼šåˆ›å»ºä¼šè¯ï¼ˆ`mcp-session-id`ï¼‰ï¼ŒGET ç«¯ç‚¹è¿”å› SSE keepalive
- å·¥å…·é€»è¾‘åœ¨æœ¬åœ°å®ç°ï¼Œè°ƒç”¨ z.ai PaaS API æ‰§è¡Œè§†è§‰åˆ†æ
:::

## æ ¸å¿ƒæ€è·¯

Antigravity Tools çš„ MCP ç«¯ç‚¹éµå¾ªä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š

1. **ç»Ÿä¸€é‰´æƒ**ï¼šç”± Antigravity ç®¡ç† z.ai Keyï¼Œå®¢æˆ·ç«¯æ— éœ€é…ç½®
2. **å¯å¼€å…³**ï¼šä¸‰ä¸ªç«¯ç‚¹å¯ä»¥ç‹¬ç«‹å¯ç”¨/ç¦ç”¨
3. **ä¼šè¯éš”ç¦»**ï¼šVision MCP ä½¿ç”¨ `mcp-session-id` éš”ç¦»ä¸åŒå®¢æˆ·ç«¯
4. **é”™è¯¯é€æ˜**ï¼šä¸Šæ¸¸çš„å“åº”ä½“å’ŒçŠ¶æ€ç ä¼šåŸæ ·è½¬å‘ï¼ˆå“åº”å¤´ä¼šè¿‡æ»¤ï¼‰

### é‰´æƒæ¨¡å‹

```
MCP å®¢æˆ·ç«¯ â†’ Antigravity æœ¬åœ°ä»£ç† â†’ z.ai ä¸Šæ¸¸
               â†“
           [å¯é€‰] proxy.auth_mode
               â†“
           [è‡ªåŠ¨] æ³¨å…¥ z.ai Key
```

Antigravity Tools çš„ä»£ç†ä¸­é—´ä»¶ï¼ˆ`src-tauri/src/proxy/middleware/auth.rs`ï¼‰ä¼šæ£€æŸ¥ `proxy.auth_mode`ï¼Œå¦‚æœå¼€å¯é‰´æƒï¼Œéœ€è¦å®¢æˆ·ç«¯å¸¦ API Keyã€‚

**é‡è¦**ï¼šæ— è®º `proxy.auth_mode` å¦‚ä½•ï¼Œz.ai Key éƒ½æ˜¯ä»£ç†è‡ªåŠ¨æ³¨å…¥çš„ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦é…ç½®ã€‚

## è·Ÿæˆ‘åš

### ç¬¬ 1 æ­¥ï¼šé…ç½® z.ai å¹¶å¯ç”¨ MCP åŠŸèƒ½

**ä¸ºä»€ä¹ˆ**
å…ˆç¡®ä¿ z.ai åŸºç¡€é…ç½®æ­£ç¡®ï¼Œå†é€ä¸ªå¯ç”¨ MCP ç«¯ç‚¹ã€‚

1. æ‰“å¼€ Antigravity Toolsï¼Œè¿›å…¥ **API Proxy** é¡µé¢
2. æ‰¾åˆ° **z.ai é…ç½®** å¡ç‰‡ï¼Œç‚¹å‡»å±•å¼€
3. é…ç½®ä»¥ä¸‹å­—æ®µï¼š

```yaml
 # z.ai é…ç½®
base_url: "https://api.z.ai/api/anthropic"  # z.ai Anthropic å…¼å®¹ç«¯ç‚¹
api_key: "ä½ çš„-z.ai-api-key"               # ä» z.ai æ§åˆ¶å°è·å–
enabled: true                              # å¯ç”¨ z.ai
```

4. æ‰¾åˆ° **MCP é…ç½®** å­å¡ç‰‡ï¼Œé…ç½®ï¼š

```yaml
 # MCP é…ç½®
enabled: true                              # å¯ç”¨ MCP æ€»å¼€å…³
web_search_enabled: true                    # å¯ç”¨ Web Search
web_reader_enabled: true                    # å¯ç”¨ Web Reader
vision_enabled: true                        # å¯ç”¨ Vision MCP
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šé…ç½®ä¿å­˜åï¼Œé¡µé¢ä¸‹æ–¹ä¼šå‡ºç°"æœ¬åœ° MCP ç«¯ç‚¹"åˆ—è¡¨ï¼Œæ˜¾ç¤ºä¸‰ä¸ªç«¯ç‚¹çš„å®Œæ•´ URLã€‚

### ç¬¬ 2 æ­¥ï¼šéªŒè¯ Web Search ç«¯ç‚¹

**ä¸ºä»€ä¹ˆ**
Web Search æ˜¯è¿œç¨‹åå‘ä»£ç†ï¼Œæœ€ç®€å•ï¼Œé€‚åˆå…ˆéªŒè¯åŸºç¡€é…ç½®ã€‚

```bash
 # 1) å…ˆåˆ—å‡º Web Search ç«¯ç‚¹æä¾›çš„å·¥å…·ï¼ˆå·¥å…·åä»¥å®é™…è¿”å›ä¸ºå‡†ï¼‰
curl -X POST http://127.0.0.1:8045/mcp/web_search_prime/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/list",
    "id": 1
  }'
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šè¿”å›ä¸€ä¸ªåŒ…å« `tools` åˆ—è¡¨çš„ JSON å“åº”ã€‚

::: tip ç»§ç»­éªŒè¯ tools/callï¼ˆå¯é€‰ï¼‰
æ‹¿åˆ° `tools[].name` å’Œ `tools[].inputSchema` åï¼Œä½ å°±èƒ½æŒ‰ schema æ‹¼ `tools/call` è¯·æ±‚ï¼ˆå‚æ•°ä»¥ schema ä¸ºå‡†ï¼Œåˆ«çŒœå­—æ®µï¼‰ã€‚
:::

::: tip ç«¯ç‚¹æœªæ‰¾åˆ°ï¼Ÿ
å¦‚æœæ”¶åˆ° `404 Not Found`ï¼Œæ£€æŸ¥ï¼š
1. `proxy.zai.mcp.enabled` æ˜¯å¦ä¸º `true`
2. `proxy.zai.mcp.web_search_enabled` æ˜¯å¦ä¸º `true`
3. åä»£æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ
:::

### ç¬¬ 3 æ­¥ï¼šéªŒè¯ Web Reader ç«¯ç‚¹

**ä¸ºä»€ä¹ˆ**
Web Reader ä¹Ÿæ˜¯è¿œç¨‹åå‘ä»£ç†ï¼Œä½†å‚æ•°å’Œè¿”å›æ ¼å¼ä¸åŒï¼ŒéªŒè¯ä»£ç†èƒ½æ­£ç¡®å¤„ç†ä¸åŒç«¯ç‚¹ã€‚

```bash
 # 2) åˆ—å‡º Web Reader ç«¯ç‚¹æä¾›çš„å·¥å…·
curl -X POST http://127.0.0.1:8045/mcp/web_reader/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/list",
    "id": 2
  }'
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šè¿”å›ä¸€ä¸ªåŒ…å« `tools` åˆ—è¡¨çš„ JSON å“åº”ã€‚

### ç¬¬ 4 æ­¥ï¼šéªŒè¯ Vision MCP ç«¯ç‚¹ï¼ˆä¼šè¯ç®¡ç†ï¼‰

**ä¸ºä»€ä¹ˆ**
Vision MCP æ˜¯å†…ç½®æœåŠ¡å™¨ï¼Œæœ‰ä¼šè¯çŠ¶æ€ï¼Œéœ€è¦å…ˆ `initialize`ï¼Œå†è°ƒç”¨å·¥å…·ã€‚

#### 4.1 åˆå§‹åŒ–ä¼šè¯

```bash
 # 1) å‘é€ initialize è¯·æ±‚
curl -X POST http://127.0.0.1:8045/mcp/zai-mcp-server/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "initialize",
    "params": {
      "protocolVersion": "2024-11-05"
    },
    "id": 1
  }'
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šå“åº”ä¸­åŒ…å« `mcp-session-id` å¤´éƒ¨ï¼Œä¿å­˜è¿™ä¸ª IDã€‚

```json
{
  "jsonrpc": "2.0",
  "result": {
    "protocolVersion": "2024-11-05",
    "capabilities": { "tools": {} },
    "serverInfo": {
      "name": "zai-mcp-server",
      "version": "<app-version>"
    }
  },
  "id": 1
}
```

::: info æé†’
`serverInfo.version` æ¥è‡ª Rust çš„ `env!("CARGO_PKG_VERSION")`ï¼Œä»¥ä½ æœ¬æœºå®é™…å®‰è£…ç‰ˆæœ¬ä¸ºå‡†ã€‚
:::

å“åº”å¤´ï¼š
```
mcp-session-id: uuid-v4-string
```

#### 4.2 è·å–å·¥å…·åˆ—è¡¨

```bash
 # 2) å‘é€ tools/list è¯·æ±‚ï¼ˆå¸¦ä¸Šä¼šè¯ IDï¼‰
curl -X POST http://127.0.0.1:8045/mcp/zai-mcp-server/mcp \
  -H "Content-Type: application/json" \
  -H "mcp-session-id: ä½ çš„ä¼šè¯ID" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/list",
    "id": 2
  }'
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šè¿”å› 8 ä¸ªå·¥å…·çš„å®šä¹‰ï¼ˆ`ui_to_artifact`ã€`extract_text_from_screenshot`ã€`diagnose_error_screenshot` ç­‰ï¼‰ã€‚

#### 4.3 è°ƒç”¨å·¥å…·

```bash
 # 3) è°ƒç”¨ analyze_image å·¥å…·
curl -X POST http://127.0.0.1:8045/mcp/zai-mcp-server/mcp \
  -H "Content-Type: application/json" \
  -H "mcp-session-id: ä½ çš„ä¼šè¯ID" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/call",
    "params": {
      "name": "analyze_image",
      "arguments": {
        "image_source": "https://example.com/image.jpg",
        "prompt": "æè¿°è¿™å¼ å›¾ç‰‡çš„å†…å®¹"
      }
    },
    "id": 3
  }'
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šè¿”å›å›¾ç‰‡åˆ†æç»“æœçš„æ–‡æœ¬æè¿°ã€‚

::: danger ä¼šè¯ ID é‡è¦
Vision MCP çš„æ‰€æœ‰è¯·æ±‚ï¼ˆé™¤äº† `initialize`ï¼‰éƒ½å¿…é¡»å¸¦ `mcp-session-id` å¤´éƒ¨ã€‚

ä¼šè¯ ID åœ¨ `initialize` å“åº”ä¸­è¿”å›ï¼Œåç»­è¯·æ±‚å¿…é¡»ä½¿ç”¨åŒä¸€ä¸ª IDã€‚ä¼šè¯ä¸¢å¤±åéœ€è¦é‡æ–° `initialize`ã€‚
:::

### ç¬¬ 5 æ­¥ï¼šæµ‹è¯• SSE keepaliveï¼ˆå¯é€‰ï¼‰

**ä¸ºä»€ä¹ˆ**
Vision MCP çš„ GET ç«¯ç‚¹è¿”å› SSEï¼ˆServer-Sent Eventsï¼‰æµï¼Œç”¨äºä¿æŒè¿æ¥æ´»è·ƒã€‚

```bash
 # 4) è°ƒç”¨ GET ç«¯ç‚¹ï¼ˆè·å– SSE æµï¼‰
curl -N http://127.0.0.1:8045/mcp/zai-mcp-server/mcp \
  -H "mcp-session-id: ä½ çš„ä¼šè¯ID"
```

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šæ¯ 15 ç§’æ”¶åˆ°ä¸€ä¸ª `event: ping` æ¶ˆæ¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```
event: ping
data: keepalive

event: ping
data: keepalive
...
```

## æ£€æŸ¥ç‚¹ âœ…

### é…ç½®æ£€æŸ¥

- [ ] `proxy.zai.enabled` ä¸º `true`
- [ ] `proxy.zai.api_key` å·²é…ç½®ï¼ˆéç©ºï¼‰
- [ ] `proxy.zai.mcp.enabled` ä¸º `true`
- [ ] è‡³å°‘å¯ç”¨äº†ä¸€ä¸ª MCP ç«¯ç‚¹ï¼ˆ`web_search_enabled` / `web_reader_enabled` / `vision_enabled`ï¼‰
- [ ] åä»£æœåŠ¡æ­£åœ¨è¿è¡Œ

### åŠŸèƒ½éªŒè¯

- [ ] Web Search ç«¯ç‚¹è¿”å›æœç´¢ç»“æœ
- [ ] Web Reader ç«¯ç‚¹è¿”å›ç½‘é¡µå†…å®¹
- [ ] Vision MCP ç«¯ç‚¹æˆåŠŸ `initialize` å¹¶è·å– `mcp-session-id`
- [ ] Vision MCP ç«¯ç‚¹è¿”å›å·¥å…·åˆ—è¡¨ï¼ˆ8 ä¸ªå·¥å…·ï¼‰
- [ ] Vision MCP ç«¯ç‚¹æˆåŠŸè°ƒç”¨å·¥å…·å¹¶è¿”å›ç»“æœ

## Vision MCP å·¥å…·é€ŸæŸ¥

| å·¥å…·å | åŠŸèƒ½ | å¿…éœ€å‚æ•° | ç¤ºä¾‹åœºæ™¯ |
|--- | --- | --- | ---|
| `ui_to_artifact` | æŠŠ UI æˆªå›¾è½¬ä¸ºä»£ç /æç¤ºè¯/è§„æ ¼/æè¿° | `image_source`ã€`output_type`ã€`prompt` | ä»è®¾è®¡ç¨¿ç”Ÿæˆå‰ç«¯ä»£ç  |
| `extract_text_from_screenshot` | ä»æˆªå›¾æå–æ–‡æœ¬/ä»£ç ï¼ˆç±»ä¼¼ OCRï¼‰ | `image_source`ã€`prompt` | è¯»å–é”™è¯¯æ—¥å¿—æˆªå›¾ |
| `diagnose_error_screenshot` | è¯Šæ–­é”™è¯¯æˆªå›¾ï¼ˆå †æ ˆè·Ÿè¸ªã€æ—¥å¿—ï¼‰ | `image_source`ã€`prompt` | åˆ†æè¿è¡Œæ—¶é”™è¯¯ |
| `understand_technical_diagram` | åˆ†ææ¶æ„/æµç¨‹/UML/ER å›¾ | `image_source`ã€`prompt` | ç†è§£ç³»ç»Ÿæ¶æ„å›¾ |
| `analyze_data_visualization` | åˆ†æå›¾è¡¨/ä»ªè¡¨æ¿ | `image_source`ã€`prompt` | ä»ä»ªè¡¨æ¿æå–è¶‹åŠ¿ |
| `ui_diff_check` | æ¯”è¾ƒä¸¤ä¸ª UI æˆªå›¾å¹¶æŠ¥å‘Šå·®å¼‚ | `expected_image_source`ã€`actual_image_source`ã€`prompt` | è§†è§‰å›å½’æµ‹è¯• |
| `analyze_image` | é€šç”¨å›¾åƒåˆ†æ | `image_source`ã€`prompt` | æè¿°å›¾ç‰‡å†…å®¹ |
| `analyze_video` | è§†é¢‘å†…å®¹åˆ†æ | `video_source`ã€`prompt` | åˆ†æè§†é¢‘åœºæ™¯ |

::: info å‚æ•°è¯´æ˜
- `image_source`ï¼šæœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ `/tmp/screenshot.png`ï¼‰æˆ–è¿œç¨‹ URLï¼ˆå¦‚ `https://example.com/image.jpg`ï¼‰
- `video_source`ï¼šæœ¬åœ°æ–‡ä»¶è·¯å¾„æˆ–è¿œç¨‹ URLï¼ˆæ”¯æŒ MP4ã€MOVã€M4Vï¼‰
- `output_type`ï¼ˆ`ui_to_artifact`ï¼‰ï¼š`code` / `prompt` / `spec` / `description`
:::

## è¸©å‘æé†’

### 404 Not Found

**ç°è±¡**ï¼šè°ƒç”¨ MCP ç«¯ç‚¹è¿”å› `404 Not Found`ã€‚

**åŸå› **ï¼š
1. ç«¯ç‚¹æœªå¯ç”¨ï¼ˆå¯¹åº”çš„ `*_enabled` ä¸º `false`ï¼‰
2. åä»£æœåŠ¡æœªå¯åŠ¨
3. URL è·¯å¾„é”™è¯¯ï¼ˆæ³¨æ„ `/mcp/` å‰ç¼€ï¼‰

**è§£å†³**ï¼š
1. æ£€æŸ¥ `proxy.zai.mcp.enabled` å’Œå¯¹åº”çš„ `*_enabled` é…ç½®
2. æ£€æŸ¥åä»£æœåŠ¡çŠ¶æ€
3. ç¡®è®¤ URL è·¯å¾„æ ¼å¼ï¼ˆå¦‚ `/mcp/web_search_prime/mcp`ï¼‰

### 400 Bad Request: Missing Mcp-Session-Id

**ç°è±¡**ï¼šè°ƒç”¨ Vision MCPï¼ˆé™¤ `initialize` å¤–ï¼‰è¿”å› `400 Bad Request`ã€‚

- GET ç«¯ç‚¹ï¼šè¿”å›çº¯æ–‡æœ¬ `Missing Mcp-Session-Id`
- POST ç«¯ç‚¹ï¼šè¿”å› JSON-RPC é”™è¯¯ `{"error":{"code":-32000,"message":"Bad Request: missing Mcp-Session-Id"}}`

**åŸå› **ï¼šè¯·æ±‚å¤´ç¼ºå°‘ `mcp-session-id` æˆ– ID æ— æ•ˆã€‚

**è§£å†³**ï¼š
1. ç¡®ä¿ `initialize` è¯·æ±‚æˆåŠŸï¼Œå¹¶ä»å“åº”å¤´è·å– `mcp-session-id`
2. åç»­è¯·æ±‚ï¼ˆ`tools/list`ã€`tools/call`ï¼Œä»¥åŠ SSE keepaliveï¼‰éƒ½å¿…é¡»å¸¦è¯¥å¤´éƒ¨
3. å¦‚æœä¼šè¯ä¸¢å¤±ï¼ˆå¦‚æœåŠ¡é‡å¯ï¼‰ï¼Œéœ€è¦é‡æ–° `initialize`

### z.ai is not configured

**ç°è±¡**ï¼šè¿”å› `400 Bad Request`ï¼Œæç¤º `z.ai is not configured`ã€‚

**åŸå› **ï¼š`proxy.zai.enabled` ä¸º `false` æˆ– `api_key` ä¸ºç©ºã€‚

**è§£å†³**ï¼š
1. ç¡®ä¿ `proxy.zai.enabled` ä¸º `true`
2. ç¡®ä¿ `proxy.zai.api_key` å·²é…ç½®ï¼ˆéç©ºï¼‰

### ä¸Šæ¸¸è¯·æ±‚å¤±è´¥

**ç°è±¡**ï¼šè¿”å› `502 Bad Gateway` æˆ–å†…éƒ¨é”™è¯¯ã€‚

**åŸå› **ï¼š
1. z.ai API Key æ— æ•ˆæˆ–è¿‡æœŸ
2. ç½‘ç»œè¿æ¥é—®é¢˜ï¼ˆéœ€è¦ä¸Šæ¸¸ä»£ç†ï¼‰
3. z.ai æœåŠ¡ç«¯é”™è¯¯

**è§£å†³**ï¼š
1. éªŒè¯ z.ai API Key æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ `proxy.upstream_proxy` é…ç½®ï¼ˆå¦‚æœéœ€è¦ä»£ç†è®¿é—® z.aiï¼‰
3. æŸ¥çœ‹æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

## ä¸å¤–éƒ¨ MCP å®¢æˆ·ç«¯é›†æˆ

### Claude Desktop é…ç½®ç¤ºä¾‹

Claude Desktop çš„ MCP å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼ˆ`~/.config/claude/claude_desktop_config.json`ï¼‰ï¼š

```json
{
  "mcpServers": {
    "antigravity-vision": {
      "command": "node",
      "args": [
        "/path/to/mcp-client-wrapper.js",
        "--endpoint",
        "http://127.0.0.1:8045/mcp/zai-mcp-server/mcp"
      ]
    },
    "antigravity-web-search": {
      "command": "node",
      "args": [
        "/path/to/mcp-client-wrapper.js",
        "--endpoint",
        "http://127.0.0.1:8045/mcp/web_search_prime/mcp"
      ]
    }
  }
}
```

::: tip Claude Desktop çš„é™åˆ¶
Claude Desktop çš„ MCP å®¢æˆ·ç«¯éœ€è¦é€šè¿‡ `stdio` é€šä¿¡ï¼Œå¦‚æœä½ ç›´æ¥ç”¨ HTTP ç«¯ç‚¹ï¼Œéœ€è¦ç¼–å†™ä¸€ä¸ª wrapper è„šæœ¬æŠŠ `stdio` è½¬ä¸º HTTP è¯·æ±‚ã€‚

æˆ–è€…ä½¿ç”¨æ”¯æŒ HTTP MCP çš„å®¢æˆ·ç«¯ï¼ˆå¦‚ Cursorï¼‰ã€‚
:::

### HTTP MCP å®¢æˆ·ç«¯ï¼ˆå¦‚ Cursorï¼‰

å¦‚æœå®¢æˆ·ç«¯æ”¯æŒ HTTP MCPï¼Œç›´æ¥é…ç½®ç«¯ç‚¹ URL å³å¯ï¼š

```yaml
 # Cursor MCP é…ç½®
mcpServers:
  - name: antigravity-vision
    url: http://127.0.0.1:8045/mcp/zai-mcp-server/mcp
  - name: antigravity-web-search
    url: http://127.0.0.1:8045/mcp/web_search_prime/mcp
```

## æœ¬è¯¾å°ç»“

Antigravity Tools çš„ MCP ç«¯ç‚¹æŠŠ z.ai çš„èƒ½åŠ›æš´éœ²ä¸ºå¯è°ƒç”¨å·¥å…·ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š
- **è¿œç¨‹åå‘ä»£ç†**ï¼ˆWeb Search/Web Readerï¼‰ï¼šç®€å•è½¬å‘ï¼Œæ— çŠ¶æ€
- **å†…ç½®æœåŠ¡å™¨**ï¼ˆVision MCPï¼‰ï¼šå®Œæ•´å®ç° JSON-RPC 2.0ï¼Œæœ‰ä¼šè¯ç®¡ç†

å…³é”®ç‚¹ï¼š
1. ç»Ÿä¸€é‰´æƒï¼šz.ai Key ç”± Antigravity ç®¡ç†ï¼Œå®¢æˆ·ç«¯æ— éœ€é…ç½®
2. å¯å¼€å…³ï¼šä¸‰ä¸ªç«¯ç‚¹å¯ç‹¬ç«‹å¯ç”¨/ç¦ç”¨
3. ä¼šè¯éš”ç¦»ï¼šVision MCP ä½¿ç”¨ `mcp-session-id` éš”ç¦»å®¢æˆ·ç«¯
4. çµæ´»é›†æˆï¼šæ”¯æŒä»»ä½•å…¼å®¹ MCP åè®®çš„å®¢æˆ·ç«¯

## ä¸‹ä¸€è¯¾é¢„å‘Š

> ä¸‹ä¸€è¯¾æˆ‘ä»¬å­¦ä¹  **[Cloudflared ä¸€é”®éš§é“](/zh/lbjlaq/Antigravity-Manager/platforms/cloudflared/)**ã€‚
>
> ä½ ä¼šå­¦åˆ°ï¼š
> - å¦‚ä½•ä¸€é”®å®‰è£…å’Œå¯åŠ¨ Cloudflared éš§é“
> - quick æ¨¡å¼ vs auth æ¨¡å¼çš„åŒºåˆ«
> - å¦‚ä½•å®‰å…¨åœ°æŠŠæœ¬åœ° API æš´éœ²åˆ°å…¬ç½‘

---

## é™„å½•ï¼šæºç å‚è€ƒ

<details>
<summary><strong>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æºç ä½ç½®</strong></summary>

> æ›´æ–°æ—¶é—´ï¼š2026-01-23

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œå· |
|--- | --- | ---|
| Web Search ç«¯ç‚¹ | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L115-L135) | 115-135 |
| Web Reader ç«¯ç‚¹ | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L137-L157) | 137-157 |
| Vision MCP ç«¯ç‚¹ï¼ˆä¸»å…¥å£ï¼‰ | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L376-L397) | 376-397 |
| Vision MCP initialize å¤„ç† | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L271-L293) | 271-293 |
| Vision MCP tools/list å¤„ç† | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L311-L314) | 311-314 |
| Vision MCP tools/call å¤„ç† | [`src-tauri/src/proxy/handlers/mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/mcp.rs#L315-L363) | 315-363 |
| Vision MCP ä¼šè¯çŠ¶æ€ç®¡ç† | [`src-tauri/src/proxy/zai_vision_mcp.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/zai_vision_mcp.rs#L1-L42) | 1-42 |
| Vision MCP å·¥å…·å®šä¹‰ | [`src-tauri/src/proxy/zai_vision_tools.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/zai_vision_tools.rs#L166-L271) | 166-271 |
| Vision MCP å·¥å…·è°ƒç”¨å®ç° | [`src-tauri/src/proxy/zai_vision_tools.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/zai_vision_tools.rs#L273-L400) | 273-400 |
| è·¯ç”±æ³¨å†Œ | [`src-tauri/src/proxy/server.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/server.rs#L157-L169) | 157-169 |
| é‰´æƒä¸­é—´ä»¶ | [`src-tauri/src/proxy/middleware/auth.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/middleware/auth.rs#L1-L78) | 1-78 |
| MCP é…ç½® UI | [`src/pages/ApiProxy.tsx`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src/pages/ApiProxy.tsx#L1304-L1357) | 1304-1357 |
| ä»“åº“å†…è¯´æ˜æ–‡æ¡£ | [`docs/zai/mcp.md`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/docs/zai/mcp.md#L1-L57) | 1-57 |

**å…³é”®å¸¸é‡**ï¼š
- `ZAI_PAAZ_CHAT_COMPLETIONS_URL = "https://api.z.ai/api/paas/v4/chat/completions"`ï¼šz.ai PaaS API ç«¯ç‚¹ï¼ˆç”¨äº Vision å·¥å…·è°ƒç”¨ï¼‰

**å…³é”®å‡½æ•°**ï¼š
- `handle_web_search_prime()`ï¼šå¤„ç† Web Search ç«¯ç‚¹çš„è¿œç¨‹åå‘ä»£ç†
- `handle_web_reader()`ï¼šå¤„ç† Web Reader ç«¯ç‚¹çš„è¿œç¨‹åå‘ä»£ç†
- `handle_zai_mcp_server()`ï¼šå¤„ç† Vision MCP ç«¯ç‚¹çš„æ‰€æœ‰æ–¹æ³•ï¼ˆGET/POST/DELETEï¼‰
- `mcp_session_id()`ï¼šä»è¯·æ±‚å¤´æå– `mcp-session-id`
- `forward_mcp()`ï¼šé€šç”¨ MCP è½¬å‘å‡½æ•°ï¼ˆæ³¨å…¥é‰´æƒå¹¶è½¬å‘åˆ°ä¸Šæ¸¸ï¼‰
- `tool_specs()`ï¼šè¿”å› Vision MCP çš„å·¥å…·å®šä¹‰åˆ—è¡¨
- `call_tool()`ï¼šæ‰§è¡ŒæŒ‡å®šçš„ Vision MCP å·¥å…·

</details>
