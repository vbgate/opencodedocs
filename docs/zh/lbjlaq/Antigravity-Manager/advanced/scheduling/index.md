---
title: "è´¦å·è°ƒåº¦: é«˜å¯ç”¨ç­–ç•¥ | Antigravity-Manager"
sidebarTitle: "è®©è¯·æ±‚æ›´ç¨³å®š"
subtitle: "é«˜å¯ç”¨è°ƒåº¦"
description: "å­¦ä¹  Antigravity Manager è´¦å·è°ƒåº¦ä¸é«˜å¯ç”¨ç­–ç•¥ã€‚æŒæ¡ç²˜æ€§ä¼šè¯ã€å›ºå®šè´¦å·ã€å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œæå‡ç³»ç»Ÿå¯ç”¨æ€§ã€‚"
tags:
  - "è¿›é˜¶"
  - "è°ƒåº¦"
  - "ç²˜æ€§ä¼šè¯"
  - "è´¦å·è½®æ¢"
  - "å¤±è´¥é‡è¯•"
prerequisite:
  - "start-add-account"
  - "start-proxy-and-first-client"
  - "advanced-config"
order: 3
---
# é«˜å¯ç”¨è°ƒåº¦ï¼šè½®æ¢ã€å›ºå®šè´¦å·ã€ç²˜æ€§ä¼šè¯ä¸å¤±è´¥é‡è¯•

ä½ æŠŠ Antigravity Tools å½“æˆæœ¬åœ° AI ç½‘å…³ç”¨äº†ä¸€æ®µæ—¶é—´åï¼ŒåŸºæœ¬éƒ½ä¼šæ’åˆ°åŒä¸€ä¸ªé—®é¢˜ï¼šè´¦å·è¶Šå°‘è¶Šå®¹æ˜“ 429/401/invalid_grantï¼Œè´¦å·è¶Šå¤šè¶Šå®¹æ˜“"å“ªä¸ªè´¦å·åœ¨å¹²æ´»"è¯´ä¸æ¸…ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¹Ÿä¼šæ‰ã€‚

è¿™èŠ‚è¯¾å°±æŠŠè°ƒåº¦è¿™å—è®²æ¸…æ¥šï¼šå®ƒåˆ°åº•æ€ä¹ˆé€‰è´¦å·ã€ä»€ä¹ˆå«"ç²˜æ€§ä¼šè¯"ã€ä»€ä¹ˆæ—¶å€™ä¼šå¼ºåˆ¶è½®æ¢ã€ä»¥åŠå¦‚ä½•ç”¨"å›ºå®šè´¦å·æ¨¡å¼"æŠŠè°ƒåº¦å˜æˆå¯æ§çš„ã€‚

## å­¦å®Œä½ èƒ½åšä»€ä¹ˆ

- çœ‹æ‡‚ Antigravity Tools çš„ 3 ç§è°ƒåº¦æ¨¡å¼åœ¨çœŸå®è¯·æ±‚é‡Œå„åšäº†ä»€ä¹ˆ
- çŸ¥é“"ä¼šè¯æŒ‡çº¹ï¼ˆsession_idï¼‰"æ€ä¹ˆç”Ÿæˆï¼Œä»¥åŠå®ƒæ€ä¹ˆå½±å“ç²˜æ€§è°ƒåº¦
- åœ¨ GUI é‡Œå¯ç”¨/å…³é—­"å›ºå®šè´¦å·æ¨¡å¼"ï¼Œå¹¶ç†è§£å®ƒä¼šè¦†ç›–å“ªäº›è°ƒåº¦é€»è¾‘
- é‡åˆ° 429/5xx/invalid_grant æ—¶ï¼ŒçŸ¥é“ç³»ç»Ÿä¼šæ€ä¹ˆæ ‡è®°é™æµã€æ€ä¹ˆé‡è¯•ã€ä»€ä¹ˆæ—¶å€™è½®æ¢

## ä½ ç°åœ¨çš„å›°å¢ƒ

- Claude Code æˆ– OpenAI SDK è·‘ç€è·‘ç€çªç„¶ 429ï¼Œä¸€é‡è¯•å°±æ¢è´¦å·ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¸‹æ»‘
- å¤šä¸ªå®¢æˆ·ç«¯å¹¶å‘è·‘ä»»åŠ¡ï¼Œç»å¸¸"äº’ç›¸è¸©æ‰"å¯¹æ–¹çš„è´¦å·çŠ¶æ€
- ä½ æƒ³æ’éšœï¼Œä½†ä¸çŸ¥é“å½“å‰è¯·æ±‚æ˜¯å“ªä¸ªè´¦å·åœ¨æœåŠ¡
- ä½ åªæƒ³ç”¨æŸä¸ª"æœ€ç¨³çš„è´¦å·"ï¼Œä½†ç³»ç»Ÿæ€»åœ¨è½®æ¢

## ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸€æ‹›

- ä½ éœ€è¦æŠŠ"ç¨³å®šæ€§ï¼ˆå°‘æŠ¥é”™ï¼‰"å’Œ"ç¼“å­˜å‘½ä¸­ï¼ˆåŒè´¦å·ï¼‰"åšæƒè¡¡
- ä½ æƒ³è®©åŒä¸€æ¡å¯¹è¯å°½é‡å¤ç”¨åŒä¸€ä¸ªè´¦å·ï¼ˆå‡å°‘ Prompt Caching æŠ–åŠ¨ï¼‰
- ä½ è¦åšç°åº¦/æ’éšœï¼Œæƒ³æŠŠæ‰€æœ‰è¯·æ±‚éƒ½å›ºå®šåˆ°ä¸€ä¸ªè´¦å·

## ğŸ’ å¼€å§‹å‰çš„å‡†å¤‡

1) è‡³å°‘å‡†å¤‡ 2 ä¸ªå¯ç”¨è´¦å·ï¼ˆè´¦å·æ± è¶Šå°ï¼Œè½®æ¢ç©ºé—´è¶Šå°ï¼‰
2) åä»£æœåŠ¡å·²å¯åŠ¨ï¼ˆåœ¨ã€ŒAPI Proxyã€é¡µé¢èƒ½çœ‹åˆ° Running çŠ¶æ€ï¼‰
3) ä½ çŸ¥é“é…ç½®æ–‡ä»¶åœ¨å“ªé‡Œï¼ˆå¦‚æœä½ éœ€è¦æ‰‹åŠ¨æ”¹é…ç½®ï¼‰

::: tip å…ˆæŠŠé…ç½®ç³»ç»Ÿè¿™è¯¾è¡¥ä¸Š
å¦‚æœä½ è¿˜ä¸ç†Ÿ `gui_config.json` å’Œå“ªäº›é…ç½®èƒ½çƒ­æ›´æ–°ï¼Œå…ˆçœ‹ **[é…ç½®å…¨è§£ï¼šAppConfig/ProxyConfigã€è½ç›˜ä½ç½®ä¸çƒ­æ›´æ–°è¯­ä¹‰](/zh/lbjlaq/Antigravity-Manager/advanced/config/)**ã€‚
:::

## æ ¸å¿ƒæ€è·¯ï¼šä¸€æ¬¡è¯·æ±‚ä¼šç»è¿‡å“ªå‡ å±‚"è°ƒåº¦"

è°ƒåº¦ä¸æ˜¯ä¸€ä¸ª"å•ç‹¬çš„å¼€å…³"ï¼Œè€Œæ˜¯å‡ å±‚æœºåˆ¶å åœ¨ä¸€èµ·ï¼š

1) **SessionManager å…ˆç»™è¯·æ±‚æ‰“ä¸€ä¸ªä¼šè¯æŒ‡çº¹ï¼ˆsession_idï¼‰**
2) **Handlers æ¯æ¬¡é‡è¯•éƒ½ä¼šè¦æ±‚ TokenManager å¼ºåˆ¶è½®æ¢**ï¼ˆ`attempt > 0`ï¼‰
3) **TokenManager å†æ ¹æ®ï¼šå›ºå®šè´¦å· â†’ ç²˜æ€§ä¼šè¯ â†’ 60s çª—å£ â†’ è½®è¯¢** é€‰å‡ºè´¦å·
4) **é‡åˆ° 429/5xx æ—¶ä¼šè®°å½•é™æµä¿¡æ¯**ï¼Œåç»­é€‰è´¦å·ä¼šä¸»åŠ¨è·³è¿‡é™æµè´¦å·

### ä»€ä¹ˆæ˜¯"ä¼šè¯æŒ‡çº¹ï¼ˆsession_idï¼‰"ï¼Ÿ

**ä¼šè¯æŒ‡çº¹**å°±æ˜¯ä¸€ä¸ª"å°½é‡ç¨³å®šçš„ Session Key"ï¼Œç”¨æ¥æŠŠåŒä¸€æ®µå¯¹è¯çš„å¤šæ¬¡è¯·æ±‚ç»‘åœ¨åŒä¸€è´¦å·ä¸Šã€‚

 åœ¨ Claude è¯·æ±‚é‡Œï¼Œä¼˜å…ˆçº§æ˜¯ï¼š

 1) `metadata.user_id`ï¼ˆå®¢æˆ·ç«¯æ˜¾å¼ä¼ å…¥ï¼Œä¸”éç©ºä¸”ä¸å« `"session-"` å‰ç¼€ï¼‰
 2) ç¬¬ä¸€æ¡"è¶³å¤Ÿé•¿"çš„ user æ¶ˆæ¯åš SHA256 å“ˆå¸Œï¼Œç„¶åæˆªæ–­æˆ `sid-xxxxxxxxxxxxxxxx`

 å¯¹åº”å®ç°ï¼š`src-tauri/src/proxy/session_manager.rs`ï¼ˆClaude/OpenAI/Gemini éƒ½æœ‰å„è‡ªçš„æå–é€»è¾‘ï¼‰ã€‚

::: info å°ç»†èŠ‚ï¼šä¸ºä»€ä¹ˆåªçœ‹ç¬¬ä¸€æ¡ user æ¶ˆæ¯ï¼Ÿ
æºç é‡Œæ˜ç¡®å†™äº†"åªå“ˆå¸Œç¬¬ä¸€æ¡ç”¨æˆ·æ¶ˆæ¯å†…å®¹ï¼Œä¸æ··å…¥æ¨¡å‹åç§°æˆ–æ—¶é—´æˆ³"ï¼Œç›®æ ‡æ˜¯è®©åŒä¸€å¯¹è¯çš„å¤šè½®è¯·æ±‚å°½é‡ç”Ÿæˆç›¸åŒçš„ session_idï¼Œä»è€Œæé«˜ç¼“å­˜å‘½ä¸­ç‡ã€‚
:::

### TokenManager é€‰è´¦å·çš„ä¼˜å…ˆçº§

TokenManager çš„æ ¸å¿ƒå…¥å£æ˜¯ï¼š

- `TokenManager::get_token(quota_group, force_rotate, session_id, target_model)`

 å®ƒåšçš„äº‹å¯ä»¥æŒ‰ä¼˜å…ˆçº§ç†è§£ï¼š

 1) **å›ºå®šè´¦å·æ¨¡å¼ï¼ˆFixed Accountï¼‰**ï¼šå¦‚æœåœ¨ GUI ä¸­å¯ç”¨äº†"å›ºå®šè´¦å·æ¨¡å¼"ï¼ˆè¿è¡Œæ—¶è®¾ç½®ï¼‰ï¼Œä¸”è¯¥è´¦å·æ²¡è¢«é™æµã€ä¹Ÿæ²¡è¢«é…é¢ä¿æŠ¤ï¼Œå°±ç›´æ¥ç”¨å®ƒã€‚
2) **ç²˜æ€§ä¼šè¯ï¼ˆSession Bindingï¼‰**ï¼šå¦‚æœæœ‰ `session_id` ä¸”è°ƒåº¦æ¨¡å¼ä¸æ˜¯ `PerformanceFirst`ï¼Œä¼šä¼˜å…ˆå¤ç”¨è¯¥ session ç»‘å®šçš„è´¦å·ã€‚
3) **60s å…¨å±€çª—å£å¤ç”¨**ï¼šå¦‚æœæ²¡ä¼  `session_id`ï¼ˆæˆ–è¿˜æ²¡ç»‘å®šæˆåŠŸï¼‰ï¼Œåœ¨é `PerformanceFirst` ä¸‹ä¼šå°½é‡åœ¨ 60 ç§’å†…å¤ç”¨"ä¸Šä¸€æ¬¡ç”¨è¿‡çš„è´¦å·"ã€‚
4) **è½®è¯¢ï¼ˆRound-robinï¼‰**ï¼šä»¥ä¸Šéƒ½ä¸é€‚ç”¨æ—¶ï¼ŒæŒ‰ä¸€ä¸ªå…¨å±€è‡ªå¢ç´¢å¼•è½®è¯¢é€‰æ‹©è´¦å·ã€‚

 æ­¤å¤–è¿˜æœ‰ä¸¤æ¡"éšå½¢è§„åˆ™"ï¼Œå¾ˆå½±å“ä½“æ„Ÿï¼š

 - **è´¦å·ä¼šå…ˆæ’åº**ï¼šULTRA > PRO > FREEï¼ŒåŒ tier å†…ä¼˜å…ˆå‰©ä½™é…é¢é«˜çš„è´¦å·ã€‚
- **å¤±è´¥æˆ–é™æµä¼šè¢«è·³è¿‡**ï¼šå·²å°è¯•å¤±è´¥çš„è´¦å·ä¼šè¿›å…¥ `attempted` é›†åˆï¼›è¢«é™æµæ ‡è®°çš„è´¦å·ä¼šè¢«è·³è¿‡ã€‚

### 3 ç§è°ƒåº¦æ¨¡å¼åˆ°åº•å·®åœ¨å“ª

 åœ¨é…ç½®é‡Œä½ ä¼šçœ‹åˆ°ï¼š`CacheFirst` / `Balance` / `PerformanceFirst`ã€‚

 ä»¥"åç«¯ TokenManager çœŸå®åˆ†æ”¯"ä¸ºå‡†ï¼Œå®ƒä»¬çš„å…³é”®å·®å¼‚åªæœ‰ä¸€ä¸ªï¼š**æ˜¯å¦å¯ç”¨ç²˜æ€§ä¼šè¯ + 60s çª—å£å¤ç”¨**ã€‚

 - `PerformanceFirst`ï¼šè·³è¿‡ç²˜æ€§ä¼šè¯ä¸ 60s çª—å£å¤ç”¨ï¼Œç›´æ¥èµ°è½®è¯¢ï¼ˆå¹¶ç»§ç»­è·³è¿‡é™æµ/é…é¢ä¿æŠ¤è´¦å·ï¼‰ã€‚
 - `CacheFirst` / `Balance`ï¼šéƒ½ä¼šå¯ç”¨ç²˜æ€§ä¼šè¯ä¸ 60s çª—å£å¤ç”¨ã€‚

 ::: warning å…³äº max_wait_seconds
 å‰ç«¯/é…ç½®ç»“æ„é‡Œæœ‰ `max_wait_seconds`ï¼Œå¹¶ä¸” UI åªåœ¨ `CacheFirst` ä¸‹å…è®¸è°ƒæ•´ã€‚ä½†ç›®å‰åç«¯è°ƒåº¦é€»è¾‘åªåŸºäº `mode` åˆ†æ”¯ï¼Œå¹¶æ²¡æœ‰è¯»å– `max_wait_seconds`ã€‚
 :::

### å¤±è´¥é‡è¯•ä¸"å¼ºåˆ¶è½®æ¢"æ€ä¹ˆè”åŠ¨

 åœ¨ OpenAI/Gemini/Claude çš„ handler é‡Œï¼Œéƒ½ä¼šç”¨ç±»ä¼¼ä¸‹é¢çš„æ¨¡å¼å¤„ç†é‡è¯•ï¼š

 - ç¬¬ 1 æ¬¡å°è¯•ï¼š`force_rotate = false`
 - ç¬¬ 2 æ¬¡åŠä»¥åï¼š`force_rotate = true`ï¼ˆ`attempt > 0`ï¼‰ï¼ŒTokenManager ä¼šè·³è¿‡ç²˜æ€§å¤ç”¨ï¼Œç›´æ¥æ‰¾ä¸‹ä¸€ä¸ªå¯ç”¨è´¦å·

 é‡åˆ° 429/529/503/500 ç­‰é”™è¯¯æ—¶ï¼š

 - handler ä¼šè°ƒç”¨ `token_manager.mark_rate_limited(...)` æŠŠè¿™ä¸ªè´¦å·è®°å½•ä¸º"é™æµ/è¿‡è½½"ï¼Œåç»­è°ƒåº¦ä¼šä¸»åŠ¨è·³è¿‡å®ƒã€‚
 - OpenAI å…¼å®¹è·¯å¾„è¿˜ä¼šå°è¯•ä»é”™è¯¯ JSON é‡Œè§£æ `RetryInfo.retryDelay` æˆ– `quotaResetDelay`ï¼Œç­‰å¾…ä¸€å°æ®µæ—¶é—´å†ç»§ç»­é‡è¯•ã€‚

## è·Ÿæˆ‘åšï¼šæŠŠè°ƒåº¦è°ƒåˆ°"å¯æ§"

### ç¬¬ 1 æ­¥ï¼šå…ˆç¡®è®¤ä½ çœŸçš„æœ‰"è´¦å·æ± "

**ä¸ºä»€ä¹ˆ**
è°ƒåº¦å†é«˜çº§ï¼Œæ± å­é‡Œåªæœ‰ 1 ä¸ªè´¦å·ä¹Ÿæ²¡å¾—é€‰ã€‚å¾ˆå¤š"è½®æ¢ä¸ç”Ÿæ•ˆ/ç²˜æ€§æ²¡æ„Ÿè§‰"çš„æ ¹å› éƒ½æ˜¯è´¦å·å¤ªå°‘ã€‚

**æ“ä½œ**
æ‰“å¼€ã€ŒAccountsã€é¡µé¢ï¼Œç¡®è®¤è‡³å°‘æœ‰ 2 ä¸ªè´¦å·å¤„äºå¯ç”¨çŠ¶æ€ï¼ˆä¸æ˜¯ disabled / proxy disabledï¼‰ã€‚

**ä½ åº”è¯¥çœ‹åˆ°**ï¼šè‡³å°‘ 2 ä¸ªè´¦å·èƒ½æ­£å¸¸åˆ·æ–°é…é¢ï¼Œå¹¶ä¸”åä»£å¯åŠ¨å `active_accounts` ä¸ä¸º 0ã€‚

### ç¬¬ 2 æ­¥ï¼šåœ¨ GUI é‡Œé€‰æ‹©è°ƒåº¦æ¨¡å¼

**ä¸ºä»€ä¹ˆ**
è°ƒåº¦æ¨¡å¼å†³å®šäº†"åŒä¸€æ®µå¯¹è¯"åˆ°åº•æ˜¯å°½é‡å¤ç”¨åŒä¸€è´¦å·ï¼Œè¿˜æ˜¯æ¯æ¬¡éƒ½è½®è¯¢ã€‚

**æ“ä½œ**
è¿›å…¥ã€ŒAPI Proxyã€é¡µé¢ï¼Œæ‰¾åˆ° "Account Scheduling & Rotation" å¡ç‰‡ï¼Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ¨¡å¼ï¼š

- `Balance`ï¼šæ¨èé»˜è®¤å€¼ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹æ›´ç¨³ï¼ˆä¼šè¯ç²˜æ€§ + å¤±è´¥æ—¶è½®æ¢ï¼‰ã€‚
- `PerformanceFirst`ï¼šå¹¶å‘é«˜ã€ä»»åŠ¡çŸ­ã€ä½ æ›´åœ¨æ„ååè€Œä¸æ˜¯ç¼“å­˜æ—¶é€‰å®ƒã€‚
- `CacheFirst`ï¼šå¦‚æœä½ å¸Œæœ›"å¯¹è¯å°½é‡å›ºå®šè´¦å·"ï¼Œå¯ä»¥é€‰å®ƒï¼ˆå½“å‰åç«¯ä¸ `Balance` çš„è¡Œä¸ºå·®å¼‚å¾ˆå°ï¼‰ã€‚

 å¦‚æœä½ è¦æ‰‹åŠ¨æ”¹é…ç½®ï¼Œå¯¹åº”ç‰‡æ®µæ˜¯ï¼š

```json
{
  "proxy": {
    "scheduling": {
      "mode": "Balance",
      "max_wait_seconds": 60
    }
  }
}
```

 **ä½ åº”è¯¥çœ‹åˆ°**ï¼šåˆ‡æ¢æ¨¡å¼åä¼šç«‹å³å†™å…¥ `gui_config.json`ï¼Œåä»£æœåŠ¡è¿è¡Œæ—¶ç›´æ¥ç”Ÿæ•ˆï¼ˆæ— éœ€é‡å¯ï¼‰ã€‚

### ç¬¬ 3 æ­¥ï¼šå¯ç”¨"å›ºå®šè´¦å·æ¨¡å¼"ï¼ˆæŠŠè½®æ¢å…³æ‰ï¼‰

**ä¸ºä»€ä¹ˆ**
æ’éšœã€ç°åº¦ã€æˆ–è€…ä½ æƒ³æŠŠæŸä¸ªè´¦å·"é’‰æ­»"ç»™æŸä¸ªå®¢æˆ·ç«¯ç”¨æ—¶ï¼Œå›ºå®šè´¦å·æ¨¡å¼æ˜¯æœ€ç›´æ¥çš„æ‰‹æ®µã€‚

**æ“ä½œ**
åœ¨åŒä¸€å¼ å¡ç‰‡é‡Œæ‰“å¼€ "Fixed Account Mode"ï¼Œç„¶ååœ¨ä¸‹æ‹‰æ¡†é‡Œé€‰æ‹©è´¦å·ã€‚

 åˆ«å¿˜äº†ï¼šè¿™ä¸ªå¼€å…³åªåœ¨åä»£æœåŠ¡ Running æ—¶å¯ç”¨ã€‚

 **ä½ åº”è¯¥çœ‹åˆ°**ï¼šåç»­è¯·æ±‚éƒ½ä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸ªè´¦å·ï¼›å¦‚æœå®ƒè¢«é™æµæˆ–è¢«é…é¢ä¿æŠ¤ï¼Œä¼šå›é€€åˆ°è½®è¯¢ã€‚

 ::: info å›ºå®šè´¦å·æ˜¯è¿è¡Œæ—¶è®¾ç½®
 å›ºå®šè´¦å·æ¨¡å¼æ˜¯**è¿è¡Œæ—¶çŠ¶æ€**ï¼ˆé€šè¿‡ GUI æˆ– API åŠ¨æ€è®¾ç½®ï¼‰ï¼Œä¸ä¼šæŒä¹…åŒ–åˆ° `gui_config.json`ã€‚é‡å¯åä»£æœåŠ¡åï¼Œå›ºå®šè´¦å·ä¼šæ¢å¤ä¸ºç©ºï¼ˆå›åˆ°è½®è¯¢æ¨¡å¼ï¼‰ã€‚
 :::

### ç¬¬ 4 æ­¥ï¼šéœ€è¦çš„æ—¶å€™æ¸…æ‰"ä¼šè¯ç»‘å®š"

**ä¸ºä»€ä¹ˆ**
ç²˜æ€§ä¼šè¯ä¼šæŠŠ `session_id -> account_id` è®°åœ¨å†…å­˜é‡Œã€‚å¦‚æœä½ åœ¨åŒä¸€å°æœºå™¨ä¸Šåšä¸åŒå®éªŒï¼ˆæ¯”å¦‚åˆ‡æ¢è´¦å·æ± ã€åˆ‡æ¢æ¨¡å¼ï¼‰ï¼Œæ—§ç»‘å®šå¯èƒ½ä¼šå¹²æ‰°ä½ è§‚å¯Ÿã€‚

**æ“ä½œ**
 åœ¨ "Account Scheduling & Rotation" å¡ç‰‡å³ä¸Šè§’ç‚¹ "Clear bindings"ã€‚

 **ä½ åº”è¯¥çœ‹åˆ°**ï¼šæ—§ä¼šè¯ä¼šé‡æ–°åˆ†é…è´¦å·ï¼ˆä¸‹ä¸€ä¸ªè¯·æ±‚ä¼šé‡æ–°ç»‘å®šï¼‰ã€‚

### ç¬¬ 5 æ­¥ï¼šç”¨å“åº”å¤´ç¡®è®¤"åˆ°åº•æ˜¯å“ªä¸ªè´¦å·åœ¨æœåŠ¡"

**ä¸ºä»€ä¹ˆ**
ä½ æƒ³éªŒè¯è°ƒåº¦æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæœ€é è°±çš„åŠæ³•æ˜¯æ‹¿åˆ°æœåŠ¡ç«¯è¿”å›çš„"å½“å‰è´¦å·æ ‡è¯†"ã€‚

**æ“ä½œ**
å¯¹ OpenAI å…¼å®¹ç«¯ç‚¹å‘ä¸€ä¸ªéæµå¼è¯·æ±‚ï¼Œç„¶åè§‚å¯Ÿå“åº”å¤´é‡Œçš„ `X-Account-Email`ã€‚

```bash
  # ä¾‹å­ï¼šæœ€å°åŒ–çš„ OpenAI Chat Completions è¯·æ±‚
  # æ³¨æ„ï¼šmodel å¿…é¡»æ˜¯ä½ å½“å‰é…ç½®é‡Œå¯ç”¨/å¯è·¯ç”±çš„æ¨¡å‹å
curl -i "http://127.0.0.1:8045/v1/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-REPLACE_ME" \
  -d '{
    "model": "gemini-3-pro-high",
    "stream": false,
    "messages": [{"role": "user", "content": "hello"}]
  }'
```

 **ä½ åº”è¯¥çœ‹åˆ°**ï¼šå“åº”å¤´é‡Œå‡ºç°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹ï¼ˆç¤ºä¾‹ï¼‰ï¼š

 ```text
 X-Account-Email: example@gmail.com
 X-Mapped-Model: gemini-3-pro-high
 ```

## æ£€æŸ¥ç‚¹ âœ…

 - ä½ èƒ½è¯´æ¸…æ¥š `fixed account`ã€`sticky session`ã€`round-robin` ä¸‰ä¸ªæœºåˆ¶è°è¦†ç›–è°
 - ä½ çŸ¥é“ `session_id` æ˜¯æ€ä¹ˆæ¥çš„ï¼ˆä¼˜å…ˆ `metadata.user_id`ï¼Œå¦åˆ™å“ˆå¸Œé¦–æ¡ user æ¶ˆæ¯ï¼‰
 - ä½ é‡åˆ° 429/5xx æ—¶èƒ½é¢„æœŸï¼šç³»ç»Ÿä¼šå…ˆè®°å½•é™æµï¼Œå†æ¢è´¦å·é‡è¯•
 - ä½ èƒ½ç”¨ `X-Account-Email` éªŒè¯å½“å‰è¯·æ±‚åˆ°åº•æ˜¯å“ªä¸ªè´¦å·åœ¨æœåŠ¡

## è¸©å‘æé†’

1) **è´¦å·æ± åªæœ‰ 1 ä¸ªæ—¶ï¼Œä¸è¦æœŸå¾…"è½®æ¢èƒ½æ•‘ä½ "**
è½®æ¢åªæ˜¯"æ¢å¦ä¸€ä¸ªè´¦å·"ï¼Œæ± å­é‡Œæ²¡ç¬¬äºŒä¸ªè´¦å·æ—¶ï¼Œ429/invalid_grant åªä¼šæ›´é¢‘ç¹æš´éœ²ã€‚

2) **`CacheFirst` ä¸æ˜¯"æ°¸è¿œç­‰åˆ°å¯ç”¨"**
å½“å‰åç«¯è°ƒåº¦é€»è¾‘é‡åˆ°é™æµä¼šå€¾å‘äºè§£ç»‘å¹¶åˆ‡æ¢è´¦å·ï¼Œè€Œä¸æ˜¯é•¿æœŸé˜»å¡ç­‰å¾…ã€‚

3) **å›ºå®šè´¦å·ä¸æ˜¯ç»å¯¹å¼ºåˆ¶**
å¦‚æœå›ºå®šè´¦å·è¢«æ ‡è®°ä¸ºé™æµã€æˆ–è¢«é…é¢ä¿æŠ¤å‘½ä¸­ï¼Œç³»ç»Ÿä¼šå›é€€åˆ°è½®è¯¢ã€‚

## æœ¬è¯¾å°ç»“

 - è°ƒåº¦é“¾è·¯ï¼šhandler æå– `session_id` â†’ `TokenManager::get_token` é€‰è´¦å· â†’ å‡ºé”™æ—¶ `attempt > 0` å¼ºåˆ¶è½®æ¢
 - ä½ æœ€å¸¸ç”¨çš„ä¸¤ä¸ªå¼€å…³ï¼šè°ƒåº¦æ¨¡å¼ï¼ˆæ˜¯å¦å¯ç”¨ç²˜æ€§/60s å¤ç”¨ï¼‰+ å›ºå®šè´¦å·æ¨¡å¼ï¼ˆç›´æ¥æŒ‡å®šè´¦å·ï¼‰
 - 429/5xx ä¼šè¢«è®°å½•æˆ"é™æµçŠ¶æ€"ï¼Œåç»­è°ƒåº¦ä¼šè·³è¿‡è¯¥è´¦å·ï¼Œç›´åˆ°é”å®šæ—¶é—´è¿‡æœŸ

## ä¸‹ä¸€è¯¾é¢„å‘Š

> ä¸‹ä¸€è¯¾æˆ‘ä»¬çœ‹ **æ¨¡å‹è·¯ç”±**ï¼šå½“ä½ å¸Œæœ›å¯¹å¤–æš´éœ²"ç¨³å®šçš„æ¨¡å‹é›†åˆ"ï¼Œä»¥åŠæƒ³åšé€šé…ç¬¦/é¢„è®¾ç­–ç•¥æ—¶ï¼Œè¯¥æ€ä¹ˆé…ç½®ä¸æ’æŸ¥ã€‚

---

## é™„å½•ï¼šæºç å‚è€ƒ

<details>
<summary><strong>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æºç ä½ç½®</strong></summary>

> æ›´æ–°æ—¶é—´ï¼š2026-01-23

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œå· |
|--- | --- | ---|
| è°ƒåº¦æ¨¡å¼ä¸é…ç½®ç»“æ„ï¼ˆStickySessionConfigï¼‰ | [`src-tauri/src/proxy/sticky_config.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/sticky_config.rs#L1-L36) | 1-36 |
| ä¼šè¯æŒ‡çº¹ç”Ÿæˆï¼ˆClaude/OpenAI/Geminiï¼‰ | [`src-tauri/src/proxy/session_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/session_manager.rs#L1-L159) | 1-159 |
| TokenManagerï¼šå›ºå®šè´¦å·æ¨¡å¼å­—æ®µä¸åˆå§‹åŒ– | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L27-L50) | 27-50 |
| TokenManagerï¼šé€‰è´¦å·æ ¸å¿ƒé€»è¾‘ï¼ˆå›ºå®šè´¦å·/ç²˜æ€§ä¼šè¯/60s çª—å£/è½®è¯¢/é…é¢ä¿æŠ¤ï¼‰ | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L470-L940) | 470-940 |
| TokenManagerï¼šinvalid_grant è‡ªåŠ¨ç¦ç”¨å¹¶ç§»å‡ºæ±  | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L868-L878) | 868-878 |
| TokenManagerï¼šé™æµè®°å½•ä¸æˆåŠŸæ¸…ç† API | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L1087-L1147) | 1087-1147 |
| TokenManagerï¼šæ›´æ–°è°ƒåº¦é…ç½® / æ¸…ç†ä¼šè¯ç»‘å®š / å›ºå®šè´¦å·æ¨¡å¼ setter | [`src-tauri/src/proxy/token_manager.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/token_manager.rs#L1419-L1461) | 1419-1461 |
| ProxyConfigï¼šscheduling å­—æ®µå®šä¹‰ä¸é»˜è®¤å€¼ | [`src-tauri/src/proxy/config.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/config.rs#L174-L257) | 174-257 |
| åä»£å¯åŠ¨æ—¶åŒæ­¥ scheduling é…ç½® | [`src-tauri/src/commands/proxy.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/commands/proxy.rs#L70-L100) | 70-100 |
| è°ƒåº¦ç›¸å…³çš„ Tauri å‘½ä»¤ï¼ˆget/update/clear bindings/fixed accountï¼‰ | [`src-tauri/src/commands/proxy.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/commands/proxy.rs#L478-L551) | 478-551 |
| OpenAI handlerï¼šsession_id + é‡è¯•æ—¶å¼ºåˆ¶è½®æ¢ | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L160-L182) | 160-182 |
| OpenAI handlerï¼š429/5xx è®°å½•é™æµ + è§£æ retry delay | [`src-tauri/src/proxy/handlers/openai.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/openai.rs#L349-L367) | 349-367 |
| Gemini handlerï¼šsession_id + é‡è¯•æ—¶å¼ºåˆ¶è½®æ¢ | [`src-tauri/src/proxy/handlers/gemini.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/gemini.rs#L62-L88) | 62-88 |
| Gemini handlerï¼š429/5xx è®°å½•é™æµå¹¶è½®æ¢ | [`src-tauri/src/proxy/handlers/gemini.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/gemini.rs#L279-L299) | 279-299 |
| Claude handlerï¼šæå– session_id å¹¶ä¼ ç»™ TokenManager | [`src-tauri/src/proxy/handlers/claude.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/handlers/claude.rs#L517-L524) | 517-524 |
| 429 retry delay è§£æï¼ˆRetryInfo.retryDelay / quotaResetDelayï¼‰ | [`src-tauri/src/proxy/upstream/retry.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/upstream/retry.rs#L37-L66) | 37-66 |
| é™æµåŸå› è¯†åˆ«ä¸æŒ‡æ•°é€€é¿ï¼ˆRateLimitTrackerï¼‰ | [`src-tauri/src/proxy/rate_limit.rs`](https://github.com/lbjlaq/Antigravity-Manager/blob/main/src-tauri/src/proxy/rate_limit.rs#L154-L279) | 154-279 |

**å…³é”®ç»“æ„ä½“**ï¼š
- `StickySessionConfig`ï¼šè°ƒåº¦æ¨¡å¼ä¸é…ç½®ç»“æ„ï¼ˆ`mode`, `max_wait_seconds`ï¼‰
- `TokenManager`ï¼šè´¦å·æ± ã€ä¼šè¯ç»‘å®šã€å›ºå®šè´¦å·æ¨¡å¼ã€é™æµè·Ÿè¸ªå™¨
- `SessionManager`ï¼šä»è¯·æ±‚ä¸­æå– `session_id`

</details>
