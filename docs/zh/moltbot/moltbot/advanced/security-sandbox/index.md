---
title: "å®‰å…¨ä¸æ²™ç®±éš”ç¦»ï¼šé™åˆ¶ AI åŠ©æ‰‹çš„æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œè®¿é—® | Clawdbot æ•™ç¨‹"
sidebarTitle: "é™åˆ¶ AI è®¿é—®èŒƒå›´"
subtitle: "å®‰å…¨ä¸æ²™ç®±éš”ç¦»ï¼šé™åˆ¶ AI åŠ©æ‰‹çš„æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œè®¿é—® | Clawdbot æ•™ç¨‹"
description: "å­¦ä¹ å¦‚ä½•é…ç½® Clawdbot çš„å®‰å…¨æ¨¡å‹ã€å·¥å…·æƒé™æ§åˆ¶ã€æ²™ç®±éš”ç¦»ï¼Œä¿æŠ¤ä½ çš„ AI åŠ©æ‰‹å…å—æ”»å‡»ã€‚é€šè¿‡è®¿é—®æ§åˆ¶ã€æƒé™é™åˆ¶å’Œå®¹å™¨éš”ç¦»ï¼Œåœ¨äº«å—å¼ºå¤§ AI èƒ½åŠ›çš„åŒæ—¶æœ€å°åŒ–å®‰å…¨é£é™©ã€‚"
tags:
  - "security"
  - "sandbox"
  - "permissions"
prerequisite:
  - "start-gateway-startup"
order: 290
---

# å®‰å…¨ä¸æ²™ç®±éš”ç¦»ï¼šä¿æŠ¤ä½ çš„ AI åŠ©æ‰‹

## å­¦å®Œä½ èƒ½åšä»€ä¹ˆ

- é…ç½®å¤šå±‚å®‰å…¨ç­–ç•¥ï¼Œä»è®¿é—®æ§åˆ¶åˆ°å·¥å…·æƒé™
- ä½¿ç”¨æ²™ç®±éš”ç¦»é™åˆ¶ AI åŠ©æ‰‹çš„æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œè®¿é—®
- è¿è¡Œå®‰å…¨å®¡è®¡ï¼Œå‘ç°å¹¶ä¿®å¤å¸¸è§çš„å®‰å…¨éšæ‚£
- æ ¹æ®ä¸åŒåœºæ™¯ï¼ˆä¸ªäºº/å®¶åº­/å…¬å¼€ï¼‰è°ƒæ•´å®‰å…¨ç­‰çº§

## ä½ ç°åœ¨çš„å›°å¢ƒ

Clawdbot è®©ä½ çš„ AI åŠ©æ‰‹å˜å¾—å¼ºå¤§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ–°çš„å®‰å…¨æŒ‘æˆ˜ï¼š

- **Shell è®¿é—®**ï¼šAI å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œè¯»å†™æ–‡ä»¶
- **ç½‘ç»œè®¿é—®**ï¼šAI å¯ä»¥è®¿é—®ä»»æ„ URL å’ŒæœåŠ¡
- **æ¶ˆæ¯å‘é€**ï¼šAI å¯ä»¥å‘ä»»ä½•äººå‘é€æ¶ˆæ¯ï¼ˆå¦‚é…ç½®äº† WhatsAppï¼‰
- **è¿œç¨‹æ§åˆ¶**ï¼šé€šè¿‡æµè§ˆå™¨å·¥å…·æ§åˆ¶æœ¬åœ°æµè§ˆå™¨
- **æ•°æ®æš´éœ²**ï¼šæ‰€æœ‰å¯¹è¯å†å²å­˜å‚¨åœ¨ç£ç›˜ä¸Š

æ²¡æœ‰é€‚å½“çš„é˜²æŠ¤ï¼Œä¸€ä¸ªè¢«æ“çºµçš„ AI æ¨¡å‹å¯èƒ½å¯¼è‡´ç¾éš¾æ€§çš„åæœã€‚

## ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸€æ‹›

- âœ… ä½ éœ€è¦è¿è¡Œ AI åŠ©æ‰‹åœ¨è‡ªæœ‰è®¾å¤‡ä¸Šï¼Œæ‹…å¿ƒå®‰å…¨é£é™©
- âœ… ä½ æƒ³å°† AI åŠ©æ‰‹æš´éœ²ç»™å¤šäººä½¿ç”¨ï¼ˆå®¶åº­æˆå‘˜ã€å›¢é˜Ÿï¼‰
- âœ… ä½ éœ€è¦é™åˆ¶ AI è®¿é—®ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•
- âœ… ä½ å¸Œæœ›éš”ç¦»ä¸åŒç”¨æˆ·/ä¼šè¯çš„è®¿é—®èŒƒå›´
- âœ… ä½ éœ€è¦è®© AI åŠ©æ‰‹åœ¨å—é™ç¯å¢ƒä¸­è¿è¡Œï¼ˆæ²™ç®±ï¼‰

::: info
**é‡è¦æ¦‚å¿µ**ï¼šå®‰å…¨æ˜¯åˆ†å±‚çš„ï¼Œä»"è°èƒ½è®¿é—®"åˆ°"èƒ½åšä»€ä¹ˆ"ï¼Œæœ€åæ‰æ˜¯"æ¨¡å‹å®‰å…¨"ã€‚
::

## ğŸ’ å¼€å§‹å‰çš„å‡†å¤‡

### å‰ç½®æ£€æŸ¥

- [x] å·²å®Œæˆ[å¿«é€Ÿå¼€å§‹](../../start/getting-started/)ï¼Œäº†è§£å¦‚ä½•å¯åŠ¨ Gateway
- [ ] å·²é…ç½®è‡³å°‘ä¸€ä¸ª AI æ¨¡å‹ï¼ˆAnthropicã€OpenAI æˆ– Ollamaï¼‰
- [ ] äº†è§£ä½ çš„ä½¿ç”¨åœºæ™¯ï¼ˆä¸ªäººä½¿ç”¨ã€å®¶åº­å…±äº«ã€å…¬å¼€æœåŠ¡ï¼‰
- [ ] äº†è§£ Linux æ–‡ä»¶æƒé™æ¦‚å¿µï¼ˆchmodï¼‰

### æ¨èå·¥å…·

- å‘½ä»¤è¡Œå·¥å…·ï¼šTerminal æˆ– SSH
- ç¼–è¾‘å™¨ï¼šä½ å–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨
- Dockerï¼šç”¨äºè¿è¡Œæ²™ç®±å®¹å™¨ï¼ˆå¯é€‰ï¼‰

---

## æ ¸å¿ƒæ€è·¯

Clawdbot çš„å®‰å…¨æ¨¡å‹åŸºäºä¸€ä¸ªæ ¸å¿ƒå“²å­¦ï¼š**è®¿é—®æ§åˆ¶ä¼˜å…ˆï¼Œé™åˆ¶åç½®å®‰å…¨**ã€‚

### å®‰å…¨åˆ†å±‚

```mermaid
graph TB
    A[è®¿é—®æ§åˆ¶] --> B[æƒé™æ§åˆ¶]
    B --> C[å·¥å…·é™åˆ¶]
    C --> D[æ²™ç®±éš”ç¦»]
    D --> E[å®¡è®¡ä¸ä¿®å¤]
```

1. **è®¿é—®æ§åˆ¶**ï¼šå†³å®šè°èƒ½ä¸ä½ çš„ AI åŠ©æ‰‹å¯¹è¯
2. **æƒé™æ§åˆ¶**ï¼šå†³å®š AI åŠ©æ‰‹èƒ½è°ƒç”¨å“ªäº›å·¥å…·
3. **æ²™ç®±éš”ç¦»**ï¼šå†³å®šå·¥å…·è¿è¡Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸­ï¼ˆä¸»æœºæˆ–å®¹å™¨ï¼‰
4. **å®¡è®¡ä¸ä¿®å¤**ï¼šæŒç»­æ£€æŸ¥å’Œä¿®å¤å®‰å…¨é…ç½®

è¿™ä¸ªåˆ†å±‚è®¾è®¡ç¡®ä¿å³ä½¿æ¨¡å‹è¢«æ“çºµï¼Œæ”»å‡»èŒƒå›´ä¹Ÿè¢«é™åˆ¶åœ¨å·²å®šä¹‰çš„è¾¹ç•Œå†…ã€‚

### è®¿é—®æ§åˆ¶çš„ä¸‰å±‚ä¿æŠ¤

Clawdbot æä¾›ä¸‰å±‚è®¿é—®æ§åˆ¶ï¼š

| å±‚çº§ | ä¿æŠ¤å†…å®¹ | é…ç½®ä½ç½® |
|--- | --- | ---|
| **Gateway è®¤è¯** | WebSocket è¿æ¥ | `gateway.auth` |
| **DM ç­–ç•¥** | ç§èŠæ¶ˆæ¯ | `channels.*.dmPolicy` |
| **Group ç­–ç•¥** | ç¾¤ç»„æ¶ˆæ¯ | `channels.*.groupPolicy` / `channels.*.groups` |

æ¯ä¸€å±‚éƒ½å¯ä»¥ç‹¬ç«‹é…ç½®ï¼Œå½¢æˆçºµæ·±é˜²å¾¡ã€‚

---

## å®‰å…¨å®¡è®¡ï¼šå‘ç°é£é™©

Clawdbot æä¾›å†…ç½®çš„å®‰å…¨å®¡è®¡å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿå‘ç°å¸¸è§çš„å®‰å…¨éšæ‚£ã€‚

### è¿è¡Œå®¡è®¡

```bash
# åŸºç¡€å®¡è®¡
clawdbot security audit

# æ·±åº¦å®¡è®¡ï¼ˆåŒ…æ‹¬ Gateway æ¢æµ‹ï¼‰
clawdbot security audit --deep

# è‡ªåŠ¨ä¿®å¤å®‰å…¨å»ºè®®
clawdbot security audit --fix
```

### å®¡è®¡æ£€æŸ¥çš„å†…å®¹

å®¡è®¡å·¥å…·ä¼šæ£€æŸ¥ä»¥ä¸‹æ–¹é¢ï¼š

| æ£€æŸ¥ç±»åˆ« | å…·ä½“é¡¹ç›® | é£é™©ç­‰çº§ |
|--- | --- | ---|
| **å…¥ç«™è®¿é—®** | Gateway è®¤è¯ã€DM ç­–ç•¥ã€Group ç­–ç•¥ | Critical / Warn |
| **å·¥å…·è®¿é—®** | Elevated exec å…è®¸åˆ—è¡¨ã€å·¥å…· allow/deny | Critical / Warn |
| **ç½‘ç»œæš´éœ²** | Gateway ç»‘å®šæ¨¡å¼ã€Tailscale Serve/Funnel | Critical / Info |
| **æµè§ˆå™¨æ§åˆ¶** | è¿œç¨‹æµè§ˆå™¨æ§åˆ¶è®¤è¯ã€URL åè®® | Critical / Warn |
| **æ–‡ä»¶æƒé™** | é…ç½®æ–‡ä»¶æƒé™ã€çŠ¶æ€ç›®å½•æƒé™ | Critical / Warn |
| **æ’ä»¶ä¿¡ä»»** | æœªæ˜¾å¼å…è®¸çš„æ’ä»¶ | Warn |

### ç†è§£å®¡è®¡è¾“å‡º

å®¡è®¡æŠ¥å‘Šä¼šæŒ‰ä¸¥é‡çº§åˆ«åˆ†ç±»ï¼š

- **Criticalï¼ˆçº¢è‰²ï¼‰**ï¼šç«‹å³ä¿®å¤ï¼Œå¯èƒ½å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œæˆ–æ•°æ®æ³„éœ²
- **Warnï¼ˆé»„è‰²ï¼‰**ï¼šå»ºè®®ä¿®å¤ï¼Œé™ä½å®‰å…¨è¾¹ç•Œ
- **Infoï¼ˆè“è‰²ï¼‰**ï¼šä¿¡æ¯æç¤ºï¼Œéå®‰å…¨é—®é¢˜

### è‡ªåŠ¨ä¿®å¤

ä½¿ç”¨ `--fix` æ ‡å¿—æ—¶ï¼Œå®¡è®¡å·¥å…·ä¼šå®‰å…¨åœ°åº”ç”¨ä»¥ä¸‹ä¿®å¤ï¼š

- å°† `groupPolicy="open"` æ”¹ä¸º `allowlist`
- å°† `logging.redactSensitive="off"` æ”¹ä¸º `"tools"`
- ä¿®å¤æ–‡ä»¶æƒé™ï¼ˆé…ç½®æ–‡ä»¶ 600ï¼Œç›®å½• 700ï¼‰

::: tip
**æœ€ä½³å®è·µ**ï¼šå®šæœŸè¿è¡Œå®¡è®¡ï¼Œå°¤å…¶æ˜¯åœ¨æ›´æ”¹é…ç½®æˆ–æ›´æ–° Gateway åã€‚
::

---

## è®¿é—®æ§åˆ¶ï¼šè°èƒ½è®¿é—®ä½ çš„ AI åŠ©æ‰‹

è®¿é—®æ§åˆ¶æ˜¯ç¬¬ä¸€é“é˜²çº¿ï¼Œå†³å®šè°èƒ½ä¸ä½ çš„ AI åŠ©æ‰‹äº¤äº’ã€‚

### Gateway è®¤è¯

é»˜è®¤æƒ…å†µä¸‹ï¼ŒGateway éœ€è¦è®¤è¯æ‰èƒ½æ¥å— WebSocket è¿æ¥ã€‚

#### é…ç½®è®¤è¯æ–¹å¼

```json5
{
  "gateway": {
    "auth": {
      "mode": "token",  // æˆ– "password"
      "token": "your-long-random-token-please-change-me"
    }
  }
}
```

**è®¤è¯æ¨¡å¼**ï¼š

| æ¨¡å¼ | ç”¨é€” | æ¨èåœºæ™¯ |
|--- | --- | ---|
| `token` | å…±äº« bearer token | å¤§å¤šæ•°æƒ…å†µï¼Œæ¨è |
| `password` | å¯†ç è®¤è¯ | æœ¬åœ°å¼€å‘ï¼Œæ–¹ä¾¿å¿«é€Ÿæµ‹è¯• |
| Tailscale Identity | Tailscale Serve | è¿œç¨‹è®¿é—®é€šè¿‡ Tailscale |

::: warning
**é‡è¦**ï¼šå¦‚æœ `gateway.bind` è®¾ç½®ä¸ºé loopbackï¼ˆå¦‚ `lan`ã€`tailnet`ï¼‰ï¼Œå¿…é¡»é…ç½®è®¤è¯ï¼Œå¦åˆ™æ‹’ç»è¿æ¥ã€‚
::

### DM ç­–ç•¥ï¼šç§èŠä¿æŠ¤

DM ç­–ç•¥æ§åˆ¶é™Œç”Ÿç”¨æˆ·æ˜¯å¦èƒ½ç›´æ¥ä¸ä½ çš„ AI åŠ©æ‰‹å¯¹è¯ã€‚

| ç­–ç•¥ | è¡Œä¸º | æ¨èåœºæ™¯ |
|--- | --- | ---|
| `pairing`ï¼ˆé»˜è®¤ï¼‰ | æœªçŸ¥å‘é€è€…æ”¶åˆ°é…å¯¹ä»£ç ï¼Œé…å¯¹å‰ä¸å¤„ç† | ä¸ªäººä½¿ç”¨ï¼Œæ¨è |
| `allowlist` | æœªçŸ¥å‘é€è€…è¢«æ‹’ç» | å¤šäººå¯ä¿¡ç¯å¢ƒ |
| `open` | å…è®¸ä»»ä½•äºº | å…¬å¼€æœåŠ¡ï¼ˆéœ€ `allowFrom` åŒ…å« `"*"`ï¼‰ |
| `disabled` | å¿½ç•¥æ‰€æœ‰ç§èŠ | ä»…ä½¿ç”¨ç¾¤ç»„åŠŸèƒ½ |

#### é…ç½®ç¤ºä¾‹

```json5
{
  "channels": {
    "whatsapp": {
      "dmPolicy": "pairing"
    },
    "telegram": {
      "dmPolicy": "allowlist",
      "allowFrom": ["user123", "user456"]
    }
  }
}
```

#### ç®¡ç†é…å¯¹

```bash
# æŸ¥çœ‹å¾…æ‰¹å‡†çš„é…å¯¹è¯·æ±‚
clawdbot pairing list whatsapp

# æ‰¹å‡†é…å¯¹
clawdbot pairing approve whatsapp <é…å¯¹ä»£ç >
```

::: tip
**æœ€ä½³å®è·µ**ï¼šé»˜è®¤ `pairing` æ¨¡å¼æä¾›äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå®‰å…¨æ€§å¹³è¡¡ã€‚ä»…åœ¨ä½ æ˜ç¡®ä¿¡ä»»æ‰€æœ‰ç”¨æˆ·æ—¶æ‰ä½¿ç”¨ `allowlist` æˆ– `open`ã€‚
::

### Group ç­–ç•¥ï¼šç¾¤ç»„æ¶ˆæ¯æ§åˆ¶

Group ç­–ç•¥å†³å®š AI åŠ©æ‰‹å¦‚ä½•åœ¨ç¾¤ç»„ä¸­å“åº”æ¶ˆæ¯ã€‚

| ç­–ç•¥ | è¡Œä¸º | é…ç½®ä½ç½® |
|--- | --- | ---|
| `allowlist` | ä»…æ¥å—ç™½åå•ä¸­çš„ç¾¤ç»„ | `channels.whatsapp.groups` |
| `disabled` | å¿½ç•¥æ‰€æœ‰ç¾¤ç»„æ¶ˆæ¯ | `channels.telegram.groups` |
| `requireMention` | ä»…åœ¨è¢« @ æåŠæˆ–å‘½ä»¤è§¦å‘æ—¶å“åº” | `channels.*.groups.*` |

#### é…ç½®ç¤ºä¾‹

```json5
{
  "channels": {
    "whatsapp": {
      "groups": {
        "*": {
          "requireMention": true
        }
      }
    },
    "discord": {
      "guilds": {
        "your-guild-id": {
          "users": ["user1", "user2"]
        }
      }
    }
  }
}
```

::: tip
**æœ€ä½³å®è·µ**ï¼šåœ¨å…¬å…±ç¾¤ç»„ä¸­å¯ç”¨ `requireMention`ï¼Œé¿å… AI åŠ©æ‰‹è¢«æ¶æ„ç”¨æˆ·æ“æ§ã€‚
::

### ä¼šè¯éš”ç¦»ï¼šé˜²æ­¢ä¸Šä¸‹æ–‡æ³„éœ²

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç§èŠæ¶ˆæ¯éƒ½è·¯ç”±åˆ°åŒä¸€ä¸ªä¸»ä¼šè¯ã€‚å½“å¤šä¸ªç”¨æˆ·å¯ä»¥è®¿é—® AI åŠ©æ‰‹æ—¶ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸Šä¸‹æ–‡æ³„éœ²ã€‚

```json5
{
  "session": {
    "dmScope": "per-channel-peer"  // ä¸ºæ¯ä¸ªæ¸ é“-å‘é€è€…åˆ›å»ºç‹¬ç«‹ä¼šè¯
  }
}
```

---

## å·¥å…·æƒé™æ§åˆ¶ï¼šé™åˆ¶ AI èƒ½åšä»€ä¹ˆ

å·¥å…·æƒé™æ§åˆ¶æ˜¯ç¬¬äºŒé“é˜²çº¿ï¼Œå†³å®š AI åŠ©æ‰‹èƒ½è°ƒç”¨å“ªäº›å·¥å…·ã€‚

### å·¥å…· Allow/Deny åˆ—è¡¨

ä½ å¯ä»¥å…¨å±€æˆ–æ¯ä¸ª Agent é…ç½®å·¥å…·çš„ç™½åå•å’Œé»‘åå•ã€‚

```json5
{
  "agents": {
    "defaults": {
      "tools": {
        "allow": ["read", "write", "web_search"],
        "deny": ["exec", "browser", "web_fetch"]
      }
    },
    "list": [
      {
        "id": "read-only",
        "tools": {
          "allow": ["read"],
          "deny": ["write", "edit", "apply_patch", "exec", "browser"]
        }
      }
    ]
  }
}
```

### å¸¸ç”¨å·¥å…·åˆ†ç±»

| å·¥å…·ç±»åˆ« | å…·ä½“å·¥å…· | é£é™©ç­‰çº§ |
|--- | --- | ---|
| **æ–‡ä»¶æ“ä½œ** | `read`ã€`write`ã€`edit`ã€`apply_patch` | ä¸­ç­‰ |
| **Shell æ‰§è¡Œ** | `exec`ã€`process` | é«˜ |
| **æµè§ˆå™¨æ§åˆ¶** | `browser` | é«˜ |
| **ç½‘ç»œè®¿é—®** | `web_search`ã€`web_fetch` | ä¸­ç­‰ |
| **Canvas å¯è§†åŒ–** | `canvas` | ä¸­ç­‰ |
| **èŠ‚ç‚¹æ“ä½œ** | `nodes_invoke` | é«˜ |
| **Cron å®šæ—¶ä»»åŠ¡** | `cron` | ä¸­ç­‰ |
| **æ¶ˆæ¯å‘é€** | `message`ã€`sessions_*` | ä½ |

### Elevated æ¨¡å¼ï¼šä¸»æœºæ‰§è¡Œçš„é€ƒç”Ÿå£

Elevated exec æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é€ƒç”Ÿå£ï¼Œå…è®¸å·¥å…·åœ¨ä¸»æœºä¸Šè¿è¡Œï¼Œç»•è¿‡æ²™ç®±ã€‚

```json5
{
  "tools": {
    "elevated": {
      "enabled": true,
      "allowFrom": {
        "whatsapp": ["your-trusted-user-id"]
      },
      "security": "allowlist",
      "ask": "on"  // æ¯æ¬¡æ‰§è¡Œå‰è¯¢é—®ç¡®è®¤
    }
  }
}
```

::: danger
**é‡è¦è­¦å‘Š**ï¼šElevated exec ç»•è¿‡æ²™ç®±é™åˆ¶ã€‚ä»…åœ¨ä½ å®Œå…¨ä¿¡ä»»å…è®¸çš„ç”¨æˆ·å’Œåœºæ™¯æ—¶å¯ç”¨ã€‚
::

::: tip
**æœ€ä½³å®è·µ**ï¼šå¯¹äºå¤§å¤šæ•°åœºæ™¯ï¼Œç¦ç”¨ elevated execï¼Œä¾èµ–æ²™ç®±éš”ç¦»å’Œä¸¥æ ¼çš„å·¥å…·ç™½åå•ã€‚
::

---

## æ²™ç®±éš”ç¦»ï¼šè¿è¡Œåœ¨å—é™ç¯å¢ƒä¸­

æ²™ç®±éš”ç¦»è®©å·¥å…·è¿è¡Œåœ¨ Docker å®¹å™¨ä¸­ï¼Œé™åˆ¶æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œè®¿é—®ã€‚

### æ²™ç®±æ¨¡å¼

| æ¨¡å¼ | è¡Œä¸º | æ¨èåœºæ™¯ |
|--- | --- | ---|
| `off` | æ‰€æœ‰å·¥å…·åœ¨ä¸»æœºä¸Šè¿è¡Œ | ä¸ªäººå¯ä¿¡ç¯å¢ƒ |
| `non-main`ï¼ˆæ¨èï¼‰ | ä¸»ä¼šè¯åœ¨ä¸»æœºï¼Œå…¶ä»–ä¼šè¯åœ¨æ²™ç®± | å¹³è¡¡æ€§èƒ½å’Œå®‰å…¨ |
| `all` | æ‰€æœ‰ä¼šè¯åœ¨æ²™ç®± | å¤šäººç¯å¢ƒã€å…¬å¼€æœåŠ¡ |

```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "mode": "non-main"
      }
    }
  }
}
```

### å·¥ä½œåŒºè®¿é—®

å·¥ä½œåŒºè®¿é—®å†³å®šæ²™ç®±å®¹å™¨èƒ½çœ‹åˆ°ä¸»æœºçš„å“ªäº›ç›®å½•ã€‚

| è®¿é—®çº§åˆ« | è¡Œä¸º | æ¨èåœºæ™¯ |
|--- | --- | ---|
| `none`ï¼ˆé»˜è®¤ï¼‰ | æ²™ç®±å·¥ä½œåŒº `~/.clawdbot/sandboxes` | æœ€å¤§éš”ç¦» |
| `ro` | ä»£ç†å·¥ä½œåŒºåªè¯»æŒ‚è½½åœ¨ `/agent` | è¯»å–ä½†ä¸å†™å…¥æ–‡ä»¶ |
| `rw` | ä»£ç†å·¥ä½œåŒºè¯»å†™æŒ‚è½½åœ¨ `/workspace` | éœ€è¦å†™å…¥æ–‡ä»¶çš„ Agent |

```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "workspaceAccess": "none"
      }
    }
  }
}
```

### æ²™ç®±èŒƒå›´

æ²™ç®±èŒƒå›´å†³å®šå®¹å™¨éš”ç¦»ç²’åº¦ã€‚

| èŒƒå›´ | è¡Œä¸º | å®¹å™¨æ•°é‡ |
|--- | --- | ---|
| `session`ï¼ˆé»˜è®¤ï¼‰ | æ¯ä¸ªä¼šè¯ä¸€ä¸ªå®¹å™¨ | è¾ƒå¤šå®¹å™¨ï¼Œæ›´å¥½éš”ç¦» |
| `agent` | æ¯ä¸ª Agent ä¸€ä¸ªå®¹å™¨ | å¹³è¡¡éš”ç¦»å’Œèµ„æº |
| `shared` | æ‰€æœ‰ä¼šè¯å…±äº«ä¸€ä¸ªå®¹å™¨ | èŠ‚çœèµ„æºï¼Œéš”ç¦»æ€§æœ€ä½ |

### Docker é…ç½®

```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "docker": {
          "image": "clawdbot-sandbox:bookworm-slim",
          "containerPrefix": "clawdbot-sbx-"
        }
      }
    }
}
```

### è‡ªå®šä¹‰æŒ‚è½½

ä½ å¯ä»¥å°†ä¸»æœºçš„é¢å¤–ç›®å½•æŒ‚è½½åˆ°æ²™ç®±å®¹å™¨ã€‚

```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "docker": {
          "binds": [
            "/home/user/source:/source:ro",
            "/var/run/docker.sock:/var/run/docker.sock"
          ]
        }
      }
    }
  }
}
```

::: warning
**å®‰å…¨æç¤º**ï¼šæŒ‚è½½ç»•è¿‡æ²™ç®±æ–‡ä»¶ç³»ç»Ÿéš”ç¦»ã€‚æ•æ„ŸæŒ‚è½½ï¼ˆå¦‚ docker.sockï¼‰åº”ä½¿ç”¨ `:ro`ï¼ˆåªè¯»ï¼‰æ¨¡å¼ã€‚
::

### æ²™ç®±åŒ–æµè§ˆå™¨

æ²™ç®±åŒ–æµè§ˆå™¨å°† Chrome å®ä¾‹è¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œéš”ç¦»æµè§ˆå™¨æ“ä½œã€‚

```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "browser": {
          "enabled": true,
          "autoStart": true,
          "autoStartTimeoutMs": 10000
        }
      }
    }
  }
}
```

::: tip
**æœ€ä½³å®è·µ**ï¼šæ²™ç®±åŒ–æµè§ˆå™¨å¯ä»¥é˜²æ­¢ AI åŠ©æ‰‹è®¿é—®ä½ æ—¥å¸¸æµè§ˆå™¨çš„ç™»å½•ä¼šè¯å’Œæ•æ„Ÿæ•°æ®ã€‚
::

---

## å¤š Agent å®‰å…¨é…ç½®

ä¸åŒ Agent å¯ä»¥æœ‰ä¸åŒçš„å®‰å…¨é…ç½®ã€‚

### åœºæ™¯ç¤ºä¾‹

#### åœºæ™¯ 1ï¼šä¸ªäºº Agentï¼ˆå®Œå…¨ä¿¡ä»»ï¼‰

```json5
{
  "agents": {
    "list": [
      {
        "id": "personal",
        "sandbox": { "mode": "off" },
        "tools": {
          "allow": ["*"],
          "deny": []
        }
      }
    ]
  }
}
```

#### åœºæ™¯ 2ï¼šå®¶åº­ Agentï¼ˆåªè¯»ï¼‰

```json5
{
  "agents": {
    "list": [
      {
        "id": "family",
        "workspace": "~/clawd-family",
        "sandbox": {
          "mode": "all",
          "scope": "agent",
          "workspaceAccess": "ro"
        },
        "tools": {
          "allow": ["read"],
          "deny": ["write", "edit", "apply_patch", "exec", "browser"]
        }
      }
    ]
  }
}
```

#### åœºæ™¯ 3ï¼šå…¬å¼€ Agentï¼ˆæ²™ç®± + ä¸¥æ ¼é™åˆ¶ï¼‰

```json5
{
  "agents": {
    "list": [
      {
        "id": "public",
        "workspace": "~/clawd-public",
        "sandbox": {
          "mode": "all",
          "scope": "agent",
          "workspaceAccess": "none"
        },
        "tools": {
          "allow": ["web_search", "sessions_list"],
          "deny": ["read", "write", "edit", "apply_patch", "exec", "browser", "web_fetch", "canvas", "nodes", "cron", "gateway", "image"]
        }
      }
    ]
  }
}
```

---

## Docker åŒ–ï¼šå®Œå…¨éš”ç¦» Gateway

é™¤äº†å·¥å…·çº§åˆ«çš„æ²™ç®±ï¼Œä½ è¿˜å¯ä»¥å°†æ•´ä¸ª Gateway è¿è¡Œåœ¨ Docker å®¹å™¨ä¸­ã€‚

### å®Œå…¨ Docker åŒ–çš„ä¼˜åŠ¿

- å®Œå…¨éš”ç¦» Gateway è¿›ç¨‹
- é¿å…åœ¨ä¸»æœºä¸Šå®‰è£…ä¾èµ–
- ä¾¿äºéƒ¨ç½²å’Œç®¡ç†
- æä¾›é¢å¤–çš„å®‰å…¨è¾¹ç•Œ

::: tip
ä½•æ—¶ä½¿ç”¨ Docker åŒ– vs å·¥å…·æ²™ç®±ï¼š
- **å·¥å…·æ²™ç®±**ï¼šå¤§å¤šæ•°åœºæ™¯ï¼Œå¹³è¡¡æ€§èƒ½å’Œå®‰å…¨
- **Docker åŒ–**ï¼šç”Ÿäº§ç¯å¢ƒã€å¤šç§Ÿæˆ·éƒ¨ç½²ã€éœ€è¦å®Œå…¨éš”ç¦»
::

### Docker å®‰è£…å‚è€ƒ

### Docker å®‰è£…å‚è€ƒ

è¯¦ç»†çš„ Docker å®‰è£…è¯´æ˜ï¼Œè¯·å‚è€ƒï¼š[éƒ¨ç½²é€‰é¡¹](../../appendix/deployment/)ã€‚

---

## è¸©å‘æé†’

### å¸¸è§é”™è¯¯

#### âŒ å¿˜è®°é…ç½® Gateway è®¤è¯

**é”™è¯¯é…ç½®**ï¼š
```json5
{
  "gateway": {
    "bind": "lan"  // å±é™©ï¼
    "auth": {}
  }
}
```

**åæœ**ï¼šä»»ä½•èƒ½è¿æ¥åˆ°ä½ å±€åŸŸç½‘çš„äººéƒ½èƒ½æ§åˆ¶ä½ çš„ AI åŠ©æ‰‹ã€‚

**æ­£ç¡®é…ç½®**ï¼š
```json5
{
  "gateway": {
    "bind": "loopback",  // æˆ–é…ç½®å¼ºè®¤è¯
    "auth": {
      "mode": "token",
      "token": "your-secure-token"
    }
  }
}
```

#### âŒ ä½¿ç”¨ `dmPolicy: "open"` ä½†å¿˜è®° `allowFrom`

**é”™è¯¯é…ç½®**ï¼š
```json5
{
  "channels": {
    "whatsapp": {
      "dmPolicy": "open"  // å±é™©ï¼
    }
  }
}
```

**åæœ**ï¼šä»»ä½•äººéƒ½èƒ½ç»™ä½ çš„ AI åŠ©æ‰‹å‘æ¶ˆæ¯ã€‚

**æ­£ç¡®é…ç½®**ï¼š
```json5
{
  "channels": {
    "whatsapp": {
      "dmPolicy": "open",
      "allowFrom": ["*"]  // å¿…é¡»æ˜¾å¼å…è®¸
    }
  }
}
```

#### âŒ å¯ç”¨ Elevated exec ä½†æ²¡æœ‰é…ç½® allowFrom

**é”™è¯¯é…ç½®**ï¼š
```json5
{
  "tools": {
    "elevated": {
      "enabled": true  // å±é™©ï¼
    }
  }
}
```

**åæœ**ï¼šä»»ä½•ç”¨æˆ·éƒ½èƒ½æ‰§è¡Œä¸»æœºå‘½ä»¤ã€‚

**æ­£ç¡®é…ç½®**ï¼š
```json5
{
  "tools": {
    "elevated": {
      "enabled": true,
      "allowFrom": {
        "discord": ["your-user-id"]  // é™åˆ¶å…è®¸çš„ç”¨æˆ·
      },
      "security": "allowlist",
      "ask": "on"  // è¦æ±‚ç¡®è®¤
    }
  }
}
```

#### âŒ æ•æ„ŸæŒ‚è½½ä½¿ç”¨è¯»å†™æ¨¡å¼

**é”™è¯¯é…ç½®**ï¼š
```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "docker": {
          "binds": [
            "/var/run/docker.sock:/var/run/docker.sock"  // å±é™©ï¼
          ]
        }
      }
    }
  }
}
```

**åæœ**ï¼šæ²™ç®±å¯ä»¥æ§åˆ¶ Docker å®ˆæŠ¤è¿›ç¨‹ã€‚

**æ­£ç¡®é…ç½®**ï¼š
```json5
{
  "agents": {
    "defaults": {
      "sandbox": {
        "docker": {
          "binds": [
            "/var/run/docker.sock:/var/run/docker.sock:ro"  // åªè¯»
          ]
        }
      }
    }
}
```

### æœ€ä½³å®è·µæ€»ç»“

| å®è·µ | åŸå›  |
|--- | ---|
| é»˜è®¤ä½¿ç”¨ `pairing` æ¨¡å¼ | å¹³è¡¡ç”¨æˆ·ä½“éªŒå’Œå®‰å…¨ |
| ç¾¤ç»„æ¶ˆæ¯ä½¿ç”¨ `requireMention` | é¿å…è¢«æ“æ§ |
| ä½¿ç”¨å·¥å…·ç™½åå•è€Œéé»‘åå• | æœ€å°æƒé™åŸåˆ™ |
| å¯ç”¨æ²™ç®±ä½†è®¾ç½® `workspaceAccess: "none"` | éš”ç¦»å·¥ä½œåŒºè®¿é—® |
| å®šæœŸè¿è¡Œå®‰å…¨å®¡è®¡ | æŒç»­å®‰å…¨ç›‘æ§ |
| å°†æ•æ„Ÿå¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶ä¸­ | é¿å…ä»£ç æ³„éœ² |

---

## æœ¬è¯¾å°ç»“

æœ¬è¯¾ä»‹ç»äº† Clawdbot çš„å®‰å…¨æ¨¡å‹å’Œæ²™ç®±éš”ç¦»åŠŸèƒ½ï¼š

**æ ¸å¿ƒè¦ç‚¹**ï¼š

1. **å®‰å…¨åˆ†å±‚**ï¼šè®¿é—®æ§åˆ¶ â†’ æƒé™æ§åˆ¶ â†’ æ²™ç®±éš”ç¦» â†’ å®¡è®¡ä¸ä¿®å¤
2. **è®¿é—®æ§åˆ¶**ï¼šGateway è®¤è¯ã€DM ç­–ç•¥ã€Group ç­–ç•¥
3. **å·¥å…·æƒé™**ï¼šallow/deny åˆ—è¡¨ã€Elevated æ¨¡å¼
4. **æ²™ç®±éš”ç¦»**ï¼šæ¨¡å¼ã€èŒƒå›´ã€å·¥ä½œåŒºè®¿é—®ã€Docker é…ç½®
5. **å®‰å…¨å®¡è®¡**ï¼š`clawdbot security audit` å‘ç°å’Œä¿®å¤é—®é¢˜

**å®‰å…¨ç¬¬ä¸€åŸåˆ™**ï¼š
- ä»æœ€å°æƒé™å¼€å§‹ï¼Œä»…åœ¨å¿…è¦æ—¶æ”¾å®½
- ä½¿ç”¨æ²™ç®±éš”ç¦»é™åˆ¶æ”»å‡»èŒƒå›´
- å®šæœŸå®¡è®¡å’Œæ›´æ–°é…ç½®
- å¯¹æ•æ„ŸåŠŸèƒ½ï¼ˆå¦‚ Elevated execï¼‰ä¿æŒè°¨æ…

---

## ä¸‹ä¸€è¯¾é¢„å‘Š

> ä¸‹ä¸€è¯¾æˆ‘ä»¬å°†å­¦ä¹  **[è¿œç¨‹ Gateway ä¸ Tailscale](../remote-gateway/)**ã€‚
>
> ä½ ä¼šå­¦åˆ°ï¼š
> - é€šè¿‡ Tailscale Serve æš´éœ² Gateway åˆ°ä½ çš„ Tailnet
> - ä½¿ç”¨ Tailscale Funnel å…¬å¼€è®¿é—®ï¼ˆéœ€è°¨æ…ï¼‰
> - SSH éš§é“å’Œåå‘ä»£ç†é…ç½®
> - è¿œç¨‹è®¿é—®çš„å®‰å…¨æœ€ä½³å®è·µ

---

## é™„å½•ï¼šæºç å‚è€ƒ

<details>
<summary><strong>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æºç ä½ç½®</strong></summary>

> æ›´æ–°æ—¶é—´ï¼š2026-01-27

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œå· |
|--- | --- | ---|
| å®‰å…¨å®¡è®¡ | [`src/security/audit.ts`](https://github.com/moltbot/moltbot/blob/main/src/security/audit.ts#L1-L910) | 1-910 |
| å®‰å…¨ä¿®å¤ | [`src/security/fix.ts`](https://github.com/moltbot/moltbot/blob/main/src/security/fix.ts#L1-L385) | 1-385 |
| æ–‡ä»¶æƒé™æ£€æŸ¥ | [`src/security/audit-fs.ts`](https://github.com/moltbot/moltbot/blob/main/src/security/audit-fs.ts) | å…¨æ–‡ä»¶ |
| Gateway é…ç½® Schema | [`src/config/zod-schema.core.ts`](https://github.com/moltbot/moltbot/blob/main/src/config/zod-schema.core.ts) | å…¨æ–‡ä»¶ |
| Agent Defaults Schema | [`src/config/zod-schema.agent-defaults.ts`](https://github.com/moltbot/moltbot/blob/main/src/config/zod-schema.agent-defaults.ts) | 1-172 |
| Sandbox Schema | [`src/config/zod-schema.agent-runtime.ts`](https://github.com/moltbot/moltbot/blob/main/src/config/zod-schema.agent-runtime.ts) | 82-511 |
| æ²™ç®±ç®¡ç† | [`src/agents/sandbox.ts`](https://github.com/moltbot/moltbot/blob/main/src/agents/sandbox.ts) | å…¨æ–‡ä»¶ |
| æ²™ç®±é…ç½®è§£æ | [`src/agents/sandbox/config.js`](https://github.com/moltbot/moltbot/blob/main/src/agents/sandbox/config.js) | å…¨æ–‡ä»¶ |
| Docker è®¾ç½® | [`src/agents/sandbox/docker.js`](https://github.com/moltbot/moltbot/blob/main/src/agents/sandbox/docker.js) | å…¨æ–‡ä»¶ |
| å®‰å…¨æ–‡æ¡£ | [`docs/gateway/security.md`](https://github.com/moltbot/moltbot/blob/main/docs/gateway/security.md) | å…¨æ–‡ä»¶ |
| æ²™ç®±æ–‡æ¡£ | [`docs/gateway/sandboxing.md`](https://github.com/moltbot/moltbot/blob/main/docs/gateway/sandboxing.md) | å…¨æ–‡ä»¶ |
| æ²™ç®± CLI | [`docs/cli/sandbox.md`](https://github.com/moltbot/moltbot/blob/main/docs/cli/sandbox.md) | å…¨æ–‡ä»¶ |

**å…³é”®é…ç½®å­—æ®µ**ï¼š

```typescript
// Sandbox é…ç½®
sandbox: {
  mode: "off" | "non-main" | "all",  // æ²™ç®±æ¨¡å¼
  workspaceAccess: "none" | "ro" | "rw",  // å·¥ä½œåŒºè®¿é—®
  scope: "session" | "agent" | "shared",  // æ²™ç®±èŒƒå›´
  docker: {
    image: string,  // Docker é•œåƒ
    binds: string[],  // ä¸»æœºæŒ‚è½½
    network: "bridge" | "none" | "custom"  // ç½‘ç»œæ¨¡å¼
  },
  browser: {
    enabled: boolean,  // æ˜¯å¦æ²™ç®±åŒ–æµè§ˆå™¨
    autoStart: boolean,  // è‡ªåŠ¨å¯åŠ¨
  },
  prune: {
    idleHours: number,  // ç©ºé—²åè‡ªåŠ¨åˆ é™¤
    maxAgeDays: number,  // æœ€å¤§ä¿ç•™å¤©æ•°
  }
}

// å·¥å…·æƒé™
tools: {
  allow: string[],  // å…è®¸çš„å·¥å…·
  deny: string[],  // æ‹’ç»çš„å·¥å…·
  elevated: {
    enabled: boolean,  // æ˜¯å¦å¯ç”¨ä¸»æœºæ‰§è¡Œ
    allowFrom: {  // æ¯ä¸ªæ¸ é“çš„å…è®¸åˆ—è¡¨
      [provider: string]: string[] | number[]
    },
    security: "deny" | "allowlist" | "full",  // å®‰å…¨ç­–ç•¥
    ask: "off" | "on-miss" | "always",  // ç¡®è®¤ç­–ç•¥
  }
}

// DM ç­–ç•¥
dmPolicy: "pairing" | "allowlist" | "open" | "disabled"

// Group ç­–ç•¥
groupPolicy: "allowlist" | "open" | "disabled"
```

**å…³é”®å¸¸é‡**ï¼š

- `DEFAULT_SANDBOX_IMAGE`: `"clawdbot-sandbox:bookworm-slim"` - é»˜è®¤æ²™ç®±é•œåƒ
- `DEFAULT_SANDBOX_COMMON_IMAGE`: é»˜è®¤é€šç”¨æ²™ç®±é•œåƒ

**å…³é”®å‡½æ•°**ï¼š

- `runSecurityAudit()`: è¿è¡Œå®‰å…¨å®¡è®¡
- `fixSecurityFootguns()`: åº”ç”¨å®‰å…¨ä¿®å¤
- `resolveSandboxConfigForAgent()`: è§£æ Agent çš„æ²™ç®±é…ç½®
- `buildSandboxCreateArgs()`: æ„å»ºæ²™ç®±å®¹å™¨åˆ›å»ºå‚æ•°

</details>
