---
title: "åå°ä»»åŠ¡: å¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»£ç† | oh-my-opencode"
sidebarTitle: "è®©å¤šä¸ª AI åŒæ—¶å¹²æ´»"
subtitle: "åå°ä»»åŠ¡: å¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»£ç† | oh-my-opencode"
description: "å­¦ä¹  oh-my-opencode åå°ä»»åŠ¡ç³»ç»Ÿçš„å¹¶è¡Œæ‰§è¡Œèƒ½åŠ›ã€‚æŒæ¡ä¸‰çº§å¹¶å‘æ§åˆ¶ã€ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ä½¿ç”¨ delegate_task å’Œ background_output å·¥å…·ã€‚"
tags:
  - "background-tasks"
  - "parallel-execution"
  - "concurrency"
prerequisite:
  - "start-sisyphus-orchestrator"
order: 80
---

# åå°å¹¶è¡Œä»»åŠ¡ï¼šåƒå›¢é˜Ÿä¸€æ ·å·¥ä½œ

## å­¦å®Œä½ èƒ½åšä»€ä¹ˆ

- âœ… å¯åŠ¨å¤šä¸ªå¹¶è¡Œåå°ä»»åŠ¡ï¼Œè®©ä¸åŒ AI ä»£ç†åŒæ—¶å·¥ä½œ
- âœ… é…ç½®å¹¶å‘é™åˆ¶ï¼Œé¿å… API é™æµå’Œæˆæœ¬å¤±æ§
- âœ… è·å–åå°ä»»åŠ¡ç»“æœï¼Œæ— éœ€ç­‰å¾…å®Œæˆ
- âœ… å–æ¶ˆä»»åŠ¡ï¼Œé‡Šæ”¾èµ„æº

## ä½ ç°åœ¨çš„å›°å¢ƒ

**åªæœ‰ä¸€ä¸ªäººåœ¨åšäº‹ï¼Ÿ**

æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š
- ä½ éœ€è¦è®© **Explore** ä»£ç†æŸ¥æ‰¾ä»£ç åº“ä¸­çš„è®¤è¯å®ç°
- åŒæ—¶è®© **Librarian** ä»£ç†ç ”ç©¶æœ€ä½³å®è·µ
- å†è®© **Oracle** ä»£ç†å®¡æŸ¥æ¶æ„è®¾è®¡

å¦‚æœæŒ‰é¡ºåºæ‰§è¡Œï¼Œæ€»è€—æ—¶ = 10 åˆ†é’Ÿ + 15 åˆ†é’Ÿ + 8 åˆ†é’Ÿ = **33 åˆ†é’Ÿ**

ä½†å¦‚æœèƒ½å¹¶è¡Œå‘¢ï¼Ÿ3 ä¸ªä»£ç†åŒæ—¶å·¥ä½œï¼Œæ€»è€—æ—¶ = **max(10, 15, 8) = 15 åˆ†é’Ÿ**ï¼ŒèŠ‚çœäº† **54%** çš„æ—¶é—´ã€‚

**é—®é¢˜**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenCode ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªä¼šè¯ã€‚è¦å®ç°å¹¶è¡Œï¼Œä½ éœ€è¦æ‰‹åŠ¨ç®¡ç†å¤šä¸ªçª—å£æˆ–ç­‰å¾…ä»»åŠ¡å®Œæˆã€‚

**è§£å†³**ï¼šoh-my-opencode çš„åå°ä»»åŠ¡ç³»ç»Ÿå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ª AI ä»£ç†ï¼Œå¹¶åœ¨åå°è¿½è¸ªå®ƒä»¬çš„è¿›åº¦ï¼Œè®©ä½ å¯ä»¥ç»§ç»­å…¶ä»–å·¥ä½œã€‚

## ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸€æ‹›

ä½¿ç”¨åå°ä»»åŠ¡ç³»ç»Ÿå¯ä»¥æå‡æ•ˆç‡çš„åœºæ™¯ï¼š

| åœºæ™¯ | ç¤ºä¾‹ | ä»·å€¼ |
|-----|------|------|
| **å¹¶è¡Œç ”ç©¶** | Explore æŸ¥æ‰¾å®ç° + Librarian æŸ¥æ–‡æ¡£ | 3 å€é€Ÿåº¦å®Œæˆç ”ç©¶ |
| **å¤šä¸“å®¶å®¡æŸ¥** | Oracle å®¡æŸ¥æ¶æ„ + Momus éªŒè¯è®¡åˆ’ | å¿«é€Ÿè·å¾—å¤šè§’åº¦åé¦ˆ |
| **å¼‚æ­¥ä»»åŠ¡** | æäº¤ Git commit æ—¶åŒæ—¶è¿›è¡Œä»£ç å®¡æŸ¥ | ä¸é˜»å¡ä¸»æµç¨‹ |
| **èµ„æºå—é™** | é™åˆ¶å¹¶å‘æ•°é¿å… API é™æµ | æ§åˆ¶æˆæœ¬å’Œç¨³å®šæ€§ |

::: tip Ultrawork æ¨¡å¼
åœ¨æç¤ºè¯ä¸­åŠ å…¥ `ultrawork` æˆ– `ulw`ï¼Œä¼šè‡ªåŠ¨æ¿€æ´»æœ€å¤§æ€§èƒ½æ¨¡å¼ï¼ŒåŒ…æ‹¬æ‰€æœ‰ä¸“ä¸šä»£ç†å’Œå¹¶è¡Œåå°ä»»åŠ¡ã€‚æ— éœ€æ‰‹åŠ¨é…ç½®ã€‚
:::

## ğŸ’ å¼€å§‹å‰çš„å‡†å¤‡

::: warning å‰ç½®æ¡ä»¶

å¼€å§‹æœ¬æ•™ç¨‹å‰ï¼Œè¯·ç¡®ä¿ï¼š
1. å·²å®‰è£… oh-my-opencodeï¼ˆè§ [å®‰è£…æ•™ç¨‹](../../start/installation/)ï¼‰
2. å·²å®ŒæˆåŸºç¡€é…ç½®ï¼Œè‡³å°‘æœ‰ä¸€ä¸ª AI Provider å¯ç”¨
3. äº†è§£ Sisyphus ç¼–æ’å™¨çš„åŸºç¡€ç”¨æ³•ï¼ˆè§ [Sisyphus æ•™ç¨‹](../sisyphus-orchestrator/)ï¼‰

:::

## æ ¸å¿ƒæ€è·¯

åå°ä»»åŠ¡ç³»ç»Ÿçš„å·¥ä½œåŸç†å¯ä»¥æ¦‚æ‹¬ä¸ºä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š

### 1. å¹¶è¡Œæ‰§è¡Œ

åå°ä»»åŠ¡ç³»ç»Ÿå…è®¸ä½ åŒæ—¶å¯åŠ¨å¤šä¸ª AI ä»£ç†ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡åœ¨ç‹¬ç«‹çš„ä¼šè¯ä¸­è¿è¡Œã€‚è¿™æ„å‘³ç€ï¼š

- **Explore** æŸ¥æ‰¾ä»£ç 
- **Librarian** æŸ¥é˜…æ–‡æ¡£
- **Oracle** å®¡æŸ¥è®¾è®¡

ä¸‰ä¸ªä»»åŠ¡å¹¶è¡Œè¿è¡Œï¼Œæ€»è€—æ—¶ç­‰äºæœ€æ…¢çš„é‚£ä¸ªä»»åŠ¡ã€‚

### 2. å¹¶å‘æ§åˆ¶

ä¸ºé¿å…åŒæ—¶å¯åŠ¨å¤ªå¤šä»»åŠ¡å¯¼è‡´ API é™æµæˆ–æˆæœ¬å¤±æ§ï¼Œç³»ç»Ÿæä¾›äº†ä¸‰çº§å¹¶å‘é™åˆ¶ï¼š

```
ä¼˜å…ˆçº§ï¼šModel > Provider > Default

ç¤ºä¾‹é…ç½®ï¼š
modelConcurrency:     claude-opus-4-5 â†’ 2
providerConcurrency:  anthropic â†’ 3
defaultConcurrency:   æ‰€æœ‰ â†’ 5
```

**è§„åˆ™**ï¼š
- å¦‚æœæŒ‡å®šäº† model çº§é™åˆ¶ï¼Œä½¿ç”¨è¯¥é™åˆ¶
- å¦åˆ™ï¼Œå¦‚æœæŒ‡å®šäº† provider çº§é™åˆ¶ï¼Œä½¿ç”¨è¯¥é™åˆ¶
- å¦åˆ™ï¼Œä½¿ç”¨é»˜è®¤é™åˆ¶ï¼ˆé»˜è®¤å€¼ 5ï¼‰

### 3. è½®è¯¢æœºåˆ¶

ç³»ç»Ÿæ¯ 2 ç§’æ£€æŸ¥ä¸€æ¬¡ä»»åŠ¡çŠ¶æ€ï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆã€‚å®Œæˆæ¡ä»¶ï¼š

- **ä¼šè¯ idle**ï¼ˆsession.idle äº‹ä»¶ï¼‰
- **ç¨³å®šæ€§æ£€æµ‹**ï¼šè¿ç»­ 3 æ¬¡è½®è¯¢ï¼Œæ¶ˆæ¯æ•°ä¸å˜
- **TODO åˆ—è¡¨ä¸ºç©º**ï¼šæ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆ

## è·Ÿæˆ‘åš

### ç¬¬ 1 æ­¥ï¼šå¯åŠ¨åå°ä»»åŠ¡

ä½¿ç”¨ `delegate_task` å·¥å…·å¯åŠ¨åå°ä»»åŠ¡ï¼š

```markdown
å¯åŠ¨å¹¶è¡Œåå°ä»»åŠ¡ï¼š

1. Explore æŸ¥æ‰¾è®¤è¯å®ç°
2. Librarian ç ”ç©¶æœ€ä½³å®è·µ
3. Oracle å®¡æŸ¥æ¶æ„è®¾è®¡

å¹¶è¡Œæ‰§è¡Œï¼š
```

**ä¸ºä»€ä¹ˆ**
è¿™æ˜¯æ¼”ç¤ºåå°ä»»åŠ¡æœ€ç»å…¸çš„ä½¿ç”¨åœºæ™¯ã€‚3 ä¸ªä»»åŠ¡å¯ä»¥åŒæ—¶è¿›è¡Œï¼Œå¤§å¹…èŠ‚çœæ—¶é—´ã€‚

**ä½ åº”è¯¥çœ‹åˆ°**
ç³»ç»Ÿä¼šè¿”å› 3 ä¸ªä»»åŠ¡ IDï¼š

```
Background task launched successfully.

Task ID: bg_abc123
Session ID: sess_xyz789
Description: Explore: æŸ¥æ‰¾è®¤è¯å®ç°
Agent: explore
Status: pending
...

Background task launched successfully.

Task ID: bg_def456
Session ID: sess_uvwx012
Description: Librarian: ç ”ç©¶æœ€ä½³å®è·µ
Agent: librarian
Status: pending
...
```

::: info ä»»åŠ¡çŠ¶æ€è¯´æ˜
- **pending**ï¼šæ’é˜Ÿç­‰å¾…å¹¶å‘æ§½
- **running**ï¼šæ­£åœ¨æ‰§è¡Œ
- **completed**ï¼šå·²å®Œæˆ
- **error**ï¼šå‡ºé”™
- **cancelled**ï¼šå·²å–æ¶ˆ
:::

### ç¬¬ 2 æ­¥ï¼šæ£€æŸ¥ä»»åŠ¡çŠ¶æ€

ä½¿ç”¨ `background_output` å·¥å…·æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ï¼š

```markdown
æŸ¥çœ‹ bg_abc123 çš„çŠ¶æ€ï¼š
```

**ä¸ºä»€ä¹ˆ**
äº†è§£ä»»åŠ¡æ˜¯å¦å®Œæˆæˆ–ä»åœ¨è¿è¡Œã€‚é»˜è®¤ä¸ç­‰å¾…ï¼Œç«‹å³è¿”å›çŠ¶æ€ã€‚

**ä½ åº”è¯¥çœ‹åˆ°**
å¦‚æœä»»åŠ¡ä»åœ¨è¿è¡Œï¼š

```
## Task Status

| Field | Value |
|-------|-------|
| Task ID | `bg_abc123` |
| Description | Explore: æŸ¥æ‰¾è®¤è¯å®ç° |
| Agent | explore |
| Status | **running** |
| Duration | 2m 15s |
| Session ID | `sess_xyz789` |

> **Note**: No need to wait explicitly - system will notify you when this task completes.

## Original Prompt

æŸ¥æ‰¾ src/auth ç›®å½•ä¸‹çš„è®¤è¯å®ç°ï¼ŒåŒ…æ‹¬ç™»å½•ã€æ³¨å†Œã€Token ç®¡ç†ç­‰
```

å¦‚æœä»»åŠ¡å·²å®Œæˆï¼š

```
Task Result

Task ID: bg_abc123
Description: Explore: æŸ¥æ‰¾è®¤è¯å®ç°
Duration: 5m 32s
Session ID: sess_xyz789

---

æ‰¾åˆ°äº† 3 ä¸ªè®¤è¯å®ç°ï¼š
1. `src/auth/login.ts` - JWT è®¤è¯
2. `src/auth/register.ts` - ç”¨æˆ·æ³¨å†Œ
3. `src/auth/token.ts` - Token åˆ·æ–°
...
```

### ç¬¬ 3 æ­¥ï¼šé…ç½®å¹¶å‘æ§åˆ¶

ç¼–è¾‘ `~/.config/opencode/oh-my-opencode.json`ï¼š

```jsonc
{
  "$schema": "https://code-yeongyu.github.io/oh-my-opencode/schema.json",

  "background_task": {
    // Provider çº§å¹¶å‘é™åˆ¶ï¼ˆæ¨èè®¾ç½®ï¼‰
    "providerConcurrency": {
      "anthropic": 3,     // Anthropic æ¨¡å‹æœ€å¤šåŒæ—¶ 3 ä¸ª
      "openai": 2,         // OpenAI æ¨¡å‹æœ€å¤šåŒæ—¶ 2 ä¸ª
      "google": 2          // Google æ¨¡å‹æœ€å¤šåŒæ—¶ 2 ä¸ª
    },

    // Model çº§å¹¶å‘é™åˆ¶ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
    "modelConcurrency": {
      "claude-opus-4-5": 2,    // Opus 4.5 æœ€å¤šåŒæ—¶ 2 ä¸ª
      "gpt-5.2": 2              // GPT 5.2 æœ€å¤šåŒæ—¶ 2 ä¸ª
    },

    // é»˜è®¤å¹¶å‘é™åˆ¶ï¼ˆå½“ä¸Šé¢éƒ½æ²¡é…ç½®æ—¶ä½¿ç”¨ï¼‰
    "defaultConcurrency": 3
  }
}
```

**ä¸ºä»€ä¹ˆ**
å¹¶å‘æ§åˆ¶æ˜¯é¿å…æˆæœ¬å¤±æ§çš„å…³é”®ã€‚å¦‚æœä½ æ²¡æœ‰è®¾ç½®é™åˆ¶ï¼ŒåŒæ—¶å¯åŠ¨ 10 ä¸ª Opus 4.5 ä»»åŠ¡ï¼Œå¯èƒ½ä¼šç¬é—´æ¶ˆè€—å¤§é‡ API é…é¢ã€‚

::: tip æ¨èè®¾ç½®
å¯¹äºå¤§å¤šæ•°åœºæ™¯ï¼Œæ¨èè®¾ç½®ï¼š
- `providerConcurrency.anthropic: 3`
- `providerConcurrency.openai: 2`
- `defaultConcurrency: 5`
:::

**ä½ åº”è¯¥çœ‹åˆ°**
é…ç½®ç”Ÿæ•ˆåï¼Œå¯åŠ¨åå°ä»»åŠ¡æ—¶ï¼š
- å¦‚æœå·²è¾¾åˆ°å¹¶å‘é™åˆ¶ï¼Œä»»åŠ¡ä¼šè¿›å…¥ **pending** çŠ¶æ€æ’é˜Ÿ
- ä¸€æ—¦æœ‰ä»»åŠ¡å®Œæˆï¼Œæ’é˜Ÿçš„ä»»åŠ¡ä¼šè‡ªåŠ¨å¯åŠ¨

### ç¬¬ 4 æ­¥ï¼šå–æ¶ˆä»»åŠ¡

ä½¿ç”¨ `background_cancel` å·¥å…·å–æ¶ˆä»»åŠ¡ï¼š

```markdown
å–æ¶ˆæ‰€æœ‰åå°ä»»åŠ¡ï¼š
```

**ä¸ºä»€ä¹ˆ**
æœ‰æ—¶ä»»åŠ¡å¡ä½æˆ–ä¸å†éœ€è¦ï¼Œå¯ä»¥ä¸»åŠ¨å–æ¶ˆé‡Šæ”¾èµ„æºã€‚

**ä½ åº”è¯¥çœ‹åˆ°**

```
Cancelled 3 background task(s):

| Task ID | Description | Status | Session ID |
|---------|-------------|--------|------------|
| `bg_abc123` | Explore: æŸ¥æ‰¾è®¤è¯å®ç° | running | `sess_xyz789` |
| `bg_def456` | Librarian: ç ”ç©¶æœ€ä½³å®è·µ | running | `sess_uvwx012` |
| `bg_ghi789` | Oracle: å®¡æŸ¥æ¶æ„è®¾è®¡ | pending | (not started) |

## Continue Instructions

To continue a cancelled task, use:

    delegate_task(session_id="<session_id>", prompt="Continue: <your follow-up>")

Continuable sessions:
- `sess_xyz789` (Explore: æŸ¥æ‰¾è®¤è¯å®ç°)
- `sess_uvwx012` (Librarian: ç ”ç©¶æœ€ä½³å®è·µ)
```

## æ£€æŸ¥ç‚¹ âœ…

ç¡®è®¤ä½ ç†è§£äº†ä»¥ä¸‹è¦ç‚¹ï¼š

- [ ] èƒ½å¯åŠ¨å¤šä¸ªå¹¶è¡Œåå°ä»»åŠ¡
- [ ] ç†è§£ä»»åŠ¡çŠ¶æ€ï¼ˆpendingã€runningã€completedï¼‰
- [ ] é…ç½®äº†åˆç†çš„å¹¶å‘é™åˆ¶
- [ ] èƒ½æŸ¥çœ‹å’Œè·å–ä»»åŠ¡ç»“æœ
- [ ] èƒ½å–æ¶ˆä¸éœ€è¦çš„ä»»åŠ¡

## è¸©å‘æé†’

### å‘ 1ï¼šå¿˜è®°é…ç½®å¹¶å‘é™åˆ¶

**ç—‡çŠ¶**ï¼šå¯åŠ¨å¤ªå¤šä»»åŠ¡ï¼ŒAPI é…é¢ç¬é—´è€—å°½ï¼Œæˆ–è§¦ Rate Limitã€‚

**è§£å†³**ï¼šåœ¨ `oh-my-opencode.json` ä¸­é…ç½® `providerConcurrency` æˆ– `defaultConcurrency`ã€‚

### å‘ 2ï¼šè½®è¯¢æ£€æŸ¥ç»“æœå¤ªé¢‘ç¹

**ç—‡çŠ¶**ï¼šæ¯éš”å‡ ç§’å°±è°ƒç”¨ `background_output` æ£€æŸ¥ä»»åŠ¡çŠ¶æ€ï¼Œå¢åŠ ä¸å¿…è¦çš„å¼€é”€ã€‚

**è§£å†³**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨é€šçŸ¥ä½ ä»»åŠ¡å®Œæˆã€‚åªæœ‰åœ¨ç¡®å®éœ€è¦ä¸­é—´ç»“æœæ—¶æ‰æ‰‹åŠ¨æ£€æŸ¥ã€‚

### å‘ 3ï¼šä»»åŠ¡è¶…æ—¶

**ç—‡çŠ¶**ï¼šä»»åŠ¡è¿è¡Œè¶…è¿‡ 30 åˆ†é’Ÿåè¢«è‡ªåŠ¨å–æ¶ˆã€‚

**åŸå› **ï¼šåå°ä»»åŠ¡æœ‰ 30 åˆ†é’Ÿçš„ TTLï¼ˆè¶…æ—¶æ—¶é—´ï¼‰ã€‚

**è§£å†³**ï¼šå¦‚æœéœ€è¦é•¿æ—¶é—´ä»»åŠ¡ï¼Œè€ƒè™‘æ‹†åˆ†ä¸ºå¤šä¸ªå­ä»»åŠ¡ï¼Œæˆ–ä½¿ç”¨ `delegate_task(background=false)` å‰å°è¿è¡Œã€‚

### å‘ 4ï¼šPending ä»»åŠ¡ä¸€ç›´ä¸å¯åŠ¨

**ç—‡çŠ¶**ï¼šä»»åŠ¡çŠ¶æ€ä¸€ç›´æ˜¯ `pending`ï¼Œä¸è¿›å…¥ `running`ã€‚

**åŸå› **ï¼šå¹¶å‘é™åˆ¶å·²æ»¡ï¼Œæ²¡æœ‰å¯ç”¨æ§½ã€‚

**è§£å†³**ï¼š
- ç­‰å¾…ç°æœ‰ä»»åŠ¡å®Œæˆ
- å¢åŠ å¹¶å‘é™åˆ¶é…ç½®
- å–æ¶ˆä¸å¿…è¦çš„ä»»åŠ¡é‡Šæ”¾æ§½

## æœ¬è¯¾å°ç»“

åå°ä»»åŠ¡ç³»ç»Ÿè®©ä½ å¯ä»¥åƒçœŸå®å›¢é˜Ÿä¸€æ ·å·¥ä½œï¼Œå¤šä¸ª AI ä»£ç†å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼š

1. **å¯åŠ¨å¹¶è¡Œä»»åŠ¡**ï¼šä½¿ç”¨ `delegate_task` å·¥å…·
2. **æ§åˆ¶å¹¶å‘**ï¼šé…ç½® `providerConcurrency`ã€`modelConcurrency`ã€`defaultConcurrency`
3. **è·å–ç»“æœ**ï¼šä½¿ç”¨ `background_output` å·¥å…·ï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨é€šçŸ¥ï¼‰
4. **å–æ¶ˆä»»åŠ¡**ï¼šä½¿ç”¨ `background_cancel` å·¥å…·

**æ ¸å¿ƒè§„åˆ™**ï¼š
- æ¯ 2 ç§’è½®è¯¢ä¸€æ¬¡ä»»åŠ¡çŠ¶æ€
- è¿ç»­ 3 æ¬¡ç¨³å®šæˆ– idle åˆ™ä»»åŠ¡å®Œæˆ
- ä»»åŠ¡ 30 åˆ†é’Ÿåè‡ªåŠ¨è¶…æ—¶
- ä¼˜å…ˆçº§ï¼šmodelConcurrency > providerConcurrency > defaultConcurrency

## ä¸‹ä¸€è¯¾é¢„å‘Š

> ä¸‹ä¸€è¯¾æˆ‘ä»¬å­¦ä¹  **[LSP ä¸ AST-Grepï¼šä»£ç é‡æ„åˆ©å™¨](../lsp-ast-tools/)**ã€‚
>
> ä½ ä¼šå­¦åˆ°ï¼š
> - å¦‚ä½•ä½¿ç”¨ LSP å·¥å…·è¿›è¡Œä»£ç å¯¼èˆªå’Œé‡æ„
> - å¦‚ä½•ä½¿ç”¨ AST-Grep è¿›è¡Œç²¾ç¡®çš„æ¨¡å¼æœç´¢å’Œæ›¿æ¢
> - LSP å’Œ AST-Grep çš„ç»“åˆä½¿ç”¨æœ€ä½³å®è·µ

---

## é™„å½•ï¼šæºç å‚è€ƒ

<details>
<summary><strong>ç‚¹å‡»å±•å¼€æŸ¥çœ‹æºç ä½ç½®</strong></summary>

> æ›´æ–°æ—¶é—´ï¼š2026-01-26

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œå· |
|------|---------|------|
| åå°ä»»åŠ¡ç®¡ç†å™¨ | [`src/features/background-agent/manager.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/main/src/features/background-agent/manager.ts) | 1-1378 |
| å¹¶å‘æ§åˆ¶ | [`src/features/background-agent/concurrency.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/main/src/features/background-agent/concurrency.ts) | 1-138 |
| delegate_task å·¥å…· | [`src/tools/background-task/tools.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/main/src/tools/background-task/tools.ts) | 51-119 |
| background_output å·¥å…· | [`src/tools/background-task/tools.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/main/src/tools/background-task/tools.ts) | 320-384 |
| background_cancel å·¥å…· | [`src/tools/background-task/tools.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/main/src/tools/background-task/tools.ts) | 386-514 |

**å…³é”®å¸¸é‡**ï¼š
- `TASK_TTL_MS = 30 * 60 * 1000`ï¼šä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆ30 åˆ†é’Ÿï¼‰
- `MIN_STABILITY_TIME_MS = 10 * 1000`ï¼šç¨³å®šæ€§æ£€æµ‹å¯åŠ¨æ—¶é—´ï¼ˆ10 ç§’ï¼‰
- `DEFAULT_STALE_TIMEOUT_MS = 180_000`ï¼šé»˜è®¤è¶…æ—¶æ—¶é—´ï¼ˆ3 åˆ†é’Ÿï¼‰
- `MIN_IDLE_TIME_MS = 5000`ï¼šå¿½ç•¥æ—©æœŸ idle çš„æœ€å°æ—¶é—´ï¼ˆ5 ç§’ï¼‰

**å…³é”®ç±»**ï¼š
- `BackgroundManager`ï¼šåå°ä»»åŠ¡ç®¡ç†å™¨ï¼Œè´Ÿè´£å¯åŠ¨ã€è¿½è¸ªã€è½®è¯¢ã€å®Œæˆä»»åŠ¡
- `ConcurrencyManager`ï¼šå¹¶å‘æ§åˆ¶ç®¡ç†å™¨ï¼Œå®ç°ä¸‰çº§ä¼˜å…ˆçº§ï¼ˆmodel > provider > defaultï¼‰

**å…³é”®å‡½æ•°**ï¼š
- `BackgroundManager.launch()`ï¼šå¯åŠ¨åå°ä»»åŠ¡
- `BackgroundManager.pollRunningTasks()`ï¼šæ¯ 2 ç§’è½®è¯¢ä»»åŠ¡çŠ¶æ€ï¼ˆç¬¬ 1182 è¡Œï¼‰
- `BackgroundManager.tryCompleteTask()`ï¼šå®‰å…¨å®Œæˆä»»åŠ¡ï¼Œé˜²æ­¢ç«æ€æ¡ä»¶ï¼ˆç¬¬ 909 è¡Œï¼‰
- `ConcurrencyManager.getConcurrencyLimit()`ï¼šè·å–å¹¶å‘é™åˆ¶ï¼ˆç¬¬ 24 è¡Œï¼‰
- `ConcurrencyManager.acquire()` / `ConcurrencyManager.release()`ï¼šè·å–/é‡Šæ”¾å¹¶å‘æ§½ï¼ˆç¬¬ 41ã€71 è¡Œï¼‰

</details>
